/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql exec
import java io serializable
import java util arraylist
import java util hashmap
import java util list
import java util map
import org apache hadoop conf configuration
import org apache hadoop hive conf hiveconf
import org apache hadoop hive ql exec persistence abstractmapjoinkey
import org apache hadoop hive ql exec persistence rowcontainer
import org apache hadoop hive ql metadata hiveexception
import org apache hadoop hive ql plan mapjoindesc
import org apache hadoop hive ql plan api operatortype
import org apache hadoop hive serde2 objectinspector objectinspector
import org apache hadoop hive serde2 objectinspector objectinspectorfactory
import org apache hadoop hive serde2 objectinspector structfield
import org apache hadoop hive serde2 objectinspector structobjectinspector
public abstract class abstractmapjoinoperator <t extends mapjoindesc> extends commonjoinoperator<t> implements
serializable
private static final long serialversionuid   1l
/**
* the expressions for join inputs's join keys.
*/
protected transient map<byte  list<exprnodeevaluator>> joinkeys
/**
* the objectinspectors for the join inputs's join keys.
*/
protected transient map<byte  list<objectinspector>> joinkeysobjectinspectors
/**
* the standard objectinspectors for the join inputs's join keys.
*/
protected transient map<byte  list<objectinspector>> joinkeysstandardobjectinspectors
protected transient int posbigtable    1     one of the tables that is not in memory
transient int mapjoinrowskey     rows for a given key
protected transient rowcontainer<arraylist<object>> emptylist   null
transient int nummaprowsread
private static final transient string fatal_err_msg
null     counter value 0 means no error
transient boolean firstrow
public abstractmapjoinoperator
public abstractmapjoinoperator abstractmapjoinoperator<? extends mapjoindesc> mjop
super  commonjoinoperator mjop
@override
protected void initializeop configuration hconf  throws hiveexception
super initializeop hconf
nummaprowsread   0
firstrow   true
joinkeys   new hashmap<byte  list<exprnodeevaluator>>
joinutil populatejoinkeyvalue joinkeys  conf getkeys   order notskipbigtable
joinkeysobjectinspectors   joinutil getobjectinspectorsfromevaluators joinkeys
inputobjinspectors notskipbigtable
joinkeysstandardobjectinspectors   joinutil getstandardobjectinspectors
joinkeysobjectinspectors notskipbigtable
// all other tables are small, and are cached in the hash table
posbigtable   conf getposbigtable
emptylist   new rowcontainer<arraylist<object>> 1  hconf  reporter
rowcontainer bigposrc   joinutil getrowcontainer hconf
rowcontainerstandardobjectinspectors get  byte  posbigtable
order  joincachesize spilltabledesc  conf
hasfilter posbigtable   reporter
storage put  byte  posbigtable  bigposrc
mapjoinrowskey   hiveconf getintvar hconf
hiveconf confvars hivemapjoinrowsize
list<? extends structfield> structfields     structobjectinspector  outputobjinspector
getallstructfieldrefs
if  conf getoutputcolumnnames   size   < structfields size
list<objectinspector> structfieldobjectinspectors   new arraylist<objectinspector>
for  byte alias   order
int sz   conf getexprs   get alias  size
list<integer> retained   conf getretainlist   get alias
for  int i   0  i < sz  i
int pos   retained get i
structfieldobjectinspectors add structfields get pos
getfieldobjectinspector
outputobjinspector   objectinspectorfactory
getstandardstructobjectinspector conf getoutputcolumnnames
structfieldobjectinspectors
initializechildren hconf
@override
protected void fatalerrormessage stringbuilder errmsg  long countercode
errmsg append     getoperatorid         id
fatal_err_msg
@override
public operatortype gettype
return operatortype mapjoin
// returns true if there are elements in key list and any of them is null
protected boolean hasanynulls arraylist<object> key
if  key    null    key size   > 0
for  int i   0  i < key size    i
if  key get i     null     nullsafes    null     nullsafes
return true
return false
// returns true if there are elements in key list and any of them is null
protected boolean hasanynulls object key
if  key    null    key length> 0
for  int i   0  i < key length  i
if  key    null     nullsafes    null     nullsafes
return true
return false
// returns true if there are elements in key list and any of them is null
protected boolean hasanynulls abstractmapjoinkey key
return key hasanynulls nullsafes