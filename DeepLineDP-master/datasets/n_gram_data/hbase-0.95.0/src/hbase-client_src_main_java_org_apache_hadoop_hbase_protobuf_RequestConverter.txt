/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase protobuf
import java io ioexception
import java util list
import org apache hadoop classification interfaceaudience
import org apache hadoop hbase cellscannable
import org apache hadoop hbase hcolumndescriptor
import org apache hadoop hbase hregioninfo
import org apache hadoop hbase htabledescriptor
import org apache hadoop hbase servername
import org apache hadoop hbase client action
import org apache hadoop hbase client append
import org apache hadoop hbase client delete
import org apache hadoop hbase client get
import org apache hadoop hbase client increment
import org apache hadoop hbase client mutation
import org apache hadoop hbase client put
import org apache hadoop hbase client row
import org apache hadoop hbase client rowmutations
import org apache hadoop hbase client scan
import org apache hadoop hbase exceptions deserializationexception
import org apache hadoop hbase exceptions donotretryioexception
import org apache hadoop hbase filter bytearraycomparable
import org apache hadoop hbase protobuf generated accesscontrolprotos
import org apache hadoop hbase protobuf generated adminprotos closeregionrequest
import org apache hadoop hbase protobuf generated adminprotos compactregionrequest
import org apache hadoop hbase protobuf generated adminprotos flushregionrequest
import org apache hadoop hbase protobuf generated adminprotos getonlineregionrequest
import org apache hadoop hbase protobuf generated adminprotos getregioninforequest
import org apache hadoop hbase protobuf generated adminprotos getserverinforequest
import org apache hadoop hbase protobuf generated adminprotos getstorefilerequest
import org apache hadoop hbase protobuf generated adminprotos mergeregionsrequest
import org apache hadoop hbase protobuf generated adminprotos openregionrequest
import org apache hadoop hbase protobuf generated adminprotos openregionrequest regionopeninfo
import org apache hadoop hbase protobuf generated adminprotos rollwalwriterrequest
import org apache hadoop hbase protobuf generated adminprotos splitregionrequest
import org apache hadoop hbase protobuf generated adminprotos stopserverrequest
import org apache hadoop hbase protobuf generated clientprotos
import org apache hadoop hbase protobuf generated clientprotos bulkloadhfilerequest
import org apache hadoop hbase protobuf generated clientprotos bulkloadhfilerequest familypath
import org apache hadoop hbase protobuf generated clientprotos column
import org apache hadoop hbase protobuf generated clientprotos condition
import org apache hadoop hbase protobuf generated clientprotos getrequest
import org apache hadoop hbase protobuf generated clientprotos multiaction
import org apache hadoop hbase protobuf generated clientprotos multigetrequest
import org apache hadoop hbase protobuf generated clientprotos multirequest
import org apache hadoop hbase protobuf generated clientprotos mutaterequest
import org apache hadoop hbase protobuf generated clientprotos mutationproto
import org apache hadoop hbase protobuf generated clientprotos mutationproto columnvalue
import org apache hadoop hbase protobuf generated clientprotos mutationproto columnvalue qualifiervalue
import org apache hadoop hbase protobuf generated clientprotos mutationproto mutationtype
import org apache hadoop hbase protobuf generated clientprotos scanrequest
import org apache hadoop hbase protobuf generated hbaseprotos comparetype
import org apache hadoop hbase protobuf generated hbaseprotos regionspecifier
import org apache hadoop hbase protobuf generated hbaseprotos regionspecifier regionspecifiertype
import org apache hadoop hbase protobuf generated masteradminprotos addcolumnrequest
import org apache hadoop hbase protobuf generated masteradminprotos assignregionrequest
import org apache hadoop hbase protobuf generated masteradminprotos balancerequest
import org apache hadoop hbase protobuf generated masteradminprotos catalogscanrequest
import org apache hadoop hbase protobuf generated masteradminprotos createtablerequest
import org apache hadoop hbase protobuf generated masteradminprotos deletecolumnrequest
import org apache hadoop hbase protobuf generated masteradminprotos deletetablerequest
import org apache hadoop hbase protobuf generated masteradminprotos disabletablerequest
import org apache hadoop hbase protobuf generated masteradminprotos dispatchmergingregionsrequest
import org apache hadoop hbase protobuf generated masteradminprotos enablecatalogjanitorrequest
import org apache hadoop hbase protobuf generated masteradminprotos enabletablerequest
import org apache hadoop hbase protobuf generated masteradminprotos iscatalogjanitorenabledrequest
import org apache hadoop hbase protobuf generated masteradminprotos modifycolumnrequest
import org apache hadoop hbase protobuf generated masteradminprotos modifytablerequest
import org apache hadoop hbase protobuf generated masteradminprotos moveregionrequest
import org apache hadoop hbase protobuf generated masteradminprotos offlineregionrequest
import org apache hadoop hbase protobuf generated masteradminprotos setbalancerrunningrequest
import org apache hadoop hbase protobuf generated masteradminprotos unassignregionrequest
import org apache hadoop hbase protobuf generated mastermonitorprotos getclusterstatusrequest
import org apache hadoop hbase protobuf generated mastermonitorprotos getschemaalterstatusrequest
import org apache hadoop hbase protobuf generated mastermonitorprotos gettabledescriptorsrequest
import org apache hadoop hbase protobuf generated masterprotos ismasterrunningrequest
import org apache hadoop hbase protobuf generated regionserverstatusprotos getlastflushedsequenceidrequest
import org apache hadoop hbase util bytes
import org apache hadoop hbase util pair
import com google protobuf bytestring
/**
* helper utility to build protocol buffer requests,
* or build components for protocol buffer requests.
*/
@interfaceaudience private
public final class requestconverter
private requestconverter
// start utilities for client
/**
* create a new protocol buffer getrequest to get a row, all columns in a family.
* if there is no such row, return the closest row before it.
*
* @param regionname the name of the region to get
* @param row the row to get
* @param family the column family to get
* should return the immediate row before
* @return a protocol buffer getreuqest
*/
public static getrequest buildgetroworbeforerequest
final byte regionname  final byte row  final byte family
getrequest builder builder   getrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setclosestrowbefore true
builder setregion region
column builder columnbuilder   column newbuilder
columnbuilder setfamily bytestring copyfrom family
clientprotos get builder getbuilder
clientprotos get newbuilder
getbuilder setrow bytestring copyfrom row
getbuilder addcolumn columnbuilder build
builder setget getbuilder build
return builder build
/**
* create a protocol buffer getrequest for a client get
*
* @param regionname the name of the region to get
* @param get the client get
* @return a protocol buffer getreuqest
*/
public static getrequest buildgetrequest final byte regionname
final get get  throws ioexception
return buildgetrequest regionname  get  false
/**
* create a protocol buffer getrequest for a client get
*
* @param regionname the name of the region to get
* @param get the client get
* @param existenceonly indicate if check row existence only
* @return a protocol buffer getrequest
*/
public static getrequest buildgetrequest final byte regionname
final get get  final boolean existenceonly  throws ioexception
getrequest builder builder   getrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setexistenceonly existenceonly
builder setregion region
builder setget protobufutil toget get
return builder build
/**
* create a protocol buffer multigetrequest for client gets all gets are going to be run against
* the same region.
* @param regionname the name of the region to get from
* @param gets the client gets
* @param existenceonly indicate if check rows existence only
* @return a protocol buffer multigetrequest
*/
public static multigetrequest buildmultigetrequest final byte regionname  final list<get> gets
final boolean existenceonly  final boolean closestrowbefore  throws ioexception
multigetrequest builder builder   multigetrequest newbuilder
regionspecifier region   buildregionspecifier regionspecifiertype region_name  regionname
builder setexistenceonly existenceonly
builder setclosestrowbefore closestrowbefore
builder setregion region
for  get get   gets
builder addget protobufutil toget get
return builder build
/**
* create a protocol buffer mutaterequest for a client increment
*
* @param regionname
* @param row
* @param family
* @param qualifier
* @param amount
* @param writetowal
* @return a mutate request
*/
public static mutaterequest buildmutaterequest
final byte regionname  final byte row  final byte family
final byte  qualifier  final long amount  final boolean writetowal
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
mutationproto builder mutatebuilder   mutationproto newbuilder
mutatebuilder setrow bytestring copyfrom row
mutatebuilder setmutatetype mutationtype increment
mutatebuilder setwritetowal writetowal
columnvalue builder columnbuilder   columnvalue newbuilder
columnbuilder setfamily bytestring copyfrom family
qualifiervalue builder valuebuilder   qualifiervalue newbuilder
valuebuilder setvalue bytestring copyfrom bytes tobytes amount
valuebuilder setqualifier bytestring copyfrom qualifier
columnbuilder addqualifiervalue valuebuilder build
mutatebuilder addcolumnvalue columnbuilder build
builder setmutation mutatebuilder build
return builder build
/**
* create a protocol buffer mutaterequest for a conditioned put
*
* @param regionname
* @param row
* @param family
* @param qualifier
* @param comparator
* @param comparetype
* @param put
* @return a mutate request
* @throws ioexception
*/
public static mutaterequest buildmutaterequest
final byte regionname  final byte row  final byte family
final byte  qualifier  final bytearraycomparable comparator
final comparetype comparetype  final put put  throws ioexception
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
condition condition   buildcondition
row  family  qualifier  comparator  comparetype
builder setmutation protobufutil tomutation mutationtype put  put
builder setcondition condition
return builder build
/**
* create a protocol buffer mutaterequest for a conditioned delete
*
* @param regionname
* @param row
* @param family
* @param qualifier
* @param comparator
* @param comparetype
* @param delete
* @return a mutate request
* @throws ioexception
*/
public static mutaterequest buildmutaterequest
final byte regionname  final byte row  final byte family
final byte  qualifier  final bytearraycomparable comparator
final comparetype comparetype  final delete delete  throws ioexception
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
condition condition   buildcondition
row  family  qualifier  comparator  comparetype
builder setmutation protobufutil tomutation mutationtype delete  delete
builder setcondition condition
return builder build
/**
* create a protocol buffer mutaterequest for a put
*
* @param regionname
* @param put
* @return a mutate request
* @throws ioexception
*/
public static mutaterequest buildmutaterequest
final byte regionname  final put put  throws ioexception
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder setmutation protobufutil tomutation mutationtype put  put
return builder build
/**
* create a protocol buffer mutaterequest for an append
*
* @param regionname
* @param append
* @return a mutate request
* @throws ioexception
*/
public static mutaterequest buildmutaterequest
final byte regionname  final append append  throws ioexception
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder setmutation protobufutil tomutation mutationtype append  append
return builder build
/**
* create a protocol buffer mutaterequest for a client increment
*
* @param regionname
* @param increment
* @return a mutate request
*/
public static mutaterequest buildmutaterequest
final byte regionname  final increment increment
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder setmutation protobufutil tomutation increment
return builder build
/**
* create a protocol buffer mutaterequest for a delete
*
* @param regionname
* @param delete
* @return a mutate request
* @throws ioexception
*/
public static mutaterequest buildmutaterequest
final byte regionname  final delete delete  throws ioexception
mutaterequest builder builder   mutaterequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder setmutation protobufutil tomutation mutationtype delete  delete
return builder build
/**
* create a protocol buffer multirequest for a row mutations
*
* @param regionname
* @param rowmutations
* @return a multi request
* @throws ioexception
*/
public static multirequest buildmultirequest final byte regionname
final rowmutations rowmutations
throws ioexception
multirequest builder builder   getmultirequestbuilderwithregionandatomicset regionname  true
for  mutation mutation  rowmutations getmutations
mutationtype mutatetype   null
if  mutation instanceof put
mutatetype   mutationtype put
else if  mutation instanceof delete
mutatetype   mutationtype delete
else
throw new donotretryioexception
mutation getclass   getname
mutationproto mp   protobufutil tomutation mutatetype  mutation
builder addaction multiaction newbuilder   setmutation mp  build
return builder build
/**
* create a protocol buffer multirequest for row mutations that does not hold data.  data/cells
* are carried outside of protobuf.  return references to the cells in <code>cells</code> param
*
* @param regionname
* @param rowmutations
* @param cells return in here a list of cells as celliterable.
* @return a multi request minus data
* @throws ioexception
*/
public static multirequest buildnodatamultirequest final byte regionname
final rowmutations rowmutations  final list<cellscannable> cells
throws ioexception
multirequest builder builder   getmultirequestbuilderwithregionandatomicset regionname  true
for  mutation mutation  rowmutations getmutations
mutationtype type   null
if  mutation instanceof put
type   mutationtype put
else if  mutation instanceof delete
type   mutationtype delete
else
throw new donotretryioexception
mutation getclass   getname
mutationproto mp   protobufutil tomutationnodata type  mutation
cells add mutation
builder addaction multiaction newbuilder   setmutation mp  build
return builder build
private static multirequest builder getmultirequestbuilderwithregionandatomicset final byte  regionname
final boolean atomic
multirequest builder builder   multirequest newbuilder
regionspecifier region   buildregionspecifier regionspecifiertype region_name  regionname
builder setregion region
return builder setatomic atomic
/**
* create a protocol buffer scanrequest for a client scan
*
* @param regionname
* @param scan
* @param numberofrows
* @param closescanner
* @return a scan request
* @throws ioexception
*/
public static scanrequest buildscanrequest final byte regionname
final scan scan  final int numberofrows
final boolean closescanner  throws ioexception
scanrequest builder builder   scanrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setnumberofrows numberofrows
builder setclosescanner closescanner
builder setregion region
builder setscan protobufutil toscan scan
return builder build
/**
* create a protocol buffer scanrequest for a scanner id
*
* @param scannerid
* @param numberofrows
* @param closescanner
* @return a scan request
*/
public static scanrequest buildscanrequest final long scannerid
final int numberofrows  final boolean closescanner
scanrequest builder builder   scanrequest newbuilder
builder setnumberofrows numberofrows
builder setclosescanner closescanner
builder setscannerid scannerid
return builder build
/**
* create a protocol buffer scanrequest for a scanner id
*
* @param scannerid
* @param numberofrows
* @param closescanner
* @param nextcallseq
* @return a scan request
*/
public static scanrequest buildscanrequest final long scannerid  final int numberofrows
final boolean closescanner  final long nextcallseq
scanrequest builder builder   scanrequest newbuilder
builder setnumberofrows numberofrows
builder setclosescanner closescanner
builder setscannerid scannerid
builder setnextcallseq nextcallseq
return builder build
/**
* create a protocol buffer bulk load request
*
* @param familypaths
* @param regionname
* @param assignseqnum
* @return a bulk load request
*/
public static bulkloadhfilerequest buildbulkloadhfilerequest
final list<pair<byte  string>> familypaths
final byte regionname  boolean assignseqnum
bulkloadhfilerequest builder builder   bulkloadhfilerequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
familypath builder familypathbuilder   familypath newbuilder
for  pair<byte  string> familypath  familypaths
familypathbuilder setfamily bytestring copyfrom familypath getfirst
familypathbuilder setpath familypath getsecond
builder addfamilypath familypathbuilder build
builder setassignseqnum assignseqnum
return builder build
/**
* create a protocol buffer multi request for a list of actions.
* rowmutations in the list (if any) will be ignored.
*
* @param regionname
* @param actions
* @return a multi request
* @throws ioexception
*/
public static <r> multirequest buildmultirequest final byte regionname
final list<action<r>> actions
throws ioexception
multirequest builder builder   getmultirequestbuilderwithregionandatomicset regionname  false
for  action<r> action  actions
multiaction builder protoaction   multiaction newbuilder
row row   action getaction
if  row instanceof get
protoaction setget protobufutil toget  get row
else if  row instanceof put
protoaction setmutation protobufutil tomutation mutationtype put   put row
else if  row instanceof delete
protoaction setmutation protobufutil tomutation mutationtype delete   delete row
else if  row instanceof append
protoaction setmutation protobufutil tomutation mutationtype append   append row
else if  row instanceof increment
protoaction setmutation protobufutil tomutation  increment row
else if  row instanceof rowmutations
continue     ignore rowmutations
else
throw new donotretryioexception
row getclass   getname
builder addaction protoaction build
return builder build
/**
* create a protocol buffer multirequest with no data for a list of actions (data is carried
* otherwise than via protobuf).  this means it just notes attributes, whether to write the
* wal, etc., and the presence in protobuf serves as place holder for the data which is
* coming along otherwise.  note that get is different.  it does not contain 'data' and is always
* carried by protobuf.  we return references to the data by adding them to the passed in
* <code>data</code> param.
*
* rowmutations in the list (if any) will be ignored.
*
* @param regionname
* @param actions
* @param cells place to stuff references to actual data.
* @return a multi request that does not carry any data.
* @throws ioexception
*/
public static <r> multirequest buildnodatamultirequest final byte regionname
final list<action<r>> actions  final list<cellscannable> cells
throws ioexception
multirequest builder builder   getmultirequestbuilderwithregionandatomicset regionname  false
for  action<r> action  actions
multiaction builder protoaction   multiaction newbuilder
row row   action getaction
if  row instanceof get
// gets are carried by protobufs.
protoaction setget protobufutil toget  get row
else if  row instanceof put
put p    put row
cells add p
protoaction setmutation protobufutil tomutationnodata mutationtype put  p
else if  row instanceof delete
delete d    delete row
int size   d size
// note that a legitimate delete may have a size of zero; i.e. a delete that has nothing
// in it but the row to delete.  in this case, the current implementation does not make
// a keyvalue to represent a delete-of-all-the-row until we serialize... for such cases
// where the size returned is zero, we will send the delete fully pb'd rather than have
// metadata only in the pb and then send the kv along the side in cells.
if  size > 0
cells add d
protoaction setmutation protobufutil tomutationnodata mutationtype delete  d
else
protoaction setmutation protobufutil tomutation mutationtype delete  d
else if  row instanceof append
append a    append row
cells add a
protoaction setmutation protobufutil tomutationnodata mutationtype append  a
else if  row instanceof increment
increment i    increment row
cells add i
protoaction setmutation protobufutil tomutationnodata mutationtype increment  i
else if  row instanceof rowmutations
continue     ignore rowmutations
else
throw new donotretryioexception     row getclass   getname
builder addaction protoaction build
return builder build
// end utilities for client
//start utilities for admin
/**
* create a protocol buffer getregioninforequest for a given region name
*
* @param regionname the name of the region to get info
* @return a protocol buffer getregioninforequest
*/
public static getregioninforequest
buildgetregioninforequest final byte regionname
return buildgetregioninforequest regionname  false
/**
* create a protocol buffer getregioninforequest for a given region name
*
* @param regionname the name of the region to get info
* @param includecompactionstate indicate if the compaction state is requested
* @return a protocol buffer getregioninforequest
*/
public static getregioninforequest
buildgetregioninforequest final byte regionname
final boolean includecompactionstate
getregioninforequest builder builder   getregioninforequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
if  includecompactionstate
builder setcompactionstate includecompactionstate
return builder build
/**
* create a protocol buffer getstorefilerequest for a given region name
*
* @param regionname the name of the region to get info
* @param family the family to get store file list
* @return a protocol buffer getstorefilerequest
*/
public static getstorefilerequest
buildgetstorefilerequest final byte regionname  final byte family
getstorefilerequest builder builder   getstorefilerequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder addfamily bytestring copyfrom family
return builder build
/**
* create a protocol buffer getonlineregionrequest
*
* @return a protocol buffer getonlineregionrequest
*/
public static getonlineregionrequest buildgetonlineregionrequest
return getonlineregionrequest newbuilder   build
/**
* create a protocol buffer flushregionrequest for a given region name
*
* @param regionname the name of the region to get info
* @return a protocol buffer flushregionrequest
*/
public static flushregionrequest
buildflushregionrequest final byte regionname
flushregionrequest builder builder   flushregionrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
return builder build
/**
* create a protocol buffer openregionrequest to open a list of regions
*
* @param regionopeninfos info of a list of regions to open
* @return a protocol buffer openregionrequest
*/
public static openregionrequest
buildopenregionrequest final list<pair<hregioninfo  integer>> regionopeninfos
openregionrequest builder builder   openregionrequest newbuilder
for  pair<hregioninfo  integer> regionopeninfo  regionopeninfos
integer second   regionopeninfo getsecond
int versionofofflinenode   second    null ?  1   second intvalue
builder addopeninfo buildregionopeninfo
regionopeninfo getfirst    versionofofflinenode
return builder build
/**
* create a protocol buffer openregionrequest for a given region
*
* @param region the region to open
* @param versionofofflinenode that needs to be present in the offline node
* @return a protocol buffer openregionrequest
*/
public static openregionrequest buildopenregionrequest
final hregioninfo region  final int versionofofflinenode
openregionrequest builder builder   openregionrequest newbuilder
builder addopeninfo buildregionopeninfo region  versionofofflinenode
return builder build
/**
* create a closeregionrequest for a given region name
*
* @param regionname the name of the region to close
* @param transitioninzk indicator if to transition in zk
* @return a closeregionrequest
*/
public static closeregionrequest buildcloseregionrequest
final byte regionname  final boolean transitioninzk
closeregionrequest builder builder   closeregionrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder settransitioninzk transitioninzk
return builder build
public static closeregionrequest buildcloseregionrequest
final byte regionname  final int versionofclosingnode
servername destinationserver  final boolean transitioninzk
closeregionrequest builder builder   closeregionrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder setversionofclosingnode versionofclosingnode
builder settransitioninzk transitioninzk
if  destinationserver    null
builder setdestinationserver protobufutil toservername  destinationserver
return builder build
/**
* create a closeregionrequest for a given encoded region name
*
* @param encodedregionname the name of the region to close
* @param transitioninzk indicator if to transition in zk
* @return a closeregionrequest
*/
public static closeregionrequest
buildcloseregionrequest final string encodedregionname
final boolean transitioninzk
closeregionrequest builder builder   closeregionrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype encoded_region_name
bytes tobytes encodedregionname
builder setregion region
builder settransitioninzk transitioninzk
return builder build
/**
* create a splitregionrequest for a given region name
*
* @param regionname the name of the region to split
* @param splitpoint the split point
* @return a splitregionrequest
*/
public static splitregionrequest buildsplitregionrequest
final byte regionname  final byte splitpoint
splitregionrequest builder builder   splitregionrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
if  splitpoint    null
builder setsplitpoint bytestring copyfrom splitpoint
return builder build
/**
* create a mergeregionsrequest for the given regions
* @param regiona name of region a
* @param regionb name of region b
* @param forcible true if it is a compulsory merge
* @return a mergeregionsrequest
*/
public static mergeregionsrequest buildmergeregionsrequest
final byte regiona  final byte regionb  final boolean forcible
mergeregionsrequest builder builder   mergeregionsrequest newbuilder
regionspecifier regionaspecifier   buildregionspecifier
regionspecifiertype region_name  regiona
regionspecifier regionbspecifier   buildregionspecifier
regionspecifiertype region_name  regionb
builder setregiona regionaspecifier
builder setregionb regionbspecifier
builder setforcible forcible
return builder build
/**
* create a  compactregionrequest for a given region name
*
* @param regionname the name of the region to get info
* @param major indicator if it is a major compaction
* @return a compactregionrequest
*/
public static compactregionrequest buildcompactregionrequest
final byte regionname  final boolean major  final byte  family
compactregionrequest builder builder   compactregionrequest newbuilder
regionspecifier region   buildregionspecifier
regionspecifiertype region_name  regionname
builder setregion region
builder setmajor major
if  family    null
builder setfamily bytestring copyfrom family
return builder build
/**
* create a new rollwalwriterrequest
*
* @return a replicatewalentryrequest
*/
public static rollwalwriterrequest buildrollwalwriterrequest
rollwalwriterrequest builder builder   rollwalwriterrequest newbuilder
return builder build
/**
* create a new getserverinforequest
*
* @return a getserverinforequest
*/
public static getserverinforequest buildgetserverinforequest
getserverinforequest builder builder    getserverinforequest newbuilder
return builder build
/**
* create a new stopserverrequest
*
* @param reason the reason to stop the server
* @return a stopserverrequest
*/
public static stopserverrequest buildstopserverrequest final string reason
stopserverrequest builder builder   stopserverrequest newbuilder
builder setreason reason
return builder build
//end utilities for admin
/**
* convert a byte array to a protocol buffer regionspecifier
*
* @param type the region specifier type
* @param value the region specifier byte array value
* @return a protocol buffer regionspecifier
*/
public static regionspecifier buildregionspecifier
final regionspecifiertype type  final byte value
regionspecifier builder regionbuilder   regionspecifier newbuilder
regionbuilder setvalue bytestring copyfrom value
regionbuilder settype type
return regionbuilder build
/**
* create a protocol buffer condition
*
* @param row
* @param family
* @param qualifier
* @param comparator
* @param comparetype
* @return a condition
* @throws ioexception
*/
private static condition buildcondition final byte row
final byte family  final byte  qualifier
final bytearraycomparable comparator
final comparetype comparetype  throws ioexception
condition builder builder   condition newbuilder
builder setrow bytestring copyfrom row
builder setfamily bytestring copyfrom family
builder setqualifier bytestring copyfrom qualifier
builder setcomparator protobufutil tocomparator comparator
builder setcomparetype comparetype
return builder build
/**
* create a protocol buffer addcolumnrequest
*
* @param tablename
* @param column
* @return an addcolumnrequest
*/
public static addcolumnrequest buildaddcolumnrequest
final byte  tablename  final hcolumndescriptor column
addcolumnrequest builder builder   addcolumnrequest newbuilder
builder settablename bytestring copyfrom tablename
builder setcolumnfamilies column convert
return builder build
/**
* create a protocol buffer deletecolumnrequest
*
* @param tablename
* @param columnname
* @return a deletecolumnrequest
*/
public static deletecolumnrequest builddeletecolumnrequest
final byte  tablename  final byte  columnname
deletecolumnrequest builder builder   deletecolumnrequest newbuilder
builder settablename bytestring copyfrom tablename
builder setcolumnname bytestring copyfrom columnname
return builder build
/**
* create a protocol buffer modifycolumnrequest
*
* @param tablename
* @param column
* @return an modifycolumnrequest
*/
public static modifycolumnrequest buildmodifycolumnrequest
final byte  tablename  final hcolumndescriptor column
modifycolumnrequest builder builder   modifycolumnrequest newbuilder
builder settablename bytestring copyfrom tablename
builder setcolumnfamilies column convert
return builder build
/**
* create a protocol buffer moveregionrequest
*
* @param encodedregionname
* @param destservername
* @return a moveregionrequest
* @throws deserializationexception
*/
public static moveregionrequest buildmoveregionrequest
final byte  encodedregionname  final byte  destservername  throws
deserializationexception
moveregionrequest builder builder   moveregionrequest newbuilder
builder setregion
buildregionspecifier regionspecifiertype encoded_region_name encodedregionname
if  destservername    null
builder setdestservername
protobufutil toservername new servername bytes tostring destservername
return builder build
public static dispatchmergingregionsrequest builddispatchmergingregionsrequest
final byte encodednameofregiona  final byte encodednameofregionb
final boolean forcible  throws deserializationexception
dispatchmergingregionsrequest builder builder   dispatchmergingregionsrequest newbuilder
builder setregiona buildregionspecifier
regionspecifiertype encoded_region_name  encodednameofregiona
builder setregionb buildregionspecifier
regionspecifiertype encoded_region_name  encodednameofregionb
builder setforcible forcible
return builder build
/**
* create a protocol buffer assignregionrequest
*
* @param regionname
* @return an assignregionrequest
*/
public static assignregionrequest buildassignregionrequest final byte  regionname
assignregionrequest builder builder   assignregionrequest newbuilder
builder setregion buildregionspecifier regionspecifiertype region_name regionname
return builder build
/**
* creates a protocol buffer unassignregionrequest
*
* @param regionname
* @param force
* @return an unassignregionrequest
*/
public static unassignregionrequest buildunassignregionrequest
final byte  regionname  final boolean force
unassignregionrequest builder builder   unassignregionrequest newbuilder
builder setregion buildregionspecifier regionspecifiertype region_name regionname
builder setforce force
return builder build
/**
* creates a protocol buffer offlineregionrequest
*
* @param regionname
* @return an offlineregionrequest
*/
public static offlineregionrequest buildofflineregionrequest final byte  regionname
offlineregionrequest builder builder   offlineregionrequest newbuilder
builder setregion buildregionspecifier regionspecifiertype region_name regionname
return builder build
/**
* creates a protocol buffer deletetablerequest
*
* @param tablename
* @return a deletetablerequest
*/
public static deletetablerequest builddeletetablerequest final byte  tablename
deletetablerequest builder builder   deletetablerequest newbuilder
builder settablename bytestring copyfrom tablename
return builder build
/**
* creates a protocol buffer enabletablerequest
*
* @param tablename
* @return an enabletablerequest
*/
public static enabletablerequest buildenabletablerequest final byte  tablename
enabletablerequest builder builder   enabletablerequest newbuilder
builder settablename bytestring copyfrom tablename
return builder build
/**
* creates a protocol buffer disabletablerequest
*
* @param tablename
* @return a disabletablerequest
*/
public static disabletablerequest builddisabletablerequest final byte  tablename
disabletablerequest builder builder   disabletablerequest newbuilder
builder settablename bytestring copyfrom tablename
return builder build
/**
* creates a protocol buffer createtablerequest
*
* @param htabledesc
* @param splitkeys
* @return a createtablerequest
*/
public static createtablerequest buildcreatetablerequest
final htabledescriptor htabledesc  final byte  splitkeys
createtablerequest builder builder   createtablerequest newbuilder
builder settableschema htabledesc convert
if  splitkeys    null
for  byte  splitkey   splitkeys
builder addsplitkeys bytestring copyfrom splitkey
return builder build
/**
* creates a protocol buffer modifytablerequest
*
* @param table
* @param htabledesc
* @return a modifytablerequest
*/
public static modifytablerequest buildmodifytablerequest
final byte  table  final htabledescriptor htabledesc
modifytablerequest builder builder   modifytablerequest newbuilder
builder settablename bytestring copyfrom table
builder settableschema htabledesc convert
return builder build
/**
* creates a protocol buffer getschemaalterstatusrequest
*
* @param tablename
* @return a getschemaalterstatusrequest
*/
public static getschemaalterstatusrequest buildgetschemaalterstatusrequest
final byte  tablename
getschemaalterstatusrequest builder builder   getschemaalterstatusrequest newbuilder
builder settablename bytestring copyfrom tablename
return builder build
/**
* creates a protocol buffer gettabledescriptorsrequest
*
* @param tablenames
* @return a gettabledescriptorsrequest
*/
public static gettabledescriptorsrequest buildgettabledescriptorsrequest
final list<string> tablenames
gettabledescriptorsrequest builder builder   gettabledescriptorsrequest newbuilder
if  tablenames    null
for  string str   tablenames
builder addtablenames str
return builder build
/**
* creates a protocol buffer ismasterrunningrequest
*
* @return a ismasterrunningrequest
*/
public static ismasterrunningrequest buildismasterrunningrequest
return ismasterrunningrequest newbuilder   build
/**
* creates a protocol buffer balancerequest
*
* @return a balancerequest
*/
public static balancerequest buildbalancerequest
return balancerequest newbuilder   build
/**
* creates a protocol buffer setbalancerrunningrequest
*
* @param on
* @param synchronous
* @return a setbalancerrunningrequest
*/
public static setbalancerrunningrequest buildsetbalancerrunningrequest boolean on  boolean synchronous
return setbalancerrunningrequest newbuilder   seton on  setsynchronous synchronous  build
/**
* creates a protocol buffer getclusterstatusrequest
*
* @return a getclusterstatusrequest
*/
public static getclusterstatusrequest buildgetclusterstatusrequest
return getclusterstatusrequest newbuilder   build
/**
* creates a request for running a catalog scan
* @return a {@link catalogscanrequest}
*/
public static catalogscanrequest buildcatalogscanrequest
return catalogscanrequest newbuilder   build
/**
* creates a request for enabling/disabling the catalog janitor
* @return a {@link enablecatalogjanitorrequest}
*/
public static enablecatalogjanitorrequest buildenablecatalogjanitorrequest boolean enable
return enablecatalogjanitorrequest newbuilder   setenable enable  build
/**
* creates a request for querying the master whether the catalog janitor is enabled
* @return a {@link iscatalogjanitorenabledrequest}
*/
public static iscatalogjanitorenabledrequest buildiscatalogjanitorenabledrequest
return iscatalogjanitorenabledrequest newbuilder   build
/**
* creates a request for querying the master the last flushed sequence id for a region
* @param regionname
* @return a {@link getlastflushedsequenceidrequest}
*/
public static getlastflushedsequenceidrequest buildgetlastflushedsequenceidrequest
byte regionname
return getlastflushedsequenceidrequest newbuilder   setregionname
bytestring copyfrom regionname   build
/**
* create a request to grant user permissions.
*
* @param username the short user name who to grant permissions
* @param table optional table name the permissions apply
* @param family optional column family
* @param qualifier optional qualifier
* @param actions the permissions to be granted
* @return a {@link accesscontrolprotos} grantrequest
*/
public static accesscontrolprotos grantrequest buildgrantrequest
string username  byte table  byte family  byte qualifier
accesscontrolprotos permission action    actions
accesscontrolprotos permission builder permissionbuilder
accesscontrolprotos permission newbuilder
for  accesscontrolprotos permission action a   actions
permissionbuilder addaction a
if  table    null
permissionbuilder settable bytestring copyfrom table
if  family    null
permissionbuilder setfamily bytestring copyfrom family
if  qualifier    null
permissionbuilder setqualifier bytestring copyfrom qualifier
return accesscontrolprotos grantrequest newbuilder
setpermission
accesscontrolprotos userpermission newbuilder
setuser bytestring copyfromutf8 username
setpermission permissionbuilder build
build
/**
* create a request to revoke user permissions.
*
* @param username the short user name whose permissions to be revoked
* @param table optional table name the permissions apply
* @param family optional column family
* @param qualifier optional qualifier
* @param actions the permissions to be revoked
* @return a {@link accesscontrolprotos} revokerequest
*/
public static accesscontrolprotos revokerequest buildrevokerequest
string username  byte table  byte family  byte qualifier
accesscontrolprotos permission action    actions
accesscontrolprotos permission builder permissionbuilder
accesscontrolprotos permission newbuilder
for  accesscontrolprotos permission action a   actions
permissionbuilder addaction a
if  table    null
permissionbuilder settable bytestring copyfrom table
if  family    null
permissionbuilder setfamily bytestring copyfrom family
if  qualifier    null
permissionbuilder setqualifier bytestring copyfrom qualifier
return accesscontrolprotos revokerequest newbuilder
setpermission
accesscontrolprotos userpermission newbuilder
setuser bytestring copyfromutf8 username
setpermission permissionbuilder build
build
/**
* create a regionopeninfo based on given region info and version of offline node
*/
private static regionopeninfo buildregionopeninfo
final hregioninfo region  final int versionofofflinenode
regionopeninfo builder builder   regionopeninfo newbuilder
builder setregion hregioninfo convert region
if  versionofofflinenode >  0
builder setversionofofflinenode versionofofflinenode
return builder build