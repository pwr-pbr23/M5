/*
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase client
import org apache hadoop classification interfaceaudience
import org apache hadoop classification interfacestability
import org apache hadoop hbase exceptions donotretryioexception
import org apache hadoop hbase util bytes
import java io printwriter
import java io stringwriter
import java util collection
import java util hashmap
import java util hashset
import java util list
import java util map
import java util set
/**
* this subclass of {@link org.apache.hadoop.hbase.client.retriesexhaustedexception}
* is thrown when we have more information about which rows were causing which
* exceptions on what servers.  you can call {@link #mayhaveclusterissues()}
* and if the result is false, you have input error problems, otherwise you
* may have cluster issues.  you can iterate over the causes, rows and last
* known server addresses via {@link #getnumexceptions()} and
* {@link #getcause(int)}, {@link #getrow(int)} and {@link #gethostnameport(int)}.
*/
@suppresswarnings
@interfaceaudience public
@interfacestability stable
public class retriesexhaustedwithdetailsexception
extends retriesexhaustedexception
list<throwable> exceptions
list<row> actions
list<string> hostnameandport
public retriesexhaustedwithdetailsexception list<throwable> exceptions
list<row> actions
list<string> hostnameandport
super     exceptions size
pluralize exceptions
getdesc exceptions  actions  hostnameandport
this exceptions   exceptions
this actions   actions
this hostnameandport   hostnameandport
public list<throwable> getcauses
return exceptions
public int getnumexceptions
return exceptions size
public throwable getcause int i
return exceptions get i
public row getrow int i
return actions get i
public string gethostnameport final int i
return this hostnameandport get i
public boolean mayhaveclusterissues
boolean res   false
// if all of the exceptions are dnrioe not exception
for  throwable t   exceptions
if     t instanceof donotretryioexception
res   true
return res
public static string pluralize collection<?> c
return pluralize c size
public static string pluralize int c
return c > 1 ?
public static string getdesc list<throwable> exceptions
list<row> actions
list<string> hostnameport
string s   getdesc classifyexs exceptions
stringbuilder addrs   new stringbuilder s
addrs append
set<string> uniqaddr   new hashset<string>
uniqaddr addall hostnameport
for string addr   uniqaddr
addrs append addr  append
return s
public string getexhaustivedescription
stringwriter errorwriter   new stringwriter
printwriter pw   new printwriter errorwriter
for  int i   0  i < this exceptions size      i
throwable t   this exceptions get i
row action   this actions get i
string server   this hostnameandport get i
pw append
if  this exceptions size   > 1
pw append     i
pw append     server
action    null  ?     bytes tostringbinary action getrow
if  t    null
t printstacktrace pw
pw flush
return errorwriter tostring
public static map<string  integer> classifyexs list<throwable> ths
map<string  integer> cls   new hashmap<string  integer>
for  throwable t   ths
if  t    null  continue
string name
if  t instanceof donotretryioexception
name   t getmessage
else
name   t getclass   getsimplename
integer i   cls get name
if  i    null
i   0
i    1
cls put name  i
return cls
public static string getdesc map<string integer> classificaton
stringbuilder classificatons  new stringbuilder 11
for  map entry<string  integer> e   classificaton entryset
classificatons append e getkey
classificatons append
classificatons append e getvalue
classificatons append
classificatons append pluralize e getvalue
classificatons append
return classificatons tostring