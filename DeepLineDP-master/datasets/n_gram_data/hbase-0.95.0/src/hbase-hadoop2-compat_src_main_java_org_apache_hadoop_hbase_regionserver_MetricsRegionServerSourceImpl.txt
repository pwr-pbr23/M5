/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase regionserver
import org apache hadoop hbase metrics basesourceimpl
import org apache hadoop metrics2 metrichistogram
import org apache hadoop metrics2 metricscollector
import org apache hadoop metrics2 metricsrecordbuilder
import org apache hadoop metrics2 lib interns
import org apache hadoop metrics2 lib mutablecounterlong
/**
* hadoop2 implementation of metricsregionserversource.
*
* implements basesource through basesourceimpl, following the pattern
*/
public class metricsregionserversourceimpl
extends basesourceimpl implements metricsregionserversource
final metricsregionserverwrapper rswrap
private final metrichistogram puthisto
private final metrichistogram deletehisto
private final metrichistogram gethisto
private final metrichistogram incrementhisto
private final metrichistogram appendhisto
private final mutablecounterlong slowput
private final mutablecounterlong slowdelete
private final mutablecounterlong slowget
private final mutablecounterlong slowincrement
private final mutablecounterlong slowappend
public metricsregionserversourceimpl metricsregionserverwrapper rswrap
this metrics_name  metrics_description  metrics_context  metrics_jmx_context  rswrap
public metricsregionserversourceimpl string metricsname
string metricsdescription
string metricscontext
string metricsjmxcontext
metricsregionserverwrapper rswrap
super metricsname  metricsdescription  metricscontext  metricsjmxcontext
this rswrap   rswrap
puthisto   getmetricsregistry   newhistogram mutate_key
slowput   getmetricsregistry   newcounter slow_mutate_key  slow_mutate_desc  0l
deletehisto   getmetricsregistry   newhistogram delete_key
slowdelete   getmetricsregistry   newcounter slow_delete_key  slow_delete_desc  0l
gethisto   getmetricsregistry   newhistogram get_key
slowget   getmetricsregistry   newcounter slow_get_key  slow_get_desc  0l
incrementhisto   getmetricsregistry   newhistogram increment_key
slowincrement   getmetricsregistry   newcounter slow_increment_key  slow_increment_desc  0l
appendhisto   getmetricsregistry   newhistogram append_key
slowappend   getmetricsregistry   newcounter slow_append_key  slow_append_desc  0l
@override
public void updateput long t
puthisto add t
@override
public void updatedelete long t
deletehisto add t
@override
public void updateget long t
gethisto add t
@override
public void updateincrement long t
incrementhisto add t
@override
public void updateappend long t
appendhisto add t
@override
public void incrslowput
slowput incr
@override
public void incrslowdelete
slowdelete incr
@override
public void incrslowget
slowget incr
@override
public void incrslowincrement
slowincrement incr
@override
public void incrslowappend
slowappend incr
/**
* yes this is a get function that doesn't return anything.  thanks hadoop for breaking all
* expectations of java programmers.  instead of returning anything hadoop metrics expects
* getmetrics to push the metrics into the collector.
*
* @param metricscollector collector to accept metrics
* @param all              push all or only changed?
*/
@override
public void getmetrics metricscollector metricscollector  boolean all
metricsrecordbuilder mrb   metricscollector addrecord metricsname
setcontext metricscontext
// rswrap can be null because this function is called inside of init.
if  rswrap    null
mrb addgauge interns info region_count  region_count_desc   rswrap getnumonlineregions
addgauge interns info store_count  store_count_desc   rswrap getnumstores
addgauge interns info storefile_count  storefile_count_desc   rswrap getnumstorefiles
addgauge interns info memstore_size  memstore_size_desc   rswrap getmemstoresize
addgauge interns info storefile_size  storefile_size_desc   rswrap getstorefilesize
addgauge interns info rs_start_time_name  rs_start_time_desc
rswrap getstartcode
addcounter interns info total_request_count  total_request_count_desc
rswrap gettotalrequestcount
addcounter interns info read_request_count  read_request_count_desc
rswrap getreadrequestscount
addcounter interns info write_request_count  write_request_count_desc
rswrap getwriterequestscount
addcounter interns info check_mutate_failed_count  check_mutate_failed_count_desc
rswrap getcheckandmutatechecksfailed
addcounter interns info check_mutate_passed_count  check_mutate_passed_count_desc
rswrap getcheckandmutatecheckspassed
addgauge interns info storefile_index_size  storefile_index_size_desc
rswrap getstorefileindexsize
addgauge interns info static_index_size  static_index_size_desc
rswrap gettotalstaticindexsize
addgauge interns info static_bloom_size  static_bloom_size_desc
rswrap gettotalstaticbloomsize
addgauge interns info number_of_puts_without_wal  number_of_puts_without_wal_desc
rswrap getnumputswithoutwal
addgauge interns info data_size_without_wal  data_size_without_wal_desc
rswrap getdatainmemorywithoutwal
addgauge interns info percent_files_local  percent_files_local_desc
rswrap getpercentfilelocal
addgauge interns info compaction_queue_length  compaction_queue_length_desc
rswrap getcompactionqueuesize
addgauge interns info flush_queue_length  flush_queue_length_desc
rswrap getflushqueuesize
addgauge interns info block_cache_free_size  block_cache_free_desc
rswrap getblockcachefreesize
addgauge interns info block_cache_count  block_cache_count_desc
rswrap getblockcachecount
addgauge interns info block_cache_size  block_cache_size_desc
rswrap getblockcachesize
addcounter interns info block_cache_hit_count  block_cache_hit_count_desc
rswrap getblockcachehitcount
addcounter interns info block_cache_miss_count  block_count_miss_count_desc
rswrap getblockcachemisscount
addcounter interns info block_cache_eviction_count  block_cache_eviction_count_desc
rswrap getblockcacheevictedcount
addgauge interns info block_cache_hit_percent  block_cache_hit_percent_desc
rswrap getblockcachehitpercent
addgauge interns info block_cache_express_hit_percent
block_cache_express_hit_percent_desc   rswrap getblockcachehitcachingpercent
addcounter interns info updates_blocked_time  updates_blocked_desc
rswrap getupdatesblockedtime
tag interns info zookeeper_quorum_name  zookeeper_quorum_desc
rswrap getzookeeperquorum
tag interns info server_name_name  server_name_desc   rswrap getservername
tag interns info cluster_id_name  cluster_id_desc   rswrap getclusterid
metricsregistry snapshot mrb  all