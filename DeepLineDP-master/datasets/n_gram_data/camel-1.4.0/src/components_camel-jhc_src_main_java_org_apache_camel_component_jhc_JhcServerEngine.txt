/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component jhc
import java io ioexception
import java io interruptedioexception
import java net inetsocketaddress
import java net socketaddress
import javax net ssl sslcontext
import org apache camel component jhc jhcconsumer myhandler
import org apache commons logging log
import org apache commons logging logfactory
import org apache http impl nio defaultserverioeventdispatch
import org apache http impl nio reactor sslserverioeventdispatch
import org apache http nio reactor ioeventdispatch
import org apache http nio reactor ioreactorexception
import org apache http nio reactor listeningioreactor
import org apache http params httpparams
import org apache http protocol httprequesthandler
import org apache http protocol httprequesthandlerregistry
import org apache http protocol httprequesthandlerresolver
import org apache http util concurrent threadfactory
public class jhcserverengine
private static final log log   logfactory getlog jhcserverengine class
private final httpparams params
private int port
private string protocol
private int nbthreads   2
private listeningioreactor ioreactor
private threadfactory threadfactory
private thread runner
private sslcontext sslcontext
private asyncbufferinghttpservicehandler servicehandler
private httprequesthandlerregistry handlerregistry
private boolean isstarted
private int referencecounter
jhcserverengine httpparams params  int port  string protocol
this params   params
servicehandler   new asyncbufferinghttpservicehandler params
handlerregistry   new httprequesthandlerregistry
servicehandler sethandlerresolver handlerregistry
this port   port
this protocol   protocol
public int getport
return port
public string getprotocol
return this protocol
public void setsslcontext sslcontext sslcontext
this sslcontext   sslcontext
public sslcontext getsslcontext
return this sslcontext
public synchronized void register string pattern  asynchttprequesthandler handler
handlerregistry register pattern  handler
referencecounter
public synchronized void unregister string pattern
handlerregistry unregister pattern
referencecounter
public int getreferencecounter
return referencecounter
public boolean isstarted
return isstarted
public void start   throws ioreactorexception
final socketaddress addr   new inetsocketaddress port
ioreactor   new defaultlisteningioreactor nbthreads  threadfactory  params
final ioeventdispatch ioeventdispatch
if    equals protocol
ioeventdispatch   new sslserverioeventdispatch servicehandler  sslcontext  params
else
ioeventdispatch   new defaultserverioeventdispatch servicehandler  params
runner   new thread
public void run
try
ioreactor listen addr
isstarted   true
ioreactor execute ioeventdispatch
catch  interruptedioexception ex
log info
catch  ioexception e
log warn     e getmessage
log debug
runner start
public void stop   throws ioexception
log debug
ioreactor shutdown
log debug
try
runner join
catch  interruptedexception e
//do nothing here
isstarted   false
log debug