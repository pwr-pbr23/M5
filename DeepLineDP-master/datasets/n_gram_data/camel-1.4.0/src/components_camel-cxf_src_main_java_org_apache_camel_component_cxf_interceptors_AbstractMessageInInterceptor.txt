/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component cxf interceptors
import java util list
import java util resourcebundle
import java util logging level
import java util logging logger
import javax xml namespace qname
import javax xml stream xmlstreamexception
import javax xml stream xmlstreamreader
import org w3c dom document
import org w3c dom element
import org apache cxf common i18n bundleutils
import org apache cxf common logging logutils
import org apache cxf endpoint endpoint
import org apache cxf interceptor fault
import org apache cxf message exchange
import org apache cxf message message
import org apache cxf phase abstractphaseinterceptor
import org apache cxf service model bindinginfo
import org apache cxf service model bindingmessageinfo
import org apache cxf service model bindingoperationinfo
import org apache cxf service model operationinfo
import org apache cxf staxutils staxutils
/**
* this is the base class for message interceptors that intercepts message as dom content
* infers the bindingoperationinfo and then set the
*
*/
public abstract class abstractmessageininterceptor<t extends message>
extends abstractphaseinterceptor<t>
public abstractmessageininterceptor string phase
super phase
protected boolean isrequestor message message
return boolean true equals message get message requestor_role
/**
* infer the operationinfo from the xml document and get the list of
* parts as dom element
*/
public void handlemessage t message  throws fault
logger logger   getlogger
if  isfaultmessage message
message getinterceptorchain   abort
endpoint ep   message getexchange   get endpoint class
if  ep getinfaultobserver      null
ep getinfaultobserver   onmessage message
return
//fault f = createfault(message, payloadel);
//message.setcontent(exception.class, f);
//return;
document document   createdommessage message
//document document = message.getcontent(document.class);
element payloadel    element document getchildnodes   item 0
exchange ex   message getexchange
bindingoperationinfo boi   ex get bindingoperationinfo class
if  boi    null
bindinginfo bi   ex get bindinginfo class
if  bi    null
endpoint ep   ex get endpoint class
bi   ep getendpointinfo   getbinding
ex put bindinginfo class  bi
// handling inbound message
if  logger isloggable level info
logger info
boi   getbindingoperation message  document
if  boi    null
qname startqname   new qname payloadel getnamespaceuri    payloadel getlocalname
throw new fault new org apache cxf common i18n message
getlogger    startqname
if  boi    null
ex put bindingoperationinfo class  boi
ex put operationinfo class  boi getoperationinfo
ex setoneway boi getoperationinfo   isoneway
if  logger isloggable level info
logger info     boi getname
bindingmessageinfo bmi   isrequestor message  ?  boi getoutput     boi getinput
list<element> partlist   getpartlist message  payloadel  bmi
message put list class  partlist
element header   getheader message
message put element class  header
/**
* this method is called to convert a incoming message format e.g stax stream
* to a dom tree. default implementation converts stax stream to a dom
*/
protected document createdommessage t message
document doc   null
try
if  getlogger   isloggable level info
getlogger   info
xmlstreamreader xsr   message getcontent xmlstreamreader class
doc   staxutils read xsr
catch  xmlstreamexception xe
throw new fault new org apache cxf common i18n message    getlogger     xe
return doc
protected abstract logger getlogger
/**
* this method is called on incoming to check if it is a fault.
*/
protected abstract boolean isfaultmessage t message
/**
* this method is called when the routing message interceptor has received a inbound message
* it infers the binding operation by matching the root element with a binding operation
* from the service model.
*/
protected abstract bindingoperationinfo getbindingoperation t inmessage  document document
/**
* this method is called when the routing message interceptor has intercepted a inbound
* message as a dom content.  it retreives the message parts as dom element
* and returns a list of element.
*/
protected abstract list<element> getpartlist t inmessage  element rootelement  bindingmessageinfo boi
/**
* this method is called when the routing message interceptor has intercepted a inbound
* message as a dom content.  it retreives the header parts as dom element
* and returns a element.
*/
protected abstract element getheader t inmessage