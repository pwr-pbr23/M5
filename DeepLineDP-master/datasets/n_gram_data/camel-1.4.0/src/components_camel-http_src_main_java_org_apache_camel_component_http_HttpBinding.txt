/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component http
import java io ioexception
import java io inputstream
import java util arrays
import java util hashset
import java util set
import javax servlet servletoutputstream
import javax servlet http httpservletrequest
import javax servlet http httpservletresponse
import org apache camel message
/**
* @version $revision$
*/
public class httpbinding
// this should be a set of lower-case strings
public static final set<string> default_headers_to_ignore   new hashset<string> arrays aslist
httpproducer http_response_code tolowercase
private set<string> ignoredheaders   default_headers_to_ignore
private boolean usereaderforpayload
/**
* writes the exchange to the servlet response
*
* @param response
* @throws ioexception
*/
public void writeresponse httpexchange exchange  httpservletresponse response  throws ioexception
message out   exchange getout
if  out    null
// set the status code in the response.  default is 200.
if  out getheader httpproducer http_response_code     null
int responsecode     integer out getheader httpproducer http_response_code   intvalue
response setstatus responsecode
// write out the headers...
for  string key   out getheaders   keyset
string value   out getheader key  string class
if  shouldheaderbepropagated key  value
response setheader key  value
// write out the body.
if  out getbody      null
// try to stream the body since that would be the most
// efficient..
inputstream is   out getbody inputstream class
if  is    null
servletoutputstream os   response getoutputstream
int c
while   c   is read    >  0
os write c
else
string data   out getbody string class
if  data    null
response getwriter   print data
/**
* parses the body from a http message
*/
public object parsebody httpmessage httpmessage  throws ioexception
// lets assume the body is a reader
httpservletrequest request   httpmessage getrequest
if  isusereaderforpayload
return request getreader
else
return request getinputstream
/*
* exclude a set of headers from responses and new requests as all headers
* get propagated between exchanges by default
*/
public boolean shouldheaderbepropagated string headername  string headervalue
if  headervalue    null
return false
if  headername startswith
return false
if  getignoredheaders   contains headername tolowercase
return false
return true
/*
* override the set of headers to ignore for responses and new requests
* @param headerstoignore should be a set of lower-case strings
*/
public void setignoredheaders set<string> headerstoignore
ignoredheaders    headerstoignore
public set<string> getignoredheaders
return ignoredheaders
public boolean isusereaderforpayload
return usereaderforpayload
/**
* should the {@link httpservletrequest#getreader()} be exposed as the payload of input messages in the camel
* {@link message#getbody()} or not. if false then the {@link httpservletrequest#getinputstream()} will be exposed.
*
* @param usereaderforpayload
*/
public void setusereaderforpayload boolean usereaderforpayload
this usereaderforpayload   usereaderforpayload