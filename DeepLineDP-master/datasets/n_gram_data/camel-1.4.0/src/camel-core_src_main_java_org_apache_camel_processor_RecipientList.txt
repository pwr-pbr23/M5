/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel processor
import java util arraylist
import java util iterator
import java util list
import org apache camel endpoint
import org apache camel exchange
import org apache camel expression
import org apache camel processor
import org apache camel producer
import org apache camel converter objectconverter
import org apache camel impl producercache
import org apache camel impl servicesupport
import org apache camel processor aggregate uselatestaggregationstrategy
import org apache camel util exchangehelper
import static org apache camel util objecthelper notnull
/**
* implements a dynamic <a
* href="http://activemq.apache.org/camel/recipient-list.html">recipient list</a>
* pattern where the list of actual endpoints to send a message exchange to are
* dependent on some dynamic expression.
*
* @version $revision$
*/
public class recipientlist extends servicesupport implements processor
private final expression<exchange> expression
private producercache<exchange> producercache   new producercache<exchange>
public recipientlist expression<exchange> expression
notnull expression
this expression   expression
@override
public string tostring
return     expression
public void process exchange exchange  throws exception
object receipientlist   expression evaluate exchange
iterator iter   objectconverter iterator receipientlist
list<processor> processors   new arraylist<processor>
while  iter hasnext
object recipient   iter next
endpoint<exchange> endpoint   resolveendpoint exchange  recipient
producer<exchange> producer   producercache getproducer endpoint
processors add producer
multicastprocessor mp   new multicastprocessor processors  new uselatestaggregationstrategy
mp process exchange
protected endpoint<exchange> resolveendpoint exchange exchange  object recipient
return exchangehelper resolveendpoint exchange  recipient
protected void dostop   throws exception
producercache stop
protected void dostart   throws exception