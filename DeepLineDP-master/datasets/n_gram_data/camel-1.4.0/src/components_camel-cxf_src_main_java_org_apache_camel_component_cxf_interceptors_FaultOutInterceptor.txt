/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component cxf interceptors
import java util logging level
import java util logging logger
import org apache cxf binding soap soapfault
import org apache cxf binding soap soapmessage
import org apache cxf binding xml xmlfault
import org apache cxf common logging logutils
import org apache cxf interceptor fault
import org apache cxf message message
import org apache cxf message xmlmessage
import org apache cxf phase abstractphaseinterceptor
import org apache cxf phase phase
import org apache cxf service model bindingoperationinfo
public class faultoutinterceptor extends abstractphaseinterceptor<message>
private static final logger log   logutils getl7dlogger faultoutinterceptor class
public faultoutinterceptor
super phase prepare_send
@suppresswarnings
public void handlemessage message message  throws fault
// to walk around the faultoutinterceptor npe issue of cxf 2.0.4
checkbindingoperationinfor message
exception ex   message getcontent exception class
if  ex    null
if    ex instanceof fault
ex   new fault ex
if  message instanceof xmlmessage
if  log isloggable level info
log info
ex   xmlfault createfault  fault ex
else if  message instanceof soapmessage
if  log isloggable level info
log info
soapmessage sm    soapmessage message
ex   soapfault createfault  fault ex  sm getversion
message setcontent exception class  ex
/*
* this method is used to walk around the npe issue of cxf 2.0.4
* org.apache.cxf.interceptor.faultoutinterceptor.
* this issue was fixed in cxf 2.0.5 and cxf 2.1, when we upgrade cxf to that version
* we could remove this method from the interceptor
*/
private void checkbindingoperationinfor message message
bindingoperationinfo bop   message getexchange   get bindingoperationinfo class
if  bop    null
bop   new fakebindingoperationinfo
message getexchange   put bindingoperationinfo class  bop