/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component timer
import java util timer
import java util timertask
import org apache camel exchange
import org apache camel processor
import org apache camel impl defaultconsumer
import org apache commons logging log
import org apache commons logging logfactory
/**
* the timer consumer.
*
* @version $revision$
*/
public class timerconsumer extends defaultconsumer<exchange>
private static final transient log log   logfactory getlog timerconsumer class
private final timerendpoint endpoint
private timertask task
public timerconsumer timerendpoint endpoint  processor processor
super endpoint  processor
this endpoint   endpoint
@override
protected void dostart   throws exception
task   new timertask
@override
public void run
sendtimerexchange
timer timer   endpoint gettimer
configuretask task  timer
@override
protected void dostop   throws exception
task cancel
protected void configuretask timertask task  timer timer
if  endpoint isfixedrate
if  endpoint gettime      null
timer scheduleatfixedrate task  endpoint gettime    endpoint getperiod
else
timer scheduleatfixedrate task  endpoint getdelay    endpoint getperiod
else
if  endpoint gettime      null
if  endpoint getperiod   >  0
timer schedule task  endpoint gettime    endpoint getperiod
else
timer schedule task  endpoint gettime
else
if  endpoint getperiod   >  0
timer schedule task  endpoint getdelay    endpoint getperiod
else
timer schedule task  endpoint getdelay
protected void sendtimerexchange
exchange exchange   endpoint createexchange
exchange setproperty    endpoint gettimername
exchange setproperty    endpoint gettime
exchange setproperty    endpoint getperiod
try
getprocessor   process exchange
catch  exception e
log error     e  e