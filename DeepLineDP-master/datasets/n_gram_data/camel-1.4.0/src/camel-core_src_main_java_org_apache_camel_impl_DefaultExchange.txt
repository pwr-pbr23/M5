/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel impl
import java util hashmap
import java util map
import org apache camel camelcontext
import org apache camel exchange
import org apache camel exchangepattern
import org apache camel exchangeproperty
import org apache camel message
import org apache camel runtimecamelexception
import org apache camel spi unitofwork
import org apache camel util uuidgenerator
/**
* a default implementation of {@link exchange}
*
* @version $revision$
*/
public class defaultexchange implements exchange
private static final uuidgenerator default_id_generator   new uuidgenerator
protected final camelcontext context
private map<string  object> properties
private message in
private message out
private message fault
private throwable exception
private string exchangeid
private unitofwork unitofwork
private exchangepattern pattern
public defaultexchange camelcontext context
this context  exchangepattern inonly
public defaultexchange camelcontext context  exchangepattern pattern
this context   context
this pattern   pattern
public defaultexchange defaultexchange parent
this parent getcontext    parent getpattern
this unitofwork   parent getunitofwork
@override
public string tostring
return     in
public exchange copy
exchange exchange   newinstance
exchange copyfrom this
return exchange
public void copyfrom exchange exchange
if  exchange    this
return
setproperties safecopy exchange getproperties
// this can cause strangeness if we copy, say, a filemessage onto an ftpexchange with overloaded getexchange() methods etc.
safecopy getin    exchange  exchange getin
message copyout   exchange getout false
if  copyout    null
safecopy getout true   exchange  copyout
message copyfault   exchange getfault false
if  copyfault    null
safecopy getfault true   exchange  copyfault
setexception exchange getexception
unitofwork   exchange getunitofwork
pattern   exchange getpattern
private static void safecopy message message  exchange exchange  message that
if  message    null
message copyfrom that
private static map<string  object> safecopy map<string  object> properties
if  properties    null
return null
return new hashmap<string  object> properties
private static message safecopy exchange exchange  message message
if  message    null
return null
message answer   message copy
if  answer instanceof messagesupport
messagesupport messagesupport    messagesupport  answer
messagesupport setexchange exchange
return answer
public exchange newinstance
return new defaultexchange this
public camelcontext getcontext
return context
public object getproperty string name
if  properties    null
return properties get name
return null
public <t> t getproperty string name  class<t> type
object value   getproperty name
// if the property is also a well known property in exchangeproperty then validate that the
// value is of the same type
exchangeproperty<?> property   exchangeproperty getbyname name
if  property    null
validateexchangepropertyisexpectedtype property  type  value
return getcontext   gettypeconverter   convertto type  value
public void setproperty string name  object value
exchangeproperty<?> property   exchangeproperty getbyname name
// if the property is also a well known property in exchangeproperty then validate that the
// value is of the same type
if  property    null
class type   value getclass
validateexchangepropertyisexpectedtype property  type  value
getproperties   put name  value
private <t> void validateexchangepropertyisexpectedtype exchangeproperty<?> property  class<t> type  object value
if  value    null    property    null     property type   isassignablefrom type
throw new runtimecamelexception
value tostring
this
property
public object removeproperty string name
return getproperties   remove name
public map<string  object> getproperties
if  properties    null
properties   new hashmap<string  object>
return properties
public void setproperties map<string  object> properties
this properties   properties
public message getin
if  in    null
in   createinmessage
configuremessage in
return in
public void setin message in
this in   in
configuremessage in
public message getout
return getout true
public message getout boolean lazycreate
if  out    null    lazycreate
out   createoutmessage
configuremessage out
return out
public void setout message out
this out   out
configuremessage out
public throwable getexception
return exception
public void setexception throwable exception
this exception   exception
public exchangepattern getpattern
return pattern
public void setpattern exchangepattern pattern
this pattern   pattern
public void throwexception   throws exception
if  exception    null
return
if  exception instanceof runtimeexception
throw  runtimeexception exception
if  exception instanceof exception
throw  exception exception
throw new runtimecamelexception exception
public message getfault
return getfault true
public message getfault boolean lazycreate
if  fault    null    lazycreate
fault   createfaultmessage
configuremessage fault
return fault
public void setfault message fault
this fault   fault
configuremessage fault
public string getexchangeid
if  exchangeid    null
exchangeid   defaultexchange default_id_generator generateid
return exchangeid
public void setexchangeid string id
this exchangeid   id
public boolean isfailed
message faultmessage   getfault false
if  faultmessage    null
object faultbody   faultmessage getbody
if  faultbody    null
return true
return getexception      null
public boolean istransacted
exchangeproperty<?> property   exchangeproperty get
return property    null    property get this     boolean true
public unitofwork getunitofwork
return unitofwork
public void setunitofwork unitofwork unitofwork
this unitofwork   unitofwork
/**
* factory method used to lazily create the in message
*/
protected message createinmessage
return new defaultmessage
/**
* factory method to lazily create the out message
*/
protected message createoutmessage
return new defaultmessage
/**
* factory method to lazily create the fault message
*/
protected message createfaultmessage
return new defaultmessage
/**
* configures the message after it has been set on the exchange
*/
protected void configuremessage message message
if  message instanceof messagesupport
messagesupport messagesupport    messagesupport message
messagesupport setexchange this