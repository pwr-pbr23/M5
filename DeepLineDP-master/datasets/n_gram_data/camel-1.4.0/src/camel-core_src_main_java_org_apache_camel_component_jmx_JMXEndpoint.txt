/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component jmx
import javax management mbeanserver
import javax management notification
import javax management objectname
import javax management monitor countermonitor
import org apache camel consumer
import org apache camel exchangepattern
import org apache camel processor
import org apache camel producer
import org apache camel impl defaultendpoint
import org apache commons logging log
import org apache commons logging logfactory
/**
* jmxendpoint for monitoring jmx attributs using {@link countermonitor}.
*
* @version $revision$
*/
public class jmxendpoint extends defaultendpoint<jmxexchange>
private static final transient log log   logfactory getlog jmxendpoint class
private string name
private objectname ourname
private string observedobjectname
private string attributename
private long granularityperiod   5000
private number threshold
private number offset
private mbeanserver mbeanserver
private countermonitor countermonitor   new countermonitor
protected jmxendpoint string endpointuri  jmxcomponent component
super endpointuri  component
observedobjectname   endpointuri
public jmxendpoint string endpointuri
super endpointuri
public producer<jmxexchange> createproducer   throws exception
throw new unsupportedoperationexception
public consumer<jmxexchange> createconsumer processor proc  throws exception
objectname observedname   new objectname observedobjectname
if  name    null
string type   observedname getkeyproperty
type   type    null ? type
name   mbeanserver getdefaultdomain         type
jmxconsumer result   new jmxconsumer this  proc
ourname   new objectname name
countermonitor setnotify true
countermonitor addobservedobject observedname
countermonitor setobservedattribute attributename
countermonitor setgranularityperiod granularityperiod
countermonitor setdifferencemode false
countermonitor setinitthreshold threshold
countermonitor setoffset offset
if  log isdebugenabled
log debug     countermonitor       ourname
mbeanserver registermbean countermonitor  ourname
// todo: how do we remove the listener?
mbeanserver addnotificationlistener ourname  result  null  new object
return result
public boolean issingleton
return true
public jmxexchange createexchange notification notification
return new jmxexchange getcamelcontext    getexchangepattern    notification
public jmxexchange createexchange
return new jmxexchange getcamelcontext    getexchangepattern    null
public jmxexchange createexchange exchangepattern pattern
return new jmxexchange getcamelcontext    pattern  null
public string getattributename
return attributename
public void setattributename string attributename
this attributename   attributename
public long getgranularityperiod
return granularityperiod
public void setgranularityperiod long granularityperiod
this granularityperiod   granularityperiod
public string getname
return name
public void setname string name
this name   name
public number getoffset
return offset
public void setoffset number offset
this offset   offset
public number getthreshold
return threshold
public void setthreshold number threshold
this threshold   threshold
public mbeanserver getmbeanserver
return mbeanserver
public void setmbeanserver mbeanserver mbeanserver
this mbeanserver   mbeanserver