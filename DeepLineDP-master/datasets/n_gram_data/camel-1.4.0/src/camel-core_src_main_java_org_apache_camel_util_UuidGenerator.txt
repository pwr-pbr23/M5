/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel util
import java net inetaddress
import java net serversocket
import java util logging level
import org apache commons logging log
import org apache commons logging logfactory
/**
* generator for globally unique strings.
*/
public class uuidgenerator
private static final transient log log   logfactory getlog uuidgenerator class
private static final string unique_stub
private static int instancecount
private static string hostname
private string seed
private long sequence
static
string stub
boolean canaccesssystemprops   true
try
securitymanager sm   system getsecuritymanager
if  sm    null
sm checkpropertiesaccess
catch  securityexception se
canaccesssystemprops   false
if  canaccesssystemprops
try
hostname   inetaddress getlocalhost   gethostname
serversocket ss   new serversocket 0
stub       ss getlocalport         system currenttimemillis
thread sleep 100
ss close
catch  exception ioe
log warn    ioe
else
hostname
stub       system currenttimemillis
unique_stub   stub
public uuidgenerator string prefix
synchronized  unique_stub
this seed   prefix   unique_stub    instancecount
public uuidgenerator
this     hostname
/**
* as we have to find the hostname as a side-affect of generating a unique
* stub, we allow it's easy retrevial here
*
* @return the local host name
*/
public static string gethostname
return hostname
/**
* generate a unqiue id
*/
public synchronized string generateid
return this seed    this sequence
/**
* generate a unique id - that is friendly for a url or file system
*
* @return a unique id
*/
public string generatesanitizedid
return generatesanitizedid generateid
/**
* ensures that the id is friendly for a url or file system
*
* @param id the unique id
* @return the id as file friendly id
*/
public static string generatesanitizedid string id
id   id replace
id   id replace
id   id replace
return id