/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component http
import java io ioexception
import java io inputstream
import org apache camel message
import org apache camel runtimecamelexception
import org apache camel component http helper loadingbytearrayoutputstream
import org apache camel impl pollingconsumersupport
import org apache commons httpclient header
import org apache commons httpclient httpclient
import org apache commons httpclient httpmethod
import org apache commons httpclient methods getmethod
import org apache commons io ioutils
/**
* a polling http consumer which by default performs a get
*
* @version $revision$
*/
public class httppollingconsumer extends pollingconsumersupport<httpexchange>
private final httpendpoint endpoint
private httpclient httpclient
public httppollingconsumer httpendpoint endpoint
super endpoint
this endpoint   endpoint
httpclient   endpoint createhttpclient
public httpexchange receive
return receivenowait
public httpexchange receive long timeout
return receivenowait
public httpexchange receivenowait
httpexchange exchange   endpoint createexchange
httpmethod method   createmethod
try
int responsecode   httpclient executemethod method
// lets store the result in the output message.
loadingbytearrayoutputstream bos   new loadingbytearrayoutputstream
inputstream is   method getresponsebodyasstream
ioutils copy is  bos
bos flush
is close
message message   exchange getin
message setbody bos createinputstream
// lets set the headers
header headers   method getresponseheaders
for  header header   headers
string name   header getname
string value   header getvalue
message setheader name  value
message setheader    responsecode
return exchange
catch  ioexception e
throw new runtimecamelexception e
finally
method releaseconnection
// properties
//-------------------------------------------------------------------------
public httpclient gethttpclient
return httpclient
public void sethttpclient httpclient httpclient
this httpclient   httpclient
// implementation methods
//-------------------------------------------------------------------------
protected httpmethod createmethod
string uri   endpoint getendpointuri
return new getmethod uri
protected void dostart   throws exception
protected void dostop   throws exception