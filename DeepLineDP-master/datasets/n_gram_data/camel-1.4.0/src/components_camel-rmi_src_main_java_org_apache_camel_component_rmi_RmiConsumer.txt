/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component rmi
import java lang reflect invocationhandler
import java lang reflect invocationtargetexception
import java lang reflect method
import java lang reflect proxy
import java rmi remote
import java rmi registry registry
import java rmi server unicastremoteobject
import org apache camel processor
import org apache camel component bean beanexchange
import org apache camel component bean beaninvocation
import org apache camel impl defaultconsumer
/**
* a {@link org.apache.camel.consumer consumer} which uses rmi's {@link unicastremoteobject} to consume
* method invocations.
*
* @version $revision$
*/
public class rmiconsumer extends defaultconsumer<beanexchange> implements invocationhandler
private final rmiendpoint endpoint
private remote stub
private remote proxy
public rmiconsumer rmiendpoint endpoint  processor processor
super endpoint  processor
this endpoint   endpoint
@override
protected void dostart   throws exception
class interfaces   new class
endpoint getremoteinterfaces   toarray interfaces
proxy    remote proxy newproxyinstance endpoint getclassloader    interfaces  this
stub   unicastremoteobject exportobject proxy  endpoint getport
try
registry registry   endpoint getregistry
string name   endpoint getname
registry bind name  stub
catch  exception e       registration might fail   clean up
try
unicastremoteobject unexportobject stub  true
catch  throwable ignore
stub   null
throw e
super dostart
@override
protected void dostop   throws exception
super dostop
try
registry registry   endpoint getregistry
registry unbind endpoint getname
catch  throwable e       do our best to unregister
unicastremoteobject unexportobject proxy  true
public object invoke object proxy  method method  object args  throws throwable
if   isstarted
throw new illegalstateexception     getendpoint   getendpointuri
beaninvocation invocation   new beaninvocation method  args
beanexchange exchange   getendpoint   createexchange
exchange setinvocation invocation
getprocessor   process exchange
throwable fault   exchange getexception
if  fault    null
throw new invocationtargetexception fault
return exchange getout   getbody
public remote getproxy
return proxy
public remote getstub
return stub