/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component cxf
import java io inputstream
import java util collections
import java util hashmap
import java util iterator
import java util list
import java util map
import javax xml transform source
import org apache commons logging log
import org apache commons logging logfactory
import org apache cxf helpers castutils
import org apache cxf message exchangeimpl
import org apache cxf message message
import org apache cxf message messageimpl
public final class cxfsoapbinding
private static final log log   logfactory getlog cxfsoapbinding class
private cxfsoapbinding
public static org apache cxf message message getcxfinmessage org apache camel exchange exchange  boolean isclient
messageimpl answer   new messageimpl
org apache cxf message exchange cxfexchange   exchange getproperty cxfconstants cxf_exchange
org apache cxf message exchange class
org apache camel message message   null
if  isclient
message   exchange getout
else
message   exchange getin
assert message    null
if  cxfexchange    null
cxfexchange   new exchangeimpl
exchange setproperty cxfconstants cxf_exchange  cxfexchange
map<string  object> headers   null
if  isclient
headers   exchange getout   getheaders
else
headers   exchange getin   getheaders
answer put message protocol_headers  getprotocolheader headers
object body   message getbody inputstream class
if  body instanceof inputstream
answer setcontent inputstream class  body
else
log warn     message getbody
answer putall message getheaders
answer setexchange cxfexchange
cxfexchange setinmessage answer
return answer
public static org apache cxf message message getcxfoutmessage org apache camel exchange exchange  boolean isclient
org apache cxf message exchange cxfexchange   exchange getproperty cxfconstants cxf_exchange  org apache cxf message exchange class
assert cxfexchange    null
org apache cxf endpoint endpoint cxfendpoint   cxfexchange get org apache cxf endpoint endpoint class
org apache cxf message message outmessage   cxfendpoint getbinding   createmessage
outmessage setexchange cxfexchange
cxfexchange setoutmessage outmessage
org apache camel message message   null
if  isclient
message   exchange getin
else
message   exchange getout
map<string  object> headers   null
if  isclient
headers   exchange getin   getheaders
else
headers   exchange getout   getheaders
outmessage put message protocol_headers  getprotocolheader headers
// send the body back
object body   message getbody source class
if  body instanceof source
outmessage setcontent source class  body
else
log warn     message getbody
outmessage putall message getheaders
return outmessage
private static map<string  list<string>> getprotocolheader map<string  object> headers
map<string  list<string>> protocolheader   new hashmap<string  list<string>>
iterator headerskeysetiterator   headers keyset   iterator
while  headerskeysetiterator hasnext
string key    string headerskeysetiterator next
object value   headers get key
if  value    null
protocolheader put key  collections singletonlist value tostring
else
protocolheader put key  null
return protocolheader
public static void setprotocolheader map<string  object> headers  map<string  list<string>> protocolheader
if  protocolheader    null
stringbuilder value   new stringbuilder 256
for  map entry<string  list<string>> entry   protocolheader entryset
value setlength 0
boolean first   true
for  string s   entry getvalue
if   first
value append
value append s
first   false
headers put entry getkey    value tostring