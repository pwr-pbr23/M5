/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel view
import java io printwriter
import java util list
import java util map
import java util set
import org apache camel model fromtype
import org apache camel model multicasttype
import org apache camel model processortype
import org apache camel model routetype
import static org apache camel util objecthelper isnotnullandnonempty
/**
* a <a href="http://www.graphviz.org/">dot</a> file creator plugin which
* creates a dot file showing the current routes
*
* @version $revision$
*/
public class routedotgenerator extends graphgeneratorsupport
public routedotgenerator string dir
super dir
// implementation methods
//-------------------------------------------------------------------------
protected void printroutes printwriter writer  map<string  list<routetype>> map
set<map entry<string  list<routetype>>> entries   map entryset
for  map entry<string  list<routetype>> entry   entries
string group   entry getkey
printroutes writer  group  entry getvalue
protected void printroutes printwriter writer  string group  list<routetype> routes
if  group    null
writer println      clustercounter
writer println
writer println
writer println  dashed
writer println    html
writer println
for  routetype route   routes
list<fromtype> inputs   route getinputs
for  fromtype input   inputs
printroute writer  route  input
writer println
if  group    null
writer println
writer println
protected string escapenodeid string text
return text replace       replace
protected void printroute printwriter writer  final routetype route  fromtype input
nodedata nodedata   getnodedata input
printnode writer  nodedata
// todo we should add a transactional client / event driven consumer / polling client
nodedata from   nodedata
for  processortype output   route getoutputs
nodedata newdata   printnode writer  from  output
from   newdata
protected nodedata printnode printwriter writer  nodedata fromdata  processortype node
if  node instanceof multicasttype
// no need for a multicast node
list<processortype> outputs   node getoutputs
for  processortype output   outputs
printnode writer  fromdata  output
return fromdata
nodedata todata   getnodedata node
printnode writer  todata
if  fromdata    null
writer print fromdata id
writer print
writer print todata id
writer println
string label   fromdata edgelabel
if  isnotnullandnonempty label
writer println
writer println
// now lets write any children
//list<processortype> outputs = node.getoutputs();
list<processortype> outputs   todata outputs
if  outputs    null
for  processortype output   outputs
nodedata newdata   printnode writer  todata  output
if   ismulticastnode node
todata   newdata
return todata
protected void printnode printwriter writer  nodedata data
if   data nodewritten
data nodewritten   true
writer println
writer print data id
writer println
writer println
writer println
if  data url    null
writer println
string image   data image
if  image    null
writer println
writer println
string shape   data shape
if  shape    null    image    null
shape
if  shape    null
writer println
writer println
writer println
protected void generatefile printwriter writer  map<string  list<routetype>> map
writer println
writer println
writer println  rounded filled
helvetica oblique
writer println
printroutes writer  map
writer println