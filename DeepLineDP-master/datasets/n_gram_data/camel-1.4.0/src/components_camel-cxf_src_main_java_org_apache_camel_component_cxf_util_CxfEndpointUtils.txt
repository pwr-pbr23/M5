/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component cxf util
import java lang annotation annotation
import java net uri
import java net url
import java util logging logger
import javax jws webservice
import javax xml namespace qname
import javax xml ws webserviceprovider
import org apache camel camelexception
import org apache camel component cxf cxfconstants
import org apache camel component cxf cxfendpoint
import org apache camel component cxf dataformat
import org apache camel component cxf spring cxfendpointbean
import org apache cxf bus
import org apache cxf common classloader classloaderutils
import org apache cxf common i18n message
import org apache cxf common logging logutils
import org apache cxf frontend clientfactorybean
import org apache cxf frontend serverfactorybean
import org apache cxf jaxws jaxwsclientfactorybean
import org apache cxf jaxws jaxwsserverfactorybean
import org apache cxf jaxws support jaxwsservicefactorybean
import org apache cxf service service
import org apache cxf service factory abstractservicefactorybean
import org apache cxf service factory reflectionservicefactorybean
import org apache cxf service model endpointinfo
import org apache cxf wsdl11 wsdlservicefactory
public final class cxfendpointutils
public static final string prop_name_port
public static final string prop_name_service
public static final string prop_name_serviceclass
public static final string prop_name_dataformat
public static final string dataformat_pojo
public static final string dataformat_message
public static final string dataformat_payload
private static final logger log   logutils getl7dlogger cxfendpointutils class
private cxfendpointutils
// not constructed
static qname getqname final string name
qname qname   null
if  name    null
try
qname    qname valueof name
catch  exception ex
ex printstacktrace
return qname
public static qname getportname final cxfendpoint endpoint
return getqname endpoint getportname
public static qname getservicename final cxfendpoint endpoint
return getqname endpoint getservicename
public static endpointinfo getendpointinfo final service service  final cxfendpoint endpoint
endpointinfo endpointinfo   null
final java util collection<endpointinfo> endpoints   service getserviceinfos   get 0  getendpoints
if  endpoints size      1
endpointinfo   endpoints iterator   next
else
final string port   endpoint getportname
if  port    null
final qname endpointname   qname valueof port
endpointinfo   service getserviceinfos   get 0  getendpoint endpointname
//tbd may be delegate to the endpointuri params.
return endpointinfo
public static class getseiclass string classname  throws classnotfoundexception
if  classname    null
return null
else
return classloaderutils loadclass classname  cxfendpointutils class
public static boolean haswebserviceannotation class<?> cls
return hasannotation cls  webservice class     hasannotation cls  webserviceprovider class
public static boolean hasannotation class<?> cls  class<? extends annotation> annotation
if  cls    null    cls    object class
return false
if  null    cls getannotation annotation
return true
for  class<?> interfaceclass   cls getinterfaces
if  null    interfaceclass getannotation annotation
return true
return hasannotation cls getsuperclass    annotation
public static serverfactorybean getserverfactorybean class<?> cls  throws camelexception
serverfactorybean serverfactory    null
try
if  cls    null
serverfactory   new serverfactorybean
serverfactory setservicefactory new wsdlsoapservicefactorybean
else
boolean isjsr181senabled   cxfendpointutils haswebserviceannotation cls
serverfactory   isjsr181senabled ? new jaxwsserverfactorybean
new serverfactorybean
return serverfactory
catch  exception e
throw new camelexception e
public static clientfactorybean getclientfactorybean class<?> cls  throws camelexception
clientfactorybean clientfactory   null
try
if  cls    null
clientfactory   new clientfactorybean
clientfactory setservicefactory new wsdlsoapservicefactorybean
else
boolean isjsr181senabled   cxfendpointutils haswebserviceannotation cls
clientfactory   isjsr181senabled ? new jaxwsclientfactorybean
new clientfactorybean
return clientfactory
catch  exception e
throw new camelexception e
//todo check the cxfendpoint information integration
public static void checkendpiontintegration cxfendpoint endpoint  bus bus  throws camelexception
string wsdllocation   endpoint getwsdlurl
qname serviceqname   cxfendpointutils getqname endpoint getservicename
string serviceclassname   endpoint getserviceclass
dataformat dataformat   cxfendpointutils getdataformat endpoint
url wsdlurl   null
if  wsdllocation    null
try
wsdlurl   uriutils getwsdlurl new uri wsdllocation
catch  exception e
throw new camelexception e
if  serviceqname    null
throw new camelexception new message    log  endpoint getservicename    tostring
if  serviceclassname    null    dataformat    dataformat pojo
throw new camelexception new message    log  tostring
abstractservicefactorybean servicefactory   null
try
if  serviceclassname    null
class<?> cls   classloaderutils loadclass serviceclassname  cxfendpointutils class
boolean isjsr181senabled   cxfendpointutils haswebserviceannotation cls
servicefactory   isjsr181senabled
? new jaxwsservicefactorybean     new reflectionservicefactorybean
servicefactory setbus bus
if  wsdlurl    null
reflectionservicefactorybean servicefactory  setwsdlurl wsdlurl
if  serviceqname    null
reflectionservicefactorybean servicefactory  setservicename serviceqname
reflectionservicefactorybean servicefactory  setserviceclass cls
else
if  wsdlurl    null
throw new camelexception new message    log  wsdllocation  tostring
servicefactory   new wsdlservicefactory bus  wsdlurl  serviceqname
catch  classnotfoundexception cnfe
throw new camelexception new message    log  serviceclassname  tostring    cnfe
catch  exception e
throw new camelexception e
public static boolean getsetdefaultbus cxfendpoint endpoint
boolean issetdefaultbus   null
// check the value of cxfendpointbean's property
cxfendpointbean cxfendpointbean   endpoint getcxfendpointbean
if  cxfendpointbean    null    cxfendpointbean getproperties      null
string value     string cxfendpointbean getproperties   get cxfconstants set_default_bus
issetdefaultbus   boolean valueof value
// we will get the value from the cxfendpontbean's properties
if  issetdefaultbus    null    endpoint issetdefaultbus      null
return issetdefaultbus booleanvalue
else if  endpoint issetdefaultbus      null
return endpoint issetdefaultbus   booleanvalue
else      return the default value false
return false
public static dataformat getdataformat cxfendpoint endpoint  throws camelexception
string dataformatstring   endpoint getdataformat
if  dataformatstring    null
cxfendpointbean cxfendpointbean   endpoint getcxfendpointbean
if  cxfendpointbean    null    cxfendpointbean getproperties      null
dataformatstring    string  cxfendpointbean getproperties   get cxfconstants data_format
// return the default value if nothing is set
if  dataformatstring    null
return dataformat pojo
dataformat retval   dataformat asenum dataformatstring
if  retval    dataformat unknown
throw new camelexception new message    log  dataformatstring  tostring
return retval