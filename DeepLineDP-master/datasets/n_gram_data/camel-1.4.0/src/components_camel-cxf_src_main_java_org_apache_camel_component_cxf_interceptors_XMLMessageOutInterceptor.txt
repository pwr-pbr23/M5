/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component cxf interceptors
import java util arraylist
import java util collection
import java util list
import java util resourcebundle
import java util logging level
import java util logging logger
import javax xml namespace qname
import org w3c dom element
import org w3c dom node
import org w3c dom nodelist
import org apache cxf bindings xformat xmlbindingmessageformat
import org apache cxf common i18n bundleutils
import org apache cxf common logging logutils
import org apache cxf interceptor fault
import org apache cxf message exchange
import org apache cxf message xmlmessage
import org apache cxf phase phase
import org apache cxf service model bindingmessageinfo
//import org.apache.cxf.service.model.bindingoperationinfo;
import org apache cxf service model messagepartinfo
public class xmlmessageoutinterceptor extends abstractmessageoutinterceptor<xmlmessage>
private static final logger log   logutils getl7dlogger xmlmessageoutinterceptor class
public xmlmessageoutinterceptor
super phase prepare_send
addafter domoutinterceptor class getname
protected logger getlogger
return log
@suppresswarnings
public void handlemessage xmlmessage message  throws fault
exchange exchange   message getexchange
//bindingoperationinfo boi = exchange.get(bindingoperationinfo.class);
bindingmessageinfo bmi   exchange get bindingmessageinfo class
list<element> payload   message get list class
if  bmi    null    payload size   > 1
throw new fault new org apache cxf common i18n message
log
if  bmi    null
element header   message get element class
if  header    null
//headers -represent as -element,
//body -represent as staxstream in cxf runtime.
//copy inbound header parts to outbound payload
if  log isloggable level info
log info
moveheaderparttopayload bmi  header  payload
xmlbindingmessageformat msgformat
bmi getextensor xmlbindingmessageformat class
qname rootname   msgformat    null ? msgformat getrootnode     null
if  rootname    null
if  payload size   > 1
throw new fault new org apache cxf common i18n message
log
else
if  log isloggable level info
log info
element el   createelement rootname  payload
payload   new arraylist<element>
payload add el
message put list class  payload
message remove element class
private void moveheaderparttopayload bindingmessageinfo bmi
element header
list<element> payload
collection<messagepartinfo> bodyparts   bmi getmessageparts
nodelist nodes   header getchildnodes
for  int idx   0  idx < nodes getlength    idx
node node   nodes item idx
int index   0
for  messagepartinfo mpi   bodyparts
qname name   mpi getconcretename
if  name getlocalpart   equals node getlocalname
name getnamespaceuri   equals node getnamespaceuri
payload add index   element node
break
index