/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java util arrays
import java util arraylist
import java util date
import java util iterator
import javax jms connection
import javax jms deliverymode
import javax jms destination
import javax jms messageproducer
import javax jms session
import javax jms textmessage
import org apache activemq activemqconnection
import org apache activemq activemqconnectionfactory
import org apache activemq util indentprinter
/**
* a simple tool for publishing messages
*
*
*/
public class producertool extends thread
private destination destination
private int messagecount   10
private long sleeptime
private boolean verbose   true
private int messagesize   255
private static int parallelthreads   1
private long timetolive
private string user   activemqconnection default_user
private string password   activemqconnection default_password
private string url   activemqconnection default_broker_url
private string subject
private boolean topic
private boolean transacted
private boolean persistent
private static object lockresults   new object
public static void main string args
arraylist<producertool> threads   new arraylist
producertool producertool   new producertool
string unknown   commandlinesupport setoptions producertool  args
if  unknown length > 0
system out println     arrays tostring unknown
system exit  1
producertool showparameters
for  int threadcount   1  threadcount <  parallelthreads  threadcount
producertool   new producertool
commandlinesupport setoptions producertool  args
producertool start
threads add producertool
while  true
iterator<producertool> itr   threads iterator
int running   0
while  itr hasnext
producertool thread   itr next
if  thread isalive
running
if  running <  0
system out println
break
try
thread sleep 1000
catch  exception e
public void showparameters
system out println     url       user       password
system out println     messagesize        topic ?              subject
system out println      persistent ?
system out println     sleeptime
system out println     parallelthreads
if  timetolive    0
system out println     timetolive
public void run
connection connection   null
try
// create the connection.
activemqconnectionfactory connectionfactory   new activemqconnectionfactory user  password  url
connection   connectionfactory createconnection
connection start
// create the session
session session   connection createsession transacted  session auto_acknowledge
if  topic
destination   session createtopic subject
else
destination   session createqueue subject
// create the producer.
messageproducer producer   session createproducer destination
if  persistent
producer setdeliverymode deliverymode persistent
else
producer setdeliverymode deliverymode non_persistent
if  timetolive    0
producer settimetolive timetolive
// start sending messages
sendloop session  producer
system out println     this getname
synchronized  lockresults
activemqconnection c    activemqconnection  connection
system out println     this getname
c getconnectionstats   dump new indentprinter
catch  exception e
system out println     this getname         e
e printstacktrace
finally
try
connection close
catch  throwable ignore
protected void sendloop session session  messageproducer producer  throws exception
for  int i   0  i < messagecount    messagecount    0  i
textmessage message   session createtextmessage createmessagetext i
if  verbose
string msg   message gettext
if  msg length   > 50
msg   msg substring 0  50
system out println     this getname         msg
producer send message
if  transacted
system out println     this getname         messagecount
session commit
thread sleep sleeptime
private string createmessagetext int index
stringbuffer buffer   new stringbuffer messagesize
buffer append     index       new date
if  buffer length   > messagesize
return buffer substring 0  messagesize
for  int i   buffer length    i < messagesize  i
buffer append
return buffer tostring
public void setpersistent boolean durable
this persistent   durable
public void setmessagecount int messagecount
this messagecount   messagecount
public void setmessagesize int messagesize
this messagesize   messagesize
public void setpassword string pwd
this password   pwd
public void setsleeptime long sleeptime
this sleeptime   sleeptime
public void setsubject string subject
this subject   subject
public void settimetolive long timetolive
this timetolive   timetolive
public void setparallelthreads int parallelthreads
if  parallelthreads < 1
parallelthreads   1
this parallelthreads   parallelthreads
public void settopic boolean topic
this topic   topic
public void setqueue boolean queue
this topic    queue
public void settransacted boolean transacted
this transacted   transacted
public void seturl string url
this url   url
public void setuser string user
this user   user
public void setverbose boolean verbose
this verbose   verbose