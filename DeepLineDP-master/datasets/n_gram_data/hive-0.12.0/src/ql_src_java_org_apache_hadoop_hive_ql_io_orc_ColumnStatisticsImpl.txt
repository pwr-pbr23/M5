/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql io orc
import org apache hadoop hive common type hivedecimal
import org apache hadoop hive serde2 io datewritable
import org apache hadoop hive serde2 objectinspector objectinspector
import org apache hadoop hive serde2 objectinspector primitiveobjectinspector
class columnstatisticsimpl implements columnstatistics
private static final class booleanstatisticsimpl extends columnstatisticsimpl
implements booleancolumnstatistics
private long truecount   0
booleanstatisticsimpl orcproto columnstatistics stats
super stats
orcproto bucketstatistics bkt   stats getbucketstatistics
truecount   bkt getcount 0
booleanstatisticsimpl
@override
void reset
super reset
truecount   0
@override
void updateboolean boolean value
if  value
truecount    1
@override
void merge columnstatisticsimpl other
super merge other
booleanstatisticsimpl bkt    booleanstatisticsimpl  other
truecount    bkt truecount
@override
orcproto columnstatistics builder serialize
orcproto columnstatistics builder builder   super serialize
orcproto bucketstatistics builder bucket
orcproto bucketstatistics newbuilder
bucket addcount truecount
builder setbucketstatistics bucket
return builder
@override
public long getfalsecount
return getnumberofvalues     truecount
@override
public long gettruecount
return truecount
@override
public string tostring
return super tostring         truecount
private static final class integerstatisticsimpl extends columnstatisticsimpl
implements integercolumnstatistics
private long minimum   long max_value
private long maximum   long min_value
private long sum   0
private boolean hasminimum   false
private boolean overflow   false
integerstatisticsimpl
integerstatisticsimpl orcproto columnstatistics stats
super stats
orcproto integerstatistics intstat   stats getintstatistics
if  intstat hasminimum
hasminimum   true
minimum   intstat getminimum
if  intstat hasmaximum
maximum   intstat getmaximum
if  intstat hassum
sum   intstat getsum
else
overflow   true
@override
void reset
super reset
hasminimum   false
minimum   long max_value
maximum   long min_value
sum   0
overflow   false
@override
void updateinteger long value
if   hasminimum
hasminimum   true
minimum   value
maximum   value
else if  value < minimum
minimum   value
else if  value > maximum
maximum   value
if   overflow
boolean waspositive   sum >  0
sum    value
if   value >  0     waspositive
overflow    sum >  0     waspositive
@override
void merge columnstatisticsimpl other
integerstatisticsimpl otherint    integerstatisticsimpl  other
if   hasminimum
hasminimum   otherint hasminimum
minimum   otherint minimum
maximum   otherint maximum
else if  otherint hasminimum
if  otherint minimum < minimum
minimum   otherint minimum
if  otherint maximum > maximum
maximum   otherint maximum
super merge other
overflow    otherint overflow
if   overflow
boolean waspositive   sum >  0
sum    otherint sum
if   otherint sum >  0     waspositive
overflow    sum >  0     waspositive
@override
orcproto columnstatistics builder serialize
orcproto columnstatistics builder builder   super serialize
orcproto integerstatistics builder intb
orcproto integerstatistics newbuilder
if  hasminimum
intb setminimum minimum
intb setmaximum maximum
if   overflow
intb setsum sum
builder setintstatistics intb
return builder
@override
public long getminimum
return minimum
@override
public long getmaximum
return maximum
@override
public boolean issumdefined
return  overflow
@override
public long getsum
return sum
@override
public string tostring
stringbuilder buf   new stringbuilder super tostring
if  hasminimum
buf append
buf append minimum
buf append
buf append maximum
if   overflow
buf append
buf append sum
return buf tostring
private static final class doublestatisticsimpl extends columnstatisticsimpl
implements doublecolumnstatistics
private boolean hasminimum   false
private double minimum   double max_value
private double maximum   double min_value
private double sum   0
doublestatisticsimpl
doublestatisticsimpl orcproto columnstatistics stats
super stats
orcproto doublestatistics dbl   stats getdoublestatistics
if  dbl hasminimum
hasminimum   true
minimum   dbl getminimum
if  dbl hasmaximum
maximum   dbl getmaximum
if  dbl hassum
sum   dbl getsum
@override
void reset
super reset
hasminimum   false
minimum   double max_value
maximum   double min_value
sum   0
@override
void updatedouble double value
if   hasminimum
hasminimum   true
minimum   value
maximum   value
else if  value < minimum
minimum   value
else if  value > maximum
maximum   value
sum    value
@override
void merge columnstatisticsimpl other
super merge other
doublestatisticsimpl dbl    doublestatisticsimpl  other
if   hasminimum
hasminimum   dbl hasminimum
minimum   dbl minimum
maximum   dbl maximum
else if  dbl hasminimum
if  dbl minimum < minimum
minimum   dbl minimum
if  dbl maximum > maximum
maximum   dbl maximum
sum    dbl sum
@override
orcproto columnstatistics builder serialize
orcproto columnstatistics builder builder   super serialize
orcproto doublestatistics builder dbl
orcproto doublestatistics newbuilder
if  hasminimum
dbl setminimum minimum
dbl setmaximum maximum
dbl setsum sum
builder setdoublestatistics dbl
return builder
@override
public double getminimum
return minimum
@override
public double getmaximum
return maximum
@override
public double getsum
return sum
@override
public string tostring
stringbuilder buf   new stringbuilder super tostring
if  hasminimum
buf append
buf append minimum
buf append
buf append maximum
buf append
buf append sum
return buf tostring
private static final class stringstatisticsimpl extends columnstatisticsimpl
implements stringcolumnstatistics
private string minimum   null
private string maximum   null
stringstatisticsimpl
stringstatisticsimpl orcproto columnstatistics stats
super stats
orcproto stringstatistics str   stats getstringstatistics
if  str hasmaximum
maximum   str getmaximum
if  str hasminimum
minimum   str getminimum
@override
void reset
super reset
minimum   null
maximum   null
@override
void updatestring string value
if  minimum    null
minimum   value
maximum   value
else if  minimum compareto value  > 0
minimum   value
else if  maximum compareto value  < 0
maximum   value
@override
void merge columnstatisticsimpl other
super merge other
stringstatisticsimpl str    stringstatisticsimpl  other
if  minimum    null
minimum   str minimum
maximum   str maximum
else if  str minimum    null
if  minimum compareto str minimum  > 0
minimum   str minimum
else if  maximum compareto str maximum  < 0
maximum   str maximum
@override
orcproto columnstatistics builder serialize
orcproto columnstatistics builder result   super serialize
orcproto stringstatistics builder str
orcproto stringstatistics newbuilder
if  getnumberofvalues      0
str setminimum minimum
str setmaximum maximum
result setstringstatistics str
return result
@override
public string getminimum
return minimum
@override
public string getmaximum
return maximum
@override
public string tostring
stringbuilder buf   new stringbuilder super tostring
if  getnumberofvalues      0
buf append
buf append minimum
buf append
buf append maximum
return buf tostring
private static final class decimalstatisticsimpl extends columnstatisticsimpl
implements decimalcolumnstatistics
private hivedecimal minimum   null
private hivedecimal maximum   null
private hivedecimal sum   hivedecimal zero
decimalstatisticsimpl
decimalstatisticsimpl orcproto columnstatistics stats
super stats
orcproto decimalstatistics dec   stats getdecimalstatistics
if  dec hasmaximum
maximum   new hivedecimal dec getmaximum
if  dec hasminimum
minimum   new hivedecimal dec getminimum
if  dec hassum
sum   new hivedecimal dec getsum
else
sum   null
@override
void reset
super reset
minimum   null
maximum   null
sum   hivedecimal zero
@override
void updatedecimal hivedecimal value
if  minimum    null
minimum   value
maximum   value
else if  minimum compareto value  > 0
minimum   value
else if  maximum compareto value  < 0
maximum   value
if  sum    null
try
sum   sum add value
catch  numberformatexception nfe
sum   null
@override
void merge columnstatisticsimpl other
super merge other
decimalstatisticsimpl dec    decimalstatisticsimpl  other
if  minimum    null
minimum   dec minimum
maximum   dec maximum
sum   dec sum
else if  dec minimum    null
if  minimum compareto dec minimum  > 0
minimum   dec minimum
else if  maximum compareto dec maximum  < 0
maximum   dec maximum
if  sum    null    dec sum    null
sum   null
else
sum   sum add dec sum
@override
orcproto columnstatistics builder serialize
orcproto columnstatistics builder result   super serialize
orcproto decimalstatistics builder dec
orcproto decimalstatistics newbuilder
if  getnumberofvalues      0
dec setminimum minimum tostring
dec setmaximum maximum tostring
if  sum    null
dec setsum sum tostring
result setdecimalstatistics dec
return result
@override
public hivedecimal getminimum
return minimum
@override
public hivedecimal getmaximum
return maximum
@override
public hivedecimal getsum
return sum
@override
public string tostring
stringbuilder buf   new stringbuilder super tostring
if  getnumberofvalues      0
buf append
buf append minimum
buf append
buf append maximum
if  sum    null
buf append
buf append sum
return buf tostring
private static final class datestatisticsimpl extends columnstatisticsimpl
implements datecolumnstatistics
private datewritable minimum   null
private datewritable maximum   null
datestatisticsimpl
datestatisticsimpl orcproto columnstatistics stats
super stats
orcproto datestatistics datestats   stats getdatestatistics
// min,max values serialized/deserialized as int (days since epoch)
if  datestats hasmaximum
maximum   new datewritable datestats getmaximum
if  datestats hasminimum
minimum   new datewritable datestats getminimum
@override
void reset
super reset
minimum   null
maximum   null
@override
void updatedate datewritable value
if  minimum    null
minimum   value
maximum   value
else if  minimum compareto value  > 0
minimum   value
else if  maximum compareto value  < 0
maximum   value
@override
void merge columnstatisticsimpl other
super merge other
datestatisticsimpl datestats    datestatisticsimpl  other
if  minimum    null
minimum   datestats minimum
maximum   datestats maximum
else if  datestats minimum    null
if  minimum compareto datestats minimum  > 0
minimum   datestats minimum
else if  maximum compareto datestats maximum  < 0
maximum   datestats maximum
@override
orcproto columnstatistics builder serialize
orcproto columnstatistics builder result   super serialize
orcproto datestatistics builder datestats
orcproto datestatistics newbuilder
if  getnumberofvalues      0
datestats setminimum minimum getdays
datestats setmaximum maximum getdays
result setdatestatistics datestats
return result
@override
public datewritable getminimum
return minimum
@override
public datewritable getmaximum
return maximum
@override
public string tostring
stringbuilder buf   new stringbuilder super tostring
if  getnumberofvalues      0
buf append
buf append minimum
buf append
buf append maximum
return buf tostring
private long count   0
columnstatisticsimpl orcproto columnstatistics stats
if  stats hasnumberofvalues
count   stats getnumberofvalues
columnstatisticsimpl
void increment
count    1
void updateboolean boolean value
throw new unsupportedoperationexception
void updateinteger long value
throw new unsupportedoperationexception
void updatedouble double value
throw new unsupportedoperationexception
void updatestring string value
throw new unsupportedoperationexception
void updatedecimal hivedecimal value
throw new unsupportedoperationexception
void updatedate datewritable value
throw new unsupportedoperationexception
void merge columnstatisticsimpl stats
count    stats count
void reset
count   0
@override
public long getnumberofvalues
return count
@override
public string tostring
return     count
orcproto columnstatistics builder serialize
orcproto columnstatistics builder builder
orcproto columnstatistics newbuilder
builder setnumberofvalues count
return builder
static columnstatisticsimpl create objectinspector inspector
switch  inspector getcategory
case primitive
switch    primitiveobjectinspector  inspector  getprimitivecategory
case boolean
return new booleanstatisticsimpl
case byte
case short
case int
case long
return new integerstatisticsimpl
case float
case double
return new doublestatisticsimpl
case string
case varchar
return new stringstatisticsimpl
case decimal
return new decimalstatisticsimpl
case date
return new datestatisticsimpl
default
return new columnstatisticsimpl
default
return new columnstatisticsimpl
static columnstatisticsimpl deserialize orcproto columnstatistics stats
if  stats hasbucketstatistics
return new booleanstatisticsimpl stats
else if  stats hasintstatistics
return new integerstatisticsimpl stats
else if  stats hasdoublestatistics
return new doublestatisticsimpl stats
else if  stats hasstringstatistics
return new stringstatisticsimpl stats
else if  stats hasdecimalstatistics
return new decimalstatisticsimpl stats
else if  stats hasdatestatistics
return new datestatisticsimpl stats
else
return new columnstatisticsimpl stats