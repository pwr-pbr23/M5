/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hive service cli operation
import java util arraylist
import java util list
import org apache hadoop hive conf hiveconf
import org apache hadoop hive metastore imetastoreclient
import org apache hadoop hive metastore api table
import org apache hive service cli fetchorientation
import org apache hive service cli hivesqlexception
import org apache hive service cli operationstate
import org apache hive service cli operationtype
import org apache hive service cli rowset
import org apache hive service cli tableschema
import org apache hive service cli session hivesession
/**
* gettablesoperation.
*
*/
public class gettablesoperation extends metadataoperation
private final string catalogname
private final string schemaname
private final string tablename
private final list<string> tabletypes   new arraylist<string>
private final rowset rowset   new rowset
private final tabletypemapping tabletypemapping
private static final tableschema result_set_schema   new tableschema
addstringcolumn
addstringcolumn
addstringcolumn
addstringcolumn     table  view
addstringcolumn
protected gettablesoperation hivesession parentsession
string catalogname  string schemaname  string tablename
list<string> tabletypes
super parentsession  operationtype get_tables
this catalogname   catalogname
this schemaname   schemaname
this tablename   tablename
string tablemappingstr   getparentsession   gethiveconf
getvar hiveconf confvars hive_server2_table_type_mapping
tabletypemapping
tabletypemappingfactory gettabletypemapping tablemappingstr
if  tabletypes    null
this tabletypes addall tabletypes
/* (non-javadoc)
* @see org.apache.hive.service.cli.operation#run()
*/
@override
public void run   throws hivesqlexception
setstate operationstate running
try
imetastoreclient metastoreclient   getparentsession   getmetastoreclient
string schemapattern   convertschemapattern schemaname
string tablepattern   convertidentifierpattern tablename  true
for  string dbname   metastoreclient getdatabases schemapattern
list<string> tablenames   metastoreclient gettables dbname  tablepattern
for  table table   metastoreclient gettableobjectsbyname dbname  tablenames
object rowdata   new object
default_hive_catalog
table getdbname
table gettablename
tabletypemapping maptoclienttype table gettabletype
table getparameters   get
if  tabletypes isempty      tabletypes contains
tabletypemapping maptoclienttype table gettabletype
rowset addrow result_set_schema  rowdata
setstate operationstate finished
catch  exception e
setstate operationstate error
throw new hivesqlexception e
/* (non-javadoc)
* @see org.apache.hive.service.cli.operation#getresultsetschema()
*/
@override
public tableschema getresultsetschema   throws hivesqlexception
assertstate operationstate finished
return result_set_schema
/* (non-javadoc)
* @see org.apache.hive.service.cli.operation#getnextrowset(org.apache.hive.service.cli.fetchorientation, long)
*/
@override
public rowset getnextrowset fetchorientation orientation  long maxrows  throws hivesqlexception
assertstate operationstate finished
return rowset extractsubset  int maxrows