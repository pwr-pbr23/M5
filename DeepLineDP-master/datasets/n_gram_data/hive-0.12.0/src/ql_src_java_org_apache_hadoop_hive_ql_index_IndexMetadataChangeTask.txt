/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql index
import org apache hadoop fs filestatus
import org apache hadoop fs filesystem
import org apache hadoop fs path
import org apache hadoop hive metastore tabletype
import org apache hadoop hive metastore warehouse
import org apache hadoop hive ql context
import org apache hadoop hive ql drivercontext
import org apache hadoop hive ql exec task
import org apache hadoop hive ql metadata hive
import org apache hadoop hive ql metadata partition
import org apache hadoop hive ql metadata table
import org apache hadoop hive ql plan api stagetype
public class indexmetadatachangetask extends task<indexmetadatachangework>
private static final long serialversionuid   1l
@override
protected int execute drivercontext drivercontext
try
hive db   hive get conf
indexmetadatachangework work   this getwork
string tblname   work getindextbl
table tbl   db gettable work getdbname    tblname
if  tbl    null
console printerror
return 1
if   tbl gettabletype   equals tabletype index_table
console printerror     tbl gettablename
return 1
if  tbl ispartitioned      work getpartspec      null
console printerror
return 1
if  work getpartspec      null
partition part   db getpartition tbl  work getpartspec    false
if  part    null
console printerror
warehouse makepartname work getpartspec    false  tostring
return 1
path url   new path part getpartitionpath   tostring
filesystem fs   url getfilesystem conf
filestatus fstat   fs getfilestatus url
part getparameters   put hiveindex index_table_createtime  long tostring fstat getmodificationtime
db alterpartition tbl gettablename    part
else
path url   new path tbl getpath   tostring
filesystem fs   url getfilesystem conf
filestatus fstat   fs getfilestatus url
tbl getparameters   put hiveindex index_table_createtime  long tostring fstat getmodificationtime
db altertable tbl gettablename    tbl
catch  exception e
e printstacktrace
console printerror
e getmessage
return 1
return 0
@override
public string getname
return indexmetadatachangetask class getsimplename
@override
public stagetype gettype
return stagetype ddl