/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing,
* software distributed under the license is distributed on an
* "as is" basis, without warranties or conditions of any
* kind, either express or implied.  see the license for the
* specific language governing permissions and limitations
* under the license.
*/
package org apache hive hcatalog templeton
import java io filenotfoundexception
import java io ioexception
import java net urisyntaxexception
import java util arraylist
import java util list
import java util map
import org apache commons exec executeexception
import org apache hive hcatalog templeton tool templetoncontrollerjob
import org apache hive hcatalog templeton tool templetonutils
/**
* submit a job to the mapreduce queue.
*
* this is the backend of the mapreduce/jar web service.
*/
public class jardelegator extends launcherdelegator
public jardelegator appconfig appconf
super appconf
public enqueuebean run string user  map<string  object> userargs  string jar  string mainclass
string libjars  string files
list<string> jarargs  list<string> defines
string statusdir  string callback  string completedurl
boolean enablelog  jobtype jobtype
throws notauthorizedexception  badparam  busyexception  queueexception
executeexception  ioexception  interruptedexception
runas   user
list<string> args   makeargs jar  mainclass
libjars  files  jarargs  defines
statusdir  completedurl  enablelog  jobtype
return enqueuecontroller user  userargs  callback  args
private list<string> makeargs string jar  string mainclass
string libjars  string files
list<string> jarargs  list<string> defines
string statusdir  string completedurl
boolean enablelog  jobtype jobtype
throws badparam  ioexception  interruptedexception
arraylist<string> args   new arraylist<string>
try
arraylist<string> allfiles   new arraylist
allfiles add templetonutils hadoopfsfilename jar  appconf  runas
args addall makelauncherargs appconf  statusdir
completedurl  allfiles  enablelog  jobtype
args add
templetonutils addcmdforwindows args
args add appconf clusterhadoop
args add
args add templetonutils hadoopfspath jar  appconf  runas  getname
if  templetonutils isset mainclass
args add mainclass
if  templetonutils isset libjars
string libjarslistasstring
templetonutils hadoopfslistasstring libjars  appconf  runas
args add
args add templetonutils quoteforwindows libjarslistasstring
if  templetonutils isset files
string fileslistasstring
templetonutils hadoopfslistasstring files  appconf  runas
args add
args add templetonutils quoteforwindows fileslistasstring
//the token file location comes after mainclass, as a -dprop=val
args add     templetoncontrollerjob token_file_arg_placeholder
for  string d   defines
args add
templetonutils quoteforwindows d
for  string arg   jarargs
args add templetonutils quoteforwindows arg
catch  filenotfoundexception e
throw new badparam e getmessage
catch  urisyntaxexception e
throw new badparam e getmessage
return args