/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql optimizer
import java util list
import org apache hadoop fs filesystem
import org apache hadoop fs path
import org apache hadoop hive conf hiveconf
import org apache hadoop hive ql exec commonjoinoperator
import org apache hadoop hive ql exec operator
import org apache hadoop hive ql exec tablescanoperator
import org apache hadoop hive ql metadata partition
import org apache hadoop hive ql metadata table
import org apache hadoop hive ql plan operatordesc
/*
* this is a pluggable policy to chose the candidate map-join table for converting a join to a
* sort merge join. the largest table is chosen based on the size of the tables.
*/
public abstract class sizebasedbigtableselectorforautosmj
protected void getlisttopops
operator<? extends operatordesc> op  list<tablescanoperator> topops
if   op getparentoperators      null
op getparentoperators   isempty
return
for  operator<? extends operatordesc> parentop   op getparentoperators
if  parentop instanceof tablescanoperator
topops add  tablescanoperator  parentop
else if  parentop instanceof commonjoinoperator
topops add null
else
getlisttopops parentop  topops
private long getsize hiveconf conf  string size  path path
// if the size is present in the metastore, use it
if  size    null
try
return long valueof size
catch  numberformatexception e
return  1
try
filesystem fs   path getfilesystem conf
return fs getcontentsummary path  getlength
catch  exception e
return  1
protected long getsize hiveconf conf  table table
path path   table getpath
string size   table getproperty
return getsize conf  size  path
protected long getsize hiveconf conf  partition partition
path path   partition getpartitionpath
string size   partition getparameters   get
return getsize conf  size  path