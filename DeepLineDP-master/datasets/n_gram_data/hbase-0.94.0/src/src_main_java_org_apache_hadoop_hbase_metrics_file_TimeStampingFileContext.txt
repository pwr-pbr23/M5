/**
* copyright 2008 the apache software foundation
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase metrics file
import java io bufferedoutputstream
import java io file
import java io filewriter
import java io ioexception
import java io printwriter
import java text simpledateformat
import java util date
import org apache hadoop metrics contextfactory
import org apache hadoop metrics file filecontext
import org apache hadoop metrics spi outputrecord
/**
* add timestamp to {@link org.apache.hadoop.metrics.file.filecontext#emitrecord(string, string, outputrecord)}.
*/
public class timestampingfilecontext extends filecontext
// copies bunch of filecontext here because writer and file are private in
// superclass.
private file file   null
private printwriter writer   null
private final simpledateformat sdf
public timestampingfilecontext
super
this sdf   new simpledateformat
@override
public void init string contextname  contextfactory factory
super init contextname  factory
string filename   getattribute file_name_property
if  filename    null
file   new file filename
@override
public void startmonitoring   throws ioexception
if  file    null
writer   new printwriter new bufferedoutputstream system out
else
writer   new printwriter new filewriter file  true
super startmonitoring
@override
public void stopmonitoring
super stopmonitoring
if  writer    null
writer close
writer   null
private synchronized string iso8601
return this sdf format new date
@override
public void emitrecord string contextname  string recordname
outputrecord outrec
writer print iso8601
writer print
writer print contextname
writer print
writer print recordname
string separator
for  string tagname   outrec gettagnames
writer print separator
separator
writer print tagname
writer print
writer print outrec gettag tagname
for  string metricname   outrec getmetricnames
writer print separator
separator
writer print metricname
writer print
writer print outrec getmetric metricname
writer println
@override
public void flush
writer flush