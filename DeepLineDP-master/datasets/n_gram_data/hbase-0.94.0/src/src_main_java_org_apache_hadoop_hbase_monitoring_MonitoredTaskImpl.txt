/**
* copyright 2011 the apache software foundation
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase monitoring
import org codehaus jackson map objectmapper
import java io ioexception
import java util hashmap
import java util map
class monitoredtaskimpl implements monitoredtask
private long starttime
private long statustime
private long statetime
private volatile string status
private volatile string description
protected volatile state state   state running
public monitoredtaskimpl
starttime   system currenttimemillis
statustime   starttime
statetime   starttime
@override
public synchronized monitoredtaskimpl clone
try
return  monitoredtaskimpl  super clone
catch  clonenotsupportedexception e
throw new assertionerror       won't happen
@override
public long getstarttime
return starttime
@override
public string getdescription
return description
@override
public string getstatus
return status
@override
public long getstatustime
return statustime
@override
public state getstate
return state
@override
public long getstatetime
return statetime
@override
public long getcompletiontimestamp
if  state    state complete    state    state aborted
return statetime
return  1
@override
public void markcomplete string status
setstate state complete
setstatus status
@override
public void pause string msg
setstate state waiting
setstatus msg
@override
public void resume string msg
setstate state running
setstatus msg
@override
public void abort string msg
setstatus msg
setstate state aborted
@override
public void setstatus string status
this status   status
statustime   system currenttimemillis
protected void setstate state state
this state   state
statetime   system currenttimemillis
@override
public void setdescription string description
this description   description
@override
public void cleanup
if  state    state running
setstate state aborted
/**
* force the completion timestamp backwards so that
* it expires now.
*/
public void expirenow
statetime    180   1000
@override
public map<string  object> tomap
map<string  object> map   new hashmap<string  object>
map put    getdescription
map put    getstatus
map put    getstate
map put    getstarttime
map put    getcompletiontimestamp
map put    getcompletiontimestamp
return map
@override
public string tojson   throws ioexception
objectmapper mapper   new objectmapper
return mapper writevalueasstring tomap
@override
public string tostring
stringbuilder sb   new stringbuilder 512
sb append getdescription
sb append
sb append getstatus
sb append
sb append getstate
sb append
sb append getstarttime
sb append
sb append getcompletiontimestamp
return sb tostring