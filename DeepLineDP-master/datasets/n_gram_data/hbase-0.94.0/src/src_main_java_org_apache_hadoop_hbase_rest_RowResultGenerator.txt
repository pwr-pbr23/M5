/*
* copyright 2010 the apache software foundation
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase rest
import java io ioexception
import java util iterator
import java util nosuchelementexception
import org apache commons logging log
import org apache commons logging logfactory
import org apache hadoop util stringutils
import org apache hadoop hbase donotretryioexception
import org apache hadoop hbase hcolumndescriptor
import org apache hadoop hbase keyvalue
import org apache hadoop hbase client get
import org apache hadoop hbase client htableinterface
import org apache hadoop hbase client htablepool
import org apache hadoop hbase client result
import org apache hadoop hbase filter filter
import org apache hadoop hbase regionserver nosuchcolumnfamilyexception
public class rowresultgenerator extends resultgenerator
private static final log log   logfactory getlog rowresultgenerator class
private iterator<keyvalue> valuesi
private keyvalue cache
public rowresultgenerator final string tablename  final rowspec rowspec
final filter filter  throws illegalargumentexception  ioexception
htablepool pool   restservlet getinstance   gettablepool
htableinterface table   pool gettable tablename
try
get get   new get rowspec getrow
if  rowspec hascolumns
for  byte col  rowspec getcolumns
byte split   keyvalue parsecolumn col
if  split length    2    split length    0
get addcolumn split  split
else
get addfamily split
else
// rowspec does not explicitly specify columns, return them all
for  hcolumndescriptor family
table gettabledescriptor   getfamilies
get addfamily family getname
get settimerange rowspec getstarttime    rowspec getendtime
get setmaxversions rowspec getmaxversions
if  filter    null
get setfilter filter
result result   table get get
if  result    null     result isempty
valuesi   result list   iterator
catch  donotretryioexception e
// warn here because stargate will return 404 in the case if multiple
// column families were specified but one did not exist -- currently
// hbase will fail the whole get.
// specifying multiple columns in a uri should be uncommon usage but
// help to avoid confusion by leaving a record of what happened here in
// the log.
log warn stringutils stringifyexception e
finally
pool puttable table
public void close
public boolean hasnext
if  cache    null
return true
if  valuesi    null
return false
return valuesi hasnext
public keyvalue next
if  cache    null
keyvalue kv   cache
cache   null
return kv
if  valuesi    null
return null
try
return valuesi next
catch  nosuchelementexception e
return null
public void putback keyvalue kv
this cache   kv
public void remove
throw new unsupportedoperationexception