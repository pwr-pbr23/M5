/*
* copyright 2011 the apache software foundation
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase client
import java io datainput
import java io dataoutput
import java io ioexception
import java util collections
import java util hashmap
import java util map
import org apache hadoop hbase util bytes
import org apache hadoop hbase util classsize
import org apache hadoop io writableutils
public abstract class operationwithattributes extends operation implements attributes
// a opaque blob of attributes
private map<string  byte> attributes
public void setattribute string name  byte value
if  attributes    null    value    null
return
if  attributes    null
attributes   new hashmap<string  byte>
if  value    null
attributes remove name
if  attributes isempty
this attributes   null
else
attributes put name  value
public byte getattribute string name
if  attributes    null
return null
return attributes get name
public map<string  byte> getattributesmap
if  attributes    null
return collections emptymap
return collections unmodifiablemap attributes
protected long getattributesize
long size   0
if  attributes    null
size    classsize align this attributes size     classsize map_entry
for map entry<string  byte> entry   this attributes entryset
size    classsize align classsize string   entry getkey   length
size    classsize align classsize array   entry getvalue   length
return size
protected void writeattributes final dataoutput out  throws ioexception
if  this attributes    null
out writeint 0
else
out writeint this attributes size
for  map entry<string  byte> attr   this attributes entryset
writableutils writestring out  attr getkey
bytes writebytearray out  attr getvalue
protected void readattributes final datainput in  throws ioexception
int numattributes   in readint
if  numattributes > 0
this attributes   new hashmap<string  byte> numattributes
for int i 0  i<numattributes  i
string name   writableutils readstring in
byte value   bytes readbytearray in
this attributes put name  value