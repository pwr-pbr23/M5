/**
* copyright 2010 the apache software foundation
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase replication regionserver
import org apache hadoop hbase metrics metricsrate
import org apache hadoop metrics metricscontext
import org apache hadoop metrics metricsrecord
import org apache hadoop metrics metricsutil
import org apache hadoop metrics updater
import org apache hadoop metrics jvm jvmmetrics
import org apache hadoop metrics util metricsintvalue
import org apache hadoop metrics util metricslongvalue
import org apache hadoop metrics util metricsregistry
/**
* this class is for maintaining the various replication statistics
* for a sink and publishing them through the metrics interfaces.
*/
public class replicationsinkmetrics implements updater
private final metricsrecord metricsrecord
private metricsregistry registry   new metricsregistry
private static replicationsinkmetrics instance
/** rate of operations applied by the sink */
public final metricsrate appliedopsrate
new metricsrate    registry
/** rate of batches (of operations) applied by the sink */
public final metricsrate appliedbatchesrate
new metricsrate    registry
/** age of the last operation that was applied by the sink */
private final metricslongvalue ageoflastappliedop
new metricslongvalue    registry
/**
* constructor used to register the metrics
*/
public replicationsinkmetrics
metricscontext context   metricsutil getcontext
string name   thread currentthread   getname
metricsrecord   metricsutil createrecord context
metricsrecord settag    name
context registerupdater this
// export for jmx
new replicationstatistics this registry
/**
* set the age of the last edit that was applied
* @param timestamp write time of the edit
*/
public void setageoflastappliedop long timestamp
ageoflastappliedop set system currenttimemillis     timestamp
@override
public void doupdates metricscontext metricscontext
synchronized  this
this appliedopsrate pushmetric this metricsrecord
this appliedbatchesrate pushmetric this metricsrecord
this ageoflastappliedop pushmetric this metricsrecord
this metricsrecord update