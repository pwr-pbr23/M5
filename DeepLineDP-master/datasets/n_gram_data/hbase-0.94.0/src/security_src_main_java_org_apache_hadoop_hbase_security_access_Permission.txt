/*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
* http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase security access
import com google common collect maps
import org apache commons logging log
import org apache commons logging logfactory
import org apache hadoop hbase util bytes
import org apache hadoop io versionedwritable
import java io datainput
import java io dataoutput
import java io ioexception
import java util arrays
import java util map
/**
* base permissions instance representing the ability to perform a given set
* of actions.
*
* @see tablepermission
*/
public class permission extends versionedwritable
protected static final byte version   0
public enum action
read     write     exec     create     admin
private byte code
action char code
this code    byte code
public byte code     return code
private static log log   logfactory getlog permission class
protected static map<byte action> action_by_code   maps newhashmap
protected action actions
static
for  action a   action values
action_by_code put a code    a
/** empty constructor for writable implementation.  <b>do not use.</b> */
public permission
super
public permission action    assigned
if  assigned    null    assigned length > 0
actions   arrays copyof assigned  assigned length
public permission byte actioncodes
if  actioncodes    null
action acts   new action
int j   0
for  int i 0  i<actioncodes length  i
byte b   actioncodes
action a   action_by_code get b
if  a    null
log error
bytes tostringbinary new byte b
continue
acts   a
this actions   arrays copyof acts  j
public action getactions
return actions
public boolean implies action action
if  this actions    null
for  action a   this actions
if  a    action
return true
return false
@override
public boolean equals object obj
if    obj instanceof permission
return false
permission other    permission obj
// check actions
if  actions    null    other getactions      null
return true
else if  actions    null    other getactions      null
action otheractions   other getactions
if  actions length    otheractions length
return false
outer
for  action a   actions
for  action oa   otheractions
if  a    oa  continue outer
return false
return true
return false
@override
public int hashcode
final int prime   37
int result   23
for  action a   actions
result   prime   result   a code
return result
public string tostring
stringbuilder str   new stringbuilder
append
if  actions    null
for  int i 0  i<actions length  i
if  i > 0
str append
if  actions    null
str append actions tostring
else
str append
str append
return str tostring
/** @return the object version number */
public byte getversion
return version
@override
public void readfields datainput in  throws ioexception
super readfields in
int length    int in readbyte
if  length > 0
actions   new action
for  int i   0  i < length  i
byte b   in readbyte
action a   action_by_code get b
if  a    null
throw new ioexception
bytes tostringbinary new byte b
this actions   a
else
actions   new action
@override
public void write dataoutput out  throws ioexception
super write out
out writebyte actions    null ? actions length   0
if  actions    null
for  action a  actions
out writebyte a code