/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase metrics histogram
import java io file
import java io ioexception
import java io printwriter
import java util arrays
import java util collection
/**
* a snapshot of all the information seen in a sample.
*/
public class snapshot
private static final double median_q   0 5
private static final double p75_q   0 75
private static final double p95_q   0 95
private static final double p98_q   0 98
private static final double p99_q   0 99
private static final double p999_q   0 999
private final double values
/**
* create a new {@link snapshot} with the given values.
*
* @param values    an unordered set of values in the sample
*/
public snapshot collection<long> values
final object copy   values toarray
this values   new double
for  int i   0  i < copy length  i
this values    long  copy
arrays sort this values
/**
* create a new {@link snapshot} with the given values.
*
* @param values    an unordered set of values in the sample
*/
public snapshot double values
this values   new double
system arraycopy values  0  this values  0  values length
arrays sort this values
/**
* returns the value at the given quantile.
*
* @param quantile    a given quantile, in [0..1]
* @return the value in the distribution at quantile
*/
public double getvalue double quantile
if  quantile < 0 0    quantile > 1 0
throw new illegalargumentexception quantile
if  values length    0
return 0 0
final double pos   quantile    values length   1
if  pos < 1
return values
if  pos >  values length
return values
final double lower   values
final double upper   values
return lower    pos   math floor pos      upper   lower
/**
* returns the number of values in the snapshot.
*
* @return the number of values in the snapshot
*/
public int size
return values length
/**
* returns the median value in the distribution.
*
* @return the median value in the distribution
*/
public double getmedian
return getvalue median_q
/**
* returns the value at the 75th percentile in the distribution.
*
* @return the value at the 75th percentile in the distribution
*/
public double get75thpercentile
return getvalue p75_q
/**
* returns the value at the 95th percentile in the distribution.
*
* @return the value at the 95th percentile in the distribution
*/
public double get95thpercentile
return getvalue p95_q
/**
* returns the value at the 98th percentile in the distribution.
*
* @return the value at the 98th percentile in the distribution
*/
public double get98thpercentile
return getvalue p98_q
/**
* returns the value at the 99th percentile in the distribution.
*
* @return the value at the 99th percentile in the distribution
*/
public double get99thpercentile
return getvalue p99_q
/**
* returns the value at the 99.9th percentile in the distribution.
*
* @return the value at the 99.9th percentile in the distribution
*/
public double get999thpercentile
return getvalue p999_q
/**
* returns the entire set of values in the snapshot.
*
* @return the entire set of values in the snapshot
*/
public double getvalues
return arrays copyof values  values length