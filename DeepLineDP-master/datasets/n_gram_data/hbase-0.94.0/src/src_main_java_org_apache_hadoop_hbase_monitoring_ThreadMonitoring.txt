/**
* copyright 2011 the apache software foundation
*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase monitoring
import java lang management managementfactory
import java lang management threadinfo
import java lang management threadmxbean
public abstract class threadmonitoring
private static final threadmxbean threadbean
managementfactory getthreadmxbean
private static final int stack_depth   20
public static threadinfo getthreadinfo thread t
long tid   t getid
return threadbean getthreadinfo tid  stack_depth
/**
* format the given threadinfo object as a string.
* @param indent a prefix for each line, used for nested indentation
*/
public static string formatthreadinfo threadinfo threadinfo  string indent
stringbuilder sb   new stringbuilder
appendthreadinfo sb  threadinfo  indent
return sb tostring
/**
* print all of the thread's information and stack traces.
*
* @param sb
* @param info
* @param indent
*/
public static void appendthreadinfo stringbuilder sb
threadinfo info
string indent
boolean contention   threadbean isthreadcontentionmonitoringenabled
if  info    null
sb append indent  append
return
string taskname   gettaskname info getthreadid    info getthreadname
sb append indent  append    append taskname  append
thread state state   info getthreadstate
sb append indent  append    append state  append
sb append indent  append    append info getblockedcount    append
sb append indent  append    append info getwaitedcount    append
if  contention
sb append indent  append     info getblockedtime    append
sb append indent  append     info getwaitedtime    append
if  state    thread state waiting
sb append indent  append    append info getlockname    append
else  if  state    thread state blocked
sb append indent  append    append info getlockname    append
sb append indent  append    append
gettaskname info getlockownerid    info getlockownername     append
sb append indent  append    append
for  stacktraceelement frame  info getstacktrace
sb append indent  append    append frame tostring    append
private static string gettaskname long id  string name
if  name    null
return long tostring id
return id       name