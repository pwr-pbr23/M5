/***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
* copyright (c) 2006 nick sieger <nicksieger@gmail.com>
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby libraries
import org jruby ruby
import org jruby rubyclass
import org jruby rubyio
import org jruby runtime callbackfactory
import org jruby runtime builtin irubyobject
import org jruby runtime load library
import org jruby util io channeldescriptor
import org jruby util io openfile
/**
* @author nick sieger
*/
public class iowaitlibrary implements library
public void load ruby runtime  boolean wrap
rubyclass ioclass   runtime getio
callbackfactory callbackfactory   runtime callbackfactory iowaitlibrary class
ioclass definefastmethod    callbackfactory getfastsingletonmethod
ioclass definefastmethod    callbackfactory getfastsingletonmethod
/**
* returns non-nil if input available without blocking, false if eof or not open/readable, otherwise nil.
*/
public static irubyobject ready irubyobject obj
rubyio io    rubyio obj
try
openfile openfile   io getopenfile
channeldescriptor descriptor   openfile getmainstream   getdescriptor
if   descriptor isopen       openfile getmainstream   getmodes   isreadable      openfile getmainstream   feof
return obj getruntime   getfalse
int avail   openfile getmainstream   ready
if  avail > 0
return obj getruntime   newfixnum avail
catch  exception anyex
return obj getruntime   getfalse
return obj getruntime   getnil
/**
* waits until input available or timed out and returns self, or nil when eof reached.
*/
public static irubyobject io_wait irubyobject obj
rubyio io    rubyio obj
try
openfile openfile   io getopenfile
channeldescriptor descriptor   openfile getmainstream   getdescriptor
if  openfile getmainstream   feof
return obj getruntime   getnil
openfile getmainstream   waituntilready
catch  exception anyex
return obj getruntime   getnil
return obj