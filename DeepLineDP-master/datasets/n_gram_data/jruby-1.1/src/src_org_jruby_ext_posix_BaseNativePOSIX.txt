package org jruby ext posix
import com sun jna nativelibrary
import java io filedescriptor
import java io ioexception
import java nio bytebuffer
import java nio charset charset
public abstract class basenativeposix implements posix
protected string libraryname
protected libc libc
protected posixhandler handler
protected javalibchelper helper
public basenativeposix string libraryname  libc libc  posixhandler handler
this libc   libc
this handler   handler
this libraryname   libraryname
helper   new javalibchelper handler
public int chmod string filename  int mode
return libc chmod filename  mode
public int chown string filename  int user  int group
return libc chown filename  user  group
public filestat fstat filedescriptor filedescriptor
filestat stat   allocatestat
int fd   helper getfd filedescriptor
if  libc fstat fd  stat  < 0  handler error errors enoent    fd
return stat
public int getegid
return libc getegid
public int geteuid
return libc geteuid
public int getgid
return libc getgid
public string getlogin
return libc getlogin
public int getpgid
return libc getpgid
public int getpgrp
return libc getpgrp
public int getpid
return libc getpid
public int getppid
return libc getppid
public passwd getpwent
return libc getpwent
public passwd getpwuid int which
return libc getpwuid which
public passwd getpwnam string which
return libc getpwnam which
public group getgrent
return libc getgrent
public group getgrgid int which
return libc getgrgid which
public group getgrnam string which
return libc getgrnam which
public int setpwent
return libc setpwent
public int endpwent
return libc endpwent
public int setgrent
return libc setgrent
public int endgrent
return libc endgrent
public int getuid
return libc getuid
public int setegid int egid
return libc setegid egid
public int seteuid int euid
return libc seteuid euid
public int setgid int gid
return libc setgid gid
public int getfd filedescriptor descriptor
return helper getfd descriptor
public int getpgid int pid
return libc getpgid pid
public int setpgid int pid  int pgid
return libc setpgid pid  pgid
public int setpgrp int pid  int pgrp
return libc setpgrp pid  pgrp
public int setsid
return libc setsid
public int setuid int uid
return libc setuid uid
public int kill int pid  int signal
return libc kill pid  signal
public int lchmod string filename  int mode
return libc lchmod filename  mode
public int lchown string filename  int user  int group
return libc lchown filename  user  group
public int link string oldpath  string newpath
return libc link oldpath  newpath
public filestat lstat string path
filestat stat   allocatestat
if  libc lstat path  stat  < 0  handler error errors enoent  path
return stat
public int mkdir string path  int mode
return libc mkdir path  mode
public filestat stat string path
filestat stat   allocatestat
if  libc stat path  stat  < 0  handler error errors enoent  path
return stat
public int symlink string oldpath  string newpath
return libc symlink oldpath  newpath
public string readlink string oldpath  throws ioexception
// todo: this should not be hardcoded to 256 bytes
bytebuffer buffer   bytebuffer allocate 256
int result   libc readlink oldpath  buffer  buffer capacity
if  result     1  return null
buffer position 0
buffer limit result
return charset forname    decode buffer  tostring
public int umask int mask
return libc umask mask
public int fork
return libc fork
public int waitpid int pid  int status  int flags
return libc waitpid pid  status  pid
public int wait int status
return libc wait status
public int getpriority int which  int who
return libc getpriority which  who
public int setpriority int which  int who  int prio
return libc setpriority which  who  prio
public boolean isatty filedescriptor fd
return libc isatty helper getfd fd      0
public abstract filestat allocatestat
/**
* does the loaded library have the method specified
* @param name of method to look for
* @return true if found.  false otherwise
*/
protected boolean hasmethod string name
try
nativelibrary getinstance libraryname  getfunction name
catch  unsatisfiedlinkerror e
return false
return true