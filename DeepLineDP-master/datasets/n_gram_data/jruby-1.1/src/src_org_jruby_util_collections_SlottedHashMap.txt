package org jruby util collections
import java util arraylist
import java util collection
import java util hashmap
import java util iterator
import java util list
import java util map
import java util set
public class slottedhashmap implements map
private slottedhashmap parent
private map map
private list children
private object owner
public class slot
private object value
public void setvalue object value
this value   value
public object getvalue
return value
public slottedhashmap getparent
return slottedhashmap this
public string tostring
return     hashcode         getparent   hashcode         getvalue
public slottedhashmap object owner
super
children   new arraylist
map   new hashmap
this owner   owner
public slottedhashmap object owner  slottedhashmap smap
this owner
parent   smap
smap addchild this
for  iterator iter   parent entryset   iterator    iter hasnext
map entry entry    map entry iter next
map put entry getkey    entry getvalue
public void addchild slottedhashmap smap
children add smap
public void setparent slottedhashmap smap
this parent   smap
/**
* put a new value into this shm. if the key provided was originally slotted by a parent,
* that association will be replaced. if no parents have provided an association we create a new one.
* @param key
* @param value
* @return
*/
public object put object key  object value
slot slot    slot map get key
if  slot    null    slot getparent      this
slot   new slot
slot setvalue value
// update all children
for  iterator iter   children iterator    iter hasnext
object obj   iter next
slottedhashmap shm    slottedhashmap obj
shm put key  value  this
return map put key  slot
/**
* potentially insert the given key and value, if we have not already overridden it
*
* @param key
* @param value
* @param parent
* @return
*/
protected object put object key  object value  slottedhashmap parent
slot slot   getslot key
if  slot    null
if  slot getparent      this
// do not replace, we've overridden
return get key
slot   parent getslot key
// update children
for  iterator iter   children iterator    iter hasnext
slottedhashmap shm    slottedhashmap iter next
shm put key  value  parent
return map put key  slot
public object get object key
slot slot   getslot key
if  slot    null  return null
return slot getvalue
public slot getslot object key
return  slot map get key
public int size
return map size
public void clear
throw new runtimeexception
public boolean isempty
return map isempty
public boolean containskey object key
return map containskey key
public boolean containsvalue object value
// todo auto-generated method stub
return false
public collection values
// todo auto-generated method stub
return null
public void putall map t
// todo auto-generated method stub
public set entryset
return map entryset
public set keyset
return map keyset
public object remove object key
slot slot   getslot key
if  slot    null
if  slot getparent      this
map remove key
// update children
for  iterator iter   children iterator    iter hasnext
slottedhashmap child    slottedhashmap iter next
child remove key  this
return slot getvalue
else
// do nothing, we have not overridden this
return null
protected void remove object key  slottedhashmap parent
slot slot   getslot key
if  slot getparent      this
// do nothing, we've overridden parent
return
else
map remove key
// update children
for  iterator iter   children iterator    iter hasnext
slottedhashmap child    slottedhashmap iter next
child remove key  parent
public object getowner
return owner