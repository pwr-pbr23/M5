package org jruby ext posix
import java io filedescriptor
public class linuxposix extends basenativeposix
private static int stat_version   3
private boolean hasfxstat
private boolean haslxstat
private boolean hasxstat
private boolean hasfstat   false
private boolean haslstat   false
private boolean hasstat   false
public linuxposix string libraryname  libc libc  posixhandler handler
super libraryname  libc  handler
/*
* most linux systems define stat/lstat/fstat as macros which force
* us to call these weird signature versions.
*/
hasfxstat   hasmethod
haslxstat   hasmethod
hasxstat   hasmethod
/*
* at least one person is using ulibc on linux which has real
* definitions for stat/lstat/fstat.
*/
if   hasfxstat  hasfstat   hasmethod
if   haslxstat  haslstat   hasmethod
if   hasxstat  hasstat   hasmethod
@override
public filestat allocatestat
return new linuxfilestat this
@override
public filestat fstat filedescriptor filedescriptor
if   hasfxstat
if  hasfstat  return super fstat filedescriptor
handler unimplementederror
filestat stat   allocatestat
int fd   helper getfd filedescriptor
if    linuxlibc  libc  __fxstat stat_version  fd  stat  < 0  handler error errors enoent      fd
return stat
@override
public filestat lstat string path
if   haslxstat
if  haslstat  return super lstat path
handler unimplementederror
filestat stat   allocatestat
if    linuxlibc  libc  __lxstat stat_version  path  stat  < 0  handler error errors enoent  path
return stat
@override
public filestat stat string path
if   hasxstat
if  hasstat  return super stat path
handler unimplementederror
filestat stat   allocatestat
if    linuxlibc  libc  __xstat stat_version  path  stat  < 0  handler error errors enoent  path
return stat