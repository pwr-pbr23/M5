/*
* to change this template, choose tools | templates
* and open the template in the editor.
*/
package org jruby util
import java io filenotfoundexception
import java io ioexception
import java util regex pattern
/**
*
* @author headius
*/
public class javanamemangler
public static final pattern path_split   pattern compile
public static string mangledfilenameforstartupclasspath string filename
if  filename equals
return
return manglefilenameforclasspath filename  null
public static string manglefilenameforclasspath string filename
return manglefilenameforclasspath filename  null
public static string manglefilenameforclasspath string filename  string parent  string prefix
try
string classpath
if filename indexof        1
string before   filename substring 6  filename indexof
classpath   new jrubyfile before   filename substring filename indexof    1   getcanonicalpath   tostring
else
try
classpath   new jrubyfile filename  getcanonicalpath   tostring
catch  ioexception ioe
// could not get canonical path, just use given path
classpath   filename
if  parent    null    parent length   > 0
string parentpath
try
parentpath   new jrubyfile parent  getcanonicalpath   tostring
catch  ioexception ioe
// could not get canonical path, just use given path
parentpath   parent
if   classpath startswith parentpath
throw new filenotfoundexception     classpath
parentpath
int parentlength   parentpath length
classpath   classpath substring parentlength
string pathelements   path_split split classpath
stringbuffer newpath   new stringbuffer prefix
for  string element   pathelements
if  element length   <  0
continue
if  newpath length   > 0
newpath append
if   character isjavaidentifierstart element charat 0
newpath append
newpath append manglestringforcleanjavaidentifier element
// strip off "_dot_rb" for .rb files
int dotrbindex   newpath indexof
if  dotrbindex     1    dotrbindex    newpath length     7
newpath delete dotrbindex  dotrbindex   7
return newpath tostring
catch  ioexception ioe
ioe printstacktrace
throw new runtimeexception ioe
public static string manglestringforcleanjavaidentifier string name
char characters   name tochararray
stringbuffer cleanbuffer   new stringbuffer
boolean prevwasreplaced   false
for  int i   0  i < characters length  i
if   i    0    character isjavaidentifierstart characters
character isjavaidentifierpart characters
cleanbuffer append characters
prevwasreplaced   false
else
if   prevwasreplaced
cleanbuffer append
prevwasreplaced   true
switch  characters
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
if   i   1  < characters length    characters
cleanbuffer append
i
else
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
case
cleanbuffer append
continue
default
cleanbuffer append integer tohexstring characters   append
return cleanbuffer tostring