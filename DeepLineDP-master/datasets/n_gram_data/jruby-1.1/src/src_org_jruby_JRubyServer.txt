/*
***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
* copyright (c) 2007 ola bini <ola@ologix.com>
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby
import java io bufferedreader
import java io inputstreamreader
import java net inetaddress
import java net inetsocketaddress
import java net serversocket
import java net socket
import java util list
import java util arraylist
/**
* @author <a href="mailto:ola.bini@ki.se">ola bini</a>
*/
public class jrubyserver extends jrubyservice
private configuration conf
private boolean stillstarting   true
private jrubyserver string args  throws exception
conf   new configuration args
if conf isdebug
system err println     conf getport         conf getkey
serversocket server   new serversocket
server bind new inetsocketaddress inetaddress getlocalhost   conf getport
while true
thread t1   new thread new handler server accept
t1 setdaemon true
t1 start
private class handler implements runnable
private socket socket
public handler socket socket
this socket   socket
public void run
try
bufferedreader rr   new bufferedreader new inputstreamreader this socket getinputstream
string command   rr readline
rr close
this socket close
this socket   null
if conf isdebug
system err println     command
string cmds   command split    3
if cmds equals conf getkey
if cmds equals cmd_term
if conf isdebug
system err println
system exit 0
else if cmds equals cmd_no_more
if conf isdebug
system err println
stillstarting   false
else if cmds equals cmd_start
if stillstarting
if conf isdebug
system err println     cmds
new main   run intocommandarguments cmds trim
else
if conf isdebug
system err println
else
if conf isdebug
system err println
else
if conf isdebug
system err println
catch exception e
protected static string intocommandarguments string str
list<string> args   new arraylist<string>
boolean insingle   false
int contentstart    1
for int i 0 j str length   i<j i
if str charat i           insingle    contentstart     1
args add str substring contentstart i
contentstart    1
continue
if str charat i
continue
if str charat i           insingle
insingle   true
contentstart   i 1
continue
if str charat i
insingle   false
args add str substring contentstart i
contentstart    1
continue
if contentstart     1
contentstart   i
if contentstart     1
args add str substring contentstart
return  string args toarray new string
public static void main string args  throws exception
new jrubyserver args
jrubyserver