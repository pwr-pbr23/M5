/***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby util
import java lang reflect field
import java util zip crc32
import java util zip checksum
/**
* this class is a wrapper around adler32 which provides the capability to
* update the running total. this functionality is provided by quite risky
* reflection and should be fixed in a better way later on.
*/
public class crc32ext implements checksum
private int crc
private final crc32 intern
private static final field intern_crc
static
try
intern_crc   crc32 class getdeclaredfield
intern_crc setaccessible true
catch final nosuchfieldexception nsfe
throw new runtimeexception
/**
* creates the basic object with default initial adler.
*/
public crc32ext
this 1
/**
* creates the basic object with the adler provided.
*
* @param adler the number to use as starting point for the crc-32 algorithm
*/
public crc32ext final int crc
super
this crc crc
this intern   new crc32
setcrcref this crc
/**
* sets the adler running total to the specified value.
*
* @param adler the number to use as current value for the crc-32 algorithm
*/
public void setadler final int crc
this crc   crc
setcrcref this crc
/**
* @see java.util.zip.checksum#update
*/
public void update final int b
this intern update b
/**
* @see java.util.zip.checksum#update
*/
public void update final byte b  final int off  final int len
this intern update b off len
/**
* @see java.util.zip.checksum#update
*/
public void update final byte b
this intern update b
/**
* @see java.util.zip.checksum#reset
*/
public void reset
this intern reset
this crc   1
/**
* @see java.util.zip.checksum#getvalue
*/
public long getvalue
return this intern getvalue
/**
* helper method to set the reference through reflection.
*
* @param val the value to set.
*/
private void setcrcref final int val
try
intern_crc setint intern val
catch final illegalaccessexception e
throw new illegalstateexception e tostring