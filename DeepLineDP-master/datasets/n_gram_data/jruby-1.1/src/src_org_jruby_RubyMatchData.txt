/***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
* copyright (c) 2001 alan moore <alan_moore@gmx.net>
* copyright (c) 2001-2004 jan arne petersen <jpetersen@uni-bonn.de>
* copyright (c) 2002 benoit cerrina <b.cerrina@wanadoo.fr>
* copyright (c) 2002-2004 anders bengtsson <ndrsbngtssn@yahoo.se>
* copyright (c) 2004 thomas e enebo <enebo@acm.org>
* copyright (c) 2004 charles o nutter <headius@headius.com>
* copyright (c) 2004 stefan matthias aust <sma@3plus4.de>
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby
import org joni regex
import org joni region
import org joni exception joniexception
import org jruby anno jrubymethod
import org jruby runtime arity
import org jruby runtime block
import org jruby runtime callbackfactory
import org jruby runtime objectallocator
import org jruby runtime threadcontext
import org jruby runtime builtin irubyobject
import org jruby util bytelist
/**
* @author olabini
*/
public class rubymatchdata extends rubyobject
region regs            captures
int begin              begin and end are used when not groups defined
int end
rubystring str
regex pattern
public static rubyclass creatematchdataclass ruby runtime
// todo: is not_allocatable_allocator ok here, since you can't actually instantiate matchdata directly?
rubyclass matchdataclass   runtime defineclass    runtime getobject    objectallocator not_allocatable_allocator
runtime setmatchdata matchdataclass
runtime defineglobalconstant    matchdataclass
matchdataclass kindof   new rubymodule kindof
public boolean iskindof irubyobject obj  rubymodule type
return obj instanceof rubymatchdata
callbackfactory callbackfactory   runtime callbackfactory rubymatchdata class
matchdataclass getmetaclass   undefinemethod
matchdataclass defineannotatedmethods rubymatchdata class
matchdataclass dispatcher   callbackfactory createdispatcher matchdataclass
return matchdataclass
public rubymatchdata ruby runtime
super runtime  runtime getmatchdata
public final static int match_busy   user2_f
// rb_match_busy
public final void use
flags    match_busy
public final boolean used
return  flags   match_busy     0
private rubyarray match_array int start
if  regs    null
if  start    0  return getruntime   newemptyarray
if  begin     1
return getruntime   newarray getruntime   getnil
else
rubystring ss   str makeshared begin  end   begin
if  istaint    ss settaint true
return getruntime   newarray ss
else
rubyarray arr   getruntime   newarray regs numregs   start
for  int i start  i<regs numregs  i
if  regs beg     1
arr append getruntime   getnil
else
rubystring ss   str makeshared regs beg  regs end   regs beg
if  istaint    ss settaint true
arr append ss
return arr
public irubyobject group long n
return rubyregexp nth_match  int n  this
@jrubymethod name
public irubyobject inspect
return anytostring
/** match_to_a
*
*/
@jrubymethod name
public rubyarray to_a
return match_array 0
@jrubymethod name      required   1  rest   true
public irubyobject values_at irubyobject args
return to_a   values_at args
@jrubymethod name      frame   true
public irubyobject select threadcontext context  block block
return block yield context  to_a
/** match_captures
*
*/
@jrubymethod name
public irubyobject captures
return match_array 1
private int nametobackrefnumber rubystring str
bytelist value   str getbytelist
try
return pattern nametobackrefnumber value bytes  value begin  value begin   value realsize  regs
catch  joniexception je
throw getruntime   newindexerror je getmessage
/** match_aref
*
*/
@jrubymethod name      required   1  optional   1
public irubyobject op_aref irubyobject args
final irubyobject rest   args length    2 ? args   null
final irubyobject idx   args
if  rest    null    rest isnil
if  idx instanceof rubyfixnum
int num   rubynumeric fix2int idx
if  num >  0  return rubyregexp nth_match num  this
else
rubystring str
if  idx instanceof rubysymbol
str    rubystring   rubysymbol idx  id2name
else if  idx instanceof rubystring
str    rubystring idx
else
return   rubyarray to_a    aref args
return rubyregexp nth_match nametobackrefnumber str   this
return   rubyarray to_a    aref args
/** match_size
*
*/
@jrubymethod name
public irubyobject size
return regs    null ? rubyfixnum one getruntime      rubyfixnum newfixnum getruntime    regs numregs
/** match_begin
*
*/
@jrubymethod name      required   1
public irubyobject begin irubyobject index
int i   rubynumeric num2int index
if  regs    null
if  i    0  throw getruntime   newindexerror     i
if  begin < 0  return getruntime   getnil
return rubyfixnum newfixnum getruntime    begin
else
if  i < 0    regs numregs <  i  throw getruntime   newindexerror     i
if  regs beg < 0  return getruntime   getnil
return rubyfixnum newfixnum getruntime    regs beg
/** match_end
*
*/
@jrubymethod name      required   1
public irubyobject end irubyobject index
int i   rubynumeric num2int index
if  regs    null
if  i    0  throw getruntime   newindexerror     i
if  end < 0  return getruntime   getnil
return rubyfixnum newfixnum getruntime    end
else
if  i < 0    regs numregs <  i  throw getruntime   newindexerror     i
if  regs end < 0  return getruntime   getnil
return rubyfixnum newfixnum getruntime    regs end
/** match_offset
*
*/
@jrubymethod name      required   1
public irubyobject offset irubyobject index
int i   rubynumeric num2int index
ruby runtime   getruntime
if  regs    null
if  i    0  throw getruntime   newindexerror     i
if  begin < 0  return runtime newarray runtime getnil    runtime getnil
return runtime newarray rubyfixnum newfixnum runtime  begin  rubyfixnum newfixnum runtime  end
else
if  i < 0    regs numregs <  i  throw runtime newindexerror     i
if  regs beg < 0  return runtime newarray runtime getnil    runtime getnil
return runtime newarray rubyfixnum newfixnum runtime  regs beg  rubyfixnum newfixnum runtime  regs end
/** match_pre_match
*
*/
@jrubymethod name
public irubyobject pre_match
rubystring ss
if  regs    null
if begin     1  return getruntime   getnil
ss   str makeshared 0  begin
else
if regs beg     1  return getruntime   getnil
ss   str makeshared 0  regs beg
if  istaint    ss settaint true
return ss
/** match_post_match
*
*/
@jrubymethod name
public irubyobject post_match
rubystring ss
if  regs    null
if  begin     1  return getruntime   getnil
ss   str makeshared end  str getbytelist   length     end
else
if  regs beg     1  return getruntime   getnil
ss   str makeshared regs end  str getbytelist   length     regs end
if istaint    ss settaint true
return ss
/** match_to_s
*
*/
@jrubymethod name
public irubyobject to_s
irubyobject ss   rubyregexp last_match this
if  ss isnil    ss   rubystring newemptystring getruntime
if  istaint    ss settaint true
return ss
/** match_string
*
*/
@jrubymethod name
public irubyobject string
return str    str is frozen
@jrubymethod name      required   1
public irubyobject initialize_copy irubyobject original
if  this    original  return this
if    getmetaclass      original getmetaclass         mri also does a pointer comparison here
throw getruntime   newtypeerror
rubymatchdata origmatchdata    rubymatchdata original
str   origmatchdata str
regs   origmatchdata regs
return this