/***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
* copyright (c) 2006 tim azzopardi <tim@tigerfive.com>
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby environment
import java lang reflect invocationtargetexception
import java lang reflect method
import java util hashmap
import java util iterator
import java util map
import java util vector
import org jruby ruby
class osenvironmentreaderfromapacheant implements iosenvironmentreader
protected map getprocenvironmentmethodv
method getprocenvironment   getprocenvironmentmethod
vector v   new vector
hashmap map   new hashmap
if  getprocenvironment    null
try
v    vector  getprocenvironment invoke null   object  null
catch  illegalargumentexception e
return map
catch  illegalaccessexception e
return map
catch  invocationtargetexception e
return map
string line
int equalspos
for  java util enumeration e    v elements    e hasmoreelements
line    string  e nextelement
equalspos   line indexof
if  equalspos >  1
map put line substring 0  equalspos   line substring equalspos   1
return map
protected method getprocenvironmentmethod
method getprocenvironment
class c
try
c   class forname
catch  classnotfoundexception e
return null
try
getprocenvironment   c getmethod     class  null
catch  securityexception e
return null
catch  nosuchmethodexception e
return null
return getprocenvironment
/* (non-javadoc)
* @see org.jruby.iosenvironment#isaccessible()
*/
public boolean isaccessible ruby runtime
return getprocenvironmentmethod      null
/* (non-javadoc)
* @see org.jruby.iosenvironment#getvariables()
*/
public map getvariables ruby runtime
return getprocenvironmentmethodv
public static void main string args
osenvironmentreaderfromapacheant getenv   new osenvironmentreaderfromapacheant
map envs   getenv getvariables null
for  iterator i   envs entryset   iterator    i hasnext
map entry entry    map entry  i next
system out println entry getkey         entry getvalue
system out println