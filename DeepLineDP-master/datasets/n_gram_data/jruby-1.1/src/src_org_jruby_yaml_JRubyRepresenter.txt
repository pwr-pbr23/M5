/***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
* copyright (c) 2006 ola bini <ola@ologix.com>
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby yaml
import java io ioexception
import org jruby rubyclass
import org jruby rubymodule
import org jruby rubyhash
import org jruby rubyarray
import org jruby rubystring
import org jruby internal runtime methods javamethod
import org jruby runtime builtin irubyobject
import org jruby javasupport javaembedutils
import org jvyamlb saferepresenterimpl
import org jvyamlb serializer
import org jvyamlb representer
import org jvyamlb yamlconfig
import org jvyamlb yamlnodecreator
import org jvyamlb nodes node
import org jruby util bytelist
/**
* @author <a href="mailto:ola.bini@ki.se">ola bini</a>
*/
public class jrubyrepresenter extends saferepresenterimpl
public jrubyrepresenter final serializer serializer  final yamlconfig opts
super serializer opts
protected yamlnodecreator getnodecreatorfor final object data
if data instanceof yamlnodecreator
return  yamlnodecreator data
else if data instanceof irubyobject
return new irubyobjectyamlnodecreator data
else
return super getnodecreatorfor data
public node map string tag  java util map mapping  object flowstyle  throws ioexception
if null    flowstyle
return map tag mapping false
else
return map tag mapping true
public node seq string tag  java util list sequence  object flowstyle  throws ioexception
if sequence instanceof rubyarray
sequence     rubyarray sequence  getlist
if null    flowstyle
return seq tag sequence false
else
return seq tag sequence true
public node scalar string tag  string val  string style  throws ioexception
return scalar tag  bytelist create val   style
public node scalar string tag  bytelist val  string style  throws ioexception
if null    style    style length      0
return scalar tag val  char 0
else
return scalar tag val style charat 0
protected boolean ignorealiases final object data
return  data instanceof irubyobject      irubyobject data  isnil       super ignorealiases data
public static class irubyobjectyamlnodecreator implements yamlnodecreator
private final irubyobject data
private final rubyclass outclass
public irubyobjectyamlnodecreator final object data
this data    irubyobject data
this outclass     rubyclass    rubymodule this data getruntime   getmodule    getconstant      getconstant
public string taguri
return data callmethod data getruntime   getcurrentcontext       tostring
public node toyamlnode final representer representer  throws ioexception
if data getmetaclass   searchmethod       data getruntime   getobjecttoyamlmethod
data getmetaclass   searchmethod    isundefined      in this case  hope that it works out correctly when calling to_yaml_node  rails does this
// to_yaml have not been overridden
object val   data callmethod data getruntime   getcurrentcontext       javaembedutils javatoruby data getruntime   representer
if val instanceof node
return  node val
else if val instanceof irubyobject
return  node javaembedutils rubytojava data getruntime    irubyobject val node class
else
irubyobject val   data callmethod data getruntime   getcurrentcontext       javaembedutils javatoruby data getruntime   representer
if  outclass isinstance val
throw val getruntime   newtypeerror     val getmetaclass   getrealclass
irubyobject value   val callmethod data getruntime   getcurrentcontext
irubyobject style   val callmethod data getruntime   getcurrentcontext
irubyobject type_id   val callmethod data getruntime   getcurrentcontext
string s   null
if  style isnil
s   style tostring
string t   type_id tostring
if value instanceof rubyhash
return   jrubyrepresenter representer  map t   rubyhash value  s
else if value instanceof rubyarray
return   jrubyrepresenter representer  seq t   rubyarray value  s
else
return   jrubyrepresenter representer  scalar t    rubystring value  getbytelist    s
return null
jrubyrepresenter