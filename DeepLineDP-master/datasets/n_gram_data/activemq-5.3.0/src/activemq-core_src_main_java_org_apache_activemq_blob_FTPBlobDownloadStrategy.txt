/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq blob
import java io ioexception
import java io inputstream
import java net connectexception
import java net url
import javax jms jmsexception
import org apache activemq command activemqblobmessage
import org apache commons net ftp ftpclient
/**
* a ftp implementation for {@link blobdownloadstrategy}.
*/
public class ftpblobdownloadstrategy implements blobdownloadstrategy
private string ftpuser
private string ftppass
public inputstream getinputstream activemqblobmessage message  throws ioexception  jmsexception
url url   message geturl
setuserinformation url getuserinfo
string connecturl   url gethost
int port   url getport   < 1 ? 21   url getport
ftpclient ftp   new ftpclient
try
ftp connect connecturl  port
catch connectexception e
throw new jmsexception
if  ftp login ftpuser  ftppass
ftp quit
ftp disconnect
throw new jmsexception
string path   url getpath
string workingdir   path substring 0  path lastindexof
string file   path substring path lastindexof    1
ftp changeworkingdirectory workingdir
ftp setfiletype ftpclient binary_file_type
inputstream input   ftp retrievefilestream file
ftp quit
ftp disconnect
return input
private void setuserinformation string userinfo
if userinfo    null
string userpass   userinfo split
if userpass length > 0  this ftpuser   userpass
if userpass length > 1  this ftppass   userpass
else
this ftpuser
this ftppass