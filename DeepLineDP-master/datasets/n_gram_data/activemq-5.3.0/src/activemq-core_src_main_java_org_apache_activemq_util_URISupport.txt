/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq util
import java io unsupportedencodingexception
import java net uri
import java net urisyntaxexception
import java net urldecoder
import java net urlencoder
import java util arraylist
import java util collections
import java util hashmap
import java util iterator
import java util list
import java util map
/**
* @version $revision$
*/
public class urisupport
public static class compositedata
private string host
private string scheme
private string path
private uri components
private map<string  string> parameters
private string fragment
public uri getcomponents
return components
public string getfragment
return fragment
public map<string  string> getparameters
return parameters
public string getscheme
return scheme
public string getpath
return path
public string gethost
return host
public uri touri   throws urisyntaxexception
stringbuffer sb   new stringbuffer
if  scheme    null
sb append scheme
sb append
if  host    null    host length      0
sb append host
else
sb append
for  int i   0  i < components length  i
if  i    0
sb append
sb append components tostring
sb append
if  path    null
sb append
sb append path
if   parameters isempty
sb append
sb append createquerystring parameters
if  fragment    null
sb append
sb append fragment
return new uri sb tostring
public static map<string  string> parsequery string uri  throws urisyntaxexception
try
map<string  string> rc   new hashmap<string  string>
if  uri    null
string parameters   uri split
for  int i   0  i < parameters length  i
int p   parameters indexof
if  p >  0
string name   urldecoder decode parameters substring 0  p
string value   urldecoder decode parameters substring p   1
rc put name  value
else
rc put parameters  null
return rc
catch  unsupportedencodingexception e
throw  urisyntaxexception new urisyntaxexception e tostring       initcause e
public static map<string  string> parseparamters uri uri  throws urisyntaxexception
return uri getquery      null ? emptymap     parsequery stripprefix uri getquery
public static uri applyparameters uri uri  map<string  string> queryparameters  throws urisyntaxexception
if  queryparameters    null     queryparameters isempty
stringbuffer newquery   uri getrawquery      null ? new stringbuffer uri getrawquery      new stringbuffer
for   map entry<string  string> param  queryparameters entryset
if  newquery length    0
newquery append
newquery append param getkey    append    append param getvalue
uri   createuriwithquery uri  newquery tostring
return uri
@suppresswarnings
private static map<string  string> emptymap
return collections empty_map
/**
* removes any uri query from the given uri
*/
public static uri removequery uri uri  throws urisyntaxexception
return createuriwithquery uri  null
/**
* creates a uri with the given query
*/
public static uri createuriwithquery uri uri  string query  throws urisyntaxexception
return new uri uri getscheme    uri getuserinfo    uri gethost    uri getport    uri getpath
query  uri getfragment
public static compositedata parsecomposite uri uri  throws urisyntaxexception
compositedata rc   new compositedata
rc scheme   uri getscheme
string ssp   stripprefix uri getschemespecificpart   trim       trim
parsecomposite uri  rc  ssp
rc fragment   uri getfragment
return rc
/**
* @param uri
* @param rc
* @param ssp
* @param p
* @throws urisyntaxexception
*/
private static void parsecomposite uri uri  compositedata rc  string ssp  throws urisyntaxexception
string componentstring
string params
if   checkparenthesis ssp
throw new urisyntaxexception uri tostring
int p
int intialparen   ssp indexof
if  intialparen    0
rc host   ssp substring 0  intialparen
p   rc host indexof
if  p >  0
rc path   rc host substring p
rc host   rc host substring 0  p
p   ssp lastindexof
componentstring   ssp substring intialparen   1  p
params   ssp substring p   1  trim
else
componentstring   ssp
params
string components   splitcomponents componentstring
rc components   new uri
for  int i   0  i < components length  i
rc components   new uri components trim
p   params indexof
if  p >  0
if  p > 0
rc path   stripprefix params substring 0  p
rc parameters   parsequery params substring p   1
else
if  params length   > 0
rc path   stripprefix params
rc parameters   emptymap
/**
* @param componentstring
* @return
*/
private static string splitcomponents string str
list<string> l   new arraylist<string>
int last   0
int depth   0
char chars   str tochararray
for  int i   0  i < chars length  i
switch  chars
case
depth
break
case
depth
break
case
if  depth    0
string s   str substring last  i
l add s
last   i   1
break
default
string s   str substring last
if  s length      0
l add s
string rc   new string
l toarray rc
return rc
public static string stripprefix string value  string prefix
if  value startswith prefix
return value substring prefix length
return value
public static uri stripscheme uri uri  throws urisyntaxexception
return new uri stripprefix uri getschemespecificpart   trim
public static string createquerystring map options  throws urisyntaxexception
try
if  options size   > 0
stringbuffer rc   new stringbuffer
boolean first   true
for  iterator iter   options keyset   iterator    iter hasnext
if  first
first   false
else
rc append
string key    string iter next
string value    string options get key
rc append urlencoder encode key
rc append
rc append urlencoder encode value
return rc tostring
else
return
catch  unsupportedencodingexception e
throw  urisyntaxexception new urisyntaxexception e tostring       initcause e
/**
* creates a uri from the original uri and the remaining paramaters
*
* @throws urisyntaxexception
*/
public static uri createremaininguri uri originaluri  map params  throws urisyntaxexception
string s   createquerystring params
if  s length      0
s   null
return createuriwithquery originaluri  s
public static uri changescheme uri bindaddr  string scheme  throws urisyntaxexception
return new uri scheme  bindaddr getuserinfo    bindaddr gethost    bindaddr getport    bindaddr
getpath    bindaddr getquery    bindaddr getfragment
public static boolean checkparenthesis string str
boolean result   true
if  str    null
int open   0
int closed   0
int i   0
while   i   str indexof    i   >  0
i
open
i   0
while   i   str indexof    i   >  0
i
closed
result   open    closed
return result
public int indexofparenthesismatch string str
int result    1
return result