/*
derby - class org.apache.derby.impl.sql.catalog.sysforeignkeysrowfactory
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl sql catalog
import org apache derby iapi types typeid
import org apache derby iapi sql dictionary systemcolumn
import org apache derby catalog typedescriptor
import org apache derby iapi types datavaluedescriptor
import org apache derby iapi types datavaluefactory
import org apache derby iapi types rowlocation
import org apache derby iapi sql dictionary catalogrowfactory
import org apache derby iapi sql dictionary constraintdescriptor
import org apache derby iapi sql dictionary conglomeratedescriptor
import org apache derby iapi sql dictionary datadescriptorgenerator
import org apache derby iapi sql dictionary datadictionary
import org apache derby iapi sql dictionary datadictionarycontext
import org apache derby iapi sql dictionary foreignkeyconstraintdescriptor
import org apache derby iapi sql dictionary keyconstraintdescriptor
import org apache derby iapi sql dictionary referencedkeyconstraintdescriptor
import org apache derby iapi sql dictionary tupledescriptor
import org apache derby iapi sql dictionary subkeyconstraintdescriptor
import org apache derby iapi sql statementtype
import org apache derby iapi sql execute executioncontext
import org apache derby iapi sql execute execindexrow
import org apache derby iapi sql execute execrow
import org apache derby iapi sql execute executionfactory
import org apache derby iapi error standardexception
import org apache derby iapi types rowlocation
import org apache derby iapi services sanity sanitymanager
import org apache derby iapi services uuid uuidfactory
import org apache derby catalog uuid
import org apache derby catalog indexdescriptor
/**
* factory for creating a sysforeignkeys row.
*
* @author jerry
*/
public class sysforeignkeysrowfactory extends catalogrowfactory
private  static final string	tablename_string
protected static final int		sysforeignkeys_column_count   5
protected static final int		sysforeignkeys_constraintid   1
protected static final int		sysforeignkeys_conglomerateid   2
protected static final int		sysforeignkeys_keyconstraintid   3
protected static final int		sysforeignkeys_deleterule   4
protected static final int		sysforeignkeys_updaterule   5
// column widths
protected static final int		sysforeignkeys_constraintid_width   36
protected static final int		sysforeignkeys_index1_id   0
protected static final int		sysforeignkeys_index2_id   1
private static final int indexcolumnpositions
sysforeignkeys_constraintid
sysforeignkeys_keyconstraintid
private	static	final	boolean	uniqueness
true
false
private	static	final	string	uuids
catalog uuid
heap uuid
sysforeignkeys_index1
sysforeignkeys_index2
/////////////////////////////////////////////////////////////////////////////
//
//	constructors
//
/////////////////////////////////////////////////////////////////////////////
public	sysforeignkeysrowfactory uuidfactory uuidf  executionfactory ef  datavaluefactory dvf
boolean convertidtolower
super uuidf ef dvf convertidtolower
initinfo sysforeignkeys_column_count  tablename_string
indexcolumnpositions  uniqueness  uuids
/////////////////////////////////////////////////////////////////////////////
//
//	methods
//
/////////////////////////////////////////////////////////////////////////////
/**
* make a sysforeignkeys row
*
* @return	row suitable for inserting into sysforeignkeys.
*
* @exception   standardexception thrown on failure
*/
public execrow makerow tupledescriptor td  tupledescriptor parent
throws standardexception
datavaluedescriptor		col
execindexrow			row
string					constraintid   null
string					keyconstraintid   null
string					conglomid   null
string	                radeleterule
string					raupdaterule
if  td    null
foreignkeyconstraintdescriptor cd    foreignkeyconstraintdescriptor td
constraintid   cd getuuid   tostring
referencedkeyconstraintdescriptor refcd   cd getreferencedconstraint
if  sanitymanager debug
sanitymanager assert refcd    null
keyconstraintid   refcd getuuid   tostring
conglomid   cd getindexuuidstring
radeleterule   getrefactionasstring cd getradeleterule
raupdaterule   getrefactionasstring cd getraupdaterule
/* build the row  */
row   getexecutionfactory   getindexablerow sysforeignkeys_column_count
/* 1st column is constraintid (uuid - char(36)) */
row setcolumn sysforeignkeys_constraintid  dvf getchardatavalue constraintid
/* 2nd column is conglomerateid (uuid - char(36)) */
row setcolumn sysforeignkeys_conglomerateid  dvf getchardatavalue conglomid
/* 3rd column is keyconstraintid (uuid - char(36)) */
row setcolumn sysforeignkeys_keyconstraintid  dvf getchardatavalue keyconstraintid
// currently, deleterule and updaterule are always "r" for restrict
/* 4th column is deleterule char(1) */
row setcolumn sysforeignkeys_deleterule  dvf getchardatavalue radeleterule
/* 5th column is updaterule char(1) */
row setcolumn sysforeignkeys_updaterule  dvf getchardatavalue raupdaterule
return row
///////////////////////////////////////////////////////////////////////////
//
//	abstract methods to be implemented by children of catalogrowfactory
//
///////////////////////////////////////////////////////////////////////////
/**
* make a viewdescriptor out of a sysforeignkeys row
*
* @param row a sysforeignkeys row
* @param parenttupledescriptor	null for this kind of descriptor.
* @param dd datadictionary
*
* @exception   standardexception thrown on failure
*/
public tupledescriptor builddescriptor
execrow					row
tupledescriptor			parenttupledescriptor
datadictionary 			dd
throws standardexception
if  sanitymanager debug
sanitymanager assert
row ncolumns      sysforeignkeys_column_count
datavaluedescriptor		col
datadescriptorgenerator ddg
uuid					constraintuuid
uuid					conglomerateuuid
uuid					keyconstraintuuid
string					constraintuuidstring
string					conglomerateuuidstring
string                  rarulestring
int                     radeleterule
int                     raupdaterule
ddg   dd getdatadescriptorgenerator
/* 1st column is constraintid (uuid - char(36)) */
col   row getcolumn sysforeignkeys_constraintid
constraintuuidstring   col getstring
constraintuuid   getuuidfactory   recreateuuid constraintuuidstring
/* 2nd column is conglomerateid (uuid - char(36)) */
col   row getcolumn sysforeignkeys_conglomerateid
conglomerateuuidstring   col getstring
conglomerateuuid   getuuidfactory   recreateuuid conglomerateuuidstring
/* 3rd column is keyconstraintid (uuid - char(36)) */
col   row getcolumn sysforeignkeys_keyconstraintid
constraintuuidstring   col getstring
keyconstraintuuid   getuuidfactory   recreateuuid constraintuuidstring
/* 4th column is deleterule char(1) */
col  row getcolumn sysforeignkeys_deleterule
rarulestring   col getstring
radeleterule    getrefactionasint rarulestring
/* 5th column is updaterule char(1) */
col   row getcolumn sysforeignkeys_updaterule
rarulestring   col getstring
raupdaterule    getrefactionasint rarulestring
/* now build and return the descriptor */
return new subkeyconstraintdescriptor
constraintuuid
conglomerateuuid
keyconstraintuuid
radeleterule
raupdaterule
/**
* builds a list of columns suitable for creating this catalog.
*
*
* @return array of systemcolumn suitable for making this catalog.
*/
public systemcolumn	buildcolumnlist
int						index   0
systemcolumn			columnlist   new systemcolumn
// describe columns
columnlist   new systemcolumnimpl
convertidcase     			   name
sysforeignkeys_constraintid 	   column number
0 					   precision
0 					   scale
false 				   nullability
datatype
true 				   built in type
36					   maxlength
columnlist   new systemcolumnimpl
convertidcase     			   name
sysforeignkeys_conglomerateid 	   column number
0 					   precision
0 					   scale
false 				   nullability
datatype
true 				   built in type
36					   maxlength
columnlist   new systemcolumnimpl
convertidcase     			   name
sysforeignkeys_keyconstraintid 	   column number
0 					   precision
0 					   scale
false 				   nullability
datatype
true 				   built in type
36					   maxlength
columnlist   new systemcolumnimpl
convertidcase     			   name
sysforeignkeys_deleterule 	   column number
0 					   precision
0 					   scale
false 				   nullability
datatype
true 				   built in type
1					   maxlength
columnlist   new systemcolumnimpl
convertidcase     			   name
sysforeignkeys_updaterule 	   column number
0 					   precision
0 					   scale
false 				   nullability
datatype
true 				   built in type
1					   maxlength
return	columnlist
int getrefactionasint string rarulestring
int rarule
switch  rarulestring charat 0
case
rarule   statementtype ra_cascade
break
case
rarule   statementtype ra_restrict
break
case
rarule   statementtype ra_noaction
break
case
rarule   statementtype ra_setnull
break
case
rarule   statementtype ra_setdefault
break
default
rarule  statementtype ra_noaction
if  sanitymanager debug
sanitymanager throwassert
rarulestring
return rarule
string getrefactionasstring int rarule
string rarulestring
switch  rarule
case statementtype ra_cascade
rarulestring
break
case statementtype ra_restrict
rarulestring
break
case statementtype ra_noaction
rarulestring
break
case statementtype ra_setnull
rarulestring
break
case statementtype ra_setdefault
rarulestring
rarule   statementtype ra_setdefault
break
default
rarulestring         no action  default value
if  sanitymanager debug
sanitymanager throwassert
rarule
return rarulestring