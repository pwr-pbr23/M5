/*
derby - class org.apache.derby.ui.popup.actions.addderbynature
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby ui popup actions
import org apache derby ui common commonnames
import org apache derby ui common messages
import org apache derby ui util derbyutils
import org apache derby ui util logger
import org apache derby ui util selectionutil
import org eclipse core resources iproject
import org eclipse core resources iprojectdescription
import org eclipse core resources iresource
import org eclipse core runtime istatus
import org eclipse jdt core iclasspathentry
import org eclipse jdt core ijavaproject
import org eclipse jdt core javacore
import org eclipse jface action iaction
import org eclipse jface dialogs messagedialog
import org eclipse jface viewers iselection
import org eclipse jface window applicationwindow
import org eclipse swt swt
import org eclipse swt graphics cursor
import org eclipse swt widgets shell
import org eclipse ui iobjectactiondelegate
import org eclipse ui iworkbenchpart
import org eclipse ui iworkbenchwindow
import org eclipse ui platformui
public class addderbynature implements iobjectactiondelegate
private ijavaproject currentjavaproject
private iproject currentproject
/*
* (non-javadoc)
*
* @see org.eclipse.ui.iobjectactiondelegate#setactivepart(org.eclipse.jface.action.iaction,
*      org.eclipse.ui.iworkbenchpart)
*/
public void setactivepart iaction action  iworkbenchpart targetpart
/*
* (non-javadoc)
*
* @see org.eclipse.ui.iactiondelegate#run(org.eclipse.jface.action.iaction)
*/
public void run iaction action
iworkbenchwindow window   platformui getworkbench
getactiveworkbenchwindow
cursor waitcursor   new cursor window getshell   getdisplay
swt cursor_wait
try
window getshell   setcursor waitcursor
applicationwindow  window  setstatus messages adding_nature
//new way
if  currentjavaproject    null
// if the java nature is not present
// it must be added, along with the derby nature
iprojectdescription description   currentproject
getdescription
string natureids   description getnatureids
string newnatures   new string
system arraycopy natureids  0  newnatures  0  natureids length
newnatures   javacore nature_id
newnatures   commonnames derby_nature
description setnatureids newnatures
currentproject setdescription description  null
currentjavaproject    ijavaproject  javacore
create  iproject  currentproject
else
//add the derby nature, the java nature is already present
iprojectdescription description   currentjavaproject
getproject   getdescription
string natures   description getnatureids
string newnatures   new string
system arraycopy natures  0  newnatures  0  natures length
// must prefix with plugin id
newnatures   commonnames derby_nature
description setnatureids newnatures
currentjavaproject getproject   setdescription description

iclasspathentry rawclasspath   currentjavaproject
getrawclasspath
currentjavaproject setrawclasspath derbyutils
addderbyjars rawclasspath   null
// refresh project so user sees new files, libraries, etc
currentjavaproject getproject   refreshlocal
iresource depth_infinite  null
applicationwindow  window  setstatus messages derby_nature_added
catch   exception e
logger log messages error_adding_nature
currentjavaproject getproject   getname         e
istatus error
shell shell   new shell
messagedialog openinformation shell  commonnames plugin_name
messages error_adding_nature
selectionutil getstatusmessages e
finally
window getshell   setcursor null
waitcursor dispose
/*
* (non-javadoc)
*
* @see org.eclipse.ui.iactiondelegate#selectionchanged(org.eclipse.jface.action.iaction,
*      org.eclipse.jface.viewers.iselection)
*/
public void selectionchanged iaction action  iselection selection
currentjavaproject   selectionutil findselectedjavaproject selection
if  currentjavaproject    null
currentproject   org apache derby ui util selectionutil
findselectedproject selection