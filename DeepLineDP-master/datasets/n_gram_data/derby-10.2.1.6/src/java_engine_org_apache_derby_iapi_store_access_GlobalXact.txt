/*
derby - class org.apache.derby.iapi.store.access.globalxact
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby iapi store access
/**
this abstract class represents a global transaction id which can be tested
for equality against other transaction ids, which can be hashed into a
hash table, and which can be output as a string.
<p>
this class has 2 direct subclasses.
<ul>
<li> org.apache.derby.iapi.store.access.xa.xaxactid :
this class is a specific implementation of the jta xid interface
<li> org.apache.derby.impl.store.access.globalxactid :
this class represents internal cloudscape transaction ids
</ul>
<p>
the main reason for this class is to ensure that equality etc. works in a
consistent way across both subclasses.
**/
public abstract class globalxact
/**************************************************************************
* protected fields of the class
**************************************************************************
*/
protected int     format_id
protected byte  global_id
protected byte  branch_id
public boolean equals object other
if  other    this
return true
if  other instanceof globalxact
globalxact other_xact    globalxact  other
return
java util arrays equals
other_xact global_id
this global_id
java util arrays equals
other_xact branch_id
this branch_id
other_xact format_id    this format_id
return false
public string tostring
string globalhex
string branchhex
if  global_id    null
int mask   0
for  int i   0  i < global_id length  i
mask    global_id   0xff
globalhex    integer tohexstring mask
if  branch_id    null
int mask   0
for  int i   0  i < branch_id length  i
mask    branch_id   0xff
branchhex    integer tohexstring mask
return     format_id       globalhex       branchhex
/**
provide a hashcode which is compatable with the equals() method.
@see java.lang.object#hashcode
**/
public int hashcode
// make sure hash does not overflow int, the only unknown is
// format_id.  lop off top bits.
int hash   global_id length   branch_id length    format_id   0xfffffff
for  int i   0  i < global_id length  i
hash    global_id
for  int i   0  i < branch_id length  i
hash    branch_id
return hash