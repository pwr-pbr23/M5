/*
derby - class org.apache.derby.impl.sql.execute.locktableconstantaction
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl sql execute
import org apache derby iapi services sanity sanitymanager
import org apache derby iapi sql execute constantaction
import org apache derby iapi reference sqlstate
import org apache derby iapi sql activation
import org apache derby iapi error standardexception
import org apache derby iapi store access conglomeratecontroller
import org apache derby iapi store access transactioncontroller
import org apache derby catalog uuid
/**
*	this class describes actions that are always performed for a
*	lock table statement at execution time.
*
*	@author jamie
*/
class locktableconstantaction extends genericconstantaction
private final string					fulltablename
private final long					conglomeratenumber
private final boolean					exclusivemode
// constructors
/**
* make the constantaction for a lock table statement.
*
*  @param fulltablename		full name of the table.
*  @param conglomeratenumber	conglomerate number for the heap
*  @param exclusivemode		whether or not to get an exclusive lock.
*/
locktableconstantaction string fulltablename
long conglomeratenumber  boolean exclusivemode
this fulltablename   fulltablename
this conglomeratenumber   conglomeratenumber
this exclusivemode   exclusivemode
// object methods
public	string	tostring
// do not put this under sanitymanager.debug - it is needed for
// error reporting.
return     fulltablename
// interface methods
/**
*	this is the guts of the execution-time logic for lock table.
*
*	@see constantaction#executeconstantaction
*
* @exception standardexception		thrown on failure
*/
public void	executeconstantaction  activation activation
throws standardexception
conglomeratecontroller	cc
transactioncontroller	tc
/* get a conglomeratecontroller for the base conglomerate */
tc   activation gettransactioncontroller
try
cc   tc openconglomerate
conglomeratenumber
false
exclusivemode  ?
transactioncontroller openmode_forupdate
transactioncontroller openmode_for_lock_only
transactioncontroller openmode_for_lock_only
transactioncontroller mode_table
transactioncontroller isolation_serializable
cc close
catch  standardexception se
string msgid   se getmessageid
if  msgid equals sqlstate deadlock     msgid equals sqlstate lock_timeout     msgid equals sqlstate lock_timeout_log
string mode    exclusivemode  ?
se   standardexception newexception sqlstate lang_cant_lock_table  se  fulltablename  mode
throw se