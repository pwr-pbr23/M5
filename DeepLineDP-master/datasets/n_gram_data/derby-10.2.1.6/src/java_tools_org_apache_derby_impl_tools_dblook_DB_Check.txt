/*
derby - class org.apache.derby.impl.tools.dblook.db_check
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl tools dblook
import java sql connection
import java sql statement
import java sql preparedstatement
import java sql resultset
import java sql sqlexception
import java util hashmap
import java util arraylist
import java util stringtokenizer
import org apache derby tools dblook
public class db_check
/* ************************************************
* generate the ddl for all checks in a given
* database.
* @param conn connection to the source database.
* @return the ddl for the indexes has been written
*  to output via logs.java.
****/
public static void dochecks connection conn
throws sqlexception
statement stmt   conn createstatement
resultset rs   stmt executequery
boolean firsttime   true
while  rs next
string tableid   rs getstring 2
string tablename   dblook lookuptableid tableid
if  dblook isexcludedtable tablename
// table isn't specified in user-given list; skip it.
continue
if  firsttime
logs reportstring
logs reportmessage
logs reportstring
stringbuffer chkstring   createcheckstring tablename  rs
logs writetonewddl chkstring tostring
logs writestmtendtonewddl
logs writenewlinetonewddl
firsttime   false
stmt close
rs close
return
/* ************************************************
* generate ddl for a specific check.
* @param tablename name of the table on which the check
*   exists.
* @param acheck information about the check in question.
* @return the ddl for the specified check has been
*  generated returned as a stringbuffer.
****/
private static stringbuffer createcheckstring  string tablename
resultset acheck  throws sqlexception
stringbuffer sb   new stringbuffer
sb append tablename
sb append
string constraintname   dblook addquotes
dblook expanddoublequotes acheck getstring 1
sb append
sb append constraintname
sb append
sb append dblook removenewlines acheck getstring 4
return sb