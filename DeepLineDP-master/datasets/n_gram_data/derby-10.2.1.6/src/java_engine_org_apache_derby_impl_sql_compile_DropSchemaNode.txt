/*
derby - class org.apache.derby.impl.sql.compile.dropschemanode
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package	org apache derby impl sql compile
import org apache derby iapi sql compile compilercontext
import org apache derby iapi sql conn authorizer
import org apache derby iapi sql conn languageconnectioncontext
import org apache derby iapi sql execute constantaction
import org apache derby iapi error standardexception
import org apache derby iapi services sanity sanitymanager
import org apache derby iapi reference sqlstate
/**
* a dropschemanode is the root of a querytree that represents
* a drop schema statement.
*
* @author jamie
*/
public class dropschemanode extends ddlstatementnode
private int			dropbehavior
private string		schemaname
/**
* initializer for a dropschemanode
*
* @param schemaname		the name of the object being dropped
* @param dropbehavior		drop behavior (restrict | cascade)
*
*/
public void init object schemaname  object dropbehavior
throws standardexception
initandcheck null
this schemaname    string  schemaname
this dropbehavior     integer  dropbehavior  intvalue
public querytreenode bind   throws standardexception
languageconnectioncontext lcc   getlanguageconnectioncontext
/*
** users are not permitted to drop
** the sys or app schemas.
*/
if  getdatadictionary   issystemschemaname schemaname
throw standardexception newexception
sqlstate lang_cannot_drop_system_schemas  this schemaname
/*
** in sql authorization mode, the current authorization identifier
** must be either the owner of the schema or the database owner
** in order for the schema object to be dropped.
*/
if  isprivilegecollectionrequired
getcompilercontext   addrequiredschemapriv schemaname
lcc getauthorizationid
authorizer drop_schema_priv
return this
/**
* convert this object to a string.  see comments in querytreenode.java
* for how this should be done for tree printing.
*
* @return	this object as a string
*/
public string tostring
if  sanitymanager debug
return super tostring
dropbehavior
else
return
public string statementtostring
return
// inherit generate() method from ddlstatementnode
/**
* create the constant information that will drive the guts of execution.
*
* @exception standardexception		thrown on failure
*/
public constantaction	makeconstantaction   throws standardexception
return	getgenericconstantactionfactory   getdropschemaconstantaction schemaname