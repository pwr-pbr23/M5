/*
derby - class org.apache.derby.impl.sql.catalog.sysschemasrowfactory
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl sql catalog
import org apache derby iapi types datatypedescriptor
import org apache derby iapi types typeid
import org apache derby iapi types datavaluedescriptor
import org apache derby iapi types typeid
import org apache derby iapi sql dictionary systemcolumn
import org apache derby catalog typedescriptor
import org apache derby iapi types datavaluefactory
import org apache derby iapi types rowlocation
import org apache derby iapi sql dictionary catalogrowfactory
import org apache derby iapi sql dictionary datadescriptorgenerator
import org apache derby iapi sql dictionary datadictionary
import org apache derby iapi sql dictionary schemadescriptor
import org apache derby iapi sql dictionary tupledescriptor
import org apache derby iapi sql execute executionfactory
import org apache derby iapi sql execute execindexrow
import org apache derby iapi sql execute execrow
import org apache derby iapi error standardexception
import org apache derby iapi services monitor monitor
import org apache derby catalog uuid
import org apache derby iapi services uuid uuidfactory
import org apache derby iapi services sanity sanitymanager
/**
* factory for creating a sysschemas row.
*
*
* @version 0.1
* @author jamie
*/
public class sysschemasrowfactory extends catalogrowfactory
private	static	final	string	tablename_string
public	static	final	int		sysschemas_column_count   3
/* column #s for sysinfo (1 based) */
public	static	final	int		sysschemas_schemaid   1
public	static	final	int		sysschemas_schemaname   2
public	static	final	int		sysschemas_schemaaid   3
protected static final int		sysschemas_index1_id   0
protected static final int		sysschemas_index2_id   1
private static final int indexcolumnpositions
sysschemas_schemaname
sysschemas_schemaid
private	static	final	boolean	uniqueness   null
private	static	final	string	uuids
catalog uuid
heap uuid
sysschemas_index1
sysschemas_index2
/////////////////////////////////////////////////////////////////////////////
//
//	constructors
//
/////////////////////////////////////////////////////////////////////////////
public	sysschemasrowfactory uuidfactory uuidf  executionfactory ef  datavaluefactory dvf
boolean convertidtolower
super uuidf ef dvf convertidtolower
initinfo sysschemas_column_count  tablename_string
indexcolumnpositions  uniqueness  uuids
/////////////////////////////////////////////////////////////////////////////
//
//	methods
//
/////////////////////////////////////////////////////////////////////////////
/**
* make a sysschemas row
*
* @return	row suitable for inserting into sysschemas.
*
* @exception   standardexception thrown on failure
*/
public execrow makerow tupledescriptor td  tupledescriptor parent
throws standardexception
datatypedescriptor		dtd
execrow    				row
datavaluedescriptor		col
string					name   null
uuid						oid   null
string					uuid   null
string					aid   null
if  td    null
schemadescriptor	schemadescriptor    schemadescriptor td
name   schemadescriptor getschemaname
oid   schemadescriptor getuuid
if   oid    null
oid   getuuidfactory   createuuid
schemadescriptor setuuid oid
uuid   oid tostring
aid   schemadescriptor getauthorizationid
/* build the row to insert */
row   getexecutionfactory   getvaluerow sysschemas_column_count
/* 1st column is schemaid */
row setcolumn 1  dvf getchardatavalue uuid
/* 2nd column is schemaname */
row setcolumn 2  dvf getvarchardatavalue name
/* 3rd column is schemaaid */
row setcolumn 3  dvf getvarchardatavalue aid
return row
///////////////////////////////////////////////////////////////////////////
//
//	abstract methods to be implemented by children of catalogrowfactory
//
///////////////////////////////////////////////////////////////////////////
/**
* make an  tuple descriptor out of a sysschemas row
*
* @param row 					a sysschemas row
* @param parenttupledescriptor	unused
* @param dd 					datadictionary
*
* @return	a  descriptor equivalent to a sysschemas row
*
* @exception   standardexception thrown on failure
*/
public tupledescriptor builddescriptor
execrow					row
tupledescriptor			parenttupledescriptor
datadictionary 			dd
throws standardexception
datavaluedescriptor			col
schemadescriptor			descriptor
string						name
uuid							id
string						aid
string						uuid
datadescriptorgenerator		ddg   dd getdatadescriptorgenerator
if  sanitymanager debug
sanitymanager assert row ncolumns      sysschemas_column_count
// first column is schemaid (uuid - char(36))
col   row getcolumn 1
uuid   col getstring
id   getuuidfactory   recreateuuid uuid
// second column is schemaname (varchar(128))
col   row getcolumn 2
name   col getstring
// third column is auid (varchar(128))
col   row getcolumn 3
aid   col getstring
descriptor   ddg newschemadescriptor name  aid  id
return descriptor
/**
* builds a list of columns suitable for creating this catalog.
*
*
* @return array of systemcolumn suitable for making this catalog.
*/
public systemcolumn	buildcolumnlist
int						index   0
systemcolumn			columnlist   new systemcolumn
// describe columns
columnlist   new systemcolumnimpl
convertidcase     			   name
sysschemas_schemaid 	   column number
0 					   precision
0 					   scale
false 				   nullability
datatype
true 				   built in type
36					   maxlength
columnlist
new systemcolumnimpl 		   sql identifier
convertidcase     		   column name
sysschemas_schemaname 	   column number
false				   nullability
columnlist
new systemcolumnimpl 		   sql identifier
convertidcase     	   column name
sysschemas_schemaaid 	   column number
false				   nullability
return	columnlist