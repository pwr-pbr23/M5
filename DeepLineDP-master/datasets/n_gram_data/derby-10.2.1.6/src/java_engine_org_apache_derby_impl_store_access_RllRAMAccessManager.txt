/*
derby - class org.apache.derby.impl.store.access.rllramaccessmanager
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl store access
import org apache derby iapi services monitor monitor
import org apache derby iapi error standardexception
import org apache derby iapi store access accessfactoryglobals
import org apache derby iapi store access transactioncontroller
import org apache derby iapi store raw lockingpolicy
import org apache derby iapi services property propertyutil
import java util properties
import org apache derby iapi reference property
/**
implements the row level locking accessmanager.
**/
public class rllramaccessmanager extends ramaccessmanager
private int system_lock_level   transactioncontroller mode_record
/**************************************************************************
* constructors for this class:
**************************************************************************
*/
public rllramaccessmanager
super
/**************************************************************************
* private/protected methods of this class:
**************************************************************************
*/
/***************************************************************************
** concrete methods of ramaccessmanager, interfaces that control locking
** level of the system.
****************************************************************************
*/
/**
* return the locking level of the system.
* <p>
* this routine controls the lowest level of locking enabled for all locks
* for all tables accessed through this accessmanager.  the concrete
* implementation may set this value always to table level locking for
* a client configuration, or it may set it to row level locking for a
* server configuration.
* <p>
* if transactioncontroller.mode_record is returned table may either be
* locked at table or row locking depending on the type of access expected
* (ie. level 3 will require table locking for heap scans.)
*
* @return transactioncontroller.mode_table if only table locking allowed,
*         else returns transactioncontroller.mode_record.
**/
protected int getsystemlocklevel
return system_lock_level
/**
* query property system to get the system lock level.
* <p>
* this routine will be called during boot after access has booted far
* enough, to allow access to the property conglomerate.  this routine
* will call the property system and set the value to be returned by
* getsystemlocklevel().
* <p>
*
* @exception  standardexception  standard exception policy.
**/
protected void bootlookupsystemlocklevel
transactioncontroller tc
throws standardexception
// the default for this module is transactioncontroller.mode_record,
// only change it if the setting is different.
if  isreadonly       propertyutil getserviceboolean tc  property row_locking  true
system_lock_level   transactioncontroller mode_table