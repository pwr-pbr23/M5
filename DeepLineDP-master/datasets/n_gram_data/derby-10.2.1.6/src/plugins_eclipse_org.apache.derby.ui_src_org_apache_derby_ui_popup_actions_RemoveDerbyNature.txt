/*
derby - class org.apache.derby.ui.popup.actions.removederbynature
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby ui popup actions
import java util arraylist
import org apache derby ui common commonnames
import org apache derby ui common messages
import org apache derby ui util derbyserverutils
import org apache derby ui util derbyutils
import org apache derby ui util logger
import org apache derby ui util selectionutil
import org eclipse core resources iproject
import org eclipse core resources iprojectdescription
import org eclipse core resources iresource
import org eclipse core runtime istatus
import org eclipse jdt core iclasspathentry
import org eclipse jdt core ijavaproject
import org eclipse jdt core javacore
import org eclipse jface action iaction
import org eclipse jface dialogs messagedialog
import org eclipse jface viewers iselection
import org eclipse jface window applicationwindow
import org eclipse swt widgets shell
import org eclipse ui iobjectactiondelegate
import org eclipse ui iworkbenchpart
import org eclipse ui iworkbenchwindow
import org eclipse ui platformui
public class removederbynature implements iobjectactiondelegate
private ijavaproject currentjavaproject
private iproject currentproject
/* (non-javadoc)
* @see org.eclipse.ui.iobjectactiondelegate#setactivepart(org.eclipse.jface.action.iaction, org.eclipse.ui.iworkbenchpart)
*/
public void setactivepart iaction action  iworkbenchpart targetpart
private static string removederbynature string  natures
arraylist arrl new arraylist
for  int i 0 i<natures length i
if   natures equalsignorecase commonnames derby_nature
arrl add natures
string  newnatures  new string
for int i 0 i<arrl size   i
newnatures  string arrl get i
return newnatures
/* (non-javadoc)
* @see org.eclipse.ui.iactiondelegate#run(org.eclipse.jface.action.iaction)
*/
public void run iaction action
iworkbenchwindow window   platformui getworkbench   getactiveworkbenchwindow
try
applicationwindow window  setstatus messages removing_nature
if currentjavaproject  null
currentjavaproject javacore create currentproject
//shutdown server if running for the current project
if derbyserverutils getdefault   getrunning currentjavaproject getproject
derbyserverutils getdefault   stopderbyserver currentjavaproject getproject
iclasspathentry rawclasspath   currentjavaproject getrawclasspath
currentjavaproject setrawclasspath derbyutils removederbyjars rawclasspath   null
iprojectdescription description   currentjavaproject getproject   getdescription
string natures   description getnatureids
description setnatureids removederbynature natures
currentjavaproject getproject   setdescription description  null
// refresh project so user sees changes
currentjavaproject getproject   refreshlocal iresource depth_infinite  null
applicationwindow window  setstatus messages derby_nature_removed
catch  exception e
logger log messages error_removing_nature   currentjavaproject getproject   getname     e istatus error
shell shell   new shell
messagedialog openinformation
shell
commonnames plugin_name
messages error_removing_nature
selectionutil getstatusmessages e
/* (non-javadoc)
* @see org.eclipse.ui.iactiondelegate#selectionchanged(org.eclipse.jface.action.iaction, org.eclipse.jface.viewers.iselection)
*/
public void selectionchanged iaction action  iselection selection
currentjavaproject   selectionutil findselectedjavaproject selection
if currentjavaproject  null
currentproject org apache derby ui util selectionutil findselectedproject selection