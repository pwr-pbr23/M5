/*
derby - class org.apache.derby.impl.store.raw.xact.containerlocking2
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl store raw xact
import org apache derby iapi services locks lockfactory
import org apache derby iapi services locks c_lockfactory
import org apache derby iapi store raw containerhandle
import org apache derby iapi store raw containerlock
import org apache derby iapi store raw transaction
import org apache derby iapi error standardexception
/**
a locking policy that implements container level locking with
isolation degree 2.
@see org.apache.derby.iapi.store.raw.lockingpolicy
*/
public class containerlocking2 extends nolocking
private final lockfactory	lf
protected containerlocking2
this lf   null
protected containerlocking2 lockfactory lf
this lf   lf
/**
obtain a container shared or exclusive lock	until
the end of the nested transaction.
@exception standardexception standard cloudscape error policy
*/
public boolean lockcontainer
transaction     t
containerhandle container
boolean         waitforlock
boolean         forupdate
throws standardexception
object qualifier   forupdate ? containerlock cx   containerlock cs
// for cursor stability put read locks on a separate lock chain, which
// will be released when the container is unlocked.
object group
forupdate ? t   container getuniqueid
return
lf lockobject
t getcompatibilityspace    group  container getid    qualifier
waitforlock ?
c_lockfactory timed_wait   c_lockfactory no_wait
/**
* unlock read locks.
* <p>
* in cursor stability release all read locks obtained.  unlockcontainer()
* will be called when the container is closed.
* <p>
*
* @param t             the transaction to associate the lock with.
* @param container     container to unlock.
*
**/
public void unlockcontainer
transaction     t
containerhandle container
// only release read locks before end of transaction in level 2.
if  container isreadonly
lf unlockgroup t getcompatibilityspace    container getuniqueid
public int getmode
return mode_container
/*
** we can inherit all the others methods of nolocking since we hold the
** container lock until the end of transaction, and we don't obtain row
** locks.
*/