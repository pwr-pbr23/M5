/*
derby - class org.apache.derby.impl.load.export
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl load
import java sql connection
import java sql resultset
import java io ioexception
import java sql sqlexception
import java util
/**
* this class provides ways to export data from
* a table or a view into a file. export functions provided
* in this  class are called through systement procedures.
*/
public class export extends exportabstract
private string outputfilename
private void doexport   throws sqlexception
try
if  entityname    null    selectstatement    null
throw loaderror entitynamemissing
if  outputfilename    null
throw loaderror datafilenull
try
doallthework
catch  ioexception iex
//in case of ioexception, catch it and throw it as our own exception
throw loaderror errorwritingdata
catch  exception ex
throw loaderror unexpectederror ex
private export connection con  string schemaname
string tablename  string selectstatement
string outputfilename  string characterdelimeter
string columndelimeter  string codeset
throws sqlexception
this con   con
this schemaname   schemaname
this entityname   tablename
this selectstatement   selectstatement
this outputfilename   outputfilename
try
controlfilereader   new controlinfo
controlfilereader setcontrolproperties characterdelimeter
columndelimeter  codeset
catch exception ex
throw loaderror unexpectederror ex
/**
* syscs_export_table  system procedure from ij or from a java application
* invokes  this method to perform export of  a table data to a file.
* @param con	 the cloudscape database connection url for the database containing the table
* @param schemaname	schema name of the table data is being exported from
* @param tablename     name of the table from which  data has to be exported.
* @param outputfilename name of the file to  which data has to be exported.
* @param columndelimeter  delimiter that seperates columns in the output file
* @param characterdelimeter  delimiter that is used to quoate non-numeric types
* @param codeset           codeset that should be used to write  the data to  the file
* @exception sql exception on errors
*/
public static void exporttable connection con  string schemaname
string tablename  string outputfilename
string columndelimeter  string characterdelimeter
string codeset
throws sqlexception
export fex   new export con  schemaname  tablename  null
outputfilename 	characterdelimeter
columndelimeter  codeset
fex doexport
/**
* syscs_export_query  system procedure from ij or from a java application
* invokes  this method to perform export of the data retrieved by select statement to a file.
* @param con	 the cloudscape database connection url for the database containing the table
* @param selectstatement    select query that is used to export the data
* @param outputfilename name of the file to  which data has to be exported.
* @param columndelimeter  delimiter that seperates columns in the output file
* @param characterdelimeter  delimiter that is used to quiote non-numeric types
* @param codeset           codeset that should be used to write  the data to  the file
* @exception sql exception on errors
*/
public static void exportquery connection con  string selectstatement
string outputfilename  string columndelimeter
string characterdelimeter  string codeset
throws sqlexception
export fex   new export con  null  null  selectstatement
outputfilename characterdelimeter
columndelimeter  codeset
fex doexport
/**
* for internal use only
* @exception	exception if there is an error
*/
//returns the control file reader corresponding to the control file passed
protected exportwritedataabstract getexportwritedata   throws exception
return new exportwritedata outputfilename  controlfilereader