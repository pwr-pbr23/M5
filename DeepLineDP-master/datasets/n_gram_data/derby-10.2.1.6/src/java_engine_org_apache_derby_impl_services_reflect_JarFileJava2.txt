/*
derby - class org.apache.derby.impl.services.reflect.jarfilejava2
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl services reflect
import org apache derby iapi reference messageid
import org apache derby iapi error standardexception
import org apache derby iapi services i18n messageservice
import java util zip zipentry
import java util zip zipinputstream
import java io ioexception
import java io file
import java io inputstream
// below are all java2 imports.
import java security cert certificate
import java security cert x509certificate
import java security generalsecurityexception
/**
sub-class of jarfile for a java2 environment that uses the
java.util.jar.* classes to be signature aware.
*/
final class jarfilejava2 extends jarfile
jarfilejava2
super
jarfilejava2 string name
super name
jarfile newjarfile string name
return new jarfilejava2 name
void initialize file jarfile  throws ioexception
java util jar jarfile jf   new java util jar jarfile jarfile
// determine if it is signed.
zip   jf
zipentry getentry string entryname
return   java util jar jarfile  zip  getjarentry entryname
zipinputstream getziponstream inputstream in  throws ioexception
return new java util jar jarinputstream in
zipentry getnextentry zipinputstream in  throws ioexception
return   java util jar jarinputstream  in  getnextjarentry
byte readdata zipentry ze  inputstream in  string classname  throws ioexception
try
return super readdata ze  in  classname
catch  securityexception se
throw handleexception se  classname
object getsigners string classname  zipentry ze  throws ioexception
exception e
try
certificate list     java util jar jarentry  ze  getcertificates
if   list    null      list length    0
return null
for  int i   0  i < list length  i
if    list instanceof x509certificate
string msg   messageservice gettextmessage messageid cm_unknown_certificate  classname  getjarname
throw new securityexception msg
x509certificate cert    x509certificate  list
cert checkvalidity
return list
catch  generalsecurityexception gse
// convert this into an unchecked security
// exception. unchecked as eventually it has
// to pass through a method that's only throwing
// classnotfoundexception
e   gse
throw handleexception e  classname
private securityexception handleexception exception e  string classname
string msg   messageservice gettextmessage messageid cm_security_exception  classname  getjarname    e getlocalizedmessage
return new securityexception msg