/*
derby - class org.apache.derby.iapi.services.context.context
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby iapi services context
import org apache derby iapi error standardexception
/**
* contexts are created and used to manage the execution
* environment. they provide a convenient location for
* storing globals organized by the module using the
* globals.
* <p>
* a basic context implementation is provided as an abstract
* class; this implementation satisfies the interface and
* should in general be used as the supertype of all context
* types.  otherwise, context classes must satisfy the
* semantics of the interface through their own distinct
* implementations.
* <p>
* contexts assist in cleanup
* when errors are caught in the outer block.
* <p>
* use of context cleanup is preferred over using try/catch
* blocks throughout the code.
* <p>
* use of context pushing and popping is preferred over
* using many instance or local variables, even when try/catch is present.
* when the instance or local variables would be holding resources.
<p>
usually context's have a reference based equality, ie. they do not provide
an implementation of equals(). contexts may implement a value based equality
but this usually means there is only one instance of the context on the stack,
this is because the popcontext(context) will remove the most recently pushed
context that matches via the equals method, not by a reference check.
implementing equals is useful for contexts used in notifyallthreads() that
is not aimed at a single thread.
*/
public interface context
/**
* returns the context manager that has stored this
* context in its stack.
*/
public contextmanager getcontextmanager
/**
* returns the current id name associated
* with this context. contexts are placed into
* stacks by id, in a context manager. null
* if the context is not assigned to an id.
* contexts known by context managers are always
* assigned to an id.
* <p>
* a default id name should be defined in each
* specific context interface as a static final
* field with the name context_id. for example,
* see org.apache.derby.iapi.sql.compile.compilercontext.context_id.
* @see org.apache.derby.iapi.sql.compile.compilercontext
*/
public string getidname
/**
* contexts will be passed errors that are caught
* by the outer system when they are serious enough
* to require corrective action. they will be told
* what the error is, so that they can react appropriately.
* most of the time, the contexts will react by either
* doing nothing or by removing themselves from the
* context manager. if there are no other references
* to the context, removing itself from the manager
* equates to freeing it.
* <br>
* on an exception that is session severity or greater
* the context must push itself off the stack. this is
* to ensure that after a session has been closed there
* are no contexts on the stack that potentially hold
* references to objects, thus delaying their garbage
* collection.
* <p>
* contexts must release all their resources before
* removing themselves from their context manager.
* <p>
* the context manager
* will "unwind" the contexts during cleanup in the
* reverse order they were placed on its global stack.
*
* <p>
* if error is an instance of standardexception then an implementation
* of this method may throw a new exception if and only if the new exception
* is an instance of standardexception that is more severe than the original error
* or the new exception is a not an instance of standardexception (e.g java.lang.nullpointerexception).
*
* @exception standardexception thrown if cleanup goes awry
*/
public void cleanuponerror throwable error
throws standardexception
/**
push myself onto my context stack.
*/
public void pushme
/**
pop myself of the context stack.
*/
public void popme
/**
* return whether or not this context is the "last" handler for a
* the specified severity level.  previously, the context manager would march
* through all of the contexts in cleanuponerror() and call each of
* their cleanuponerror() methods.  that did not work with server side
* jdbc, especially for a statementexception, because outer contexts
* could get cleaned up incorrectly.  this functionality is specific
* to the language system.  any non-language system contexts should
* return exceptionseverity.not_applicable_severity.
*
* note: both the languageconnectioncontext and the jdbc connection context are
* interested in session level errors because they both have clean up to do.
* this method allows both of them to return false so that all such handlers
* under them can do their clean up.
*/
public boolean islasthandler int severity