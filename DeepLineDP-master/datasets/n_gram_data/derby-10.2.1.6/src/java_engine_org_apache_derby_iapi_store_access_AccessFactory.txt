/*
derby - class org.apache.derby.iapi.store.access.accessfactory
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby iapi store access
import org apache derby catalog uuid
import org apache derby iapi services context contextmanager
import org apache derby iapi services locks lockfactory
import org apache derby iapi error standardexception
import org apache derby iapi store access conglomerate methodfactory
import org apache derby iapi services property propertysetcallback
import java util properties
import java io file
/**
module interface for an access manager.  an access manager provides
transactional access via access methods to data in a single storage
manager.
<p>
an accessfactory is typically obtained from the monitor:
<p>
<blockquote><pre>
// get the current transaction controller.
accessfactory af;
af = (accessfactory) monitor.findservicemodule(this, accessfactory.module);
</pre></blockquote>
**/
public interface accessfactory
/**
* used to identify this interface when finding it with the monitor.
**/
public static final string module
/**
* register an access method that this access manager can use.
**/
void registeraccessmethod methodfactory factory
/**
* database creation has finished.
*
* @exception standardexception standard exception policy.
**/
public void createfinished   throws standardexception
/**
*find an access method that implements an implementation type.
*
* @exception standardexception standard exception policy.
**/
methodfactory findmethodfactorybyimpl string impltype
throws standardexception
/**
* find an access method that implements a format type.
**/
methodfactory findmethodfactorybyformat uuid format
/**
* get the lockfactory to use with this store.
*
* @return the lock factory to use with this store.
*
**/
public lockfactory getlockfactory
/**
* return the xaresourcemanager associated with this accessfactory.
* <p>
* returns an object which can be used to implement the "offline"
* 2 phase commit interaction between the accessfactory and outstanding
* transaction managers taking care of in-doubt transactions.
*
* @return the xaresourcemanager associated with this accessfactory.
*
* @exception standardexception standard exception policy.
*
**/
public    xaresourcemanager    object getxaresourcemanager
throws standardexception
/**
* is the store read-only.
*/
public boolean isreadonly
/**************************************************************************
* methods that are property related.
**************************************************************************
*/
/**************************************************************************
* methods that are transaction related.
**************************************************************************
*/
/**
* get a transaction controller with which to manipulate data within
* the access manager.  implicitly creates an access context if one
* does not already exist.
*
* @param cm    the context manager for the current context.
*
* @exception standardexception standard exception policy.
* @see transactioncontroller
**/
transactioncontroller gettransaction contextmanager cm
throws standardexception
/**
* get a transaction. if a new transaction is
* implicitly created, give it name transname.
*
* @param cm            the context manager for the current context.
* @param transname     if a new transaction is started, it will be given
*                      this name.  the name is displayed in the
*                      transactiontable vti.
*
* @exception standardexception standard exception policy.
*
* @see transactioncontroller
* @see accessfactory#gettransaction
*/
transactioncontroller getandnametransaction
contextmanager  cm
string          transname
throws standardexception
/**
* return a snap shot of all transactions in the db.
* <p>
* take a snap shot of all transactions currently in the database and make
* a record of their information.
*
* @return an array of transactioninfo, or null if there is
*         no transaction in the database.
*
**/
public transactioninfo gettransactioninfo
/**
* start a global transaction.
* <p>
* get a transaction controller with which to manipulate data within
* the access manager.  implicitly creates an access context.
* <p>
* must only be called if no other transaction context exists in the
* current context manager.  if another transaction exists in the context
* an exception will be thrown.
* <p>
* the (format_id, global_id, branch_id) triplet is meant to come exactly
* from a javax.transaction.xa.xid.  we don't use xid so that the system
* can be delivered on a non-1.2 vm system and not require the javax classes
* in the path.
* <p>
* if the global transaction id given matches an existing in-doubt global
* transaction in the current system, then a standardexception will
* be thrown with a state of sqlstate.store_xa_xaer_dupid.
* <p>
*
* @param cm        the context manager for the current context.
* @param format_id the format id part of the xid - ie. xid.getformatid().
* @param global_id the global transaction identifier part of xid - ie.
*                  xid.getglobaltransactionid().
* @param branch_id the branch qualifier of the xid - ie.
*                  xid.getbranchqaulifier()
*
* @exception standardexception standard exception policy.
* @see transactioncontroller
**/
xatransactioncontroller    object startxatransaction
contextmanager  cm
int             format_id
byte          global_id
byte          branch_id
throws standardexception
/**************************************************************************
* methods that implement functionality on the
*     org.apache.derby.iapi.db api
**************************************************************************
*/
/**
* freeze the database temporarily so a backup can be taken.
* <p>please see derby on line documentation on backup and restore.
*
* @exception standardexception thrown on error
*/
public void freeze   throws standardexception
/**
* unfreeze the database after a backup has been taken.
* <p>please see derby on line documentation on backup and restore.
*
* @exception standardexception thrown on error
*/
public void unfreeze   throws standardexception
/**
* backup the database to backupdir.
* <p>please see derby on line documentation on backup and restore.
*
* @param backupdir the name of the directory where the backup should be
*		             stored.
* @param wait      if <tt>true</tt>, waits for  all the backup blocking
*                  operations in progress to finish.
*
* @exception standardexception thrown on error
*/
public void backup string backupdir  boolean wait
throws standardexception
/**
* backup the database to a backup directory and enable the log archive
* mode that will keep the archived log files required for roll-forward
* from this version backup.
*
* @param backupdir                     the directory name where the
*                                      database backup should go.  this
*                                      directory will be created if not it
*                                      does not exist.
*
* @param deleteonlinearchivedlogfiles  if true deletes online archived log
*                                      files that exist before this backup,
*                                      delete will occur only after backup
*                                      is complete.
*
* @param wait                          if <tt>true</tt>, waits for all the
*                                      backup blocking operations in
*                                      progress to finish.
*
* @exception standardexception thrown on error
*/
public void backupandenablelogarchivemode
string  backupdir
boolean deleteonlinearchivedlogfiles
boolean wait
throws standardexception
/**
* disables the log archival process, i.e no old log files
* will be kept around for a roll-forward recovery.
*
* @param deleteonlinearchivedlogfiles  if true deletes all online archived
*                                      log files that exist before this
*                                      call immediately; only restore that
*                                      can be performed after disabling log
*                                      archive mode is version recovery.
*
* @exception standardexception thrown on error
*/
public void disablelogarchivemode boolean deleteonlinearchivedlogfiles
throws standardexception
/**
* checkpoints the database, that is, flushes all dirty data to disk.
* records a checkpoint in the transaction log, if there is a log.
*
* @exception standardexception thrown on error
*/
public void checkpoint   throws standardexception
/*
*wait until the thread handling the post commit work
*finihes the work assigned to it.
*/
public void waitforpostcommittofinishwork