/*
derby - class org.apache.derbybuild.eclipse.derbyeclipseplugin
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derbybuild eclipse
import java util
import java io file
import java io fileoutputstream
import java io filewriter
import java io inputstream
import org apache derby iapi services info productgenusnames
import org apache derby iapi services info propertynames
/**
* this class provides the functionality to create the build related
* related properties, which are used for creating the derby plug-in
* for eclipse by the ant script.
*
* - the eclipse plugin will be called 'apache derby core plug-in for eclipse'
*
* - the plugin can be build from the main build.xml using 'ant' with the 'plugin'
*   argument.
*
* - the package name for the derby plug-in will
*   be: org.apache.derby.core_<major>.<minor>.<interim> (example: org.apache.derby.core_10.1.0).
*
* - the plugin.xml in the derby plug-in will show the actual version of the
*   the derby build (example: 10.1.0.0 (111545m) ). this can be viewed from
*   help - about eclipse platform - plug-in details of eclipse of the eclipse ide
*
* - the zip file created for the derbyeclipse under the jars directory will have the name:
*   derby_core_plugin_<major>.<minor>.<interim>.zip (example:derby_core_plugin_10.1.0.zip)
*
* - the current packaging includes derby.jar, derbynet.jar and
*   derbytools.jar. the locale jars for derby are not included yet.
*
* @author rajesh kartha
*/
public class derbyeclipseplugin
/*
* derby plug-in package property and name
*/
private static string plugin_pkg
private static string plugin_pkg_name
/*
* derby plug-in zip file property and name
*/
private static string plugin_zip_file
private static string plugin_zip_file_name
/*
* derby plug-in build properties and name
*/
private static string plugin_version
private static string plugin_version_build_number
private static int maint_div 1000000
/*
* plugin.xml file information, split into three parts
*/
private static string part_1  1 0  utf 8
3 0
org apache derby core
apache derby core plug in for eclipse
"
private static string part_2  "
private static string part_3
derby jar
derbyclient jar
derbytools jar
derbynet jar
private string version
private string tmppropfile
private static file tmpfilelocation null
private static properties tmpprop new properties
private string pluginxmlfile
/*
* the public main() method to test the working of this class. a valid destination
* string is all that is needed as an argument for running this class.
* <p>
* example: java derbyeclipseplugin <destination>
* <p>
*/
public static void main string  args
if args length< 0
system out println
return
try
tmpfilelocation new file args
derbyeclipseplugin dep   new derbyeclipseplugin
dep getprops
dep createtmpfiles
catch exception e
e printstacktrace
/*
* for internal use only.
* getprops() generates the required properties from the dbms.properties file.
*
* @exception	exception if there is an error
*/
private void getprops   throws exception
inputstream versionstream   getclass   getresourceasstream productgenusnames dbms_info
properties prop new properties
prop load versionstream
//create the tmp prop file
tmpprop put plugin_pkg plugin_pkg_name  			  package name
tmpprop put plugin_zip_file plugin_zip_file_name  	  zip file name
tmpprop put propertynames product_vendor_name prop getproperty propertynames product_vendor_name
int maint integer parseint prop getproperty propertynames product_maint_version
version prop getproperty propertynames product_major_version    prop getproperty propertynames product_minor_version    maint maint_div
tmpprop put plugin_version version
//with eclipse 3.1m5a release, adding '(product_build_number)' to the 'version' info in
//the plugin.xml creates some issues while loading. it has been removed and only the
//major.minor.interim.point has been added to the plugin.xml.
//the actual derby build version can be obtained using the 'sysinfo' tool.
version    maint%maint_div
tmpprop put plugin_version_build_number version   prop getproperty propertynames product_build_number
//add info to plugin.xml strings
part_1  version  "
part_2  tmpprop getproperty propertynames product_vendor_name   > n"
/*
* for internal use only.
* createtmpfiles() create the temporary files with the build properties at the specified location.
*
* @exception	exception if there is an error
*/
private void createtmpfiles   throws exception
file file new file tmpfilelocation getabsolutepath   file separator tmppropfile
fileoutputstream fo new fileoutputstream file
tmpprop store fo null
fo close
file new file tmpfilelocation getabsolutepath   file separator pluginxmlfile
filewriter fw new filewriter file
fw write part_1 part_2 part_3
fw close