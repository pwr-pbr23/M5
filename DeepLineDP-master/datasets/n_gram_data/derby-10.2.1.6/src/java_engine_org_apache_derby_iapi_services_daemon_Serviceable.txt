/*
derby - class org.apache.derby.iapi.services.daemon.serviceable
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby iapi services daemon
import org apache derby iapi services context contextmanager
import org apache derby iapi error standardexception
/**
to use a daemonservice, one implements the serviceable interface.  only one
daemonservice will call this at any given time.  however, if this serviceable
object subscribes to or enqueues to the deamonservice multiple times, then
multiple daemonservice threads may call this serviceable object at the same
time.  the serviceable object must decide what synchronization it needs to
provide depending on what work it needs to do.
the serviceable interface does not provide a way to pass a work object to
identify what work needs to be done, it is assumed that the serviceable
object knows that.  if a serviceable object has different work for the
daemonservice to do, it must somehow encapsulate or identify the different
work by an intermediary object which implements the serviceable interface and
which can an identify the different work and pass it along to the object that
can deal with them.
*/
public interface serviceable
/**
do whatever it is that you want the daemon to do for you. there may be
multiple daemon objects on different thread calling performwork at the
same time.
the daemonservice will always call performwork with a context manager
set up.  the daemonservice will clean up the context if an exception is
thrown.  however, it is up to performwork to manage its own
transaction.  if you start a transaction in performwork, you
<b>must</b> commit or abort it at the end.  you may leave the
transaction open so that other serviceable may use the transaction and
context without starting a new one.  on the same token, there may
already be an opened transaction on the context.  serviceable
performwork should always check the state of the context before use.
a serviceable object should be well behaved while it is performing the
daemon work, i.e., it should not take too many resources or hog the cpu
for too long or deadlock with anyone else.
@param context the contextmanager set up by the daemonservice.  there
may or may not be the necessary context on it, depending on which other
serviceable object it has done work for.
@return the return status is only significant if the serviceable client
was enqueued instead of subscribed.  for subscribed client, the return
status is ignored.  for enqueue client, it returns done or requeue.  if
a requeued is returned, it would be desirable if this should not be
serviceasap, although no harm is done if this still maintains that this
should be serviced asap ...
@exception standardexception  standard cloudscape exception policy
<p>mt - depends on the work.  be wary of multiple daemonservice thread
calling at the same time if you subscribe or enqueue multiple times.
*/
public int performwork contextmanager context  throws standardexception
/** return status for performwork - only meaningful for enqueued client */
public static int done   1 	   the daemon work is finished  the
// daemonservice can get rid of this client
public static int requeue   2    the daemon work is not finished  requeue
// the request to be serviced again later.
/**
if this work should be done as soon as possible, then return true.
if it doesn't make any difference if it is done sooner rather than
later, then return false.
the difference is whether or not the daemon service will be notified to
work on this when this work is enqueued or subscribed, in case the
serviceable work is put together but not sent to the daemon service
directly, like in post commit processing
<p>mt - mt safe
*/
public boolean serviceasap
/**
if this work should be done immediately on the user thread then return true.
if it doesn't make any difference if this work is done on a the user thread
immediately or if it is performed by another thread asynchronously
later, then return false.
*/
public boolean serviceimmediately