/*
derby - class org.apache.derby.impl.store.raw.data.removefileoperation
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby impl store raw data
import org apache derby iapi store raw loggable
import org apache derby iapi store raw undoable
import org apache derby iapi store raw transaction
import org apache derby iapi store raw compensation
import org apache derby iapi services io formatidutil
import org apache derby iapi services io storedformatids
import org apache derby iapi store raw xact rawtransaction
import org apache derby iapi error standardexception
import org apache derby iapi services sanity sanitymanager
import org apache derby iapi store access fileresource
import org apache derby iapi store raw log loginstant
import org apache derby io storagefile
import org apache derby iapi util bytearray
import java io objectinput
import java io objectoutput
import java io ioexception
import java io inputstream
import org apache derby iapi services io limitobjectinput
/**
*/
public class removefileoperation implements undoable
private string name
private long generationid
private boolean removeatonce
transient private storagefile filetogo
// no-arg constructor, required by formatable
public removefileoperation
removefileoperation string name  long generationid  boolean removeatonce
this name   name
this generationid   generationid
this removeatonce   removeatonce
/*
* formatable methods
*/
public void writeexternal objectoutput out  throws ioexception
out writeutf name
out writelong generationid
out writeboolean removeatonce
public void readexternal objectinput in
throws ioexception  classnotfoundexception
name   in readutf
generationid   in readlong
removeatonce   in readboolean
/**
return my format identifier.
*/
public int gettypeformatid
return storedformatids logop_remove_file
/**
loggable methods
*/
/**
the default for prepared log is always null for all the operations
that don't have optionaldata.  if an operation has optional data,
the operation need to prepare the optional data for this method.
space operation has no optional data to write out
*/
public bytearray getpreparedlog
return null
public void releaseresource transaction tran
/**
a space operation is a rawstore log record
*/
public int group
return loggable file_resource   loggable rawstore
public void dome transaction xact  loginstant instant
limitobjectinput in
throws standardexception
if  filetogo    null
return
basedatafilefactory bdff
basedatafilefactory    rawtransaction  xact  getdatafactory
bdff filetoremove filetogo  true
/**
@exception standardexception standard cloudscape error policy
*/
public boolean needsredo transaction xact
throws standardexception
if   removeatonce
return false
fileresource fr     rawtransaction  xact  getdatafactory   getfilehandler
filetogo   fr getasfile name  generationid
if  filetogo    null
return false
return filetogo exists
public compensation generateundo transaction xact  limitobjectinput in
throws standardexception  ioexception
if  filetogo    null
basedatafilefactory bdff
basedatafilefactory    rawtransaction  xact  getdatafactory
bdff filetoremove filetogo  false
return null