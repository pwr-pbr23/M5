/*
derby - class org.apache.derby.jdbc.resourceadapterimpl
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby jdbc
import org apache derby iapi services info jvminfo
import org apache derby iapi services context contextservice
import org apache derby iapi services monitor modulecontrol
import org apache derby iapi services monitor monitor
import org apache derby iapi services sanity sanitymanager
import org apache derby iapi jdbc resourceadapter
//import org.apache.derby.iapi.jdbc.xatransactionresource;
import org apache derby iapi error standardexception
import org apache derby iapi store access accessfactory
import org apache derby iapi store access xa xaresourcemanager
import org apache derby iapi store access xa xaxactid
import java util properties
import java util hashtable
import java util enumeration
public class resourceadapterimpl
implements resourceadapter  modulecontrol
private boolean active
// the real resource manager
private xaresourcemanager rm
// maps xid to xatransationresource for run time transactions
private hashtable connectiontable
/*
* module control
*/
public void boot boolean create  properties properties
throws standardexception
// we can only run on jdk1.2 or beyond with jta and java 20 extension
// loaded.
connectiontable   new hashtable
accessfactory af
accessfactory monitor findservicemodule this  accessfactory module
rm    xaresourcemanager  af getxaresourcemanager
active   true
public void stop
active   false
for  enumeration e   connectiontable elements    e hasmoreelements
xatransactionstate transtate    xatransactionstate  e nextelement
try
transtate conn close
catch  java sql sqlexception sqle
active   false
public boolean isactive
return active
/*
* resource adapter methods
*/
public synchronized object findconnection xaxactid xid
return connectiontable get xid
public synchronized boolean addconnection xaxactid xid  object conn
if  connectiontable get xid     null
return false
// put this into the transaction table, if the xid is already
// present as an in-doubt transaction, we need to remove it from
// the run time list
connectiontable put xid  conn
return true
public synchronized object removeconnection xaxactid xid
return connectiontable remove xid
/**
return the xa resource manager to the xa connection
*/
public xaresourcemanager getxaresourcemanager
return rm