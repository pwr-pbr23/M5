/*
derby - class org.apache.derby.client.clientxid
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package org apache derby client
import javax transaction xa xid
public class clientxid implements xid
//
// the format identifier for the xid. a value of -1 indicates
// that the nullxid
//
private int formatid_
//
// the number of bytes in the global transaction identfier
//
private int gtrid_length_
//
// the number of bytes in the branch qualifier
//
private int bqual_length_
//
// the data for the xid.
// <p> the xid is made up of two contiguous parts. the first (of size
// <b>gtrid_length</b>) is the global transaction identfier and the second
// (of size <b>bqual_length</b>) is the branch qualifier.
// <p>if the <b>formatid</b> is -1, indicating the nullxid, the data is
//    ignored.
//
private byte data_
//
// the size of <b>data</b>.
//
static private final int xiddatasize   128
//
// the maximum size of the global transaction identifier.
//
static public final int maxgtridsize   64
//
// the maximum size of the branch qualifier.
//
static public final int maxbqualsize   64
static private final string hextab_
//
// constructs a new null xid.
// <p>after construction the data within the xid should be initialized.
//
public clientxid
data_   new byte
gtrid_length_   0
bqual_length_   0
formatid_    1
//
// another contructor
//
public clientxid int formatid  byte gtrid  byte bqual
formatid_   formatid
gtrid_length_   gtrid length
bqual_length_   bqual length
data_   new byte
system arraycopy gtrid  0  data_  0  gtrid_length_
system arraycopy bqual  0  data_  gtrid_length_  bqual_length_
//
// return a string representing this xid for debuging
//
// @return the string representation of this xid
//
public string tostring
stringbuffer d                 data string  in hexidecimal
string s                 resultant string
int i
int v
int l
l   gtrid_length_   bqual_length_
d   new stringbuffer l   l
for  i   0  i < l  i
// convert data string to hex
v   data_   0xff
d append hextab_ charat v   16
d append hextab_ charat v   15
if   i   1  % 4    0     i   1  < l
d append
s
formatid_
gtrid_length_
bqual_length_
d tostring
return s
//
// returns the branch qualifier for this xid.
//
// @return the branch qualifier
//
public byte getbranchqualifier
byte bqual   new byte
system arraycopy data_  gtrid_length_  bqual  0  bqual_length_
return bqual
//
// set the branch qualifier for this xid.
//
// @param qual a byte array containing the branch qualifier to be set. if
// the size of the array exceeds maxbqualsize, only the first maxbqualsize
// elements of qual will be used.
//
public void setbranchqualifier byte qual
bqual_length_   qual length > maxbqualsize ? maxbqualsize   qual length
system arraycopy qual  0  data_  gtrid_length_  bqual_length_
//
// obtain the format identifier part of the xid.
//
// @return format identifier. -1 indicates a null xid
//
public int getformatid
return formatid_
//
// set the format identifier part of the xid.
//
// @param format identifier. -1 indicates a null xid.
//
public void setformatid int formatid
formatid_   formatid
return
//
// returns the global transaction identifier for this xid.
//
// @return the global transaction identifier
//
public byte getglobaltransactionid
byte gtrid   new byte
system arraycopy data_  0  gtrid  0  gtrid_length_
return gtrid
//
// return fields of xid
//
public byte getdata
return data_
public int getgtridlength
return gtrid_length_
public int getbquallength
return bqual_length_
public int hashcode
if  formatid_      1
return   1
return formatid_   gtrid_length_   bqual_length_
public boolean equals object obj
return org apache derby client net netxaresource xidsequal this   javax transaction xa xid  obj
class xid