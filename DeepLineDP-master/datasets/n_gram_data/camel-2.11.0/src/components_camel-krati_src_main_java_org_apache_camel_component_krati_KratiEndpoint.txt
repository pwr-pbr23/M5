/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component krati
import java net uri
import java net urisyntaxexception
import java util hashmap
import java util map
import krati core segment channelsegmentfactory
import krati core segment segmentfactory
import krati io serializer
import krati store datastore
import krati util fnvhashfunction
import krati util hashfunction
import org apache camel consumer
import org apache camel processor
import org apache camel producer
import org apache camel component krati serializer kratidefaultserializer
import org apache camel impl defaultendpoint
/**
* represents a krati endpoint.
*/
public class kratiendpoint extends defaultendpoint
protected static map<string  kratidatastoreregistration> datastoreregistry   new hashmap<string  kratidatastoreregistration>
protected string key
protected string value
protected string operation
protected int initialcapacity   100
protected int segmentfilesize   64
@suppresswarnings
protected serializer<object> keyserializer   new kratidefaultserializer
@suppresswarnings
protected serializer<object> valueserializer   new kratidefaultserializer
protected segmentfactory segmentfactory   new channelsegmentfactory
protected hashfunction<byte> hashfunction   new fnvhashfunction
protected string path
public kratiendpoint string uri  kraticomponent component  throws urisyntaxexception
super uri  component
this path   getpath uri
@override
public void stop   throws exception
super stop
kratidatastoreregistration registration   datastoreregistry get path
if  registration    null
registration unregister
public producer createproducer   throws exception
datastore<object  object> datastore   null
kratidatastoreregistration registration   datastoreregistry get path
if  registration    null
datastore   registration getdatastore
if  datastore    null     datastore isopen
datastore   kratihelper <object  object>createdatastore path  initialcapacity  segmentfilesize  segmentfactory  hashfunction  keyserializer  valueserializer
datastoreregistry put path  new kratidatastoreregistration datastore
return new kratiproducer this  datastore
public consumer createconsumer processor processor  throws exception
datastore<object  object> datastore   null
kratidatastoreregistration registration   datastoreregistry get path
if  registration    null
datastore   registration getdatastore
if  datastore    null     datastore isopen
datastore   kratihelper createdatastore path  initialcapacity  segmentfilesize  segmentfactory  hashfunction  keyserializer  valueserializer
datastoreregistry put path  new kratidatastoreregistration datastore
return new kraticonsumer this  processor  datastore
public boolean issingleton
return true
/**
* returns the path from the uri.
*
* @param uri
* @return
*/
protected string getpath string uri  throws urisyntaxexception
uri u   new uri uri
stringbuilder pathbuilder   new stringbuilder
if  u gethost      null
pathbuilder append u gethost
if  u getpath      null
pathbuilder append u getpath
return pathbuilder tostring
public string getkey
return key
public void setkey string key
this key   key
public string getvalue
return value
public void setvalue string value
this value   value
public string getoperation
return operation
public void setoperation string operation
this operation   operation
public int getinitialcapacity
return initialcapacity
public void setinitialcapacity int initialcapacity
this initialcapacity   initialcapacity
public int getsegmentfilesize
return segmentfilesize
public void setsegmentfilesize int segmentfilesize
this segmentfilesize   segmentfilesize
public segmentfactory getsegmentfactory
return segmentfactory
public void setsegmentfactory segmentfactory segmentfactory
this segmentfactory   segmentfactory
public hashfunction<byte> gethashfunction
return hashfunction
public void sethashfunction hashfunction<byte> hashfunction
this hashfunction   hashfunction
public string getpath
return path