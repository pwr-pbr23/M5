/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component validator
import java io inputstream
import java util map
import javax xml transform stream streamsource
import org w3c dom ls lsresourceresolver
import org apache camel endpoint
import org apache camel impl defaultcomponent
import org apache camel impl processorendpoint
import org apache camel processor validation validatingprocessor
import org apache camel util iohelper
import org apache camel util resourcehelper
import org slf4j logger
import org slf4j loggerfactory
/**
* the <a href="http://camel.apache.org/validation.html">validator component</a>
* for validating xml against some schema
*/
public class validatorcomponent extends defaultcomponent
private static final transient logger log   loggerfactory getlogger validatorcomponent class
protected endpoint createendpoint string uri  string remaining  map<string  object> parameters  throws exception
final string resourceuri   remaining
inputstream is   resourcehelper resolvemandatoryresourceasinputstream getcamelcontext   getclassresolver    resourceuri
streamsource source   new streamsource is
validatingprocessor validator   new validatingprocessor
validator setschemasource source
log debug    this  resourceuri
configurevalidator validator  uri  remaining  parameters
// force loading of schema at create time otherwise concurrent
// processing could cause thread safe issues for the javax.xml.validation.schemafactory
validator loadschema
// and make sure to close the input stream after the schema has been loaded
iohelper close is
return new processorendpoint uri  this  validator
protected void configurevalidator validatingprocessor validator  string uri  string remaining  map<string  object> parameters  throws exception
lsresourceresolver resourceresolver   resolveandremovereferenceparameter parameters     lsresourceresolver class
if  resourceresolver    null
validator setresourceresolver resourceresolver
else
validator setresourceresolver new defaultlsresourceresolver getcamelcontext    remaining
setproperties validator  parameters