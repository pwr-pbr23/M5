/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component mqtt
import java util list
import java util concurrent copyonwritearraylist
import java util concurrent timeunit
import org apache camel consumer
import org apache camel exchange
import org apache camel processor
import org apache camel producer
import org apache camel impl defaultendpoint
import org fusesource hawtbuf buffer
import org fusesource hawtbuf utf8buffer
import org fusesource mqtt client callback
import org fusesource mqtt client callbackconnection
import org fusesource mqtt client listener
import org fusesource mqtt client promise
import org fusesource mqtt client qos
import org fusesource mqtt client topic
import org slf4j logger
import org slf4j loggerfactory
/**
* mqtt endpoint
*/
public class mqttendpoint extends defaultendpoint
private static final transient logger log   loggerfactory getlogger mqttendpoint class
private callbackconnection connection
private final mqttconfiguration configuration
private final list<mqttconsumer> consumers   new copyonwritearraylist<mqttconsumer>
public mqttendpoint string uri  mqttcomponent component  mqttconfiguration properties
super uri  component
this configuration   properties
@override
public consumer createconsumer processor processor  throws exception
return new mqttconsumer this  processor
@override
public producer createproducer   throws exception
return new mqttproducer this
public mqttconfiguration getconfiguration
return configuration
@override
protected void dostart   throws exception
super dostart
connection   configuration callbackconnection
connection listener new listener
public void onconnected
log info    configuration gethost
public void ondisconnected
log debug    configuration gethost
public void onpublish utf8buffer topic  buffer body  runnable ack
if   consumers isempty
exchange exchange   createexchange
exchange getin   setbody body tobytearray
exchange setproperty configuration getmqtttopicpropertyname    topic tostring
for  mqttconsumer consumer   consumers
consumer processexchange exchange
if  ack    null
ack run
public void onfailure throwable value
connection disconnect new callback<void>
public void onsuccess void value
public void onfailure throwable e
log debug     configuration gethost        e
final promise<object> promise   new promise<object>
connection connect new callback<void>
public void onsuccess void value
string subscribetopicname   configuration getsubscribetopicname
subscribetopicname   subscribetopicname    null ? subscribetopicname trim     null
if  subscribetopicname    null     subscribetopicname isempty
topic topics    new topic subscribetopicname  configuration getqos
connection subscribe topics  new callback<byte>
public void onsuccess byte value
promise onsuccess value
public void onfailure throwable value
promise onfailure value
connection disconnect null
else
promise onsuccess value
public void onfailure throwable value
promise onfailure value
connection disconnect null
promise await configuration getconnectwaitinseconds    timeunit seconds
protected void dostop   throws exception
if  connection    null
final promise<void> promise   new promise<void>
connection disconnect new callback<void>
public void onsuccess void value
promise onsuccess value
public void onfailure throwable value
promise onfailure value
promise await configuration getdisconnectwaitinseconds    timeunit seconds
super dostop
void publish string topic  byte payload  qos qos  boolean retain  callback<void> callback  throws exception
connection publish topic  payload  qos  retain  callback
void addconsumer mqttconsumer consumer
consumers add consumer
void removeconsumer mqttconsumer consumer
consumers remove consumer
public boolean issingleton
return true