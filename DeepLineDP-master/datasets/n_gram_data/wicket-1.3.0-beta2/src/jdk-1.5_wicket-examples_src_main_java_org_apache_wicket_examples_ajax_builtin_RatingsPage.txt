/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket examples ajax builtin
import org apache wicket iclusterable
import org apache wicket resourcereference
import org apache wicket ajax ajaxrequesttarget
import org apache wicket extensions rating ratingpanel
import org apache wicket markup html link link
import org apache wicket model imodel
import org apache wicket model model
import org apache wicket model propertymodel
/**
* demo page for the rating component.
*
* @author martijn dashorst
*/
public class ratingspage extends basepage
/**
* star image for no selected star
*/
public static final resourcereference wicketstar0   new resourcereference ratingspage class
/**
* star image for selected star
*/
public static final resourcereference wicketstar1   new resourcereference ratingspage class
/** for serialization. */
private static final long serialversionuid   1l
/**
* link to reset the ratings.
*/
private final class resetratinglink extends link
/** for serialization. */
private static final long serialversionuid   1l
/**
* constructor.
*
* @param id
*            component id
* @param object
*            the model to reset.
*/
public resetratinglink string id  imodel object
super id  object
/**
* @see link#onclick()
*/
public void onclick
ratingmodel rating    ratingmodel getmodelobject
rating nrofvotes   0
rating rating   0
rating sumofratings   0
/**
* rating model for storing the ratings, typically this comes from a
* database.
*/
public static class ratingmodel implements iclusterable
private int nrofvotes   0
private int sumofratings   0
private double rating   0
/**
* returns whether the star should be rendered active.
*
* @param star
*            the number of the star
* @return true when the star is active
*/
public boolean isactive int star
return star <   int  rating   0 5
/**
* gets the number of cast votes.
*
* @return the number of cast votes.
*/
public integer getnrofvotes
return new integer nrofvotes
/**
* adds the vote from the user to the total of votes, and calculates the
* rating.
*
* @param nrofstars
*            the number of stars the user has cast
*/
public void addrating int nrofstars
nrofvotes
sumofratings    nrofstars
rating   sumofratings    1 0   nrofvotes
/**
* gets the rating.
*
* @return the rating
*/
public double getrating
return new double rating
/**
* returns the sum of the ratings.
*
* @return the sum of the ratings.
*/
public int getsumofratings
return sumofratings
/**
* static models for the ratings, not thread safe, but in this case, we
* don't care.
*/
private static ratingmodel rating1   new ratingmodel
/**
* static model for the ratings, not thread safe, but in this case, we don't
* care.
*/
private static ratingmodel rating2   new ratingmodel
/**
* keeps track whether the user has already voted on this page, comes
* typically from the database, or is stored in a cookie on the client side.
*/
private boolean hasvoted   boolean false
/**
* constructor.
*/
public ratingspage
add new ratingpanel    new propertymodel rating1      5  new propertymodel
rating1      true
protected boolean onisstaractive int star
return ratingspage rating1 isactive star
protected void onrated int rating  ajaxrequesttarget target
ratingspage rating1 addrating rating
add new ratingpanel    new propertymodel rating2      new model new integer
5    new propertymodel rating2      new propertymodel this
true
protected string getactivestarurl int iteration
return getrequestcycle   urlfor wicketstar1  tostring
protected string getinactivestarurl int iteration
return getrequestcycle   urlfor wicketstar0  tostring
protected boolean onisstaractive int star
return ratingspage rating2 isactive star
protected void onrated int rating  ajaxrequesttarget target
// make sure the user can't vote again
hasvoted   boolean true
ratingspage rating2 addrating rating
add new resetratinglink    new model rating1
add new resetratinglink    new model rating2
/**
* getter for the hasvoted flag.
*
* @return <code>true</code> when the user has already voted.
*/
public boolean gethasvoted
return hasvoted