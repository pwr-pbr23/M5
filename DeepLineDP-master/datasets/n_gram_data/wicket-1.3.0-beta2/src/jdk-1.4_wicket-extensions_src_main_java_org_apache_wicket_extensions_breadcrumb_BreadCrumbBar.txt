/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket extensions breadcrumb
import java util arraylist
import java util list
import org apache wicket component
import org apache wicket behavior headercontributor
import org apache wicket markup html basic label
import org apache wicket markup html list listitem
import org apache wicket markup html list listview
import org apache wicket markup html panel panel
import org apache wicket model loadabledetachablemodel
/**
* a component that renders bread crumbs. by default, it renders a horizontal
* list from left to right (oldest left) with bread crumb links and a ' / ' as a
* seperator, e.g.
*
* <pre>
* first / second / third
* </pre>
*
* this component also functions as a implementation of
* {@link ibreadcrumbmodel bread crumb model}. this component holds the state
* as well as doing the rendering. override and provide your own markup file if
* you want to work with other elements, e.g. uls instead of spans.
*
* @author eelco hillenius
*/
public class breadcrumbbar extends panel implements ibreadcrumbmodel
/**
* list view for rendering the bread crumbs.
*/
protected class breadcrumbslistview extends listview implements ibreadcrumbmodellistener
private static final long serialversionuid   1l
private transient boolean dirty   false
private transient int size
/**
* construct.
*
* @param id
*            component id
*/
public breadcrumbslistview string id
super id
setreuseitems false
setmodel new loadabledetachablemodel
private static final long serialversionuid   1l
protected object load
// save a copy
list l   new arraylist allbreadcrumbparticipants
size   l size
return l
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodellistener#breadcrumbactivated(org.apache.wicket.extensions.breadcrumb.ibreadcrumbparticipant,
*      org.apache.wicket.extensions.breadcrumb.ibreadcrumbparticipant)
*/
public void breadcrumbactivated ibreadcrumbparticipant previousparticipant
ibreadcrumbparticipant breadcrumbparticipant
signalmodelchange
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodellistener#breadcrumbadded(org.apache.wicket.extensions.breadcrumb.ibreadcrumbparticipant)
*/
public void breadcrumbadded ibreadcrumbparticipant breadcrumbparticipant
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodellistener#breadcrumbremoved(org.apache.wicket.extensions.breadcrumb.ibreadcrumbparticipant)
*/
public void breadcrumbremoved ibreadcrumbparticipant breadcrumbparticipant
/**
* @see org.apache.wicket.markup.html.list.listview#onbeforerender()
*/
protected void onbeforerender
super onbeforerender
if  dirty
super internalonattach
this dirty   false
/**
* @see org.apache.wicket.markup.html.list.listview#populateitem(org.apache.wicket.markup.html.list.listitem)
*/
protected void populateitem listitem item
int index   item getindex
ibreadcrumbparticipant breadcrumbparticipant    ibreadcrumbparticipant item
getmodelobject
item add newbreadcrumbcomponent    index  size  breadcrumbparticipant
/**
* signal model change.
*/
private void signalmodelchange
// else let the listview recalculate it's childs immediately;
// it was attached, but it needs to go trhough that again now
// as the signalling component attached after this
getmodel   detach
super internalonattach
/** default crumb component. */
private static final class breadcrumbcomponent extends panel
private static final long serialversionuid   1l
/**
* construct.
*
* @param id
*            component id
* @param index
*            the index of the bread crumb
* @param breadcrumbmodel
*            the bread crumb model
* @param breadcrumbparticipant
*            the bread crumb
* @param enablelink
*            whether the link should be enabled
*/
public breadcrumbcomponent string id  int index  ibreadcrumbmodel breadcrumbmodel
final ibreadcrumbparticipant breadcrumbparticipant  boolean enablelink
super id
add new label     index > 0  ?        setescapemodelstrings false
setrenderbodyonly true
breadcrumblink link   new breadcrumblink    breadcrumbmodel
private static final long serialversionuid   1l
protected ibreadcrumbparticipant getparticipant string componentid
return breadcrumbparticipant
link setenabled enablelink
add link
link add new label    breadcrumbparticipant gettitle    setrenderbodyonly true
private static final long serialversionuid   1l
/** the currently active participant, if any (possibly null). */
private ibreadcrumbparticipant activeparticipant   null
/** holds the current list of crumbs. */
private list crumbs   new arraylist
/** listeners utility. */
private final breadcrumbmodellistenersupport listenersupport   new breadcrumbmodellistenersupport
/**
* construct. adds the default style.
*
* @param id
*            component id
*/
public breadcrumbbar string id
this id  true
/**
* construct.
*
* @param id
*            component id
* @param adddefaultcssstyle
*            whether the {@link #adddefaultcssstyle() default style} should
*            be added *
* @deprecated as of 1.2.1 calling this method with adddefaultcssstyle ==
*             true doesn't add any style anymore. use your own markup file
*             or
*             {@link headercontributor#forcss(class, string) css header contribution}
*             if you want a different style/ look. the default
*             implementation doesn't use unnumbered lists anymore because
*             of the issues described <a
*             href="http://tagsoup.com/-dev/null-/css/list/indent/">here</a>
*             this method will be removed in 2.0
*/
public breadcrumbbar string id  boolean adddefaultcssstyle
super id
breadcrumbslistview breadcrumbslistview   new breadcrumbslistview
addlistener breadcrumbslistview
add breadcrumbslistview
/**
* will let the bread crumb bar contribute a css include to the page's
* header. it will add breadcrumbbar.css from this package. this method is
* typically called by the class that creates the bread crumb bar.
*
* @deprecated as of 1.2.1 calling this method is a no-op. use your own
*             markup file or
*             {@link headercontributor#forcss(class, string) css header contribution}
*             if you want a different style/ look. the default
*             implementation doesn't use unnumbered lists anymore because
*             of the issues described <a
*             href="http://tagsoup.com/-dev/null-/css/list/indent/">here</a>
*             this method will be removed in 2.0
*/
public final void adddefaultcssstyle
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodel#addlistener(org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodellistener)
*/
public final void addlistener ibreadcrumbmodellistener listener
this listenersupport addlistener listener
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodel#allbreadcrumbparticipants()
*/
public final list allbreadcrumbparticipants
return crumbs
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodel#getactive()
*/
public ibreadcrumbparticipant getactive
return activeparticipant
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodel#removelistener(org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodellistener)
*/
public final void removelistener ibreadcrumbmodellistener listener
this listenersupport removelistener listener
/**
* @see org.apache.wicket.extensions.breadcrumb.ibreadcrumbmodel#setactive(org.apache.wicket.extensions.breadcrumb.ibreadcrumbparticipant)
*/
public final void setactive final ibreadcrumbparticipant breadcrumbparticipant
// see if the bread crumb was already added, and if so,
// clean up the stack after (on top of) this bred crumb
// and notify listeners of the removal
int len   crumbs size     1
int i   len
while  i >  1
ibreadcrumbparticipant temp    ibreadcrumbparticipant crumbs get i
// if we found the bread crumb
if  breadcrumbparticipant equals temp
// remove the bread crumbs after this one
int j   len
while  j > i
// remove and fire event
ibreadcrumbparticipant removed    ibreadcrumbparticipant crumbs remove j
listenersupport firebreadcrumbremoved removed
// activate the bread crumb participant
activate breadcrumbparticipant
// we're done; the provided bread crumb is on top
// and the content is replaced, so just return this function
return
i
// arriving here means we weren't able to find the bread crumb
// add the new crumb
crumbs add breadcrumbparticipant
// and notify listeners
listenersupport firebreadcrumbadded breadcrumbparticipant
// activate the bread crumb participant
activate breadcrumbparticipant
/**
* activates the bread crumb participant.
*
* @param breadcrumbparticipant
*            the participant to activate
*/
protected final void activate final ibreadcrumbparticipant breadcrumbparticipant
// get old value
ibreadcrumbparticipant previousparticipant   this activeparticipant
// and set the provided participant as the active one
this activeparticipant   breadcrumbparticipant
// fire bread crumb activated event
listenersupport firebreadcrumbactivated previousparticipant  breadcrumbparticipant
// signal the bread crumb participant that it is selected as the
// currently active one
breadcrumbparticipant onactivate previousparticipant
/**
* gets whether the current bread crumb should be displayed as a link (e.g.
* for refreshing) or as a disabled link (effictively just a label). the
* latter is the default. override if you want different behavior.
*
* @return whether the current bread crumb should be displayed as a link;
*         this method returns false
*/
protected boolean getenablelinktocurrent
return false
/**
* creates a new bread crumb component. that component will be rendered as
* part of the bread crumbs list (which is a &lt;ul&gt; &lt;li&gt;
* structure).
*
* @param id
*            the component id
* @param index
*            the index of the bread crumb
* @param total
*            the total number of bread crumbs in the current model
* @param breadcrumbparticipant
*            the bread crumb
* @return a new bread crumb component
*/
protected component newbreadcrumbcomponent string id  int index  int total
ibreadcrumbparticipant breadcrumbparticipant
boolean enablelink   getenablelinktocurrent       index <  total   1
return new breadcrumbcomponent id  index  this  breadcrumbparticipant  enablelink