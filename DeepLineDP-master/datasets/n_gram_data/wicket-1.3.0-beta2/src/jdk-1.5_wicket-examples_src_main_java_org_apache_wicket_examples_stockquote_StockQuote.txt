/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket examples stockquote
import java io bufferedreader
import java io ioexception
import java io inputstream
import java io inputstreamreader
import java io outputstream
import java net httpurlconnection
import java net protocolexception
import java net url
import java net urlconnection
/**
* provides access to a soap service for getting stock quotes based on a symbol.
* found on http://www.devx.com/java/article/27559/0/page/2
*/
public class stockquote
/**
* we used to use the www.xmethods.com demo webservice for stockquotes.
* we now use webservicex, as xmethods was really overloaded and unreliable.
*/
private static final string serviceurl
/** the symbol to get the quote for. */
private string symbol
/**
* default constructor.
*/
public stockquote
/**
* constructor setting the symbol to get the quote for.
*
* @param symbol
*            the symbol to look up
*/
public stockquote string symbol
this symbol   symbol
/**
* gets the symbol.
*
* @return the symbol
*/
public string getsymbol
return symbol
/**
* sets the symbol for getting the quote.
*
* @param symbol
*/
public void setsymbol string symbol
this symbol   symbol
/**
* gets a stock quote for the given symbol
*
* @return the stock quote
*/
public string getquote
final string response   getsoapquote symbol
// make sure we get
int start   response indexof        length
int end   response indexof
// if the string returned isn't valid, just return empty.
if  start <   length
return
string result   response substring start  end
return result equals    ?     result
/**
* calls the soap service to get the stock quote for the symbol.
*
* @param symbol
*            the name to search for
* @return the soap response containing the stockquote
*/
private string getsoapquote string symbol
string response
try
final url url   new url serviceurl
final string message   createmessage symbol
// create the connection where we're going to send the file.
httpurlconnection httpconn   setuphttpconnection url  message length
// everything's set up; send the xml that was read in to
// the service.
writerequest message  httpconn
// read the response and write it to standard out.
response   readresult httpconn
catch  exception e
e printstacktrace
return response
/**
* writes the message to the connection.
*
* @param message
*            the message to write
* @param httpconn
*            the connection
* @throws ioexception
*/
private void writerequest string message  httpurlconnection httpconn  throws ioexception
outputstream out   httpconn getoutputstream
out write message tostring   getbytes
out close
/**
* sets up the http connection.
*
* @param url
*            the url to connect to
* @param length
*            the length to the input message
* @return the httpurlconnection
* @throws ioexception
* @throws protocolexception
*/
private httpurlconnection setuphttpconnection url url  int length  throws ioexception
protocolexception
urlconnection connection   url openconnection
httpurlconnection httpconn    httpurlconnection connection
// set the appropriate http parameters.
httpconn setrequestproperty    string valueof length
httpconn setrequestproperty
httpconn setrequestproperty     http   www webservicex net getquote
httpconn setrequestmethod
httpconn setdooutput true
httpconn setdoinput true
return httpconn
/**
* reads the response from the http connection.
*
* @param connection
*            the connection to read the response from
* @return the response
* @throws ioexception
*/
private string readresult httpurlconnection connection  throws ioexception
inputstream inputstream   connection getinputstream
inputstreamreader isr   new inputstreamreader inputstream
bufferedreader in   new bufferedreader isr
stringbuffer sb   new stringbuffer
string inputline
while   inputline   in readline       null
sb append inputline
in close
return sb tostring
/**
* creates the request message for retrieving a stock quote.
*
* @param symbol
*            the symbol to query for
* @return the request message
*/
private string createmessage string symbol
stringbuffer message   new stringbuffer  1 0  utf 8
message append  http   www w3 org 2001 xmlschema instance  http   www w3 org 2001 xmlschema  http   schemas xmlsoap org soap envelope
message append
message append  http   www webservicex net
message append    append symbol  append
message append
message append
message append
return message tostring