/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket markup html pages
import java io serializable
import org apache wicket attributemodifier
import org apache wicket pageparameters
import org apache wicket requestcycle
import org apache wicket response
import org apache wicket markup html webcomponent
import org apache wicket markup html webmarkupcontainer
import org apache wicket markup html webpage
import org apache wicket model model
import org apache wicket protocol http clientproperties
import org apache wicket protocol http webrequestcycle
import org apache wicket protocol http websession
import org apache wicket protocol http request webclientinfo
import org apache wicket request clientinfo
import org apache wicket request target component bookmarkablepagerequesttarget
import org apache wicket settings irequestcyclesettings
import org apache wicket util string strings
import org slf4j logger
import org slf4j loggerfactory
/**
* <p>
* this page uses a form post right after the page has loaded in the browser,
* using javascript or alternative means to detect and pass on settings to the
* embedded form. the form submit method updates this session's
* {@link org.apache.wicket.request.clientinfo} object and then redirects to the
* original location as was passed in as a url argument in the constructor.
* </p>
* <p>
* this page is being used by the default implementation of
* {@link webrequestcycle#newclientinfo}, which in turn uses
* {@link irequestcyclesettings#getgatherextendedbrowserinfo() a setting} to
* determine whether this page should be redirected to (it does when it is
* true).
* </p>
*
* @author eelco hillenius
*/
public class browserinfopage extends webpage
/** log. */
private static final logger log   loggerfactory getlogger browserinfopage class
private static final long serialversionuid   1l
/** the url to continue to after this page. */
private string continueto
/**
* bookmarkable constructor. this is not for normal framework client use. it
* will be called whenever javascript is not supported, and the browser info
* page's meta refresh fires to this page. prior to this, the other
* constructor should already have been called.
*
* @param parameters
*            page parameters with the original url in it
*/
public browserinfopage pageparameters parameters
string to   strings tostring parameters get
if  to    null
throw new illegalargumentexception
setcontinueto to
initcomps
webrequestcycle requestcycle    webrequestcycle getrequestcycle
websession session    websession getsession
clientinfo clientinfo   session getclientinfo
if  clientinfo    null
clientinfo   new webclientinfo requestcycle
getsession   setclientinfo clientinfo
else if  clientinfo instanceof webclientinfo
webclientinfo info    webclientinfo clientinfo
clientproperties properties   info getproperties
properties setjavaenabled false
else
warnnotusingwebclientinfo clientinfo
continuetoprevious
/**
* constructor. the page will redirect to the given url after waiting for
* the given number of seconds.
*
* @param continueto
*            the url to redirect to when the browser info is handled
*/
public browserinfopage final string continueto
if  continueto    null
throw new illegalargumentexception
setcontinueto continueto
initcomps
/**
* @see org.apache.wicket.component#isversioned()
*/
public boolean isversioned
return false
/**
* adds components.
*/
private final void initcomps
webcomponent meta   new webcomponent
pageparameters parameters   new pageparameters
parameters put    continueto
charsequence url   urlfor new bookmarkablepagerequesttarget browserinfopage class
parameters
meta add new attributemodifier    true  new model     url
add meta
webmarkupcontainer link   new webmarkupcontainer
link add new attributemodifier    true  new model  serializable url
add link
add new browserinfoform
private static final long serialversionuid   1l
/**
* @see org.apache.wicket.markup.html.pages.browserinfoform#aftersubmit()
*/
protected void aftersubmit
continuetoprevious
/**
* continue to the location previous to this interception.
*/
protected final void continuetoprevious
// continue to original distination
requestcycle requestcycle   getrequestcycle
// since we are explicitly redirecting to a page already, we do not
// want a second redirect to occur automatically
requestcycle setredirect false
// redirect there
response response   requestcycle getresponse
response reset
response redirect requestcycle getrequest   getrelativepathprefixtowickethandler
continueto
/**
* log a warning that for in order to use this page, you should really be
* using {@link webclientinfo}.
*
* @param clientinfo
*            the actual client info object
*/
void warnnotusingwebclientinfo clientinfo clientinfo
log warn     getclass   getname
webclientinfo class getname
clientinfo getclass   getname
/**
* set the url to continue to after this page.
*
* @param continueto
*            the url
*/
protected final void setcontinueto string continueto
this continueto   continueto