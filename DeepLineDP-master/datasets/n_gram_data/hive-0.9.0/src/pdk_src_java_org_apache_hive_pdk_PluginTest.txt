/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hive pdk
import java io bufferedreader
import java io bytearrayinputstream
import java io bytearrayoutputstream
import java io file
import java io filereader
import java io inputstreamreader
import java io ioexception
import java io printstream
import java util arraylist
import java util arrays
import java util list
import junit extensions testsetup
import junit framework test
import junit framework testcase
import junit framework testsuite
import org apache hadoop hive cli clidriver
/**
* plugintest is a test harness for invoking all of the unit tests
* annotated on the classes in a plugin.
*/
public class plugintest extends testcase
private hivepdkunittest unittest
private plugintest hivepdkunittest unittest
super unittest query
this unittest   unittest
public void runtest   throws exception
string output   runhive
unittest query
assertequals unittest result    output
static string runhive string     args  throws exception
bytearrayoutputstream outbytes   new bytearrayoutputstream
bytearrayoutputstream errbytes   new bytearrayoutputstream
printstream outsaved   system out
printstream errsaved   system err
system setout new printstream outbytes  true
system seterr new printstream errbytes  true
try
clidriver run args
finally
system setout outsaved
system seterr errsaved
bytearrayinputstream outbytesin
new bytearrayinputstream outbytes tobytearray
bytearrayinputstream errbytesin
new bytearrayinputstream errbytes tobytearray
bufferedreader is
new bufferedreader new inputstreamreader outbytesin
bufferedreader es
new bufferedreader new inputstreamreader errbytesin
stringbuilder output   new stringbuilder
string line
while   line   is readline       null
if  output length   > 0
output append
output append line
if  output length      0
output   new stringbuilder
while   line   es readline       null
output append
output append line
return output tostring
public static test suite   throws exception
string classlist   system getproperty
string  classnames   classlist split
testsuite suite   new testsuite
for  string classname   classnames
class<?> c   class forname classname
hivepdkunittests tests   c getannotation hivepdkunittests class
if  tests    null
continue
testsuite classsuite   new testsuite c getname
for  hivepdkunittest unittest   tests cases
classsuite addtest new plugintest unittest
suite addtest new plugintestsetup classsuite  tests
return new pluginglobalsetup suite
public static void main string  args  throws exception
junit textui testrunner run suite
public static class plugintestsetup extends testsetup
string name
hivepdkunittests unittests
plugintestsetup testsuite test  hivepdkunittests unittests
super test
this name   test getname
this unittests   unittests
protected void setup   throws exception
string cleanup   unittests cleanup
string setup   unittests setup
if  cleanup    null
cleanup
if  setup    null
setup
if   cleanup length   > 0      setup length   > 0
string result   runhive
cleanup       setup
if  result length   > 0
system err println name       result
protected void teardown   throws exception
string cleanup   unittests cleanup
if  cleanup    null
string result   runhive
cleanup
if  result length   > 0
system err println name       result
public static class pluginglobalsetup extends testsetup
private file testscriptdir
pluginglobalsetup test test
super test
testscriptdir
new file system getproperty
protected void setup   throws exception
string result   runhive
new file testscriptdir     tostring
new file testscriptdir     tostring
if  result length   > 0
system err println     result
protected void teardown   throws exception
string result   runhive
new file testscriptdir     tostring
if  result length   > 0
system err println     result