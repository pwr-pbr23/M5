/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive shims
import java util hashmap
import java util map
import org apache hadoop hive thrift hadoopthriftauthbridge
import org apache hadoop util versioninfo
/**
* shimloader.
*
*/
public abstract class shimloader
private static hadoopshims hadoopshims
private static jettyshims jettyshims
/**
* the names of the classes for shimming hadoop for each major version.
*/
private static final hashmap<string  string> hadoop_shim_classes
new hashmap<string  string>
static
hadoop_shim_classes put
hadoop_shim_classes put
hadoop_shim_classes put
/**
* the names of the classes for shimming jetty for each major version of
* hadoop.
*/
private static final hashmap<string  string> jetty_shim_classes
new hashmap<string  string>
static
jetty_shim_classes put
jetty_shim_classes put
jetty_shim_classes put
/**
* factory method to get an instance of hadoopshims based on the
* version of hadoop on the classpath.
*/
public static synchronized hadoopshims gethadoopshims
if  hadoopshims    null
hadoopshims   loadshims hadoop_shim_classes  hadoopshims class
return hadoopshims
/**
* factory method to get an instance of jettyshims based on the version
* of hadoop on the classpath.
*/
public static synchronized jettyshims getjettyshims
if  jettyshims    null
jettyshims   loadshims jetty_shim_classes  jettyshims class
return jettyshims
public static synchronized hadoopthriftauthbridge gethadoopthriftauthbridge
if  gethadoopshims   issecureshimimpl
return createshim
hadoopthriftauthbridge class
else
return new hadoopthriftauthbridge
private static <t> t loadshims map<string  string> classmap  class<t> xface
string vers   getmajorversion
string classname   classmap get vers
return createshim classname  xface
private static <t> t createshim string classname  class<t> xface
try
class<?> clazz   class forname classname
return xface cast clazz newinstance
catch  exception e
throw new runtimeexception
classname  e
/**
* return the major version of hadoop currently on the classpath.
* this is simply the first two components of the version number
* (e.g "0.18" or "0.20")
*/
public static string getmajorversion
string vers   versioninfo getversion
string parts   vers split
if  parts length < 2
throw new runtimeexception     vers
if  integer parseint parts  > 0
return
string majorversion   parts       parts
// if we are running a security release, we won't have unixusergroupinformation
// (removed by hadoop-6299 when switching to jaas for login)
try
class forname
catch  classnotfoundexception cnf
if    equals majorversion
majorversion
return majorversion
private shimloader
// prevent instantiation