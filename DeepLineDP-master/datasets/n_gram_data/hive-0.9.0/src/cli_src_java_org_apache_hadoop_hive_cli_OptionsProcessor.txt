/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive cli
import java util hashmap
import java util arrays
import java util map
import java util properties
import org apache commons cli gnuparser
import org apache commons cli helpformatter
import org apache commons cli option
import org apache commons cli optionbuilder
import org apache commons cli options
import org apache commons cli parseexception
import org apache commons logging log
import org apache commons logging logfactory
/**
* optionsprocessor.
*
*/
public class optionsprocessor
protected static final log l4j   logfactory getlog optionsprocessor class getname
private final options options   new options
private org apache commons cli commandline commandline
map<string  string> hivevariables   new hashmap<string  string>
@suppresswarnings
public optionsprocessor
// -e 'quoted-query-string'
options addoption optionbuilder
hasarg
withargname
withdescription
create
// -f <query-file>
options addoption optionbuilder
hasarg
withargname
withdescription
create
// -i <init-query-file>
options addoption optionbuilder
hasarg
withargname
withdescription
create
// -hiveconf x=y
options addoption optionbuilder
withvalueseparator
hasargs 2
withargname
withlongopt
withdescription
create
// -h hostname/ippaddress
options addoption optionbuilder
hasarg
withargname
withdescription
create
// -p port
options addoption optionbuilder
hasarg
withargname
withdescription
create
// substitution option -d, --define
options addoption optionbuilder
withvalueseparator
hasargs 2
withargname
withlongopt
withdescription
create
// substitution option --hivevar
options addoption optionbuilder
withvalueseparator
hasargs 2
withargname
withlongopt
withdescription
create
// [-s|--silent]
options addoption new option       false
// [-v|--verbose]
options addoption new option       false
// [-h|--help]
options addoption new option       false
public boolean process_stage1 string argv
try
commandline   new gnuparser   parse options  argv
properties confprops   commandline getoptionproperties
for  string propkey   confprops stringpropertynames
system setproperty propkey  confprops getproperty propkey
properties hivevars   commandline getoptionproperties
for  string propkey   hivevars stringpropertynames
hivevariables put propkey  hivevars getproperty propkey
properties hivevars2   commandline getoptionproperties
for  string propkey   hivevars2 stringpropertynames
hivevariables put propkey  hivevars2 getproperty propkey
catch  parseexception e
system err println e getmessage
printusage
return false
return true
public boolean process_stage2 clisessionstate ss
ss getconf
if  commandline hasoption
printusage
return false
ss setissilent commandline hasoption
ss execstring   commandline getoptionvalue
ss filename   commandline getoptionvalue
ss setisverbose commandline hasoption
ss host    string  commandline getoptionvalue
ss port   integer parseint  string  commandline getoptionvalue
string initfiles   commandline getoptionvalues
if  null    initfiles
ss initfiles   arrays aslist initfiles
if  ss execstring    null    ss filename    null
system err println
printusage
return false
if  commandline hasoption
properties confprops   commandline getoptionproperties
for  string propkey   confprops stringpropertynames
ss cmdproperties setproperty propkey  confprops getproperty propkey
return true
private void printusage
new helpformatter   printhelp    options
public map<string  string> gethivevariables
return hivevariables