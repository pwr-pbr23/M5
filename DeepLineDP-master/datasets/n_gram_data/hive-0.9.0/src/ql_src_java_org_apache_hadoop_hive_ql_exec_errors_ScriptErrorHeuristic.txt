/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql exec errors
import java util list
import java util regex matcher
import java util regex pattern
/**
* detects when a query has failed because a user's script that was specified in
* transform returns a non-zero error code.
*
* conditions to check:
*
* 1. "script failed with code <some number>" is in the log
*
*/
public class scripterrorheuristic extends regexerrorheuristic
private static final string failed_regex
public scripterrorheuristic
setqueryregex
getlogregexes   add failed_regex
@override
public errorandsolution geterrorandsolution
errorandsolution es   null
if getquerymatches
for list<string> matchinglines   getregextologlines   values
// there should really only be one line with "script failed..."
if  matchinglines size   > 0
assert matchinglines size      1
// get "script failed with code <some number>"
matcher m1   pattern compile failed_regex  matcher matchinglines get 0
m1 find
string failedstr   m1 group
// get "<some number>"
matcher m2   pattern compile    matcher failedstr
m2 find
string errorcode   m2 group
es   new errorandsolution
errorcode
reset
return es