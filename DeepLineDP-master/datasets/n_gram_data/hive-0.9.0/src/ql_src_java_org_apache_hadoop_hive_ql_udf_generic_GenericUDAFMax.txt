/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql udf generic
import org apache commons logging log
import org apache commons logging logfactory
import org apache hadoop hive ql exec description
import org apache hadoop hive ql exec udfargumenttypeexception
import org apache hadoop hive ql metadata hiveexception
import org apache hadoop hive ql parse semanticexception
import org apache hadoop hive ql udf udftype
import org apache hadoop hive serde2 objectinspector objectinspector
import org apache hadoop hive serde2 objectinspector objectinspectorutils
import org apache hadoop hive serde2 objectinspector objectinspectorutils objectinspectorcopyoption
import org apache hadoop hive serde2 typeinfo typeinfo
import org apache hadoop hive serde2 typeinfo typeinfoutils
@description name      value
public class genericudafmax extends abstractgenericudafresolver
static final log log   logfactory getlog genericudafmax class getname
@override
public genericudafevaluator getevaluator typeinfo parameters
throws semanticexception
if  parameters length    1
throw new udfargumenttypeexception parameters length   1
objectinspector oi   typeinfoutils getstandardjavaobjectinspectorfromtypeinfo parameters
if   objectinspectorutils comparesupported oi
throw new udfargumenttypeexception parameters length   1
return new genericudafmaxevaluator
@udftype distinctlike true
public static class genericudafmaxevaluator extends genericudafevaluator
objectinspector inputoi
objectinspector outputoi
@override
public objectinspector init mode m  objectinspector parameters
throws hiveexception
assert  parameters length    1
super init m  parameters
inputoi   parameters
// copy to java object because that saves object creation time.
// note that on average the number of copies is log(n) so that's not
// very important.
outputoi   objectinspectorutils getstandardobjectinspector inputoi
objectinspectorcopyoption java
return outputoi
/** class for storing the current max value */
static class maxagg implements aggregationbuffer
object o
@override
public aggregationbuffer getnewaggregationbuffer   throws hiveexception
maxagg result   new maxagg
return result
@override
public void reset aggregationbuffer agg  throws hiveexception
maxagg myagg    maxagg  agg
myagg o   null
boolean warned   false
@override
public void iterate aggregationbuffer agg  object parameters
throws hiveexception
assert  parameters length    1
merge agg  parameters
@override
public object terminatepartial aggregationbuffer agg  throws hiveexception
return terminate agg
@override
public void merge aggregationbuffer agg  object partial
throws hiveexception
if  partial    null
maxagg myagg    maxagg  agg
int r   objectinspectorutils compare myagg o  outputoi  partial  inputoi
if  myagg o    null    r < 0
myagg o   objectinspectorutils copytostandardobject partial  inputoi
objectinspectorcopyoption java
@override
public object terminate aggregationbuffer agg  throws hiveexception
maxagg myagg    maxagg  agg
return myagg o