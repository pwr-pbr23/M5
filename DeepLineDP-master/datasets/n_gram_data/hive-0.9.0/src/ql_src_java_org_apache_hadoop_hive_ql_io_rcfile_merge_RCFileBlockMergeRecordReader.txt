/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql io rcfile merge
import java io ioexception
import org apache hadoop conf configuration
import org apache hadoop fs filesystem
import org apache hadoop fs path
import org apache hadoop hive ql io rcfile
import org apache hadoop hive ql io rcfile reader
import org apache hadoop mapred filesplit
import org apache hadoop mapred recordreader
@suppresswarnings
public class rcfileblockmergerecordreader implements
recordreader<rcfilekeybufferwrapper  rcfilevaluebufferwrapper>
private final reader in
private final long start
private final long end
private boolean more   true
private final path path
protected configuration conf
public rcfileblockmergerecordreader configuration conf  filesplit split
throws ioexception
path   split getpath
filesystem fs   path getfilesystem conf
this in   new rcfile reader fs  path  conf
this end   split getstart     split getlength
this conf   conf
if  split getstart   > in getposition
in sync split getstart        sync to start
this start   in getposition
more   start < end
public class<?> getkeyclass
return rcfilekeybufferwrapper class
public class<?> getvalueclass
return rcfilevaluebufferwrapper class
public rcfilekeybufferwrapper createkey
return new rcfilekeybufferwrapper
public rcfilevaluebufferwrapper createvalue
return new rcfilevaluebufferwrapper
@override
public boolean next rcfilekeybufferwrapper key  rcfilevaluebufferwrapper value
throws ioexception
more   nextblock key  value
return more
protected boolean nextblock rcfilekeybufferwrapper keywrapper  rcfilevaluebufferwrapper valuewrapper
throws ioexception
if   more
return false
more   in nextblock
if   more
return false
keywrapper keybuffer   this in getcurrentkeybufferobj
keywrapper recordlength   this in getcurrentblocklength
keywrapper keylength   this in getcurrentkeylength
keywrapper compressedkeylength   this in getcurrentcompressedkeylen
keywrapper codec   this in getcompressioncodec
keywrapper inputpath   path
valuewrapper valuebuffer   this in getcurrentvaluebufferobj
long lastseensyncpos   in lastseensyncpos
if  lastseensyncpos >  end
more   false
return more
return more
/**
* return the progress within the input split.
*
* @return 0.0 to 1.0 of the input byte range
*/
public float getprogress   throws ioexception
if  end    start
return 0 0f
else
return math min 1 0f   in getposition     start     float   end   start
public long getpos   throws ioexception
return in getposition
protected void seek long pos  throws ioexception
in seek pos
public long getstart
return start
public void close   throws ioexception
in close