/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql plan
import java io serializable
import java util arraylist
import java util hashmap
import java util iterator
import java util list
import java util map
import org apache hadoop hive metastore warehouse
import org apache hadoop hive ql exec columninfo
import org apache hadoop hive ql metadata table
public class dynamicpartitionctx implements serializable
/**
* default serialization id
*/
private static final long serialversionuid   1l
private map<string  string> partspec     partspec is an ordered hash map
private int numdpcols       number of dynamic partition columns
private int numspcols       number of static partition columns
private string sppath       path name corresponding to sp columns
private string rootpath     the root path dp columns paths start from
private int numbuckets      number of buckets in each partition
private map<string  string> inputtodpcols     mapping from input column names to dp columns
private list<string> spnames     sp column names
private list<string> dpnames     dp column names
private string defaultpartname     default partition name in case of null or empty value
private int maxpartspernode        maximum dynamic partitions created per mapper reducer
public dynamicpartitionctx
public dynamicpartitionctx table tbl  map<string  string> partspec  string defaultpartname
int maxparts
this partspec   partspec
this spnames   new arraylist<string>
this dpnames   new arraylist<string>
this numbuckets   0
this maxpartspernode   maxparts
this defaultpartname   defaultpartname
for  map entry<string  string> me  partspec entryset
if  me getvalue      null
dpnames add me getkey
else
spnames add me getkey
this numdpcols   dpnames size
this numspcols   spnames size
this inputtodpcols   new hashmap<string  string>
if  this numspcols > 0
this sppath   warehouse makedynamicpartname partspec
else
this sppath   null
public dynamicpartitionctx dynamicpartitionctx dp
this partspec   dp partspec
this numdpcols   dp numdpcols
this numspcols   dp numspcols
this sppath   dp sppath
this rootpath   dp rootpath
this numbuckets   dp numbuckets
this inputtodpcols   dp inputtodpcols
this spnames   dp spnames
this dpnames   dp dpnames
this defaultpartname   dp defaultpartname
this maxpartspernode   dp maxpartspernode
public void mapinputtodp list<columninfo> fs
assert fs size      this numdpcols
iterator<columninfo> itr1   fs iterator
iterator<string> itr2   dpnames iterator
while  itr1 hasnext      itr2 hasnext
inputtodpcols put itr1 next   getinternalname    itr2 next
public int getmaxpartitionspernode
return this maxpartspernode
public void setmaxpartitionspernode int maxparts
this maxpartspernode   maxparts
public string getdefaultpartitionname
return this defaultpartname
public void setdefaultpartitionname string pname
this defaultpartname   pname
public void setnumbuckets int bk
this numbuckets   bk
public int getnumbuckets
return this numbuckets
public void setrootpath string root
this rootpath   root
public string getrootpath
return this rootpath
public list<string> getdpcolnames
return this dpnames
public void setdpcolnames list<string> dp
this dpnames   dp
public list<string> getspcolnames
return this spnames
public void setpartspec map<string  string> ps
this partspec   ps
public map<string  string> getpartspec
return this partspec
public void setspcolnames list<string> sp
this spnames   sp
public map<string  string> getinputtodpcols
return this inputtodpcols
public void setinputtodpcols map<string  string> map
this inputtodpcols   map
public void setnumdpcols int dp
this numdpcols   dp
public int getnumdpcols
return this numdpcols
public void setnumspcols int sp
this numspcols   sp
public int getnumspcols
return this numspcols
public void setsppath string sp
this sppath   sp
public string getsppath
return this sppath