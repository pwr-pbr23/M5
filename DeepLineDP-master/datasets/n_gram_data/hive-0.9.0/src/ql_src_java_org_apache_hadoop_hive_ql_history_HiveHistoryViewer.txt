/*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql history
import java io ioexception
import java util hashmap
import java util map
import org apache hadoop hive ql history hivehistory keys
import org apache hadoop hive ql history hivehistory listener
import org apache hadoop hive ql history hivehistory queryinfo
import org apache hadoop hive ql history hivehistory recordtypes
import org apache hadoop hive ql history hivehistory taskinfo
/**
* hivehistoryviewer.
*
*/
public class hivehistoryviewer implements listener
string historyfile
string sessionid
// job hash map
private final hashmap<string  queryinfo> jobinfomap   new hashmap<string  queryinfo>
// task hash map
private final hashmap<string  taskinfo> taskinfomap   new hashmap<string  taskinfo>
public hivehistoryviewer string path
historyfile   path
init
public string getsessionid
return sessionid
public map<string  queryinfo> getjobinfomap
return jobinfomap
public map<string  taskinfo> gettaskinfomap
return taskinfomap
/**
* parse history files.
*/
void init
try
hivehistory parsehivehistory historyfile  this
catch  ioexception e
// todo auto-generated catch block
e printstacktrace
/**
* implementation listner interface function.
*
* @see org.apache.hadoop.hive.ql.history.hivehistory.listener#handle(org.apache.hadoop.hive.ql.history.hivehistory.recordtypes,
*      java.util.map)
*/
public void handle recordtypes rectype  map<string  string> values
if  rectype    recordtypes sessionstart
sessionid   values get keys session_id name
else if  rectype    recordtypes querystart
rectype    recordtypes queryend
string key   values get keys query_id name
queryinfo ji
if  jobinfomap containskey key
ji   jobinfomap get key
ji hm putall values
else
ji   new queryinfo
ji hm   new hashmap<string  string>
ji hm putall values
jobinfomap put key  ji
else if  rectype    recordtypes taskstart
rectype    recordtypes taskend
rectype    recordtypes taskprogress
string jobid   values get keys query_id name
string taskid   values get keys task_id name
string key   jobid       taskid
taskinfo ti
if  taskinfomap containskey key
ti   taskinfomap get key
ti hm putall values
else
ti   new taskinfo
ti hm   new hashmap<string  string>
ti hm putall values
taskinfomap put key  ti