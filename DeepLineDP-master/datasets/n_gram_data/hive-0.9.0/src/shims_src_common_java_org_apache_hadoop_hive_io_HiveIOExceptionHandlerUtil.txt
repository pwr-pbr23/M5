/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive io
import java io ioexception
import org apache hadoop mapred jobconf
import org apache hadoop mapred recordreader
public class hiveioexceptionhandlerutil
private static threadlocal<hiveioexceptionhandlerchain> handlerchaininstance
new threadlocal<hiveioexceptionhandlerchain>
private static hiveioexceptionhandlerchain get jobconf job
hiveioexceptionhandlerchain cache   hiveioexceptionhandlerutil handlerchaininstance
get
if  cache    null
hiveioexceptionhandlerchain toset   hiveioexceptionhandlerchain
gethiveioexceptionhandlerchain job
handlerchaininstance set toset
cache   hiveioexceptionhandlerutil handlerchaininstance get
return cache
/**
* handle exception thrown when creating record reader. in case that there is
* an exception raised when construction the record reader and one handler can
* handle this exception, it should return an record reader, which is either a
* dummy empty record reader or a specific record reader that do some magic.
*
* @param e
* @param job
* @return recordreader
* @throws ioexception
*/
public static recordreader handlerecordreadercreationexception exception e
jobconf job  throws ioexception
hiveioexceptionhandlerchain ioexpectionhandlerchain   get job
if  ioexpectionhandlerchain    null
return ioexpectionhandlerchain handlerecordreadercreationexception e
throw new ioexception e
/**
* handle exception thrown when calling record reader's next. if this
* exception is handled by one handler, will just return true. otherwise,
* either re-throw this exception in one handler or at the end of the handler
* chain.
*
* @param e
* @param job
* @return true on success
* @throws ioexception
*/
public static boolean handlerecordreadernextexception exception e  jobconf job
throws ioexception
hiveioexceptionhandlerchain ioexpectionhandlerchain   get job
if  ioexpectionhandlerchain    null
return ioexpectionhandlerchain handlerecordreadernextexception e
throw new ioexception e