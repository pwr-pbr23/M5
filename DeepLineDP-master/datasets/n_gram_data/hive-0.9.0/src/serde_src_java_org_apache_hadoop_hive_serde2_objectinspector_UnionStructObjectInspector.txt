/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive serde2 objectinspector
import java util arraylist
import java util list
/**
* unionstructobjectinspector unions several struct data into a single struct.
* basically, the fields of these structs are put together sequentially into a
* single struct.
*
* the object that can be acceptable by this objectinspector is a list of
* objects, each of which can be inspected by the objectinspector provided in
* the ctor of unionstructobjectinspector.
*
* always use the objectinspectorfactory to create new objectinspector objects,
* instead of directly creating an instance of this class.
*/
public class unionstructobjectinspector extends structobjectinspector
/**
* myfield.
*
*/
public static class myfield implements structfield
public int structid
structfield structfield
public myfield int structid  structfield structfield
this structid   structid
this structfield   structfield
public string getfieldname
return structfield getfieldname
public objectinspector getfieldobjectinspector
return structfield getfieldobjectinspector
public string getfieldcomment
return structfield getfieldcomment
list<structobjectinspector> unionobjectinspectors
list<myfield> fields
protected unionstructobjectinspector
list<structobjectinspector> unionobjectinspectors
init unionobjectinspectors
void init list<structobjectinspector> unionobjectinspectors
this unionobjectinspectors   unionobjectinspectors
int totalsize   0
for  int i   0  i < unionobjectinspectors size    i
totalsize    unionobjectinspectors get i  getallstructfieldrefs   size
fields   new arraylist<myfield> totalsize
for  int i   0  i < unionobjectinspectors size    i
structobjectinspector oi   unionobjectinspectors get i
for  structfield sf   oi getallstructfieldrefs
fields add new myfield i  sf
public final category getcategory
return category struct
public string gettypename
return objectinspectorutils getstandardstructtypename this
// without data
@override
public structfield getstructfieldref string fieldname
return objectinspectorutils getstandardstructfieldref fieldname  fields
@override
public list<? extends structfield> getallstructfieldrefs
return fields
// with data
@override
@suppresswarnings
public object getstructfielddata object data  structfield fieldref
if  data    null
return null
myfield f    myfield  fieldref
object fielddata
// we support both list<object> and object[]
// so we have to do differently.
if     data instanceof list
object list    object  data
assert  list length    unionobjectinspectors size
fielddata   list
else
list<object> list    list<object>  data
assert  list size      unionobjectinspectors size
fielddata   list get f structid
return unionobjectinspectors get f structid  getstructfielddata fielddata
f structfield
@override
@suppresswarnings
public list<object> getstructfieldsdataaslist object data
if  data    null
return null
// we support both list<object> and object[]
// so we have to do differently.
if     data instanceof list
data   java util arrays aslist  object  data
list<object> list    list<object>  data
assert  list size      unionobjectinspectors size
// explode
arraylist<object> result   new arraylist<object> fields size
for  int i   0  i < unionobjectinspectors size    i
result addall unionobjectinspectors get i  getstructfieldsdataaslist
list get i
return result