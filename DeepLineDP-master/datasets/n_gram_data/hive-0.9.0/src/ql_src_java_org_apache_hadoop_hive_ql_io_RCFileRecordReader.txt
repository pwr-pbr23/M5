/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql io
import java io ioexception
import org apache hadoop conf configuration
import org apache hadoop fs filesystem
import org apache hadoop fs path
import org apache hadoop hive ql io rcfile reader
import org apache hadoop hive serde2 columnar bytesrefarraywritable
import org apache hadoop io longwritable
import org apache hadoop mapred filesplit
import org apache hadoop mapred recordreader
import org apache hadoop util reflectionutils
/**
* rcfilerecordreader.
*
* @param <k>
* @param <v>
*/
public class rcfilerecordreader<k extends longwritable  v extends bytesrefarraywritable>
implements recordreader<longwritable  bytesrefarraywritable>
private final reader in
private final long start
private final long end
private boolean more   true
protected configuration conf
public rcfilerecordreader configuration conf  filesplit split
throws ioexception
path path   split getpath
filesystem fs   path getfilesystem conf
this in   new rcfile reader fs  path  conf
this end   split getstart     split getlength
this conf   conf
if  split getstart   > in getposition
in sync split getstart        sync to start
this start   in getposition
more   start < end
public class<?> getkeyclass
return longwritable class
public class<?> getvalueclass
return bytesrefarraywritable class
public longwritable createkey
return  longwritable  reflectionutils newinstance getkeyclass    conf
public bytesrefarraywritable createvalue
return  bytesrefarraywritable  reflectionutils newinstance getvalueclass
conf
@override
public boolean next longwritable key  bytesrefarraywritable value
throws ioexception
more   next key
if  more
in getcurrentrow value
return more
protected boolean next longwritable key  throws ioexception
if   more
return false
more   in next key
if   more
return false
long lastseensyncpos   in lastseensyncpos
if  lastseensyncpos >  end
more   false
return more
return more
/**
* return the progress within the input split.
*
* @return 0.0 to 1.0 of the input byte range
*/
public float getprogress   throws ioexception
if  end    start
return 0 0f
else
return math min 1 0f   in getposition     start     float   end   start
public long getpos   throws ioexception
return in getposition
protected void seek long pos  throws ioexception
in seek pos
public void sync long pos  throws ioexception
in sync pos
public void resetbuffer
in resetbuffer
public long getstart
return start
public void close   throws ioexception
in close