/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive hwi
import java io file
import java io ioexception
import org apache commons logging log
import org apache commons logging logfactory
import org apache hadoop hive conf hiveconf
import org apache hadoop hive shims jettyshims
import org apache hadoop hive shims shimloader
/**
* this is the entry point for hwi. a web server is invoked in the same manner
* as the hive cli. rather then opening a command line session a web server is
* started and a web application to work with hive is started.
*/
public class hwiserver
protected static final log l4j   logfactory getlog hwiserver class getname
private jettyshims server webserver
private final string args
/**
*
* @param args
*          these are the command line arguments. usually -hiveconf.
* @throws java.io.ioexception
*/
public hwiserver string args  throws ioexception
this args   args
/**
* this method initialized the internal jetty servlet engine. it adds the hwi
* context path.
*
* @throws java.io.ioexception
*           port already in use, bad bind etc.
*/
public void start   throws ioexception
hiveconf conf   new hiveconf this getclass
string listen   null
int port    1
listen   conf getvar hiveconf confvars hivehwilistenhost
port   conf getintvar hiveconf confvars hivehwilistenport
if  listen equals
l4j warn
listen
if  port     1
l4j warn
port   9999
string hwiwar   conf getvar hiveconf confvars hivehwiwarfile
string hivehome   system getenv   get
file hwiwarfile   new file hivehome  hwiwar
if   hwiwarfile exists
l4j fatal     hwiwarfile tostring
system exit 1
webserver   shimloader getjettyshims   startserver listen  port
webserver addwar hwiwarfile tostring
/*
* the command line args may be used by multiple components. rather by
* setting these as a system property we avoid having to specifically pass
* them
*/
stringbuilder sb   new stringbuilder
for  string arg   args
sb append arg
system setproperty    sb tostring
try
while  true
try
webserver start
webserver join
l4j debug
break
catch  org mortbay util multiexception ex
throw ex
catch  ioexception ie
throw ie
catch  exception e
ioexception ie   new ioexception
ie initcause e
l4j error    e
throw ie
/**
*
* @param args
*          as of now no arguments are supported
* @throws java.lang.exception
*           could be thrown if due to issues with jetty or bad configuration
*           options
*
*/
public static void main string args  throws exception
hwiserver hwi   new hwiserver args
l4j info
hwi start
/**
* shut down the running hwi server.
*
* @throws exception
*           running thread.stop() can and probably will throw this
*/
public void stop   throws exception
l4j info
webserver stop