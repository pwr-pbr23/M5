/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql exec errors
import java util list
import java util map
import java util regex matcher
import java util regex pattern
/**
* detects the condition where there is a error with one of the input files in
* the query.
*
* conditions to check:
* 1. eofexception in log
* 2. a line indicating the split file in the log. this is needed to
*    generate the proper error message.
*
*/
public class datacorrupterrorheuristic extends regexerrorheuristic
private static final string split_regex
private static final string exception_regex
public datacorrupterrorheuristic
setqueryregex
getlogregexes   add split_regex
getlogregexes   add exception_regex
@override
public errorandsolution geterrorandsolution
errorandsolution es   null
if getquerymatches
map<string  list<string>> rll   getregextologlines
if  rll get exception_regex  size   > 0
rll get split_regex  size   > 0
// there should only be a single split line...
assert rll get split_regex  size    1
string splitlogline   rll get split_regex  get 0
// extract only 'split: hdfs://...'
pattern p   pattern compile split_regex  pattern case_insensitive
matcher m   p matcher splitlogline
m find
string splitstr   m group
es   new errorandsolution
splitstr
reset
return es