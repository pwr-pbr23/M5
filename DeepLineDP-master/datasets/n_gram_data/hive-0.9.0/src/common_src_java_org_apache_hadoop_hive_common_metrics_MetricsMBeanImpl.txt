/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive common metrics
import java io ioexception
import java util hashmap
import java util map
import javax management attribute
import javax management attributelist
import javax management attributenotfoundexception
import javax management invalidattributevalueexception
import javax management mbeanattributeinfo
import javax management mbeanconstructorinfo
import javax management mbeanexception
import javax management mbeaninfo
import javax management mbeannotificationinfo
import javax management mbeanoperationinfo
import javax management reflectionexception
public class metricsmbeanimpl implements  metricsmbean
map<string object> metricsmap   new hashmap<string object>
mbeanattributeinfo attributeinfos
boolean dirtyattributeinfocache   true
mbeanconstructorinfo ctors   null
mbeanoperationinfo ops    new mbeanoperationinfo
null     mbeanoperationinfo action
mbeannotificationinfo notifs   null
@override
public object getattribute string arg0  throws attributenotfoundexception
mbeanexception  reflectionexception
synchronized metricsmap
if  metricsmap containskey arg0
return metricsmap get arg0
else
throw new attributenotfoundexception     arg0
@override
public attributelist getattributes string arg0
attributelist results   new attributelist
synchronized metricsmap
for  string key   arg0
results add new attribute key metricsmap get key
return results
@override
public mbeaninfo getmbeaninfo
if  dirtyattributeinfocache
synchronized metricsmap
attributeinfos   new mbeanattributeinfo
int i   0
for  string key   metricsmap keyset
attributeinfos   new mbeanattributeinfo
key  metricsmap get key  getclass   getname    key  true  false  false
i
dirtyattributeinfocache   false
return new mbeaninfo
this getclass   getname
attributeinfos  ctors  ops  notifs
@override
public object invoke string name  object args  string signature
throws mbeanexception  reflectionexception
if  name equals
reset
return null
throw new reflectionexception new nosuchmethodexception name
@override
public void setattribute attribute attr  throws attributenotfoundexception
invalidattributevalueexception  mbeanexception  reflectionexception
try
put attr getname   attr getvalue
catch  exception e
throw new mbeanexception e
@override
public attributelist setattributes attributelist arg0
attributelist attributesset   new attributelist
for  attribute attr   arg0 aslist
try
setattribute attr
attributesset add attr
catch  attributenotfoundexception e
// ignore exception - we simply don't add this attribute
// back in to the resultant set.
catch  invalidattributevalueexception e
// ditto
catch  mbeanexception e
// likewise
catch  reflectionexception e
// and again, one last time.
return attributesset
public boolean haskey string name
synchronized metricsmap
return metricsmap containskey name
public void put string name  object value  throws ioexception
synchronized metricsmap
if   metricsmap containskey name
dirtyattributeinfocache   true
metricsmap put name  value
public object get string name  throws ioexception
try
return getattribute name
catch  attributenotfoundexception e
throw new ioexception e
catch  mbeanexception e
throw new ioexception e
catch  reflectionexception e
throw new ioexception e
public void reset
synchronized metricsmap
for  string key   metricsmap keyset
metricsmap put key  long valueof 0