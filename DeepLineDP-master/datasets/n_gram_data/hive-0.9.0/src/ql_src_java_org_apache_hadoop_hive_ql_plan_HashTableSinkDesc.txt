/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hive ql plan
import java io serializable
import java util arraylist
import java util hashmap
import java util iterator
import java util linkedhashmap
import java util list
import java util map
import java util map entry
import java util set
/**
* map join operator descriptor implementation.
*
*/
@explain displayname
public class hashtablesinkdesc extends joindesc implements serializable
private static final long serialversionuid   1l
// used to handle skew join
private boolean handleskewjoin   false
private int skewkeydefinition    1
private map<byte  string> bigkeysdirmap
private map<byte  map<byte  string>> smallkeysdirmap
private map<byte  tabledesc> skewkeysvaluestables
// alias to key mapping
private map<byte  list<exprnodedesc>> exprs
// alias to filter mapping
private map<byte  list<exprnodedesc>> filters
// used for create joinoutputobjectinspector
protected list<string> outputcolumnnames
// key:column output name, value:tag
private transient map<string  byte> reversedexprs
// no outer join involved
protected boolean noouterjoin
protected joinconddesc conds
protected byte tagorder
private tabledesc keytabledesc
private map<byte  list<exprnodedesc>> keys
private tabledesc keytbldesc
private list<tabledesc> valuetbldescs
private list<tabledesc> valuetblfiltereddescs
private int posbigtable
private map<byte  list<integer>> retainlist
private transient string bigtablealias
private linkedhashmap<string  linkedhashmap<string  arraylist<string>>> aliasbucketfilenamemapping
private linkedhashmap<string  integer> bucketfilenamemapping
private float hashtablememoryusage
//map join dump file name
private string dumpfileprefix
public hashtablesinkdesc
bucketfilenamemapping   new linkedhashmap<string  integer>
public hashtablesinkdesc mapjoindesc clone
this bigkeysdirmap   clone getbigkeysdirmap
this conds   clone getconds
this exprs  clone getexprs
this handleskewjoin   clone gethandleskewjoin
this keytabledesc   clone getkeytabledesc
this noouterjoin   clone getnoouterjoin
this outputcolumnnames   clone getoutputcolumnnames
this reversedexprs   clone getreversedexprs
this skewkeydefinition   clone getskewkeydefinition
this skewkeysvaluestables   clone getskewkeysvaluestables
this smallkeysdirmap   clone getsmallkeysdirmap
this tagorder   clone gettagorder
this filters   clone getfilters
this keys   clone getkeys
this keytbldesc   clone getkeytbldesc
this valuetbldescs   clone getvaluetbldescs
this valuetblfiltereddescs   clone getvaluefilteredtbldescs
this posbigtable   clone getposbigtable
this retainlist   clone getretainlist
this bigtablealias   clone getbigtablealias
this aliasbucketfilenamemapping   clone getaliasbucketfilenamemapping
this bucketfilenamemapping   clone getbucketfilenamemapping
this dumpfileprefix   clone getdumpfileprefix
private void initretainexprlist
retainlist   new hashmap<byte  list<integer>>
set<entry<byte  list<exprnodedesc>>> set   exprs entryset
iterator<entry<byte  list<exprnodedesc>>> setiter   set iterator
while  setiter hasnext
entry<byte  list<exprnodedesc>> current   setiter next
list<integer> list   new arraylist<integer>
for  int i   0  i < current getvalue   size    i
list add i
retainlist put current getkey    list
public float gethashtablememoryusage
return hashtablememoryusage
public void sethashtablememoryusage float hashtablememoryusage
this hashtablememoryusage   hashtablememoryusage
/**
* @return the dumpfileprefix
*/
public string getdumpfileprefix
return dumpfileprefix
/**
* @param dumpfileprefix
*          the dumpfileprefix to set
*/
public void setdumpfileprefix string dumpfileprefix
this dumpfileprefix   dumpfileprefix
public boolean ishandleskewjoin
return handleskewjoin
@override
public void sethandleskewjoin boolean handleskewjoin
this handleskewjoin   handleskewjoin
@override
public int getskewkeydefinition
return skewkeydefinition
@override
public void setskewkeydefinition int skewkeydefinition
this skewkeydefinition   skewkeydefinition
@override
public map<byte  string> getbigkeysdirmap
return bigkeysdirmap
@override
public void setbigkeysdirmap map<byte  string> bigkeysdirmap
this bigkeysdirmap   bigkeysdirmap
@override
public map<byte  map<byte  string>> getsmallkeysdirmap
return smallkeysdirmap
@override
public void setsmallkeysdirmap map<byte  map<byte  string>> smallkeysdirmap
this smallkeysdirmap   smallkeysdirmap
@override
public map<byte  tabledesc> getskewkeysvaluestables
return skewkeysvaluestables
@override
public void setskewkeysvaluestables map<byte  tabledesc> skewkeysvaluestables
this skewkeysvaluestables   skewkeysvaluestables
@override
public map<byte  list<exprnodedesc>> getexprs
return exprs
@override
public void setexprs map<byte  list<exprnodedesc>> exprs
this exprs   exprs
@override
public map<byte  list<exprnodedesc>> getfilters
return filters
public list<tabledesc> getvaluetblfiltereddescs
return valuetblfiltereddescs
public void setvaluetblfiltereddescs list<tabledesc> valuetblfiltereddescs
this valuetblfiltereddescs   valuetblfiltereddescs
@override
public void setfilters map<byte  list<exprnodedesc>> filters
this filters   filters
@override
public list<string> getoutputcolumnnames
return outputcolumnnames
@override
public void setoutputcolumnnames list<string> outputcolumnnames
this outputcolumnnames   outputcolumnnames
@override
public map<string  byte> getreversedexprs
return reversedexprs
@override
public void setreversedexprs map<string  byte> reversedexprs
this reversedexprs   reversedexprs
@override
public boolean isnoouterjoin
return noouterjoin
@override
public void setnoouterjoin boolean noouterjoin
this noouterjoin   noouterjoin
@override
public joinconddesc getconds
return conds
@override
public void setconds joinconddesc conds
this conds   conds
@override
public byte gettagorder
return tagorder
@override
public void settagorder byte tagorder
this tagorder   tagorder
@override
public tabledesc getkeytabledesc
return keytabledesc
@override
public void setkeytabledesc tabledesc keytabledesc
this keytabledesc   keytabledesc
public map<byte  list<integer>> getretainlist
return retainlist
public void setretainlist map<byte  list<integer>> retainlist
this retainlist   retainlist
/**
* @return the keys
*/
@explain displayname
public map<byte  list<exprnodedesc>> getkeys
return keys
/**
* @param keys
*          the keys to set
*/
public void setkeys map<byte  list<exprnodedesc>> keys
this keys   keys
/**
* @return the position of the big table not in memory
*/
@explain displayname
public int getposbigtable
return posbigtable
/**
* @param posbigtable
*          the position of the big table not in memory
*/
public void setposbigtable int posbigtable
this posbigtable   posbigtable
/**
* @return the keytbldesc
*/
public tabledesc getkeytbldesc
return keytbldesc
/**
* @param keytbldesc
*          the keytbldesc to set
*/
public void setkeytbldesc tabledesc keytbldesc
this keytbldesc   keytbldesc
/**
* @return the valuetbldescs
*/
public list<tabledesc> getvaluetbldescs
return valuetbldescs
/**
* @param valuetbldescs
*          the valuetbldescs to set
*/
public void setvaluetbldescs list<tabledesc> valuetbldescs
this valuetbldescs   valuetbldescs
/**
* @return bigtablealias
*/
public string getbigtablealias
return bigtablealias
/**
* @param bigtablealias
*/
public void setbigtablealias string bigtablealias
this bigtablealias   bigtablealias
public linkedhashmap<string  linkedhashmap<string  arraylist<string>>> getaliasbucketfilenamemapping
return aliasbucketfilenamemapping
public void setaliasbucketfilenamemapping
linkedhashmap<string  linkedhashmap<string  arraylist<string>>> aliasbucketfilenamemapping
this aliasbucketfilenamemapping   aliasbucketfilenamemapping
public linkedhashmap<string  integer> getbucketfilenamemapping
return bucketfilenamemapping
public void setbucketfilenamemapping linkedhashmap<string  integer> bucketfilenamemapping
this bucketfilenamemapping   bucketfilenamemapping