/*
derby - class org.apache.derby.impl.sql.compile.droptablenode
licensed to the apache software foundation (asf) under one or more
contributor license agreements.  see the notice file distributed with
this work for additional information regarding copyright ownership.
the asf licenses this file to you under the apache license, version 2.0
(the "license"); you may not use this file except in compliance with
the license.  you may obtain a copy of the license at
http://www.apache.org/licenses/license-2.0
unless required by applicable law or agreed to in writing, software
distributed under the license is distributed on an "as is" basis,
without warranties or conditions of any kind, either express or implied.
see the license for the specific language governing permissions and
limitations under the license.
*/
package	org apache derby impl sql compile
import org apache derby iapi error standardexception
import org apache derby iapi services sanity sanitymanager
import org apache derby iapi sql compile compilercontext
import org apache derby iapi sql dictionary conglomeratedescriptor
import org apache derby iapi sql dictionary tabledescriptor
import org apache derby iapi sql execute constantaction
/**
* a droptablenode is the root of a querytree that represents a drop table
* statement.
*
*/
public class droptablenode extends ddlstatementnode
private long		conglomeratenumber
private int			dropbehavior
private	tabledescriptor	td
/**
* intializer for a droptablenode
*
* @param dropobjectname	the name of the object being dropped
* @param dropbehavior		drop behavior (restrict | cascade)
*
*/
public void init object dropobjectname  object dropbehavior
throws standardexception
initandcheck dropobjectname
this dropbehavior     integer  dropbehavior  intvalue
/**
* convert this object to a string.  see comments in querytreenode.java
* for how this should be done for tree printing.
*
* @return	this object as a string
*/
public string tostring
if  sanitymanager debug
return super tostring
conglomeratenumber
td    null  ?     td tostring
dropbehavior
else
return
public string statementtostring
return
/**
* bind this locktablenode.  this means looking up the table,
* verifying it exists and getting the heap conglomerate number.
*
*
* @exception standardexception		thrown on error
*/
public void bindstatement   throws standardexception
compilercontext			cc   getcompilercontext
td   gettabledescriptor
conglomeratenumber   td getheapconglomerateid
/* get the base conglomerate descriptor */
conglomeratedescriptor cd   td getconglomeratedescriptor conglomeratenumber
/* statement is dependent on the tabledescriptor and conglomeratedescriptor */
cc createdependency td
cc createdependency cd
/**
* return true if the node references session schema tables (temporary or permanent)
*
* @return	true if references session schema tables, else false
*
* @exception standardexception		thrown on error
*/
public boolean referencessessionschema
throws standardexception
//if table being dropped is in session schema, then return true.
return issessionschema td getschemadescriptor
// inherit generate() method from ddlstatementnode
/**
* create the constant information that will drive the guts of execution.
*
* @exception standardexception		thrown on failure
*/
public constantaction	makeconstantaction   throws standardexception
return	getgenericconstantactionfactory   getdroptableconstantaction  getfullname
getrelativename
getschemadescriptor
conglomeratenumber
td getuuid
dropbehavior