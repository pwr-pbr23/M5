/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket markup html link
import java util arraylist
import java util iterator
import java util list
import org apache wicket iclusterable
import org apache wicket markup componenttag
import org apache wicket markup markupstream
import org apache wicket markup html webmarkupcontainer
/**
* an image map holds links with different hot-area shapes.
*
* @author jonathan locke
*/
public final class imagemap extends webmarkupcontainer
private static final long serialversionuid   1l
/** list of shape links. */
private final list shapelinks   new arraylist
/**
* a shape that has a circle form.
*/
private static final class circlelink extends shapelink
private static final long serialversionuid   1l
/** the circle's radius. */
private final int radius
/** upper left x */
private final int x
/** upper left y */
private final int y
/**
* construct.
*
* @param x
*            left upper x
* @param y
*            left upper y
* @param radius
*            the circles' radius
* @param link
*            the link
*/
public circlelink final int x  final int y  final int radius  final link link
super link
this x   x
this y   y
this radius   radius
/**
* @see org.apache.wicket.markup.html.link.imagemap.shapelink#getcoordinates()
*/
string getcoordinates
return x       y       radius
/**
* @see org.apache.wicket.markup.html.link.imagemap.shapelink#gettype()
*/
string gettype
return
/**
* a shape that has a free (polygon) form.
*/
private static final class polygonlink extends shapelink
private static final long serialversionuid   1l
/** its coordinates. */
private final int coordinates
/**
* construct.
*
* @param coordinates
*            the polygon coordinates
* @param link
*            the link
*/
public polygonlink final int coordinates  final link link
super link
this coordinates   coordinates
/**
* @see org.apache.wicket.markup.html.link.imagemap.shapelink#getcoordinates()
*/
string getcoordinates
final stringbuffer buffer   new stringbuffer
for  int i   0  i < coordinates length  i
buffer append coordinates
if  i <  coordinates length   1
buffer append
return buffer tostring
/**
* @see org.apache.wicket.markup.html.link.imagemap.shapelink#gettype()
*/
string gettype
return
/**
* a shape that has a rectangular form.
*/
private static final class rectanglelink extends shapelink
private static final long serialversionuid   1l
/** left upper x. */
private final int x1
/** right bottom x. */
private final int x2
/** left upper y. */
private final int y1
/** right bottom y. */
private final int y2
/**
* construct.
*
* @param x1
*            left upper x
* @param y1
*            left upper y
* @param x2
*            right bottom x
* @param y2
*            right bottom y
* @param link
*            the link
*/
public rectanglelink final int x1  final int y1  final int x2  final int y2  final link link
super link
this x1   x1
this y1   y1
this x2   x2
this y2   y2
/**
* @see org.apache.wicket.markup.html.link.imagemap.shapelink#getcoordinates()
*/
string getcoordinates
return x1       y1       x2       y2
/**
* @see org.apache.wicket.markup.html.link.imagemap.shapelink#gettype()
*/
string gettype
return
/**
* base class for shaped links.
*/
private static abstract class shapelink implements iclusterable
/** the link. */
private final link link
/**
* constructor.
*
* @param link
*            the link
*/
public shapelink final link link
this link   link
/**
* the shape as a string using the given request cycle; will be used for
* rendering.
*
* @return the shape as a string
*/
public string tostring
// add any popup script
final string popupjavascript
if  link getpopupsettings      null
popupjavascript   link getpopupsettings   getpopupjavascript
else
popupjavascript   null
return
popupjavascript    null  ?
/**
* gets the coordinates of the shape.
*
* @return the coordinates of the shape
*/
abstract string getcoordinates
/**
* gets the shape type.
*
* @return the shape type
*/
abstract string gettype
/**
* constructor.
*
* @param id
*            see component
*/
public imagemap final string id
super id
/**
* adds a circle link.
*
* @param x1
*            top left x
* @param y1
*            top left y
* @param radius
*            the radius
* @param link
*            the link
* @return this
*/
public imagemap addcirclelink final int x1  final int y1  final int radius  final link link
add link
shapelinks add new circlelink x1  y1  radius  link
return this
/**
* adds a polygon link.
*
* @param coordinates
*            the coordinates for the polygon
* @param link
*            the link
* @return this
*/
public imagemap addpolygonlink final int coordinates  final link link
add link
shapelinks add new polygonlink coordinates  link
return this
/**
* adds a rectangular link.
*
* @param x1
*            top left x
* @param y1
*            top left y
* @param x2
*            bottom right x
* @param y2
*            bottom right y
* @param link
* @return this
*/
public imagemap addrectanglelink final int x1  final int y1  final int x2  final int y2
final link link
add link
shapelinks add new rectanglelink x1  y1  x2  y2  link
return this
/**
* renders this component.
*
* @see org.apache.wicket.component#onrender(markupstream)
*/
protected void onrender final markupstream markupstream
// get mutable copy of next tag
final componenttag tag   markupstream gettag   mutable
// must be an img tag
checkcomponenttag tag
// set map name to path
tag put        getpath
// write out the tag
rendercomponenttag tag
markupstream next
// write out the image map
final stringbuffer imagemap   new stringbuffer
imagemap append
for  iterator iterator   shapelinks iterator    iterator hasnext
final shapelink shapelink    shapelink iterator next
imagemap append
imagemap append shapelink tostring
// tell framework that this link was actually rendered
getpage   componentrendered shapelink link
imagemap append
getresponse   write imagemap tostring