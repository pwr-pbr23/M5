/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket util file
import java net url
import java util arraylist
import java util iterator
import java util list
import javax servlet servletcontext
import org apache commons logging log
import org apache commons logging logfactory
import org apache wicket util resource fileresourcestream
import org apache wicket util resource iresourcestream
import org apache wicket util resource urlresourcestream
import org apache wicket util string stringlist
/**
* maintain a list of paths which might either be ordinary folders of the
* filesystem or relative paths to the web application's servlet context.
*
* @author johan compagner
*/
public final class webapplicationpath implements iresourcepath
private final static log log   logfactory getlog webapplicationpath class
/** the list of urls in the path */
private final list webapppaths   new arraylist
/** the list of folders in the path */
private final list folders   new arraylist
/** the web apps servlet context */
private final servletcontext servletcontext
/**
* constructor
*
* @param servletcontext
*            the webapplication context where the resources must be loaded
*            from
*/
public webapplicationpath final servletcontext servletcontext
this servletcontext   servletcontext
/**
* @param path
*            add a path that is lookup through the servlet context
*/
public void add string path
final folder folder   new folder path
if  folder exists
folders add folder
else
if   path startswith
path       path
if   path endswith
path
webapppaths add path
/**
*
* @see org.apache.wicket.util.file.iresourcefinder#find(class, string)
*/
public iresourcestream find final class clazz  final string pathname
iterator iter   folders iterator
while  iter hasnext
folder folder    folder  iter next
final file file   new file folder  pathname
if  file exists
return new fileresourcestream file
iter   webapppaths iterator
while  iter hasnext
string path    string  iter next
try
final url url   servletcontext getresource path   pathname
if  url    null
iresourcestream stream   new urlresourcestream url
if  stream    null
log error
url toexternalform
return stream
catch  exception ex
// ignore, file couldn't be found
return null
/**
* @see java.lang.object#tostring()
*/
public string tostring
return     stringlist valueof folders
stringlist valueof webapppaths