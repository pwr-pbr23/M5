/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket extensions util encoding
import java io ioexception
import java io inputstream
import javax servlet servletcontext
import org apache commons logging log
import org apache commons logging logfactory
import org apache wicket requestcycle
import org apache wicket wicketruntimeexception
import org apache wicket protocol http webapplication
/**
* utility class. initialize locale to character encoding mapping based on
* defaults and optionally a properties file charsetmap.charset_resource
* to be found in web-inf.
*
* @author jonathan locke
* @author juergen donnerstag
*/
public class charsetutil
/** logging */
private static final log log   logfactory getlog charsetutil class
/** locale to character encoding mapping */
private static charsetmap charsetmap
/**
* constructor
*/
public charsetutil
/**
* initialize the mapping table based on defaults and optionally modified by
* entries from a properties file to be found in web-inf.
*
* @param application wicket application object
*/
private synchronized static final void initialize final webapplication application
if  charsetmap    null
// get servlet context
final servletcontext context   application getservletcontext
final inputstream inputstream   context getresourceasstream
charsetmap charset_resource
if  inputstream    null
charsetmap   new charsetmap
if  log isdebugenabled
log debug     charsetmap charset_resource
else
try
charsetmap   new charsetmap inputstream
catch  ioexception ex
throw new wicketruntimeexception    ex
/**
* based on the session's locale determine the associated character encoding.
*
* @param cycle
* @return char set to use for response.
*/
public final static string getencoding final requestcycle cycle
if  charsetmap    null
initialize  webapplication cycle getapplication
return charsetmap getcharset cycle getsession   getlocale