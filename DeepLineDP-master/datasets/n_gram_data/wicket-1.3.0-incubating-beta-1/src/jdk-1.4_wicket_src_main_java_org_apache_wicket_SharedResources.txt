/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket
import java util hashmap
import java util locale
import java util map
import org apache commons logging log
import org apache commons logging logfactory
import org apache wicket util file files
import org apache wicket util string appendingstringbuffer
/**
* class which holds shared resources. resources can be shared by name. an
* optional scope can be given to prevent naming conflicts and a locale and/or
* style can be given as well.
*
* @author jonathan locke
* @author johan compagner
* @author gili tzabari
*/
public class sharedresources
/** logger */
private static final log log   logfactory getlog sharedresources class
/**
* this method is not part of the wicket public api. do not call it. inserts
* _[locale] and _[style] into path just before any extension that might
* exist.
*
* @param path
*            the resource path
* @param locale
*            the locale
* @param style
*            the style (see {@link org.apache.wicket.session})
* @return the localized path
*/
public static string resourcekey final string path  final locale locale  final string style
final string extension   files extension path
final string basepath   files basepath path  extension
final appendingstringbuffer buffer   new appendingstringbuffer basepath length     16
buffer append basepath
// first style because locale can append later on.
if  style    null
buffer append
buffer append style
if  locale    null
buffer append
boolean l   locale getlanguage   length      0
boolean c   locale getcountry   length      0
boolean v   locale getvariant   length      0
buffer append locale getlanguage
if  c     l    v
buffer append    append locale getcountry        this may just
// append '_'
if  v     l    c
buffer append    append locale getvariant
if  extension    null
buffer append
buffer append extension
return buffer tostring
/** map of class to alias string */
private final map classaliasmap   new hashmap
private final map aliasclassmap   new hashmap
/** map of shared resources states */
private final map resourcemap   new hashmap
/**
* construct.
*
* @param application
*            the application
*/
sharedresources application application
/**
* adds a resource.
*
* @param scope
*            scope of resource
* @param name
*            logical name of resource
* @param locale
*            the locale of the resource
* @param style
*            the resource style (see {@link org.apache.wicket.session})
* @param resource
*            resource to store
*/
public final void add final class scope  final string name  final locale locale
final string style  final resource resource
// store resource
final string key   resourcekey scope  name  locale  style
synchronized  resourcemap
resource value    resource resourcemap get key
if  value    null
resourcemap put key  resource
if  log isdebugenabled
log debug     key
/**
* adds a resource.
*
* @param name
*            logical name of resource
* @param locale
*            the locale of the resource
* @param resource
*            resource to store
*/
public final void add final string name  final locale locale  final resource resource
add application class  name  locale  null  resource
/**
* adds a resource.
*
* @param name
*            logical name of resource
* @param resource
*            resource to store
*/
public final void add final string name  final resource resource
add application class  name  null  null  resource
/**
* @param scope
*            the resource's scope
* @param name
*            name of resource to get
* @param locale
*            the locale of the resource
* @param style
*            the resource style (see {@link org.apache.wicket.session})
* @param exact
*            if true then only return the resource that is registered for
*            the given locale and style.
*
* @return the logical resource
*/
public final resource get final class scope  final string name  final locale locale
final string style  boolean exact
// 1. look for fully qualified entry with locale and style
if  locale    null    style    null
final string resourcekey   resourcekey scope  name  locale  style
final resource resource   get resourcekey
if  resource    null
return resource
if  exact
return null
// 2. look for entry without style
if  locale    null
final string key   resourcekey scope  name  locale  null
final resource resource   get key
if  resource    null
return resource
if  exact
return null
// 3. look for entry without locale
if  style    null
final string key   resourcekey scope  name  null  style
final resource resource   get key
if  resource    null
return resource
if  exact
return null
// 4. look for base name with no locale or style
final string key   resourcekey scope  name  null  null
return get key
/**
* this method is not part of the wicket public api. do not use it.
*
* @param key
*            shared resource key
* @return the resource
*/
public final resource get final string key
synchronized  resourcemap
return  resource resourcemap get key
/**
* sets an alias for a class so that a resource url can look like:
* resources/images/image.jpg instead of
* resources/org.apache.wicket.resources.resourceclass/image.jpg
*
* @param clz
*            the class that has to be aliased.
* @param alias
*            the alias string.
*/
public final void putclassalias class clz  string alias
classaliasmap put clz  alias
aliasclassmap put alias  clz
/**
* gets the class for a given resource alias.
*
* @param alias
* @return the class this is an alias for.
* @see #putclassalias(class, string)
*/
public final class getaliasclass string alias
return  class aliasclassmap get alias
/**
* removes a shared resource.
*
* @param key
*            shared resource key
*/
public final void remove final string key
synchronized  resourcemap
resourcemap remove key
/**
* this method is not part of the wicket public api. do not call it.
*
* @param scope
*            the scope of the resource
* @param path
*            the resource path
* @param locale
*            the locale
* @param style
*            the style (see {@link org.apache.wicket.session})
* @return the localized path
*/
public string resourcekey final class scope  final string path  final locale locale
final string style
string alias    string classaliasmap get scope
if  alias    null
alias   scope getname
return alias       resourcekey path  locale  style