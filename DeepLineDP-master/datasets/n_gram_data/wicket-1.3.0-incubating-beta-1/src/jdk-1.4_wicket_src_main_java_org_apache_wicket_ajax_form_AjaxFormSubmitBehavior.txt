/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket ajax form
import org apache wicket component
import org apache wicket page
import org apache wicket ajax ajaxeventbehavior
import org apache wicket ajax ajaxrequesttarget
import org apache wicket markup html form button
import org apache wicket markup html form form
import org apache wicket markup html form formcomponent
import org apache wicket util string appendingstringbuffer
/**
* ajax event behavior that submits a form via ajax when the event it is
* attached to is invoked.
* <p>
* the form must have an id attribute in the markup or have markupidsetter
* added.
*
* @see ajaxeventbehavior
*
* @since 1.2
*
* @author igor vaynberg (ivaynberg)
*
*/
public abstract class ajaxformsubmitbehavior extends ajaxeventbehavior
/**
*
*/
private static final long serialversionuid   1l
private component owner
private form form
/**
* constructor. this constructor can only be used when the component this
* behavior is attached to is inside a form.
*
* @param event
*            javascript event this behavior is attached to, like onclick
*/
public ajaxformsubmitbehavior string event
this null  event
/**
* construct.
*
* @param form
*            form that will be submitted
* @param event
*            javascript event this behavior is attached to, like onclick
*/
public ajaxformsubmitbehavior form form  string event
super event
this form   form
if  form    null
form setoutputmarkupid true
private form getform
if  form    null
// try to find form in the hierarchy of owning component
component cursor   getcomponent
while  cursor    null      cursor instanceof form
cursor   cursor getparent
if  cursor    null
throw new illegalstateexception
else
form    form cursor
return form
protected charsequence geteventhandler
final string formid   getform   getmarkupid
final charsequence url   getcallbackurl
appendingstringbuffer call   new appendingstringbuffer    append
formid  append    append url  append
if  getcomponent   instanceof button
call append    append   formcomponent getcomponent    getinputname    append
else
call append
return getcallbackscript call  null  null
protected void onevent ajaxrequesttarget target
getform   onformsubmitted
if   getform   haserror
onsubmit target
if  form findparent page class     null
/*
* there can be cases when a form is replaced with another component
* in the onsubmit() handler of this behavior. in that case form no
* longer has a page and so calling .haserror on it will cause an
* exception, thus the check above.
*/
if  getform   haserror
onerror target
/**
* listener method that is invoked after the form has ben submitted and
* processed without errors
*
* @param target
*/
protected abstract void onsubmit ajaxrequesttarget target
/**
* listener method invoked when the form has been processed and errors
* occured
*
* @param target
*
* todo 1.3: make abstract to be consistent with onsubmit()
*
*/
protected void onerror ajaxrequesttarget target