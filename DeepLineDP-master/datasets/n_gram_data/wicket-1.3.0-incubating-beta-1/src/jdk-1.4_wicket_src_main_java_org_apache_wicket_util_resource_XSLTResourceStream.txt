/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket util resource
import java io bytearrayinputstream
import java io bytearrayoutputstream
import java io ioexception
import java io inputstream
import java util iterator
import java util map
import java util map entry
import org apache wicket wicketruntimeexception
import org apache wicket util resource abstractresourcestream
import org apache wicket util resource iresourcestream
import org apache wicket util resource resourcestreamnotfoundexception
import org apache wicket util time time
/**
* {@link iresourcestream} that applies xslt on an input {@link iresourcestream}.
* the xsl stylesheet itself is also an {@link iresourcestream}. override
* {@link #getparameters()} to pass parameters to the xsl stylesheet.
*
* <p>
* fixme experimental feature, does not implement any kind of caching, use with
* care, running an xsl transformation for every request is very expensive!
* please have a look at {@link zipresourcestream} for an in-depth explanation
* of what needs to be done with respect to caching.
* </p>
*
* @author <a href="mailto:jbq@apache.org">jean-baptiste quenot</a>
*/
public class xsltresourcestream extends abstractresourcestream
/**
*
*/
private static final long serialversionuid   1l
bytearrayoutputstream out
/**
* @return a {@link map} of xslt parameters, appropriate for passing
*         information to the xsl stylesheet
*/
protected map getparameters
return null
/**
* construct.
*
* @param xsltresource
*            the xsl stylesheet as an {@link iresourcestream}
* @param xmlresource
*            the input xml document as an {@link iresourcestream}
*/
public xsltresourcestream iresourcestream xsltresource  iresourcestream xmlresource
try
javax xml transform source xmlsource   new javax xml transform stream streamsource
xmlresource getinputstream
javax xml transform source xsltsource   new javax xml transform stream streamsource
xsltresource getinputstream
out   new bytearrayoutputstream
javax xml transform result result   new javax xml transform stream streamresult out
// create an instance of transformerfactory
javax xml transform transformerfactory transfact   javax xml transform transformerfactory
newinstance
javax xml transform transformer trans   transfact newtransformer xsltsource
map parameters   getparameters
if  parameters    null
iterator it   parameters entryset   iterator
while  it hasnext
entry e    entry it next
trans setparameter e getkey   tostring    e getvalue   tostring
trans transform xmlsource  result
catch  exception e
throw new wicketruntimeexception e
finally
try
xmlresource close
xsltresource close
catch  ioexception e
// ignore
/**
* @see org.apache.wicket.util.resource.iresourcestream#close()
*/
public void close   throws ioexception
/**
* returns always null
*
* @see org.apache.wicket.util.resource.iresourcestream#getcontenttype()
*/
public string getcontenttype
return null
/**
* @see org.apache.wicket.util.resource.iresourcestream#getinputstream()
*/
public inputstream getinputstream   throws resourcestreamnotfoundexception
return new bytearrayinputstream out tobytearray
/**
* @see org.apache.wicket.util.resource.iresourcestream#length()
*/
public long length
return out size
/**
* returns always null
*
* @see org.apache.wicket.util.watch.imodifiable#lastmodifiedtime()
*/
public time lastmodifiedtime
return null