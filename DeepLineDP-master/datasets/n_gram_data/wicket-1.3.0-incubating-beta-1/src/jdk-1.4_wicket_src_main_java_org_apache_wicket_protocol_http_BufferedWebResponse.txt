/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket protocol http
import javax servlet http httpservletresponse
import org apache wicket wicketruntimeexception
import org apache wicket util string appendingstringbuffer
/**
* subclass of webresponse which buffers output and any redirection.
*
* @author jonathan locke
*/
public class bufferedwebresponse extends webresponse
/** url to redirect to when response is flushed, if any */
private string redirecturl
/** buffer to hold page */
private appendingstringbuffer buffer   new appendingstringbuffer 4096
/**
* constructor for testing harness.
*/
bufferedwebresponse
/**
* package private constructor.
*
* @param httpservletresponse
*            the servlet response object
*/
public bufferedwebresponse final httpservletresponse httpservletresponse
super httpservletresponse
/**
* flushes the response buffer by doing a redirect or writing out the
* buffer. note: the servlet container will close the response output
* stream.
*/
public void close
// if a redirection was specified
if  redirecturl    null
// actually redirect
super redirect redirecturl
else
// write the buffer to the response stream
if  buffer length      0
super write buffer
/**
* @see org.apache.wicket.response#reset()
*/
public void reset
redirecturl   null
buffer clear
/**
* saves url to redirect to when buffered response is flushed.
* implementations should encode the url to make sure cookie-less operation
* is supported in case clients forgot.
*
* @param url
*            the url to redirect to
*/
public final void redirect final string url
if  redirecturl    null
throw new wicketruntimeexception     redirecturl
// encode to make sure no caller forgot this
this redirecturl   encodeurl url  tostring
/**
* writes string to response output.
*
* @param string
*            the string to write
*/
public void write final charsequence string
buffer append string
/**
* this method is not part of the wicket public api.
*/
public final void filter
if  redirecturl    null    buffer length      0
this buffer   filter buffer
/**
*
* @see java.lang.object#tostring()
*/
public string tostring
return buffer tostring