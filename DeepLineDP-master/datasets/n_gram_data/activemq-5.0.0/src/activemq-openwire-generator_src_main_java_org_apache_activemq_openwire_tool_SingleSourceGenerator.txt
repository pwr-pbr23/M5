/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq openwire tool
import java io file
import java io filewriter
import java io printwriter
import java util arraylist
import java util hashset
import java util iterator
import java util list
import java util set
import org apache tools ant project
import org apache tools ant taskdefs fixcrlf
import org codehaus jam jclass
import org codehaus jam jproperty
import org codehaus jam jamclassiterator
/**
* @version $revision: 386442 $
*/
public abstract class singlesourcegenerator extends openwiregenerator
protected set<string> manuallymaintainedclasses   new hashset<string>
protected file destfile
protected jclass jclass
protected jclass superclass
protected string simplename
protected string classname
protected string baseclass
protected list<jclass> sortedclasses
public singlesourcegenerator
initialisemanuallymaintainedclasses
public object run
if  destfile    null
throw new illegalargumentexception
destfile getparentfile   mkdirs
printwriter out   null
try
out   new printwriter new filewriter destfile
arraylist<jclass> classes   new arraylist<jclass>
jamclassiterator iter   getclasses
while  iter hasnext
jclass   iter nextclass
if  isvalidclass jclass
classes add jclass
sortedclasses   sort classes
generatesetup out
for  iterator<jclass> iterator   sortedclasses iterator    iterator hasnext
jclass   iterator next
simplename   jclass getsimplename
superclass   jclass getsuperclass
classname   getclassname jclass
baseclass   getbaseclassname jclass
system out println getclass   getname         simplename
generatefile out
generateteardown out
catch  exception e
throw new runtimeexception e
finally
if  out    null
out close
// use the fixcrlf ant task to make sure the file has consistent
// newlines
// so that svn does not complain on checkin.
project project   new project
project init
fixcrlf fixcrlf   new fixcrlf
fixcrlf setproject project
fixcrlf setsrcdir destfile getparentfile
fixcrlf setincludes destfile getname
fixcrlf execute
return null
protected list<jclass> sort list<jclass> classes
return classes
protected void generateteardown printwriter out
protected void generatesetup printwriter out
/**
* returns all the valid properties available on the current class
*/
public list<jproperty> getproperties
list<jproperty> answer   new arraylist<jproperty>
jproperty properties   jclass getdeclaredproperties
for  int i   0  i < properties length  i
jproperty property   properties
if  isvalidproperty property
answer add property
return answer
protected boolean isvalidclass jclass jclass
if  jclass    null    jclass getannotation       null
return false
return true
// return !manuallymaintainedclasses.contains(jclass.getsimplename());
protected abstract void generatefile printwriter out  throws exception
protected string getbaseclassname jclass jclass
string answer
if  superclass    null
string name   superclass getsimplename
if  name    null     name equals
answer   name
return answer
protected string getclassname jclass jclass
return jclass getsimplename
public boolean isabstractclass
return jclass    null    jclass isabstract
public string getabstractclasstext
return isabstractclass   ?
public boolean ismarshalleraware
return ismarshallaware jclass
protected void initialisemanuallymaintainedclasses
string names
for  int i   0  i < names length  i
manuallymaintainedclasses add names
public string getbaseclass
return baseclass
public void setbaseclass string baseclass
this baseclass   baseclass
public string getclassname
return classname
public void setclassname string classname
this classname   classname
public file getdestfile
return destfile
public void setdestfile file destfile
this destfile   destfile
public jclass getjclass
return jclass
public void setjclass jclass jclass
this jclass   jclass
public set<string> getmanuallymaintainedclasses
return manuallymaintainedclasses
public void setmanuallymaintainedclasses set<string> manuallymaintainedclasses
this manuallymaintainedclasses   manuallymaintainedclasses
public string getsimplename
return simplename
public void setsimplename string simplename
this simplename   simplename
public jclass getsuperclass
return superclass
public void setsuperclass jclass superclass
this superclass   superclass