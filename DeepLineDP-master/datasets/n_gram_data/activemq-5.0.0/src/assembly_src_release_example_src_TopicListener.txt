/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java util arrays
import javax jms connection
import javax jms jmsexception
import javax jms message
import javax jms messageconsumer
import javax jms messagelistener
import javax jms messageproducer
import javax jms session
import javax jms textmessage
import javax jms topic
import org apache activemq activemqconnectionfactory
/**
* use in conjunction with topicpublisher to test the performance of activemq
* topics.
*/
public class topiclistener implements messagelistener
private connection connection
private messageproducer producer
private session session
private int count
private long start
private topic topic
private topic control
private string url
public static void main string argv  throws exception
topiclistener l   new topiclistener
string unknown   commandlinesupport setoptions l  argv
if  unknown length > 0
system out println     arrays tostring unknown
system exit  1
l run
public void run   throws jmsexception
activemqconnectionfactory factory   new activemqconnectionfactory url
connection   factory createconnection
session   connection createsession false  session auto_acknowledge
topic   session createtopic
control   session createtopic
messageconsumer consumer   session createconsumer topic
consumer setmessagelistener this
connection start
producer   session createproducer control
system out println
private static boolean checktext message m  string s
try
return m instanceof textmessage      textmessage m  gettext   equals s
catch  jmsexception e
e printstacktrace system out
return false
public void onmessage message message
if  checktext message
try
connection close
catch  exception e
e printstacktrace system out
else if  checktext message
// send a report:
try
long time   system currenttimemillis     start
string msg       count       time
producer send session createtextmessage msg
catch  exception e
e printstacktrace system out
count   0
else
if  count    0
start   system currenttimemillis
if    count % 1000    0
system out println     count
public void seturl string url
this url   url