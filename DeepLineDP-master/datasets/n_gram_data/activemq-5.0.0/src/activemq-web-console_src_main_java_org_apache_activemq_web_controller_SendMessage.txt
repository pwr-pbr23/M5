/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq web controller
import java util iterator
import java util map
import javax jms jmsexception
import javax jms message
import javax servlet http httpservletrequest
import javax servlet http httpservletresponse
import org apache activemq command activemqdestination
import org apache activemq web brokerfacade
import org apache activemq web destinationfacade
import org apache activemq web webclient
import org springframework web servlet modelandview
import org springframework web servlet mvc controller
/**
* sends a message
*
* @version $revision$
*/
public class sendmessage extends destinationfacade implements controller
private string jmstext
private boolean jmspersistent
private int jmspriority
private int jmstimetolive    1
private string jmscorrelationid
private string jmsreplyto
private string jmstype
private int jmsmessagecount   1
private string jmsmessagecountheader
private boolean redirecttobrowse
public sendmessage brokerfacade brokerfacade
super brokerfacade
public modelandview handlerequest httpservletrequest request  httpservletresponse response  throws exception
webclient client   webclient getwebclient request
activemqdestination dest   createdestination
sendmessages request  client  dest
if  redirecttobrowse
if  isqueue
return new modelandview     getjmsdestination
return redirecttobrowseview
protected void sendmessages httpservletrequest request  webclient client  activemqdestination dest  throws jmsexception
if  jmsmessagecount <  1
jmsmessagecount   1
for  int i   0  i < jmsmessagecount  i
message message   createmessage client  request
appendheaders message  request
if  jmsmessagecount > 1
message setintproperty jmsmessagecountheader  i   1
client send dest  message  jmspersistent  jmspriority  jmstimetolive
// properties
// -------------------------------------------------------------------------
public string getjmscorrelationid
return jmscorrelationid
public void setjmscorrelationid string correlationid
jmscorrelationid   correlationid
public string getjmsreplyto
return jmsreplyto
public void setjmsreplyto string replyto
jmsreplyto   replyto
public string getjmstype
return jmstype
public void setjmstype string type
jmstype   type
public boolean isjmspersistent
return jmspersistent
public void setjmspersistent boolean persistent
this jmspersistent   persistent
public int getjmspriority
return jmspriority
public void setjmspriority int priority
this jmspriority   priority
public string getjmstext
return jmstext
public void setjmstext string text
this jmstext   text
public int getjmstimetolive
return jmstimetolive
public void setjmstimetolive int timetolive
this jmstimetolive   timetolive
public int getjmsmessagecount
return jmsmessagecount
public void setjmsmessagecount int copies
jmsmessagecount   copies
public string getjmsmessagecountheader
return jmsmessagecountheader
public void setjmsmessagecountheader string messagecountheader
jmsmessagecountheader   messagecountheader
// implementation methods
// -------------------------------------------------------------------------
protected message createmessage webclient client  httpservletrequest request  throws jmsexception
if  jmstext    null
return client getsession   createtextmessage jmstext
// todo create bytes message from request body...
return client getsession   createmessage
protected void appendheaders message message  httpservletrequest request  throws jmsexception
message setjmscorrelationid jmscorrelationid
if  jmsreplyto    null    jmsreplyto trim   length   > 0
message setjmsreplyto activemqdestination createdestination jmsreplyto  activemqdestination queue_type
message setjmstype jmstype
// now lets add all of the parameters
map map   request getparametermap
if  map    null
for  iterator iter   map entryset   iterator    iter hasnext
map entry entry    map entry iter next
string name    string entry getkey
object value   entry getvalue
if  isvalidpropertyname name
if  value instanceof string
string array    string value
if  array length > 0
value   array
else
value   null
if  value instanceof string
string text   value tostring   trim
if  text length      0
value   null
else
value   text
if  value    null
message setobjectproperty name  value
protected boolean isvalidpropertyname string name
// allow jmsx extensions or non jms properties
return name startswith        name startswith