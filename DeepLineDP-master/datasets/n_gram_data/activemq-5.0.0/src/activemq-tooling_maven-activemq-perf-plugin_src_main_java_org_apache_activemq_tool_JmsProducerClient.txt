/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq tool
import java util arrays
import javax jms connectionfactory
import javax jms deliverymode
import javax jms destination
import javax jms jmsexception
import javax jms messageproducer
import javax jms textmessage
import org apache activemq tool properties jmsclientproperties
import org apache activemq tool properties jmsproducerproperties
import org apache commons logging log
import org apache commons logging logfactory
public class jmsproducerclient extends abstractjmsmeasurableclient
private static final log log   logfactory getlog jmsproducerclient class
protected jmsproducerproperties client
protected messageproducer jmsproducer
protected textmessage jmstextmessage
public jmsproducerclient connectionfactory factory
this new jmsproducerproperties    factory
public jmsproducerclient jmsproducerproperties clientprops  connectionfactory factory
super factory
this client   clientprops
public void sendmessages   throws jmsexception
// send a specific number of messages
if  client getsendtype   equalsignorecase jmsproducerproperties count_based_sending
sendcountbasedmessages client getsendcount
// send messages for a specific duration
else
sendtimebasedmessages client getsendduration
public void sendmessages int destcount  throws jmsexception
this destcount   destcount
sendmessages
public void sendmessages int destindex  int destcount  throws jmsexception
this destindex   destindex
sendmessages destcount
public void sendcountbasedmessages long messagecount  throws jmsexception
// parse through different ways to send messages
// avoided putting the condition inside the loop to prevent effect on performance
destination dest   createdestination destindex  destcount
// create a producer, if none is created.
if  getjmsproducer      null
if  dest length    1
createjmsproducer dest
else
createjmsproducer
try
getconnection   start
log info     client getmessagesize         messagecount
// send one type of message only, avoiding the creation of different messages on sending
if   client iscreatenewmsg
// create only a single message
createjmstextmessage
// send to more than one actual destination
if  dest length > 1
for  int i   0  i < messagecount  i
for  int j   0  j < dest length  j
getjmsproducer   send dest  getjmstextmessage
incthroughput
// send to only one actual destination
else
for  int i   0  i < messagecount  i
getjmsproducer   send getjmstextmessage
incthroughput
// send different type of messages using indexing to identify each one.
// message size will vary. definitely slower, since messages properties
// will be set individually each send.
else
// send to more than one actual destination
if  dest length > 1
for  int i   0  i < messagecount  i
for  int j   0  j < dest length  j
getjmsproducer   send dest  createjmstextmessage     i
incthroughput
// send to only one actual destination
else
for  int i   0  i < messagecount  i
getjmsproducer   send createjmstextmessage     i
incthroughput
finally
getconnection   close
public void sendtimebasedmessages long duration  throws jmsexception
long endtime   system currenttimemillis     duration
// parse through different ways to send messages
// avoided putting the condition inside the loop to prevent effect on performance
destination dest   createdestination destindex  destcount
// create a producer, if none is created.
if  getjmsproducer      null
if  dest length    1
createjmsproducer dest
else
createjmsproducer
try
getconnection   start
log info     client getmessagesize         duration
// send one type of message only, avoiding the creation of different messages on sending
if   client iscreatenewmsg
// create only a single message
createjmstextmessage
// send to more than one actual destination
if  dest length > 1
while  system currenttimemillis   < endtime
for  int j   0  j < dest length  j
getjmsproducer   send dest  getjmstextmessage
incthroughput
// send to only one actual destination
else
while  system currenttimemillis   < endtime
getjmsproducer   send getjmstextmessage
incthroughput
// send different type of messages using indexing to identify each one.
// message size will vary. definitely slower, since messages properties
// will be set individually each send.
else
// send to more than one actual destination
long count   1
if  dest length > 1
while  system currenttimemillis   < endtime
for  int j   0  j < dest length  j
getjmsproducer   send dest  createjmstextmessage     count
incthroughput
// send to only one actual destination
else
while  system currenttimemillis   < endtime
getjmsproducer   send createjmstextmessage     count
incthroughput
finally
getconnection   close
public messageproducer createjmsproducer   throws jmsexception
jmsproducer   getsession   createproducer null
if  client getdeliverymode   equalsignorecase jmsproducerproperties delivery_mode_persistent
log info
jmsproducer setdeliverymode deliverymode persistent
else if  client getdeliverymode   equalsignorecase jmsproducerproperties delivery_mode_non_persistent
log info
jmsproducer setdeliverymode deliverymode non_persistent
else
log warn
jmsproducer setdeliverymode deliverymode non_persistent
return jmsproducer
public messageproducer createjmsproducer destination dest  throws jmsexception
jmsproducer   getsession   createproducer dest
if  client getdeliverymode   equalsignorecase jmsproducerproperties delivery_mode_persistent
log info     dest tostring
jmsproducer setdeliverymode deliverymode persistent
else if  client getdeliverymode   equalsignorecase jmsproducerproperties delivery_mode_non_persistent
log info     dest tostring
jmsproducer setdeliverymode deliverymode non_persistent
else
log warn
jmsproducer setdeliverymode deliverymode non_persistent
return jmsproducer
public messageproducer getjmsproducer
return jmsproducer
public textmessage createjmstextmessage   throws jmsexception
return createjmstextmessage client getmessagesize
public textmessage createjmstextmessage int size  throws jmsexception
jmstextmessage   getsession   createtextmessage buildtext    size
return jmstextmessage
public textmessage createjmstextmessage string text  throws jmsexception
jmstextmessage   getsession   createtextmessage buildtext text  client getmessagesize
return jmstextmessage
public textmessage getjmstextmessage
return jmstextmessage
public jmsclientproperties getclient
return client
public void setclient jmsclientproperties clientprops
client    jmsproducerproperties clientprops
protected string buildtext string text  int size
byte data   new byte
arrays fill data   byte  0
return text   new string data