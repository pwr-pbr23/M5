/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq kaha impl async
import java io ioexception
import org apache activemq kaha marshaller
import org apache activemq kaha storelocation
import org apache activemq kaha impl data redolistener
import org apache activemq util bytesequence
import org apache activemq util databytearrayinputstream
import org apache activemq util databytearrayoutputstream
/**
* provides a kaha datamanager facade to the datamanager.
*
* @version $revision: 1.1.1.1 $
*/
public final class datamanagerfacade implements org apache activemq kaha impl datamanager
private static final bytesequence force_command   new bytesequence new byte
private asyncdatamanager datamanager
private final string name
private marshaller redomarshaller
private static class storelocationfacade implements storelocation
private final location location
public storelocationfacade location location
this location   location
public int getfile
return location getdatafileid
public long getoffset
return location getoffset
public int getsize
return location getsize
public location getlocation
return location
public datamanagerfacade asyncdatamanager datamanager  string name
this datamanager   datamanager
this name   name
private static storelocation converttostorelocation location location
if  location    null
return null
return new storelocationfacade location
private static location convertfromstorelocation storelocation location
if  location    null
return null
if  location getclass      storelocationfacade class
return   storelocationfacade location  getlocation
location l   new location
l setoffset  int location getoffset
l setsize location getsize
l setdatafileid location getfile
return l
public object readitem marshaller marshaller  storelocation location  throws ioexception
bytesequence sequence   datamanager read convertfromstorelocation location
databytearrayinputstream datain   new databytearrayinputstream sequence
return marshaller readpayload datain
public storelocation storedataitem marshaller marshaller  object payload  throws ioexception
final databytearrayoutputstream buffer   new databytearrayoutputstream
marshaller writepayload payload  buffer
bytesequence data   buffer tobytesequence
return converttostorelocation datamanager write data   byte 1  false
public void force   throws ioexception
datamanager write force_command   byte 2  true
public void updateitem storelocation location  marshaller marshaller  object payload  throws ioexception
final databytearrayoutputstream buffer   new databytearrayoutputstream
marshaller writepayload payload  buffer
bytesequence data   buffer tobytesequence
datamanager update convertfromstorelocation location   data  false
public void close   throws ioexception
datamanager close
public void consolidatedatafiles   throws ioexception
datamanager consolidatedatafiles
public boolean delete   throws ioexception
return datamanager delete
public void addinterestinfile int file  throws ioexception
datamanager addinterestinfile file
public void removeinterestinfile int file  throws ioexception
datamanager removeinterestinfile file
public void recoverredoitems redolistener listener  throws ioexception
throw new runtimeexception
public storelocation storeredoitem object payload  throws ioexception
throw new runtimeexception
public marshaller getredomarshaller
return redomarshaller
public void setredomarshaller marshaller redomarshaller
this redomarshaller   redomarshaller
public string getname
return name