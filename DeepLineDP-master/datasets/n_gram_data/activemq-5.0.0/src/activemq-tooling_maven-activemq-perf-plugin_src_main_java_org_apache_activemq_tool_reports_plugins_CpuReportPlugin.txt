/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq tool reports plugins
import java util arraylist
import java util hashmap
import java util list
import java util map
import java util stringtokenizer
import org apache activemq tool reports performancestatisticsutil
import org apache commons logging log
import org apache commons logging logfactory
public class cpureportplugin implements reportplugin
public static final string name_ignore_list
public static final string name_block_recv
public static final string name_block_sent
public static final string name_ctx_switch
public static final string name_user_time
public static final string name_sys_time
public static final string name_idle_time
public static final string name_wait_time
public static final string key_block_recv
public static final string key_block_sent
public static final string key_ctx_switch
public static final string key_user_time
public static final string key_sys_time
public static final string key_idle_time
public static final string key_wait_time
public static final string key_ave_block_recv
public static final string key_ave_block_sent
public static final string key_ave_ctx_switch
public static final string key_ave_user_time
public static final string key_ave_sys_time
public static final string key_ave_idle_time
public static final string key_ave_wait_time
private static final log log   logfactory getlog cpureportplugin class
protected list<long> blockrecv   new arraylist<long>
protected list<long> blocksent   new arraylist<long>
protected list<long> ctxswitch   new arraylist<long>
protected list<long> usertime    new arraylist<long>
protected list<long> systime     new arraylist<long>
protected list<long> idletime    new arraylist<long>
protected list<long> waittime    new arraylist<long>
public void handlecsvdata string csvdata
stringtokenizer tokenizer   new stringtokenizer csvdata
string data
string key
string val
while  tokenizer hasmoretokens
data   tokenizer nexttoken
key    data substring 0  data indexof
val    data substring data indexof      1
addtocpulist key  val
public map<string  string> getsummary
long val
map<string  string> summary   new hashmap<string  string>
if  blockrecv size   > 0
val   performancestatisticsutil getsum blockrecv
summary put key_block_recv  string valueof val
summary put key_ave_block_recv  string valueof  double val    double blockrecv size
if  blocksent size   > 0
val   performancestatisticsutil getsum blocksent
summary put key_block_sent  string valueof val
summary put key_ave_block_sent  string valueof  double val    double blocksent size
if  ctxswitch size   > 0
val   performancestatisticsutil getsum ctxswitch
summary put key_ctx_switch  string valueof val
summary put key_ave_ctx_switch  string valueof  double val    double ctxswitch size
if  usertime size   > 0
val   performancestatisticsutil getsum usertime
summary put key_user_time  string valueof val
summary put key_ave_user_time  string valueof  double val    double usertime size
if  systime size   > 0
val   performancestatisticsutil getsum systime
summary put key_sys_time  string valueof val
summary put key_ave_sys_time  string valueof  double val    double systime size
if  idletime size   > 0
val   performancestatisticsutil getsum idletime
summary put key_idle_time  string valueof val
summary put key_ave_idle_time  string valueof  double val    double idletime size
if  waittime size   > 0
val   performancestatisticsutil getsum waittime
summary put key_wait_time  string valueof val
summary put key_ave_wait_time  string valueof  double val    double waittime size
if  summary size   > 0
return summary
else
return null
protected void addtocpulist string key  string val
if  key equals name_block_recv
blockrecv add long valueof val
else if  key equals name_block_sent
blocksent add long valueof val
else if  key equals name_ctx_switch
ctxswitch add long valueof val
else if  key equals name_user_time
usertime add long valueof val
else if  key equals name_sys_time
systime add long valueof val
else if  key equals name_idle_time
idletime add long valueof val
else if  key equals name_wait_time
waittime add long valueof val
else if  name_ignore_list indexof     key          1
// ignore key
else
log warn     key       val