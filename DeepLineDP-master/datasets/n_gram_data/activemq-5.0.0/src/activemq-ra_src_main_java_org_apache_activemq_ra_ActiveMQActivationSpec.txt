/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq ra
import java beans introspectionexception
import java beans propertydescriptor
import java io serializable
import java util arraylist
import java util iterator
import java util list
import javax jms queue
import javax jms session
import javax jms topic
import javax resource resourceexception
import javax resource spi invalidpropertyexception
import javax resource spi resourceadapter
import org apache activemq redeliverypolicy
import org apache activemq command activemqdestination
import org apache activemq command activemqqueue
import org apache activemq command activemqtopic
import org apache activemq selector selectorparser
/**
* configures the inbound jms consumer specification using activemq
*
* @org.apache.xbean.xbean element="activationspec"
* @version $revision$ $date: 2007-08-11 17:29:21 -0400 (sat, 11 aug
*          2007) $
*/
public class activemqactivationspec implements messageactivationspec  serializable
/** auto-acknowledge constant for <code>acknowledgemode</code> property * */
public static final string auto_acknowledge_mode
/** dups-ok-acknowledge constant for <code>acknowledgemode</code> property * */
public static final string dups_ok_acknowledge_mode
/** durable constant for <code>subscriptiondurability</code> property * */
public static final string durable_subscription
/** nondurable constant for <code>subscriptiondurability</code> property * */
public static final string non_durable_subscription
public static final int invalid_acknowledge_mode    1
private static final long serialversionuid    7153087544100459975l
private transient messageresourceadapter resourceadapter
private string destinationtype
private string messageselector
private string destination
private string acknowledgemode   auto_acknowledge_mode
private string username
private string password
private string clientid
private string subscriptionname
private string subscriptiondurability   non_durable_subscription
private string nolocal
private string useramanagedtransaction
private string maxsessions
private string maxmessagespersessions
private string enablebatch
private string maxmessagesperbatch
private redeliverypolicy redeliverypolicy
/**
* @see javax.resource.spi.activationspec#validate()
*/
public void validate   throws invalidpropertyexception
list<string> errormessages   new arraylist<string>
list<propertydescriptor> propsnotset   new arraylist<propertydescriptor>
try
if   isvaliddestination errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvaliddestinationtype errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidacknowledgemode errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidsubscriptiondurability errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidclientid errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidsubscriptionname errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidmaxmessagespersessions errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidmaxsessions errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidmessageselector errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidnolocal errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvaliduseramanagedtransaction errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidenablebatch errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
if   isvalidmaxmessagesperbatch errormessages
propsnotset add new propertydescriptor    activemqactivationspec class
catch  introspectionexception e
e printstacktrace
if  propsnotset size   > 0
stringbuffer b   new stringbuffer
b append
for  iterator<string> iter   errormessages iterator    iter hasnext
b append
b append iter next
invalidpropertyexception e   new invalidpropertyexception b tostring
final propertydescriptor descriptors   propsnotset toarray new propertydescriptor
e setinvalidpropertydescriptors descriptors
throw e
public boolean isvaliduseramanagedtransaction list<string> errormessages
try
new boolean nolocal
return true
catch  throwable e
//
errormessages add
return false
public boolean isvalidnolocal list<string> errormessages
try
new boolean nolocal
return true
catch  throwable e
//
errormessages add
return false
public boolean isvalidmessageselector list<string> errormessages
try
if   isempty messageselector
new selectorparser   parse messageselector
return true
catch  throwable e
errormessages add     e getmessage
return false
public boolean isvalidmaxsessions list<string> errormessages
try
if  integer parseint maxsessions  > 0
return true
catch  numberformatexception e
//
errormessages add
return false
public boolean isvalidmaxmessagespersessions list<string> errormessages
try
if  integer parseint maxmessagespersessions  > 0
return true
catch  numberformatexception e
//
errormessages add
return false
public boolean isvalidmaxmessagesperbatch list<string> errormessages
try
if  integer parseint maxmessagesperbatch  > 0
return true
catch  numberformatexception e
//
errormessages add
return false
public boolean isvalidenablebatch list<string> errormessages
try
new boolean enablebatch
return true
catch  throwable e
//
errormessages add
return false
public resourceadapter getresourceadapter
return resourceadapter
/**
* @see javax.resource.spi.resourceadapterassociation#setresourceadapter(javax.resource.spi.resourceadapter)
*/
public void setresourceadapter resourceadapter resourceadapter  throws resourceexception
// spec section 5.3.3
if  this resourceadapter    null
throw new resourceexception
if    resourceadapter instanceof messageresourceadapter
throw new resourceexception     messageresourceadapter class getname
this resourceadapter    messageresourceadapter resourceadapter
// ///////////////////////////////////////////////////////////////////////
//
// java bean getters and setters for this activationspec class.
//
// ///////////////////////////////////////////////////////////////////////
public string getdestinationtype
if   isempty destinationtype
return destinationtype
return null
/**
* @param destinationtype the destinationtype to set.
*/
public void setdestinationtype string destinationtype
this destinationtype   destinationtype
public string getpassword
if   isempty password
return password
return null
/**
*
*/
public void setpassword string password
this password   password
public string getusername
if   isempty username
return username
return null
/**
*
*/
public void setusername string username
this username   username
public string getmessageselector
if   isempty messageselector
return messageselector
return null
/**
* @param messageselector the messageselector to set.
*/
public void setmessageselector string messageselector
this messageselector   messageselector
public string getnolocal
return nolocal
/**
* @param nolocal the nolocal to set.
*/
public void setnolocal string nolocal
if  nolocal    null
this nolocal   nolocal
public string getacknowledgemode
if   isempty acknowledgemode
return acknowledgemode
return null
/**
*
*/
public void setacknowledgemode string acknowledgemode
this acknowledgemode   acknowledgemode
public string getclientid
if   isempty clientid
return clientid
return null
/**
*
*/
public void setclientid string clientid
this clientid   clientid
public string getdestination
if   isempty destination
return destination
return null
/**
*
*/
public void setdestination string destination
this destination   destination
public string getsubscriptiondurability
if   isempty subscriptiondurability
return subscriptiondurability
return null
/**
*
*/
public void setsubscriptiondurability string subscriptiondurability
this subscriptiondurability   subscriptiondurability
public string getsubscriptionname
if   isempty subscriptionname
return subscriptionname
return null
/**
*
*/
public void setsubscriptionname string subscriptionname
this subscriptionname   subscriptionname
public boolean isvalidsubscriptionname list<string> errormessages
if   isdurablesubscription   ? true   subscriptionname    null    subscriptionname trim   length   > 0
return true
errormessages add
return false
public boolean isvalidclientid list<string> errormessages
if   isdurablesubscription   ? true   clientid    null    clientid trim   length   > 0
return true
errormessages add
return false
public boolean isdurablesubscription
return durable_subscription equals subscriptiondurability
public boolean isvalidsubscriptiondurability list<string> errormessages
// subscriptiondurability only applies to topics
if  durable_subscription equals subscriptiondurability     getdestinationtype      null     topic class getname   equals getdestinationtype
errormessages add     durable_subscription       queue class getname
topic class getname
return false
if  non_durable_subscription equals subscriptiondurability     durable_subscription equals subscriptiondurability
return true
errormessages add     non_durable_subscription       durable_subscription
return false
public boolean isvalidacknowledgemode list<string> errormessages
if  auto_acknowledge_mode equals acknowledgemode     dups_ok_acknowledge_mode equals acknowledgemode
return true
errormessages add     auto_acknowledge_mode       dups_ok_acknowledge_mode
return false
public boolean isvaliddestinationtype list<string> errormessages
if  queue class getname   equals destinationtype     topic class getname   equals destinationtype
return true
errormessages add     queue class getname         topic class getname
return false
public boolean isvaliddestination list<string> errormessages
if    destination    null    destination equals
return true
errormessages add
return false
public boolean isempty string value
return value    null      equals value trim
/**
*
*/
@override
public string tostring
return         acknowledgemode           destinationtype           messageselector
destination           clientid           subscriptionname           subscriptiondurability
public int getacknowledgemodeforsession
if  auto_acknowledge_mode equals acknowledgemode
return session auto_acknowledge
else if  dups_ok_acknowledge_mode equals acknowledgemode
return session dups_ok_acknowledge
else
return invalid_acknowledge_mode
/**
* a helper method mostly for use in dependency injection containers which
* allows you to customize the destination and destinationtype properties
* from a single activemqdestination pojo
*/
public void setactivemqdestination activemqdestination destination
setdestination destination getphysicalname
if  destination instanceof queue
setdestinationtype queue class getname
else
setdestinationtype topic class getname
/**
*
*/
public activemqdestination createdestination
if  isempty destinationtype     isempty destination
return null
activemqdestination dest   null
if  queue class getname   equals destinationtype
dest   new activemqqueue destination
else if  topic class getname   equals destinationtype
dest   new activemqtopic destination
else
assert false
return dest
public string getmaxmessagespersessions
return maxmessagespersessions
/**
*
*/
public void setmaxmessagespersessions string maxmessagespersessions
if  maxmessagespersessions    null
this maxmessagespersessions   maxmessagespersessions
public string getmaxsessions
return maxsessions
/**
*
*/
public void setmaxsessions string maxsessions
if  maxsessions    null
this maxsessions   maxsessions
public string getuseramanagedtransaction
return useramanagedtransaction
/**
*
*/
public void setuseramanagedtransaction string useramanagedtransaction
if  useramanagedtransaction    null
this useramanagedtransaction   useramanagedtransaction
public int getmaxmessagespersessionsintvalue
return integer parseint maxmessagespersessions
public int getmaxsessionsintvalue
return integer parseint maxsessions
public boolean isuseramanagedtransactionenabled
return boolean valueof useramanagedtransaction  booleanvalue
public boolean getnolocalbooleanvalue
return boolean valueof nolocal  booleanvalue
public string getenablebatch
return enablebatch
/**
*
*/
public void setenablebatch string enablebatch
if  enablebatch    null
this enablebatch   enablebatch
public boolean getenablebatchbooleanvalue
return boolean valueof enablebatch  booleanvalue
public int getmaxmessagesperbatchintvalue
return integer parseint maxmessagesperbatch
public string getmaxmessagesperbatch
return maxmessagesperbatch
/**
*
*/
public void setmaxmessagesperbatch string maxmessagesperbatch
if  maxmessagesperbatch    null
this maxmessagesperbatch   maxmessagesperbatch
public short getbackoffmultiplier
if  redeliverypolicy    null
return 0
return redeliverypolicy getbackoffmultiplier
public long getinitialredeliverydelay
if  redeliverypolicy    null
return 0
return redeliverypolicy getinitialredeliverydelay
public int getmaximumredeliveries
if  redeliverypolicy    null
return 0
return redeliverypolicy getmaximumredeliveries
public boolean isuseexponentialbackoff
if  redeliverypolicy    null
return false
return redeliverypolicy isuseexponentialbackoff
/**
*
*/
public void setbackoffmultiplier short backoffmultiplier
lazycreateredeliverypolicy   setbackoffmultiplier backoffmultiplier
/**
*
*/
public void setinitialredeliverydelay long initialredeliverydelay
lazycreateredeliverypolicy   setinitialredeliverydelay initialredeliverydelay
/**
*
*/
public void setmaximumredeliveries int maximumredeliveries
lazycreateredeliverypolicy   setmaximumredeliveries maximumredeliveries
/**
*
*/
public void setuseexponentialbackoff boolean useexponentialbackoff
lazycreateredeliverypolicy   setuseexponentialbackoff useexponentialbackoff
// don't use getter to avoid causing introspection errors in containers
public redeliverypolicy redeliverypolicy
return redeliverypolicy
public redeliverypolicy lazycreateredeliverypolicy
if  redeliverypolicy    null
redeliverypolicy   new redeliverypolicy
return redeliverypolicy