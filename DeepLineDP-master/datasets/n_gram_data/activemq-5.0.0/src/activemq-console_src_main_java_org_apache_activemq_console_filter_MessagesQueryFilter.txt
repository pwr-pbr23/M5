/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq console filter
import java io ioexception
import java net malformedurlexception
import java util arrays
import java util iterator
import java util list
import javax management mbeanserverconnection
import javax management objectname
import javax management openmbean compositedata
import javax management remote jmxconnector
import javax management remote jmxconnectorfactory
import javax management remote jmxserviceurl
public class messagesqueryfilter extends abstractqueryfilter
private jmxserviceurl jmxserviceurl
private objectname destname
/**
* create a jms message query filter
*
* @param jmxserviceurl - jmx service url to connect to
* @param destname - object name query to retrieve the destination
*/
public messagesqueryfilter jmxserviceurl jmxserviceurl  objectname destname
super null
this jmxserviceurl   jmxserviceurl
this destname   destname
/**
* queries the specified destination using the message selector format query
*
* @param queries - message selector queries
* @return list messages that matches the selector
* @throws exception
*/
public list query list queries  throws exception
string selector
// convert to message selector
for  iterator i   queries iterator    i hasnext
selector   selector       i next   tostring
// remove last and
if   selector equals
selector   selector substring 0  selector length     5
return querymessages selector
/**
* query the messages of a queue destination using jmx
*
* @param selector - message selector
* @return list of messages that matches the selector
* @throws exception
*/
protected list querymessages string selector  throws exception
jmxconnector connector   createjmxconnector
mbeanserverconnection server   connector getmbeanserverconnection
compositedata messages    compositedata server invoke destname     new object     new string
connector close
return arrays aslist messages
/**
* get the jmx service url the query is connecting to.
*
* @return jmx service url
*/
public jmxserviceurl getjmxserviceurl
return jmxserviceurl
/**
* sets the jmx service url the query is going to connect to.
*
* @param jmxserviceurl - new jmx service url
*/
public void setjmxserviceurl jmxserviceurl jmxserviceurl
this jmxserviceurl   jmxserviceurl
/**
* sets the jmx service url the query is going to connect to.
*
* @param jmxserviceurl - new jmx service url
*/
public void setjmxserviceurl string jmxserviceurl  throws malformedurlexception
setjmxserviceurl new jmxserviceurl jmxserviceurl
/**
* creates a jmx connector
*
* @return jmx connector
* @throws java.io.ioexception
*/
protected jmxconnector createjmxconnector   throws ioexception
return jmxconnectorfactory connect getjmxserviceurl