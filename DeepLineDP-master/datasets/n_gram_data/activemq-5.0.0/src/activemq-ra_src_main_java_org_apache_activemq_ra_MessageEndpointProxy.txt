/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq ra
import java lang reflect method
import javax jms message
import javax jms messagelistener
import javax resource resourceexception
import javax resource spi endpoint messageendpoint
/**
* @author <a href="mailto:michael.gaffney@panacya.com">michael gaffney </a>
*/
public class messageendpointproxy implements messagelistener  messageendpoint
private static final messageendpointstate alive   new messageendpointalive
private static final messageendpointstate dead   new messageendpointdead
private static int proxycount
private final int proxyid
private final messageendpoint endpoint
private final messagelistener messagelistener
private messageendpointstate state   alive
public messageendpointproxy messageendpoint endpoint
if    endpoint instanceof messagelistener
throw new illegalargumentexception
messagelistener    messagelistener endpoint
proxyid   getid
this endpoint   endpoint
private static int getid
return   proxycount
public void beforedelivery method method  throws nosuchmethodexception  resourceexception
state beforedelivery this  method
public void onmessage message message
state onmessage this  message
public void afterdelivery   throws resourceexception
state afterdelivery this
public void release
state release this
public string tostring
return         proxyid       endpoint
private abstract static class messageendpointstate
public void beforedelivery messageendpointproxy proxy  method method  throws nosuchmethodexception  resourceexception
throw new illegalstateexception
public void onmessage messageendpointproxy proxy  message message
throw new illegalstateexception
public void afterdelivery messageendpointproxy proxy  throws resourceexception
throw new illegalstateexception
public void release messageendpointproxy proxy
throw new illegalstateexception
protected final void transition messageendpointproxy proxy  messageendpointstate nextstate
proxy state   nextstate
nextstate enter proxy
protected void enter messageendpointproxy proxy
private static class messageendpointalive extends messageendpointstate
public void beforedelivery messageendpointproxy proxy  method method  throws nosuchmethodexception  resourceexception
try
proxy endpoint beforedelivery method
catch  nosuchmethodexception e
transition proxy  dead
throw e
catch  resourceexception e
transition proxy  dead
throw e
public void onmessage messageendpointproxy proxy  message message
proxy messagelistener onmessage message
public void afterdelivery messageendpointproxy proxy  throws resourceexception
try
proxy endpoint afterdelivery
catch  resourceexception e
transition proxy  dead
throw e
public void release messageendpointproxy proxy
transition proxy  dead
private static class messageendpointdead extends messageendpointstate
protected void enter messageendpointproxy proxy
proxy endpoint release
public void beforedelivery messageendpointproxy proxy  method method  throws nosuchmethodexception  resourceexception
throw new invalidmessageendpointexception
public void onmessage messageendpointproxy proxy  message message
throw new invalidmessageendpointexception
public void afterdelivery messageendpointproxy proxy  throws resourceexception
throw new invalidmessageendpointexception
public void release messageendpointproxy proxy
throw new invalidmessageendpointexception