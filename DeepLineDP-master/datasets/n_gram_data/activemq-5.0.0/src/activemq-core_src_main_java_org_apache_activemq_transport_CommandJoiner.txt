/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq transport
import java io bytearrayoutputstream
import java io datainputstream
import java io ioexception
import org apache activemq command command
import org apache activemq command lastpartialcommand
import org apache activemq command partialcommand
import org apache activemq openwire openwireformat
import org apache activemq util bytearrayinputstream
import org apache commons logging log
import org apache commons logging logfactory
/**
* joins together of partial commands which were split into individual chunks of
* data.
*
* @version $revision$
*/
public class commandjoiner extends transportfilter
private static final log log   logfactory getlog commandjoiner class
private bytearrayoutputstream out   new bytearrayoutputstream
private openwireformat wireformat
public commandjoiner transport next  openwireformat wireformat
super next
this wireformat   wireformat
public void oncommand object o
command command    command o
byte type   command getdatastructuretype
if  type    partialcommand data_structure_type    type    lastpartialcommand data_structure_type
partialcommand header    partialcommand command
byte partialdata   header getdata
try
out write partialdata
catch  ioexception e
gettransportlistener   onexception e
if  type    lastpartialcommand data_structure_type
try
byte fulldata   out tobytearray
out reset
datainputstream datain   new datainputstream new bytearrayinputstream fulldata
command completecommand    command wireformat unmarshal datain
lastpartialcommand lastcommand    lastpartialcommand command
lastcommand configure completecommand
gettransportlistener   oncommand completecommand
catch  ioexception e
log warn     command
gettransportlistener   onexception e
else
gettransportlistener   oncommand command
public void stop   throws exception
super stop
out   null
public string tostring
return next tostring