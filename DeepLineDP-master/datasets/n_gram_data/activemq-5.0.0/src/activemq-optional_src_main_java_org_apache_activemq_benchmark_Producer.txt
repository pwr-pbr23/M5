/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq benchmark
import java io bufferedreader
import java io file
import java io filereader
import java io ioexception
import javax jms deliverymode
import javax jms destination
import javax jms jmsexception
import javax jms message
import javax jms messageproducer
import javax jms session
/**
* @author james strachan
* @version $revision$
*/
public class producer extends benchmarksupport
int loops    1
int loopsize   1000
private int messagesize   1000
public producer
public static void main string args
producer tool   new producer
if  args length > 0
tool seturl args
if  args length > 1
tool settopic parseboolean args
if  args length > 2
tool setsubject args
if  args length > 3
tool setdurable parseboolean args
if  args length > 4
tool setmessagesize integer parseint args
if  args length > 5
tool setconnectioncount integer parseint args
try
tool run
catch  exception e
system out println     e
e printstacktrace
public void run   throws exception
start
publish
// properties
// -------------------------------------------------------------------------
public int getmessagesize
return messagesize
public void setmessagesize int messagesize
this messagesize   messagesize
public int getloopsize
return loopsize
public void setloopsize int loopsize
this loopsize   loopsize
// implementation methods
// -------------------------------------------------------------------------
protected void publish   throws exception
final string text   getmessage
system out println     subjects length
for  int i   0  i < subjects length  i
final string subject   subjects
thread thread   new thread
public void run
try
publish text  subject
catch  jmsexception e
system out println     e
e printstacktrace
thread start
protected string getmessage
stringbuffer buffer   new stringbuffer
for  int i   0  i < messagesize  i
char ch
buffer append ch
return buffer tostring
protected void publish string text  string subject  throws jmsexception
session session   createsession
destination destination   createdestination session  subject
messageproducer publisher   session createproducer destination
if  isdurable
publisher setdeliverymode deliverymode persistent
else
publisher setdeliverymode deliverymode non_persistent
system out println     destination       destination getclass   getname
system out println     text length
if  loops <  0
while  true
publishloop session  publisher  text
else
for  int i   0  i < loops  i
publishloop session  publisher  text
protected void publishloop session session  messageproducer publisher  string text  throws jmsexception
for  int i   0  i < loopsize  i
message message   session createtextmessage text
publisher send message
count 1
protected string loadfile string file  throws ioexception
system out println     file
stringbuffer buffer   new stringbuffer
bufferedreader in   new bufferedreader new filereader file
while  true
string line   in readline
if  line    null
break
buffer append line
buffer append file separator
in close
return buffer tostring