/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq filter
import java io ioexception
import java lang reflect constructor
import java lang reflect invocationtargetexception
import javax jms jmsexception
import org apache activemq command message
import org apache activemq util jmsexceptionsupport
import org apache commons logging log
import org apache commons logging logfactory
/**
* used to evaluate an xpath expression in a jms selector.
*/
public final class xpathexpression implements booleanexpression
private static final log log   logfactory getlog xpathexpression class
private static final string evaluator_system_property
private static final string default_evaluator_class_name   xalanxpathevaluator class getname
private static final constructor evaluator_constructor
static
string cn   system getproperty evaluator_system_property  default_evaluator_class_name
constructor m   null
try
try
m   getxpathevaluatorconstructor cn
catch  throwable e
log warn     xpathevaluator class getname         cn       e  e
cn   default_evaluator_class_name
try
m   getxpathevaluatorconstructor cn
catch  throwable e2
log error    e
finally
evaluator_constructor   m
private final string xpath
private final xpathevaluator evaluator
public static interface xpathevaluator
boolean evaluate message message  throws jmsexception
xpathexpression string xpath
this xpath   xpath
this evaluator   createevaluator xpath
private static constructor getxpathevaluatorconstructor string cn  throws classnotfoundexception  securityexception  nosuchmethodexception
class c   xpathexpression class getclassloader   loadclass cn
if   xpathevaluator class isassignablefrom c
throw new classcastexception     c       xpathevaluator class
return c getconstructor new class  string class
private xpathevaluator createevaluator string xpath2
try
return  xpathevaluator evaluator_constructor newinstance new object  xpath
catch  invocationtargetexception e
throwable cause   e getcause
if  cause instanceof runtimeexception
throw  runtimeexception cause
throw new runtimeexception     xpath       e getmessage    e
catch  throwable e
throw new runtimeexception     xpath       e getmessage    e
public object evaluate messageevaluationcontext message  throws jmsexception
try
if  message isdropped
return null
return evaluator evaluate message getmessage    ? boolean true   boolean false
catch  ioexception e
throw jmsexceptionsupport create e
public string tostring
return     constantexpression encodestring xpath
/**
* @param message
* @return true if the expression evaluates to boolean.true.
* @throws jmsexception
*/
public boolean matches messageevaluationcontext message  throws jmsexception
object object   evaluate message
return object    null    object    boolean true