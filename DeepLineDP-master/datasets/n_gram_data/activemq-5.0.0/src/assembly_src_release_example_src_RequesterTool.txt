/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java util arrays
import java util date
import javax jms connection
import javax jms deliverymode
import javax jms destination
import javax jms message
import javax jms messageconsumer
import javax jms messageproducer
import javax jms session
import javax jms textmessage
import org apache activemq activemqconnection
import org apache activemq activemqconnectionfactory
import org apache activemq util indentprinter
/**
* a simple tool for publishing messages
*
* @version $revision: 1.2 $
*/
public class requestertool
private int messagecount   10
private long sleeptime
private boolean verbose   true
private int messagesize   255
private long timetolive
private string subject
private string replysubject
private boolean topic
private string user   activemqconnection default_user
private string password   activemqconnection default_password
private string url   activemqconnection default_broker_url
private boolean transacted
private boolean persistent
private string clientid
private destination destination
private destination replydest
private messageproducer producer
private messageconsumer consumer
private session session
public static void main string args
requestertool requestertool   new requestertool
string unknown   commandlinesupport setoptions requestertool  args
if  unknown length > 0
system out println     arrays tostring unknown
system exit  1
requestertool run
public void run
connection connection   null
try
system out println     url
system out println     messagesize        topic ?              subject
system out println      persistent ?
system out println     sleeptime
// create the connection
activemqconnectionfactory connectionfactory   new activemqconnectionfactory user  password  url
connection   connectionfactory createconnection
if  persistent    clientid    null    clientid length   > 0       equals clientid
connection setclientid clientid
connection start
// create the session
session   connection createsession transacted  session auto_acknowledge
// and the destinations..
if  topic
destination   session createtopic subject
if  replysubject    null    replysubject equals
replydest   session createtemporarytopic
else
replydest   session createtopic replysubject
else
destination   session createqueue subject
if  replysubject    null    replysubject equals
replydest   session createtemporaryqueue
else
replydest   session createqueue replysubject
system out println     replydest
// create the producer
producer   session createproducer destination
if  persistent
producer setdeliverymode deliverymode persistent
else
producer setdeliverymode deliverymode non_persistent
if  timetolive    0
system out println     timetolive
producer settimetolive timetolive
// create the reply consumer
consumer   session createconsumer replydest
// start sending reqests.
requestloop
system out println
// use the activemqconnection interface to dump the connection
// stats.
activemqconnection c    activemqconnection connection
c getconnectionstats   dump new indentprinter
catch  exception e
system out println     e
e printstacktrace
finally
try
connection close
catch  throwable ignore
protected void requestloop   throws exception
for  int i   0  i < messagecount    messagecount    0  i
textmessage message   session createtextmessage createmessagetext i
message setjmsreplyto replydest
if  verbose
string msg   message gettext
if  msg length   > 50
msg   msg substring 0  50
system out println     msg
producer send message
if  transacted
session commit
system out println
message message2   consumer receive
if  message2 instanceof textmessage
system out println       textmessage message2  gettext
else
system out println     message2
if  transacted
session commit
thread sleep sleeptime
/**
* @param i
* @return
*/
private string createmessagetext int index
stringbuffer buffer   new stringbuffer messagesize
buffer append     index       new date
if  buffer length   > messagesize
return buffer substring 0  messagesize
for  int i   buffer length    i < messagesize  i
buffer append
return buffer tostring
public void setclientid string clientid
this clientid   clientid
public void setpersistent boolean durable
this persistent   durable
public void setmessagecount int messagecount
this messagecount   messagecount
public void setmessagesize int messagesize
this messagesize   messagesize
public void setpassword string password
this password   password
public void setsleeptime long sleeptime
this sleeptime   sleeptime
public void setsubject string subject
this subject   subject
public void settimetolive long timetolive
this timetolive   timetolive
public void settopic boolean topic
this topic   topic
public void setqueue boolean queue
this topic    queue
public void settransacted boolean transacted
this transacted   transacted
public void seturl string url
this url   url
public void setuser string user
this user   user
public void setverbose boolean verbose
this verbose   verbose
public void setreplysubject string replysubject
this replysubject   replysubject