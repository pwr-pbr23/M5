/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache activemq console filter
import java io ioexception
import java util arraylist
import java util collection
import java util iterator
import java util list
import java util set
import javax management attribute
import javax management attributelist
import javax management instancenotfoundexception
import javax management introspectionexception
import javax management mbeanattributeinfo
import javax management mbeanserverconnection
import javax management objectinstance
import javax management objectname
import javax management reflectionexception
import javax management remote jmxconnector
import javax management remote jmxconnectorfactory
import javax management remote jmxserviceurl
public class mbeansattributequeryfilter extends abstractqueryfilter
public static final string key_object_name_attribute
private jmxserviceurl jmxserviceurl
private set attribview
/**
* create an mbean attributes query filter that is able to select specific
* mbean attributes based on the object name to get.
*
* @param jmxserviceurl - jmx service url to connect to.
* @param attribview - the attributes to extract
* @param next - the next query filter
*/
public mbeansattributequeryfilter jmxserviceurl jmxserviceurl  set attribview  mbeansobjectnamequeryfilter next
super next
this jmxserviceurl   jmxserviceurl
this attribview   attribview
/**
* filter the query by retrieving the attributes specified, this will modify
* the collection to a list of attributelist
*
* @param queries - query list
* @return list of attributelist, which includes the objectname, which has a
*         key of mbeansattributequeryfilter.key_object_name_attribute
* @throws exception
*/
public list query list queries  throws exception
return getmbeanattributescollection next query queries
/**
* retrieve the specified attributes of the mbean
*
* @param result - collection of objectinstances and/or objectnames
* @return list of attributelist
* @throws ioexception
* @throws reflectionexception
* @throws instancenotfoundexception
* @throws nosuchmethodexception
*/
protected list getmbeanattributescollection collection result  throws ioexception  reflectionexception  instancenotfoundexception  nosuchmethodexception  introspectionexception
list mbeanscollection   new arraylist
for  iterator i   result iterator    i hasnext
object mbean   i next
if  mbean instanceof objectinstance
mbeanscollection add getmbeanattributes   objectinstance mbean  getobjectname    attribview
else if  mbean instanceof objectname
mbeanscollection add getmbeanattributes  objectname mbean  attribview
else
throw new nosuchmethodexception     mbean getclass   getname
return mbeanscollection
/**
* retrieve the specified attributes of the mbean
*
* @param obj - mbean objectinstance
* @param attrview - list of attributes to retrieve
* @return attributelist for the mbean
* @throws reflectionexception
* @throws instancenotfoundexception
* @throws ioexception
*/
protected attributelist getmbeanattributes objectinstance obj  set attrview  throws reflectionexception  instancenotfoundexception  ioexception  introspectionexception
return getmbeanattributes obj getobjectname    attrview
/**
* retrieve the specified attributes of the mbean
*
* @param objname - mbean objectname
* @param attrview - list of attributes to retrieve
* @return attributelist for the mbean
* @throws ioexception
* @throws reflectionexception
* @throws instancenotfoundexception
*/
protected attributelist getmbeanattributes objectname objname  set attrview  throws ioexception  reflectionexception  instancenotfoundexception  introspectionexception
jmxconnector jmxconnector   jmxconnectorfactory connect jmxserviceurl
mbeanserverconnection server   jmxconnector getmbeanserverconnection
// if no attribute view specified, get all attributes
string attribs
if  attrview    null    attrview isempty
mbeanattributeinfo infos   server getmbeaninfo objname  getattributes
attribs   new string
for  int i   0  i < infos length  i
if  infos isreadable
attribs   infos getname
// get selected attributes
else
attribs   new string
int count   0
for  iterator i   attrview iterator    i hasnext
attribs    string i next
attributelist attriblist   server getattributes objname  attribs
jmxconnector close
attriblist add 0  new attribute key_object_name_attribute  objname
return attriblist