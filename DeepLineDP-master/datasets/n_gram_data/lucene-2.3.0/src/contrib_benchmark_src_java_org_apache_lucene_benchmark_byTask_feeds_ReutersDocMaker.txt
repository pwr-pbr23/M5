package org apache lucene benchmark bytask feeds
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import org apache lucene benchmark bytask utils config
import java io bufferedreader
import java io file
import java io filereader
import java text dateformat
import java text simpledateformat
import java util arraylist
import java util date
import java util locale
/**
* a docmaker using the reuters collection for its input.
* <p>
* config properties:<ul>
* <li>work.dir=&lt;path to the root of docs and indexes dirs| default: work&gt;</li>
* <li>docs.dir=&lt;path to the docs dir| default: reuters-out&gt;</li>
* </ul>
*/
public class reutersdocmaker extends basicdocmaker
private threadlocal dateformat   new threadlocal
private file datadir   null
private arraylist inputfiles   new arraylist
private int nextfile   0
private int iteration 0
/* (non-javadoc)
* @see simpledocmaker#setconfig(java.util.properties)
*/
public void setconfig config config
super setconfig config
file workdir   new file config get
string d   config get
datadir   new file d
if   datadir isabsolute
datadir   new file workdir  d
collectfiles datadir inputfiles
if  inputfiles size    0
throw new runtimeexception   datadir getabsolutepath
// get/initiate a thread-local simple date format (must do so
// because simpledateformat is not thread-safe.
protected synchronized dateformat getdateformat
dateformat df    dateformat  dateformat get
if  df    null
// date format: 30-mar-1987 14:22:36.87
df   new simpledateformat   locale us
df setlenient true
dateformat set df
return df
protected docdata getnextdocdata   throws exception
file f   null
string name   null
synchronized  this
if  nextfile >  inputfiles size
// exhausted files, start a new round, unless forever set to false.
if   forever
throw new nomoredataexception
nextfile   0
iteration
f    file  inputfiles get nextfile
name   f getcanonicalpath     iteration
bufferedreader reader   new bufferedreader new filereader f
string line   null
//first line is the date, 3rd is the title, rest is body
string datestr   reader readline
reader readline     skip an empty line
string title   reader readline
reader readline     skip an empty line
stringbuffer bodybuf   new stringbuffer 1024
while   line   reader readline       null
bodybuf append line  append
reader close
addbytes f length
date date   getdateformat   parse datestr trim
return new docdata name  bodybuf tostring    title  null  date
/*
*  (non-javadoc)
* @see docmaker#resetiinputs()
*/
public synchronized void resetinputs
super resetinputs
nextfile   0
iteration   0
/*
*  (non-javadoc)
* @see docmaker#numuniquetexts()
*/
public int numuniquetexts
return inputfiles size