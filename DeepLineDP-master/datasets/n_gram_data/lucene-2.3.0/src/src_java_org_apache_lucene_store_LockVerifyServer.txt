package org apache lucene store
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java net serversocket
import java net socket
import java io outputstream
import java io inputstream
import java io ioexception
/**
* simple standalone server that must be running when you
* use {@link verifyinglockfactory}.  this server simply
* verifies at most one process holds the lock at a time.
* run without any args to see usage.
*
* @see verifyinglockfactory
* @see lockstresstest
*/
public class lockverifyserver
private static string gettime long starttime
return       system currenttimemillis   starttime  1000
public static void main string args  throws ioexception
if  args length    1
system out println
system exit 1
final int port   integer parseint args
serversocket s   new serversocket port
s setreuseaddress true
system out println     port
int lockedid   0
long starttime   system currenttimemillis
while true
socket cs   s accept
outputstream out   cs getoutputstream
inputstream in   cs getinputstream
int id   in read
int command   in read
boolean err   false
if  command    1
// locked
if  lockedid    0
err   true
system out println gettime starttime        id       lockedid
lockedid   id
else if  command    0
if  lockedid    id
err   true
system out println gettime starttime        id       lockedid
lockedid   0
else
throw new runtimeexception     command
system out print
if  err
out write 1
else
out write 0
out close
in close
cs close