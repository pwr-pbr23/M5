package org apache lucene queryparser surround query
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java util list
import java util iterator
import java io ioexception
import org apache lucene index indexreader
import org apache lucene search query
import org apache lucene search spans spannearquery
import org apache lucene search spans spanquery
public class distancequery extends composedquery implements distancesubquery
public distancequery
list queries
boolean infix
int opdistance
string opname
boolean ordered
super queries  infix  opname
this opdistance   opdistance     the distance indicated in the operator
this ordered   ordered
private int opdistance
public int getopdistance    return opdistance
private boolean ordered
public boolean subqueriesordered    return ordered
public string distancesubquerynotallowed
iterator sqi   getsubqueriesiterator
while  sqi hasnext
object leq   sqi next
if  leq instanceof distancesubquery
distancesubquery dsq    distancesubquery  leq
string m   dsq distancesubquerynotallowed
if  m    null
return m
else
return     getoperatorname         leq tostring
return null     subqueries acceptable
public void addspanqueries spannearclausefactory sncf  throws ioexception
query snq   getspannearquery sncf getindexreader
sncf getfieldname
getweight
sncf getbasicqueryfactory
sncf addspannearquery snq
public query makelucenequeryfieldnoboost final string fieldname  final basicqueryfactory qf
return new query
public string tostring string fn
return getclass   tostring         fieldname       fn
public query rewrite indexreader reader  throws ioexception
return getspannearquery reader  fieldname  getboost    qf
public query getspannearquery
indexreader reader
string fieldname
float boost
basicqueryfactory qf  throws ioexception
spanquery spannearclauses   new spanquery
iterator sqi   getsubqueriesiterator
int qi   0
while  sqi hasnext
spannearclausefactory sncf   new spannearclausefactory reader  fieldname  qf
distancesubquery sqi next    addspanqueries sncf
if  sncf size      0       distance operator requires all sub queries
while  sqi hasnext         produce evt  error messages but ignore results
distancesubquery sqi next    addspanqueries sncf
sncf clear
return srndquery theemptylcnquery
spannearclauses   sncf makespannearclause
qi
spannearquery r   new spannearquery spannearclauses  getopdistance     1  subqueriesordered
r setboost boost
return r