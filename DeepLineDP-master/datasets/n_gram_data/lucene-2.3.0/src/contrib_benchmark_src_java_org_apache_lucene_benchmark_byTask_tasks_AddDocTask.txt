package org apache lucene benchmark bytask tasks
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import org apache lucene benchmark bytask perfrundata
import org apache lucene benchmark bytask feeds docmaker
import org apache lucene document document
import java text numberformat
/**
* add a document, optionally with of a certain size.
* <br>other side effects: none.
* <br>relevant properties: <code>doc.add.log.step</code>.
* <br>takes optional param: document size.
*/
public class adddoctask extends perftask
/**
* default value for property <code>doc.add.log.step<code> - indicating how often
* an "added n docs" message should be logged.
*/
public static final int default_add_doc_log_step   500
public adddoctask perfrundata rundata
super rundata
private int logstep    1
private int docsize   0
int count   0
// volatile data passed between setup(), dologic(), teardown().
private document doc   null
/*
*  (non-javadoc)
* @see perftask#setup()
*/
public void setup   throws exception
super setup
docmaker docmaker   getrundata   getdocmaker
if  docsize > 0
doc   docmaker makedocument docsize
else
doc   docmaker makedocument
/* (non-javadoc)
* @see perftask#teardown()
*/
public void teardown   throws exception
log   count
doc   null
super teardown
public int dologic   throws exception
getrundata   getindexwriter   adddocument doc
return 1
private void log  int count
if  logstep<0
// init once per instance
logstep   getrundata   getconfig   get   default_add_doc_log_step
if  logstep>0     count%logstep   0
double seconds    system currenttimemillis     getrundata   getstarttimemillis    1000 0
numberformat nf   numberformat getinstance
nf setmaximumfractiondigits 2
system out println   nf format seconds        thread currentthread   getname     count
/**
* set the params (docsize only)
* @param params docsize, or 0 for no limit.
*/
public void setparams string params
super setparams params
docsize    int  float parsefloat params
/* (non-javadoc)
* @see org.apache.lucene.benchmark.bytask.tasks.perftask#supportsparams()
*/
public boolean supportsparams
return true