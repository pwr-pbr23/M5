package org apache lucene benchmark utils
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import org xml sax attributes
import org xml sax inputsource
import org xml sax xmlreader
import org xml sax helpers defaulthandler
import org xml sax helpers xmlreaderfactory
import javax xml parsers saxparser
import javax xml parsers saxparserfactory
import java io file
import java io fileinputstream
import java io filewriter
import java io ioexception
/**
* extract the downloaded wikipedia dump into separate files for indexing.
*/
public class extractwikipedia
private file wikipedia
private file outputdir
public extractwikipedia file wikipedia  file outputdir
this wikipedia   wikipedia
this outputdir   outputdir
system out println     outputdir
file  files   outputdir listfiles
for  int i   0  i < files length  i
files delete
static public int count   0
static string months
public class parser extends defaulthandler
public parser
stringbuffer contents   new stringbuffer
public void characters char ch  int start  int length
contents append ch  start  length
string title
string id
string body
string time
static final int base   10
public void startelement string namespace
string simple
string qualified
attributes attributes
if  qualified equals
title   null
id   null
body   null
time   null
else if  qualified equals
contents setlength 0
else if  qualified equals
contents setlength 0
else if  qualified equals
contents setlength 0
else if  qualified equals
contents setlength 0
public file directory  int count  file directory
if  directory    null
directory   outputdir
int base   base
while  base <  count
base    base
if  count < base
return directory
directory   new file  directory   integer tostring base   base
directory   new file  directory   integer tostring count    base   base
return directory count %  base   base   directory
public void create string id  string title  string time  string body
file d   directory count    null
d mkdirs
file f   new file d  id
stringbuffer contents   new stringbuffer
contents append time
contents append
contents append title
contents append
contents append body
contents append
try
filewriter writer   new filewriter f
writer write contents tostring
writer close
catch  ioexception ioe
throw new runtimeexception ioe
string time string original
stringbuffer buffer   new stringbuffer
buffer append original substring 8  10
buffer append
buffer append months
buffer append
buffer append original substring 0  4
buffer append
buffer append original substring 11  19
buffer append
return buffer tostring
public void endelement string namespace  string simple  string qualified
if  qualified equals
title   contents tostring
else if  qualified equals
body   contents tostring
if  body startswith
body startswith
body   null
else if  qualified equals
time   time contents tostring
else if  qualified equals       id    null
id   contents tostring
else if  qualified equals
if  body    null
create id  title  time  body
public void extract
try
parser parser   new parser
if  false
saxparser sp   saxparserfactory newinstance   newsaxparser
sp parse new fileinputstream wikipedia   parser
else
xmlreader reader
xmlreaderfactory createxmlreader
reader setcontenthandler parser
reader seterrorhandler parser
reader parse new inputsource new fileinputstream wikipedia
catch  exception e
throw new runtimeexception e
public static void main string args
if  args length    2
printusage
file wikipedia   new file args
if  wikipedia exists
file outputdir   new file args
outputdir mkdirs
extractwikipedia extractor   new extractwikipedia wikipedia  outputdir
extractor extract
else
printusage
private static void printusage
system err println