package org apache lucene index
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java io ioexception
import java util arrays
import org apache lucene store indexinput
/**
* implements the skip list reader for the default posting list format
* that stores positions and payloads.
*
*/
class defaultskiplistreader extends multilevelskiplistreader
private boolean currentfieldstorespayloads
private long freqpointer
private long proxpointer
private int payloadlength
private long lastfreqpointer
private long lastproxpointer
private int lastpayloadlength
defaultskiplistreader indexinput skipstream  int maxskiplevels  int skipinterval
super skipstream  maxskiplevels  skipinterval
freqpointer   new long
proxpointer   new long
payloadlength   new int
void init long skippointer  long freqbasepointer  long proxbasepointer  int df  boolean storespayloads
super init skippointer  df
this currentfieldstorespayloads   storespayloads
lastfreqpointer   freqbasepointer
lastproxpointer   proxbasepointer
arrays fill freqpointer  freqbasepointer
arrays fill proxpointer  proxbasepointer
arrays fill payloadlength  0
/** returns the freq pointer of the doc to which the last call of
* {@link multilevelskiplistreader#skipto(int)} has skipped.  */
long getfreqpointer
return lastfreqpointer
/** returns the prox pointer of the doc to which the last call of
* {@link multilevelskiplistreader#skipto(int)} has skipped.  */
long getproxpointer
return lastproxpointer
/** returns the payload length of the payload stored just before
* the doc to which the last call of {@link multilevelskiplistreader#skipto(int)}
* has skipped.  */
int getpayloadlength
return lastpayloadlength
protected void seekchild int level  throws ioexception
super seekchild level
freqpointer   lastfreqpointer
proxpointer   lastproxpointer
payloadlength   lastpayloadlength
protected void setlastskipdata int level
super setlastskipdata level
lastfreqpointer   freqpointer
lastproxpointer   proxpointer
lastpayloadlength   payloadlength
protected int readskipdata int level  indexinput skipstream  throws ioexception
int delta
if  currentfieldstorespayloads
// the current field stores payloads.
// if the doc delta is odd then we have
// to read the current payload length
// because it differs from the length of the
// previous payload
delta   skipstream readvint
if   delta   1     0
payloadlength   skipstream readvint
delta >>>  1
else
delta   skipstream readvint
freqpointer    skipstream readvint
proxpointer    skipstream readvint
return delta