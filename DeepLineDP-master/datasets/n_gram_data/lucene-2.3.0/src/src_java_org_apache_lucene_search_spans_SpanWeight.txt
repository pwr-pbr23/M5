package org apache lucene search spans
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import org apache lucene index indexreader
import org apache lucene index term
import org apache lucene search
import java io ioexception
import java util hashset
import java util iterator
import java util set
/**
* expert-only.  public for use by other weight implementations
*/
public class spanweight implements weight
protected similarity similarity
protected float value
protected float idf
protected float querynorm
protected float queryweight
protected set terms
protected spanquery query
public spanweight spanquery query  searcher searcher
throws ioexception
this similarity   query getsimilarity searcher
this query   query
terms new hashset
query extractterms terms
idf   this query getsimilarity searcher  idf terms  searcher
public query getquery     return query
public float getvalue     return value
public float sumofsquaredweights   throws ioexception
queryweight   idf   query getboost               compute query weight
return queryweight   queryweight                 square it
public void normalize float querynorm
this querynorm   querynorm
queryweight    querynorm                         normalize query weight
value   queryweight   idf                        idf for document
public scorer scorer indexreader reader  throws ioexception
return new spanscorer query getspans reader   this
similarity
reader norms query getfield
public explanation explain indexreader reader  int doc
throws ioexception
complexexplanation result   new complexexplanation
result setdescription   getquery     doc
string field     spanquery getquery    getfield
stringbuffer docfreqs   new stringbuffer
iterator i   terms iterator
while  i hasnext
term term    term i next
docfreqs append term text
docfreqs append
docfreqs append reader docfreq term
if  i hasnext
docfreqs append
explanation idfexpl
new explanation idf      field       docfreqs
// explain query weight
explanation queryexpl   new explanation
queryexpl setdescription     getquery
explanation boostexpl   new explanation getquery   getboost
if  getquery   getboost      1 0f
queryexpl adddetail boostexpl
queryexpl adddetail idfexpl
explanation querynormexpl   new explanation querynorm
queryexpl adddetail querynormexpl
queryexpl setvalue boostexpl getvalue
idfexpl getvalue
querynormexpl getvalue
result adddetail queryexpl
// explain field weight
complexexplanation fieldexpl   new complexexplanation
fieldexpl setdescription   field   query tostring field
doc
explanation tfexpl   scorer reader  explain doc
fieldexpl adddetail tfexpl
fieldexpl adddetail idfexpl
explanation fieldnormexpl   new explanation
byte fieldnorms   reader norms field
float fieldnorm
fieldnorms  null ? similarity decodenorm fieldnorms    0 0f
fieldnormexpl setvalue fieldnorm
fieldnormexpl setdescription   field   doc
fieldexpl adddetail fieldnormexpl
fieldexpl setmatch boolean valueof tfexpl ismatch
fieldexpl setvalue tfexpl getvalue
idfexpl getvalue
fieldnormexpl getvalue
result adddetail fieldexpl
result setmatch fieldexpl getmatch
// combine them
result setvalue queryexpl getvalue     fieldexpl getvalue
if  queryexpl getvalue      1 0f
return fieldexpl
return result