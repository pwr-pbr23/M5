package org apache lucene benchmark bytask tasks
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java io bufferedwriter
import java io fileoutputstream
import java io outputstreamwriter
import org apache lucene benchmark bytask perfrundata
import org apache lucene benchmark bytask feeds docmaker
import org apache lucene benchmark bytask feeds basicdocmaker
import org apache lucene benchmark bytask utils config
import org apache lucene document document
import org apache lucene document field
public class writelinedoctask extends perftask
/**
* default value for property <code>doc.add.log.step<code> - indicating how often
* an "added n docs" message should be logged.
*/
public static final int default_writeline_doc_log_step   1000
public writelinedoctask perfrundata rundata
super rundata
private int logstep    1
private int docsize   0
int count   0
private bufferedwriter linefileout null
private docmaker docmaker
public final static string sep
/*
*  (non-javadoc)
* @see perftask#setup()
*/
public void setup   throws exception
super setup
if  linefileout  null
config config   getrundata   getconfig
string filename   config get    null
if  filename    null
throw new exception
linefileout   new bufferedwriter new outputstreamwriter new fileoutputstream filename
docmaker   getrundata   getdocmaker
public void teardown   throws exception
log   count
super teardown
public int dologic   throws exception
document doc
if  docsize > 0
doc   docmaker makedocument docsize
else
doc   docmaker makedocument
field f   doc getfield basicdocmaker body_field
string body  title  date
if  f    null
body   f stringvalue   replace
else
body   null
f   doc getfield basicdocmaker title_field
if  f    null
title   f stringvalue   replace
else
title
f   doc getfield basicdocmaker date_field
if  f    null
date   f stringvalue   replace
else
date
if  body    null
linefileout write title  0  title length
linefileout write sep
linefileout write date  0  date length
linefileout write sep
linefileout write body  0  body length
linefileout newline
linefileout flush
return 1
private void log  int count
if  logstep<0
// init once per instance
logstep   getrundata   getconfig   get    default_writeline_doc_log_step
if  logstep>0     count%logstep   0
system out println   thread currentthread   getname     count
/**
* set the params (docsize only)
* @param params docsize, or 0 for no limit.
*/
public void setparams string params
super setparams params
docsize    int  float parsefloat params
/* (non-javadoc)
* @see org.apache.lucene.benchmark.bytask.tasks.perftask#supportsparams()
*/
public boolean supportsparams
return true