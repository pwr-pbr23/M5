/* generated by:javacc: do not edit this line. queryparser.java */
package org apache lucene queryparser surround parser
import java util arraylist
import java util list
import java io stringreader
import org apache lucene analysis tokenstream
import org apache lucene queryparser surround query srndquery
import org apache lucene queryparser surround query fieldsquery
import org apache lucene queryparser surround query orquery
import org apache lucene queryparser surround query andquery
import org apache lucene queryparser surround query notquery
import org apache lucene queryparser surround query distancequery
import org apache lucene queryparser surround query srndtermquery
import org apache lucene queryparser surround query srndprefixquery
import org apache lucene queryparser surround query srndtruncquery
/**
* this class is generated by javacc.  the only method that clients should need
* to call is <a href="#parse">parse()</a>.
*/
public class queryparser implements queryparserconstants
final int minimumprefixlength   3
final int minimumcharsintrunc   3
final string truncationerrormessage
final string boosterrormessage
/* checkme: these should be the same as for the tokenizer. how? */
final char truncator
final char anychar
final char quote
final char fieldoperator
final char comma         prefix list separator
final char carat         weight oparator
static public srndquery parse string query  throws parseexception
queryparser parser   new queryparser
return parser parse2 query
public queryparser
this new fastcharstream new stringreader
public srndquery parse2 string query  throws parseexception
reinit new fastcharstream new stringreader query
try
return topsrndquery
catch  tokenmgrerror tme
throw new parseexception tme getmessage
protected srndquery getfieldsquery
srndquery q  arraylist fieldnames
/* fixme: check acceptable subquery: at least one subquery should not be
* a fields query.
*/
return new fieldsquery q  fieldnames  fieldoperator
protected srndquery getorquery list queries  boolean infix  token ortoken
return new orquery queries  infix  ortoken image
protected srndquery getandquery list queries  boolean infix  token andtoken
return new andquery  queries  infix  andtoken image
protected srndquery getnotquery list queries  token nottoken
return new notquery  queries  nottoken image
protected static int getopdistance string distanceop
/* w, 2w, 3w etc -> 1, 2 3, etc. same for n, 2n ... */
return distanceop length      1
? 1
integer parseint  distanceop substring  0  distanceop length     1
protected static void checkdistancesubqueries distancequery distq  string opname
throws parseexception
string m   distq distancesubquerynotallowed
if  m    null
throw new parseexception     opname       m
protected srndquery getdistancequery
list queries
boolean infix
token dtoken
boolean ordered  throws parseexception
distancequery dq   new distancequery queries
infix
getopdistance dtoken image
dtoken image
ordered
checkdistancesubqueries dq  dtoken image
return dq
protected srndquery gettermquery
string term  boolean quoted
return new srndtermquery term  quoted
protected boolean allowedsuffix string suffixed
return  suffixed length     1  >  minimumprefixlength
protected srndquery getprefixquery
string prefix  boolean quoted
return new srndprefixquery prefix  quoted  truncator
protected boolean allowedtruncation string truncated
/* at least 3 normal characters needed. */
int nrnormalchars   0
for  int i   0  i < truncated length    i
char c   truncated charat i
if   c    truncator      c    anychar
nrnormalchars
return nrnormalchars >  minimumcharsintrunc
protected srndquery gettruncquery string truncated
return new srndtruncquery truncated  truncator  anychar
final public srndquery topsrndquery   throws parseexception
srndquery q
q   fieldsquery
jj_consume_token 0
if  true  return q
throw new error
final public srndquery fieldsquery   throws parseexception
srndquery q
arraylist fieldnames
fieldnames   optionalfields
q   orquery
if  true  return  fieldnames    null  ? q   getfieldsquery q  fieldnames
throw new error
final public arraylist optionalfields   throws parseexception
token fieldname
arraylist fieldnames   null
label_1
while  true
if  jj_2_1 2
else
break label_1
// to the colon
fieldname   jj_consume_token term
jj_consume_token colon
if  fieldnames    null
fieldnames   new arraylist
fieldnames add fieldname image
if  true  return fieldnames
throw new error
final public srndquery orquery   throws parseexception
srndquery q
arraylist queries   null
token oprt   null
q   andquery
label_2
while  true
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case or
break
default
jj_la1   jj_gen
break label_2
oprt   jj_consume_token or
/* keep only last used operator */
if  queries    null
queries   new arraylist
queries add q
q   andquery
queries add q
if  true  return  queries    null  ? q   getorquery queries  true    infix     oprt
throw new error
final public srndquery andquery   throws parseexception
srndquery q
arraylist queries   null
token oprt   null
q   notquery
label_3
while  true
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case and
break
default
jj_la1   jj_gen
break label_3
oprt   jj_consume_token and
/* keep only last used operator */
if  queries    null
queries   new arraylist
queries add q
q   notquery
queries add q
if  true  return  queries    null  ? q   getandquery queries  true    infix     oprt
throw new error
final public srndquery notquery   throws parseexception
srndquery q
arraylist queries   null
token oprt   null
q   nquery
label_4
while  true
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case not
break
default
jj_la1   jj_gen
break label_4
oprt   jj_consume_token not
/* keep only last used operator */
if  queries    null
queries   new arraylist
queries add q
q   nquery
queries add q
if  true  return  queries    null  ? q   getnotquery queries  oprt
throw new error
final public srndquery nquery   throws parseexception
srndquery q
arraylist queries
token dt
q   wquery
label_5
while  true
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case n
break
default
jj_la1   jj_gen
break label_5
dt   jj_consume_token n
queries   new arraylist
queries add q      left associative
q   wquery
queries add q
q   getdistancequery queries  true    infix     dt  false    not ordered
if  true  return q
throw new error
final public srndquery wquery   throws parseexception
srndquery q
arraylist queries
token wt
q   primaryquery
label_6
while  true
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case w
break
default
jj_la1   jj_gen
break label_6
wt   jj_consume_token w
queries   new arraylist
queries add q      left associative
q   primaryquery
queries add q
q   getdistancequery queries  true    infix     wt  true    ordered
if  true  return q
throw new error
final public srndquery primaryquery   throws parseexception
/* bracketed weighted query or weighted term */
srndquery q
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case lparen
jj_consume_token lparen
q   fieldsquery
jj_consume_token rparen
break
case or
case and
case w
case n
q   prefixoperatorquery
break
case truncquoted
case quoted
case suffixterm
case truncterm
case term
q   simpleterm
break
default
jj_la1   jj_gen
jj_consume_token  1
throw new parseexception
optionalweights q
if  true  return q
throw new error
final public srndquery prefixoperatorquery   throws parseexception
token oprt
list queries
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case or
oprt   jj_consume_token or
/* prefix or */
queries   fieldsquerylist
if  true  return getorquery queries  false    not infix     oprt
break
case and
oprt   jj_consume_token and
/* prefix and */
queries   fieldsquerylist
if  true  return getandquery queries  false    not infix     oprt
break
case n
oprt   jj_consume_token n
/* prefix n */
queries   fieldsquerylist
if  true  return getdistancequery queries  false    not infix     oprt  false    not ordered
break
case w
oprt   jj_consume_token w
/* prefix w */
queries   fieldsquerylist
if  true  return getdistancequery queries  false     not infix     oprt  true    ordered
break
default
jj_la1   jj_gen
jj_consume_token  1
throw new parseexception
throw new error
final public list fieldsquerylist   throws parseexception
srndquery q
arraylist queries   new arraylist
jj_consume_token lparen
q   fieldsquery
queries add q
label_7
while  true
jj_consume_token comma
q   fieldsquery
queries add q
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case comma
break
default
jj_la1   jj_gen
break label_7
jj_consume_token rparen
if  true  return queries
throw new error
final public srndquery simpleterm   throws parseexception
token term
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case term
term   jj_consume_token term
if  true  return gettermquery term image  false    not quoted
break
case quoted
term   jj_consume_token quoted
if  true  return gettermquery term image substring 1  term image length   1   true    quoted
break
case suffixterm
term   jj_consume_token suffixterm
/* ending in * */
if    allowedsuffix term image
if  true  throw new parseexception truncationerrormessage   term image
if  true  return getprefixquery term image substring 0  term image length   1   false    not quoted
break
case truncterm
term   jj_consume_token truncterm
/* with at least one * or ? */
if    allowedtruncation term image
if  true  throw new parseexception truncationerrormessage   term image
if  true  return gettruncquery term image
break
case truncquoted
term   jj_consume_token truncquoted
/* eg. "9b-b,m"* */
if   term image length     3  < minimumprefixlength
if  true  throw new parseexception truncationerrormessage   term image
if  true  return getprefixquery term image substring 1  term image length   2   true    quoted
break
default
jj_la1   jj_gen
jj_consume_token  1
throw new parseexception
throw new error
final public void optionalweights srndquery q  throws parseexception
token weight null
label_8
while  true
switch   jj_ntk   1 ?jj_ntk   jj_ntk
case carat
break
default
jj_la1   jj_gen
break label_8
jj_consume_token carat
weight   jj_consume_token number
float f
try
f   float valueof weight image  floatvalue
catch  exception floatexc
if  true  throw new parseexception boosterrormessage   weight image       floatexc
if  f <  0 0
if  true  throw new parseexception boosterrormessage   weight image
q setweight f   q getweight        left associative  fwiw
final private boolean jj_2_1 int xla
jj_la   xla  jj_lastpos   jj_scanpos   token
try   return  jj_3_1
catch lookaheadsuccess ls    return true
finally   jj_save 0  xla
final private boolean jj_3_1
if  jj_scan_token term   return true
if  jj_scan_token colon   return true
return false
public queryparsertokenmanager token_source
public token token  jj_nt
private int jj_ntk
private token jj_scanpos  jj_lastpos
private int jj_la
public boolean lookingahead   false
private boolean jj_semla
private int jj_gen
final private int jj_la1   new int
static private int jj_la1_0
static
jj_la1_0
private static void jj_la1_0
jj_la1_0   new int  0x100 0x200 0x400 0x1000 0x800 0x7c3b00 0x1b00 0x8000 0x7c0000 0x20000
final private jjcalls jj_2_rtns   new jjcalls
private boolean jj_rescan   false
private int jj_gc   0
public queryparser charstream stream
token_source   new queryparsertokenmanager stream
token   new token
jj_ntk    1
jj_gen   0
for  int i   0  i < 10  i    jj_la1    1
for  int i   0  i < jj_2_rtns length  i    jj_2_rtns   new jjcalls
public void reinit charstream stream
token_source reinit stream
token   new token
jj_ntk    1
jj_gen   0
for  int i   0  i < 10  i    jj_la1    1
for  int i   0  i < jj_2_rtns length  i    jj_2_rtns   new jjcalls
public queryparser queryparsertokenmanager tm
token_source   tm
token   new token
jj_ntk    1
jj_gen   0
for  int i   0  i < 10  i    jj_la1    1
for  int i   0  i < jj_2_rtns length  i    jj_2_rtns   new jjcalls
public void reinit queryparsertokenmanager tm
token_source   tm
token   new token
jj_ntk    1
jj_gen   0
for  int i   0  i < 10  i    jj_la1    1
for  int i   0  i < jj_2_rtns length  i    jj_2_rtns   new jjcalls
final private token jj_consume_token int kind  throws parseexception
token oldtoken
if   oldtoken   token  next    null  token   token next
else token   token next   token_source getnexttoken
jj_ntk    1
if  token kind    kind
jj_gen
if    jj_gc > 100
jj_gc   0
for  int i   0  i < jj_2_rtns length  i
jjcalls c   jj_2_rtns
while  c    null
if  c gen < jj_gen  c first   null
c   c next
return token
token   oldtoken
jj_kind   kind
throw generateparseexception
static private final class lookaheadsuccess extends java lang error
final private lookaheadsuccess jj_ls   new lookaheadsuccess
final private boolean jj_scan_token int kind
if  jj_scanpos    jj_lastpos
jj_la
if  jj_scanpos next    null
jj_lastpos   jj_scanpos   jj_scanpos next   token_source getnexttoken
else
jj_lastpos   jj_scanpos   jj_scanpos next
else
jj_scanpos   jj_scanpos next
if  jj_rescan
int i   0  token tok   token
while  tok    null    tok    jj_scanpos    i    tok   tok next
if  tok    null  jj_add_error_token kind  i
if  jj_scanpos kind    kind  return true
if  jj_la    0    jj_scanpos    jj_lastpos  throw jj_ls
return false
final public token getnexttoken
if  token next    null  token   token next
else token   token next   token_source getnexttoken
jj_ntk    1
jj_gen
return token
final public token gettoken int index
token t   lookingahead ? jj_scanpos   token
for  int i   0  i < index  i
if  t next    null  t   t next
else t   t next   token_source getnexttoken
return t
final private int jj_ntk
if   jj_nt token next     null
return  jj_ntk    token next token_source getnexttoken    kind
else
return  jj_ntk   jj_nt kind
private java util vector jj_expentries   new java util vector
private int jj_expentry
private int jj_kind    1
private int jj_lasttokens   new int
private int jj_endpos
private void jj_add_error_token int kind  int pos
if  pos >  100  return
if  pos    jj_endpos   1
jj_lasttokens   kind
else if  jj_endpos    0
jj_expentry   new int
for  int i   0  i < jj_endpos  i
jj_expentry   jj_lasttokens
boolean exists   false
for  java util enumeration e   jj_expentries elements    e hasmoreelements
int oldentry    int  e nextelement
if  oldentry length    jj_expentry length
exists   true
for  int i   0  i < jj_expentry length  i
if  oldentry    jj_expentry
exists   false
break
if  exists  break
if   exists  jj_expentries addelement jj_expentry
if  pos    0  jj_lasttokens   kind
public parseexception generateparseexception
jj_expentries removeallelements
boolean la1tokens   new boolean
for  int i   0  i < 24  i
la1tokens   false
if  jj_kind >  0
la1tokens   true
jj_kind    1
for  int i   0  i < 10  i
if  jj_la1    jj_gen
for  int j   0  j < 32  j
if   jj_la1_0    1<<j      0
la1tokens   true
for  int i   0  i < 24  i
if  la1tokens
jj_expentry   new int
jj_expentry   i
jj_expentries addelement jj_expentry
jj_endpos   0
jj_rescan_token
jj_add_error_token 0  0
int exptokseq   new int
for  int i   0  i < jj_expentries size    i
exptokseq    int jj_expentries elementat i
return new parseexception token  exptokseq  tokenimage
final public void enable_tracing
final public void disable_tracing
final private void jj_rescan_token
jj_rescan   true
for  int i   0  i < 1  i
jjcalls p   jj_2_rtns
do
if  p gen > jj_gen
jj_la   p arg  jj_lastpos   jj_scanpos   p first
switch  i
case 0  jj_3_1    break
p   p next
while  p    null
jj_rescan   false
final private void jj_save int index  int xla
jjcalls p   jj_2_rtns
while  p gen > jj_gen
if  p next    null    p   p next   new jjcalls    break
p   p next
p gen   jj_gen   xla   jj_la  p first   token  p arg   xla
static final class jjcalls
int gen
token first
int arg
jjcalls next