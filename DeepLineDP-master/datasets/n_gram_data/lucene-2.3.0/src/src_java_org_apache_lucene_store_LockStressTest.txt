package org apache lucene store
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java io ioexception
import java io file
/**
* simple standalone tool that forever acquires & releases a
* lock using a specific lockfactory.  run without any args
* to see usage.
*
* @see verifyinglockfactory
* @see lockverifyserver
*/
public class lockstresstest
public static void main string args  throws exception
if  args length    6
system out println
system exit 1
final int myid   integer parseint args
if  myid < 0    myid > 255
system out println
system exit 1
final string verifierhost   args
final int verifierport   integer parseint args
final string lockfactoryclassname   args
final string lockdirname   args
final int sleeptimems   integer parseint args
class c
try
c   class forname lockfactoryclassname
catch  classnotfoundexception e
throw new ioexception     lockfactoryclassname
lockfactory lockfactory
try
lockfactory    lockfactory  c newinstance
catch  illegalaccessexception e
throw new ioexception     lockfactoryclassname
catch  instantiationexception e
throw new ioexception     lockfactoryclassname
catch  classcastexception e
throw new ioexception     lockfactoryclassname
file lockdir   new file lockdirname
if  lockfactory instanceof nativefslockfactory
nativefslockfactory  lockfactory  setlockdir lockdir
else if  lockfactory instanceof simplefslockfactory
simplefslockfactory  lockfactory  setlockdir lockdir
lockfactory setlockprefix
lockfactory verifylf   new verifyinglockfactory  byte  myid  lockfactory  verifierhost  verifierport
lock l   verifylf makelock
while true
boolean obtained   false
try
obtained   l obtain 10
catch  lockobtainfailedexception e
system out print
if  obtained
system out print
l release
thread sleep sleeptimems