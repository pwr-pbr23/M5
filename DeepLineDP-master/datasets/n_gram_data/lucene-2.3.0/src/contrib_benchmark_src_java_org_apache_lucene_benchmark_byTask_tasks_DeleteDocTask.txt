package org apache lucene benchmark bytask tasks
import org apache lucene benchmark bytask perfrundata
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
/**
* delete a document by docid.
* <br>other side effects: none.
* <br>relevant properties: <code>doc.delete.log.step , doc.delete.step</code>.
* <br>if no docid param is supplied, deletes doc with <code>id = last-deleted-doc + doc.delete.step</code>.
* <br>takes optional param: document id.
*/
public class deletedoctask extends perftask
/**
* gap between ids of deleted docs, applies when no docid param is provided.
*/
public static final int default_doc_delete_step   8
/**
* default value for property <code>doc.delete.log.step<code> - indicating how often
* an "deleted n docs" message should be logged.
*/
public static final int default_delete_doc_log_step   500
public deletedoctask perfrundata rundata
super rundata
private int logstep    1
private int deletestep    1
private static int numdeleted   0
private static int lastdeleted    1
private int docid    1
private boolean bystep   true
public int dologic   throws exception
getrundata   getindexreader   deletedocument docid
lastdeleted   docid
return 1     one work item done here
/* (non-javadoc)
* @see org.apache.lucene.benchmark.bytask.tasks.perftask#setup()
*/
public void setup   throws exception
super setup
// one time static initializations
if  logstep<0
logstep   getrundata   getconfig   get   default_delete_doc_log_step
if  deletestep<0
deletestep   getrundata   getconfig   get   default_doc_delete_step
// set the docid to be deleted
docid    bystep ? lastdeleted   deletestep   docid
/* (non-javadoc)
* @see perftask#teardown()
*/
public void teardown   throws exception
log   numdeleted
super teardown
private void log  int count
if  logstep>0     count%logstep   0
system out println   count   lastdeleted
/**
* set the params (docid only)
* @param params docid to delete, or -1 for deleting by delete gap settings.
*/
public void setparams string params
super setparams params
docid    int  float parsefloat params
bystep    docid < 0
/* (non-javadoc)
* @see org.apache.lucene.benchmark.bytask.tasks.perftask#supportsparams()
*/
public boolean supportsparams
return true