/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket request resource
import java net urlconnection
import org apache wicket wicketruntimeexception
import org apache wicket util time time
/**
* an {@link iresource} for byte arrays. the byte array can be static - passed to the constructor,
* or dynamic - by overriding
* {@link #getdata(org.apache.wicket.request.resource.iresource.attributes)}
*
* @author matej knopp
*/
public class bytearrayresource extends abstractresource
private static final long serialversionuid   1l
/** the content type. */
private final string contenttype
/** the binary data. */
private byte array
/** the time that this resource was last modified; same as construction time. */
private final time lastmodified   time now
private final string filename
/**
* creates a {@link bytearrayresource} which will provide its data dynamically with
* {@link #getdata(org.apache.wicket.request.resource.iresource.attributes)}
*
* @param contenttype
*            the content type of the array.
*/
public bytearrayresource final string contenttype
this contenttype  null  null
/**
* creates a resource from the given byte array with its content type
*
* @param contenttype
*            the content type of the array.
* @param array
*            the binary content
*/
public bytearrayresource final string contenttype  final byte array
this contenttype  array  null
/**
* creates a resource from the given byte array with its content type
*
* @param contenttype
*            the content type of the array.
* @param array
*            the binary content
* @param filename
*            the filename that will be set as the content-disposition header.
*/
public bytearrayresource final string contenttype  final byte array  final string filename
this contenttype   contenttype
this array   array
this filename   filename
protected void configureresponse final resourceresponse response  final attributes attributes
/**
* @see org.apache.wicket.request.resource.abstractresource#newresourceresponse(org.apache.wicket.request.resource.iresource.attributes)
*/
@override
protected resourceresponse newresourceresponse final attributes attributes
final resourceresponse response   new resourceresponse
string contenttype   this contenttype
if  contenttype    null
if  filename    null
contenttype   urlconnection getfilenamemap   getcontenttypefor filename
if  contenttype    null
contenttype
response setcontenttype contenttype
response setlastmodified lastmodified
final byte data   getdata attributes
if  data    null
throw new wicketruntimeexception
response setcontentlength data length
if  response dataneedstobewritten attributes
if  filename    null
response setfilename filename
response setcontentdisposition contentdisposition attachment
else
response setcontentdisposition contentdisposition inline
response setwritecallback new writecallback
@override
public void writedata final attributes attributes
attributes getresponse   write data
configureresponse response  attributes
return response
/**
* gets the data for this resource.
*
* @param attributes
*            the context bringing the request, response and the parameters
*
* @return the byte array data for this resource
*/
protected byte getdata final attributes attributes
return array