/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket extensions markup html tree table
import java text numberformat
import java util arrays
import java util locale
import javax swing tree treenode
import org apache wicket component
import org apache wicket extensions markup html tree table columnlocation unit
import org apache wicket request response
import org apache wicket request cycle requestcycle
import org apache wicket response nullresponse
/**
* class that renders cells of columns aligned in the middle. this class also takes care of counting
* their widths and of column spans.
*
* @author matej knopp
*/
final class middlecolumnsview extends abstractcolumnsview
private static final long serialversionuid   1l
private final boolean treehasleftcolumn
/**
* constructor.
*
* @param id
*            the component id
* @param node
*            the tree node
* @param treehasleftcolumn
*            whether there is a column aligned to left in the tree table
*/
public middlecolumnsview final string id  final treenode node  final boolean treehasleftcolumn
super id  node
this treehasleftcolumn   treehasleftcolumn
/**
* computes the percentagle widths of columns. if a column spans over other columns, the widths
* of those columns will be zero.
*
* @return widths of columns
*/
protected double computecolumnwidths
// initialize the columns array
double result   new double
arrays fill result  0d
// the sum of weights of all columns
double sum   0d
double whole   99 8d
// go over all columns, check their alignment and count sum of their
// weights
for  icolumn column   columns
// check if the unit is right
if  column getlocation   getunit      unit proportional
throw new illegalstateexception
sum    column getlocation   getsize
int index   0     index of currently processed column
int spancolumn   0     index of column that is spanning over currently
// processed column (if any)
int spanleft   0     over how many columns does the spanning column
// span
for  icolumn column   columns
int ix   index     to which column should we append the size
if  spanleft > 0     is there a column spanning over current
// column?
ix   spancolumn     the size should be appended to the
// spanning
// column
spanleft
// add the percentage size to the column
result    math round  column getlocation   getsize      sum   whole
// wants this column to span and no other column is spanning over
// this column?
if   spanleft    0      column getspan node  > 1
int maxspan   columns size     columns indexof column      how
// many
// columns
// left
int span   column getspan node    1     how much columns want
// the column to span
// over
spancolumn   index     index of column that is spanning
spanleft   span < maxspan ? span   maxspan     set the number of
// columns spanned
// over
index
// count the sum
double together   0d
for  double value   result
together    value
// is it bigger than 99.8? that can cause layout problems in ie
if  together > 99 8d
// this can happen - rounding error. just decrease the last one
for  int i   result length   1  i >  0    i
if  result    0d
result    together   99 8d
break
return result
/**
* @see org.apache.wicket.markupcontainer#onrender()
*/
@override
protected void onrender
response response   requestcycle get   getresponse
double widths   computecolumnwidths
numberformat nf   numberformat getnumberinstance locale english
nf setmaximumfractiondigits 0
nf setmaximumintegerdigits 2
for  int i   0  i < columns size      i
component component   components get i
irenderable renderable   renderables get i
icolumn column   columns get i
// write the wrapping column markup
response write  b_  width  %
// determine whether we should render the left border
if   treehasleftcolumn     i    0
response write  d_
else
response write  c_
if  component    null     is there a component for current column?
// render the component
component render
else if  renderable    null     no component   try to render
// renderable
renderable render node  response
else
// no renderable or component. fail
throw new illegalstateexception
// end of wrapping markup
response write
// does this component span over other columns
int span   column getspan node
if  span > 1
// iterate through the columns and if any of them has a
// component,
// render the component to null response (otherwise the
// component will
// complain that it hasn't been rendered
for  int j   1   j < span      i < components size       j
i
if  components get i     null
response old   requestcycle get   setresponse nullresponse getinstance
components get i   render
requestcycle get   setresponse old