/*
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache wicket markup
import java util arraylist
import org apache wicket page
import org apache wicket markup html form autolabeltaghandler
import org apache wicket markup parser imarkupfilter
import org apache wicket markup parser ixmlpullparser
import org apache wicket markup parser filter conditionalcommentfilter
import org apache wicket markup parser filter enclosurehandler
import org apache wicket markup parser filter headforcetagidhandler
import org apache wicket markup parser filter htmlhandler
import org apache wicket markup parser filter htmlheadersectionhandler
import org apache wicket markup parser filter inlineenclosurehandler
import org apache wicket markup parser filter openclosetagexpander
import org apache wicket markup parser filter relativepathprefixhandler
import org apache wicket markup parser filter styleandscriptidentifier
import org apache wicket markup parser filter wicketlinktaghandler
import org apache wicket markup parser filter wicketmessagetaghandler
import org apache wicket markup parser filter wicketnamespacehandler
import org apache wicket markup parser filter wicketremovetaghandler
import org apache wicket markup parser filter wickettagidentifier
/**
* this is wicket's default markup parser. it gets pre-configured with wicket's default wicket
* filters.
*
* @see markupfactory
*
* @author juergen donnerstag
*/
public class markupparser extends abstractmarkupparser
/** "wicket" */
public final static string wicket
/**
* constructor.
*
* @param resource
*            the markup resource (file)
*/
public markupparser final markupresourcestream resource
super resource
/**
* constructor. usually for testing purposes only
*
* @param markup
*            the markup resource.
*/
public markupparser final string markup
super markup
/**
* constructor.
*
* @param xmlparser
*            the streaming xml parser to read and parse the markup
* @param resource
*            the markup resource (file)
*/
public markupparser final ixmlpullparser xmlparser  final markupresourcestream resource
super xmlparser  resource
@override
public markupfilterlist getmarkupfilters
return  markupfilterlist super getmarkupfilters
/**
* add a markup filter
*
* @param filter
* @return true, if successful
*/
public final boolean add final imarkupfilter filter
return getmarkupfilters   add filter
/**
* add a markup filter before the 'beforefilter'
*
* @param filter
* @param beforefilter
* @return true, if successful
*/
public final boolean add final imarkupfilter filter
final class<? extends imarkupfilter> beforefilter
return getmarkupfilters   add filter  beforefilter
/**
* a) allow subclasses to configure individual wicket filters
* <p>
* b) allows to disable wicket filters via returning false
*
* @param filter
* @return the filter to be added. null to ignore.
*/
protected imarkupfilter onappendmarkupfilter final imarkupfilter filter
return filter
/**
* initialize wicket's markupparser with all necessary markup filters. you may subclass this
* method, to add your own filters to the list.
*
* @param markup
* @return the list of markup filter
*/
@override
protected markupfilterlist initializemarkupfilters final markup markup
// markupfilterlist is a simple extension of arraylist providing few additional helpers
final markupfilterlist filters   new markupfilterlist
markupresourcestream markupresourcestream   markup getmarkupresourcestream
filters add new wickettagidentifier markupresourcestream
filters add new htmlhandler
filters add new wicketremovetaghandler
filters add new wicketlinktaghandler
filters add new autolabeltaghandler
filters add new wicketnamespacehandler markupresourcestream
// provided the wicket component requesting the markup is known ...
if   markupresourcestream    null      markupresourcestream getresource      null
final containerinfo containerinfo   markupresourcestream getcontainerinfo
if  containerinfo    null
filters add new wicketmessagetaghandler
// pages require additional handlers
if  page class isassignablefrom containerinfo getcontainerclass
filters add new htmlheadersectionhandler markup
filters add new headforcetagidhandler containerinfo getcontainerclass
filters add new openclosetagexpander
filters add new relativepathprefixhandler
filters add new enclosurehandler
filters add new inlineenclosurehandler
filters add new styleandscriptidentifier markup
filters add new conditionalcommentfilter
return filters
/**
* a simple extension to arraylist to manage wicket markupfilter's more easily
*/
public class markupfilterlist extends arraylist<imarkupfilter>
private static final long serialversionuid   1l
@override
public boolean add final imarkupfilter filter
return add filter  relativepathprefixhandler class
/**
* insert a markup filter before a another one.
*
* @param filter
* @param beforefilter
* @return true, if successful
*/
public boolean add imarkupfilter filter  final class<? extends imarkupfilter> beforefilter
filter   onadd filter
if  filter    null
return false
int index   indexof beforefilter
if  index < 0
return super add filter
super add index  filter
return true
/**
* a) allow subclasses to configure individual wicket filters which otherwise can not be
* accessed.
* <p>
* b) allows to disable wicket filters via returning false
*
* @param filter
* @return the filter to be added. null to ignore
*/
protected imarkupfilter onadd final imarkupfilter filter
return onappendmarkupfilter filter