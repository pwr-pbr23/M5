package org apache lucene xmlparser builders
import org apache lucene analysis analyzer
import org apache lucene queryparser parseexception
import org apache lucene queryparser queryparser
import org apache lucene search query
import org apache lucene xmlparser domutils
import org apache lucene xmlparser parserexception
import org apache lucene xmlparser querybuilder
import org w3c dom element
import org apache lucene util version
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
/**
* userinputquerybuilder uses 1 of 2 strategies for thread-safe parsing:
* 1) synchronizing access to "parse" calls on a previously supplied queryparser
* or..
* 2) creating a new queryparser object for each parse request
*/
public class userinputquerybuilder implements querybuilder
queryparser unsafeparser
private analyzer analyzer
private string defaultfield
/**
* this constructor has the disadvantage of not being able to change choice of default field name
* @param parser thread un-safe query parser
*/
public userinputquerybuilder queryparser parser
this unsafeparser   parser
public userinputquerybuilder string defaultfield  analyzer analyzer
this analyzer   analyzer
this defaultfield   defaultfield
/* (non-javadoc)
* @see org.apache.lucene.xmlparser.queryobjectbuilder#process(org.w3c.dom.element)
*/
public query getquery element e  throws parserexception
string text domutils gettext e
try
query q   null
if unsafeparser  null
//synchronize on unsafe parser
synchronized  unsafeparser
q   unsafeparser parse text
else
string fieldname domutils getattribute e     defaultfield
//create new parser
queryparser parser createqueryparser fieldname  analyzer
q   parser parse text
q setboost domutils getattribute e   1 0f
return q
catch  parseexception e1
throw new parserexception e1 getmessage
/**
* method to create a queryparser - designed to be overridden
* @param fieldname
* @param analyzer
* @return queryparser
*/
protected queryparser createqueryparser string fieldname  analyzer analyzer
return new queryparser version lucene_current  fieldname analyzer