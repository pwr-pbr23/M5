/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component printer
import java io inputstream
import javax print docflavor
import javax print docprintjob
import javax print printexception
import javax print printservice
import javax print printservicelookup
import javax print attribute hashprintrequestattributeset
import javax print attribute printrequestattributeset
import javax print attribute standard copies
import org apache camel endpoint
import org apache camel exchange
import org apache camel impl defaultproducer
import org apache camel util objecthelper
public class printerproducer extends defaultproducer
private final printerconfiguration config
private printeroperations printeroperations
private printservice printservice
private string printer
public printerproducer endpoint endpoint  printerconfiguration config  throws exception
super endpoint
this config   config
public void process exchange exchange  throws exception
object body   exchange getin   getbody
inputstream is   exchange getcontext   gettypeconverter   convertto inputstream class  body
print is
private void print inputstream body  throws printexception
if  printeroperations getprintservice   isdocflavorsupported printeroperations getflavor
printdocument printdoc   new printdocument body  printeroperations getflavor
printeroperations print printdoc  config getcopies    config issendtoprinter    config getmimetype
private docflavor assigndocflavor   throws exception
return config getdocflavor
private printrequestattributeset assignprintattributes   throws printexception
printrequestattributeset printrequestattributeset   new hashprintrequestattributeset
if  config getcopies   >  1
printrequestattributeset add new copies config getcopies
else
throw new printexception
printrequestattributeset add config getmediasizename
printrequestattributeset add config getinternalsides
return printrequestattributeset
private docprintjob assignprintjob printservice printservice
return printservice createprintjob
private printservice assignprintservice   throws printexception
printservice printservice
if   config gethostname   equalsignorecase
config getprintername   equalsignorecase
printservice   printservicelookup lookupdefaultprintservice
else
printservice services   printservicelookup lookupprintservices null  null
string name
if  config gethostname   equalsignorecase
// no hostname for localhost printers
name   config getprintername
else
name       config gethostname         config getprintername
log debug    name
setprinter name
int position   findprinter services  printer
if  position < 0
throw new printexception     printer
printservice   services
return printservice
private int findprinter printservice services  string printer
int position    1
for  int i   0  i < services length  i
if  printer equalsignorecase services getname
position   i
break
return position
public printerconfiguration getconfig
return config
public printeroperations getprinteroperations
return printeroperations
public void setprinteroperations printeroperations printeroperations
this printeroperations   printeroperations
public printservice getprintservice
return printservice
public void setprintservice printservice printservice
this printservice   printservice
public string getprinter
return printer
public void setprinter string printer
this printer   printer
@override
protected void dostart   throws exception
if  printservice     null
printservice   assignprintservice
objecthelper notnull printservice     this
if  printeroperations    null
printeroperations   new printeroperations printservice  assignprintjob printservice   assigndocflavor    assignprintattributes
super dostart
@override
protected void dostop   throws exception
super dostop