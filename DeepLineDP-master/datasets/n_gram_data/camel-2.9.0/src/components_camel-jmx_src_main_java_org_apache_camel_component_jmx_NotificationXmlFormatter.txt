/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component jmx
import java io stringwriter
import java util arraylist
import java util date
import java util gregoriancalendar
import java util list
import java util concurrent locks lock
import java util concurrent locks reentrantlock
import javax management attributechangenotification
import javax management mbeanservernotification
import javax management notification
import javax management objectname
import javax management monitor monitornotification
import javax management relation relationnotification
import javax management remote jmxconnectionnotification
import javax management timer timernotification
import javax xml bind jaxbcontext
import javax xml bind jaxbexception
import javax xml bind marshaller
import javax xml datatype datatypeconfigurationexception
import javax xml datatype datatypefactory
import org apache camel component jmx jaxb notificationeventtype
import org apache camel component jmx jaxb objectfactory
import org apache camel component jmx jaxb objectnamestype
/**
* converts the notification into an xml stream.
*
* @author markford
*/
public class notificationxmlformatter
private datatypefactory mdatatypefactory
private marshaller mmarshaller
private lock mmarshallerlock   new reentrantlock false
private objectfactory mobjectfactory   new objectfactory
public string format notification anotification  throws notificationformatexception
notificationeventtype jaxb   null
boolean wrap   false
if  anotification instanceof attributechangenotification
attributechangenotification ac    attributechangenotification  anotification
jaxb   mobjectfactory createattributechangenotification
withattributename ac getattributename
withattributetype ac getattributetype
withnewvalue ac getnewvalue      null ? null   string valueof ac getnewvalue
witholdvalue ac getoldvalue      null ? null   string valueof ac getoldvalue
else if  anotification instanceof jmxconnectionnotification
jaxb   mobjectfactory createjmxconnectionnotification
withconnectionid   jmxconnectionnotification  anotification  getconnectionid
else if  anotification instanceof mbeanservernotification
jaxb   mobjectfactory creatembeanservernotification
withmbeanname string valueof   mbeanservernotification  anotification  getmbeanname
else if  anotification instanceof monitornotification
monitornotification mn    monitornotification  anotification
jaxb   mobjectfactory createmonitornotification
withderivedgauge string valueof mn getderivedgauge
withobservedattribute mn getobservedattribute
withobservedobject string valueof mn getobservedobject
withtrigger string valueof mn gettrigger
else if  anotification instanceof relationnotification
relationnotification rn    relationnotification  anotification
jaxb   mobjectfactory createrelationnotification
withobjectname string valueof rn getobjectname
withrelationid rn getrelationid
withrelationtypename rn getrelationtypename
withrolename rn getrolename
if  rn getnewrolevalue      null
objectnamestype ont   toobjectnamestype rn getnewrolevalue
org apache camel component jmx jaxb relationnotification  jaxb  withnewrolevalue ont
if  rn getoldrolevalue      null
objectnamestype ont   toobjectnamestype rn getoldrolevalue
org apache camel component jmx jaxb relationnotification  jaxb  witholdrolevalue ont
if  rn getmbeanstounregister      null
objectnamestype ont   toobjectnamestype rn getmbeanstounregister
org apache camel component jmx jaxb relationnotification  jaxb  withmbeanstounregister ont
else if  anotification instanceof timernotification
jaxb   mobjectfactory createtimernotification   withnotificationid   timernotification  anotification  getnotificationid
else
jaxb   mobjectfactory createnotificationeventtype
wrap   true
// add all of the common properties
jaxb withmessage anotification getmessage
withsequence anotification getsequencenumber
withsource string valueof anotification getsource
withtimestamp anotification gettimestamp
withtype anotification gettype
if  anotification getuserdata      null
jaxb withuserdata string valueof anotification getuserdata
try
datatypefactory df   getdatatypefactory
date date   new date anotification gettimestamp
gregoriancalendar gc   new gregoriancalendar
gc settime date
jaxb withdatetime df newxmlgregoriancalendar gc
object bean   wrap ? mobjectfactory createnotificationevent jaxb    jaxb
stringwriter sw   new stringwriter
try
mmarshallerlock lock
getmarshaller mobjectfactory getclass   getpackage   getname    marshal bean  sw
finally
mmarshallerlock unlock
return sw tostring
catch  jaxbexception e
throw new notificationformatexception e
catch  datatypeconfigurationexception e
throw new notificationformatexception e
private objectnamestype toobjectnamestype list<objectname> objectnamelist
list<string> roles   tostringlist objectnamelist
objectnamestype ont   mobjectfactory createobjectnamestype
ont withobjectname roles
return ont
private datatypefactory getdatatypefactory   throws datatypeconfigurationexception
if  mdatatypefactory    null
mdatatypefactory   datatypefactory newinstance
return mdatatypefactory
private marshaller getmarshaller string apackagename  throws jaxbexception
if  mmarshaller    null
mmarshaller   jaxbcontext newinstance apackagename  createmarshaller
return mmarshaller
private list<string> tostringlist list<objectname> objectnames
list<string> roles   new arraylist<string> objectnames size
for  objectname on   objectnames
roles add on tostring
return roles