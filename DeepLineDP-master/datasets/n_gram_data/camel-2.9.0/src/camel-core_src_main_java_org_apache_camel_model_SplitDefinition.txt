/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel model
import java util concurrent executorservice
import javax xml bind annotation xmlaccesstype
import javax xml bind annotation xmlaccessortype
import javax xml bind annotation xmlattribute
import javax xml bind annotation xmlrootelement
import javax xml bind annotation xmltransient
import org apache camel expression
import org apache camel processor
import org apache camel model language expressiondefinition
import org apache camel processor splitter
import org apache camel processor subunitofworkprocessor
import org apache camel processor aggregate aggregationstrategy
import org apache camel spi executorservicemanager
import org apache camel spi routecontext
import org apache camel util camelcontexthelper
/**
* represents an xml &lt;split/&gt; element
*
* @version
*/
@xmlrootelement name
@xmlaccessortype xmlaccesstype field
public class splitdefinition extends expressionnode implements executorserviceawaredefinition<splitdefinition>
@xmltransient
private aggregationstrategy aggregationstrategy
@xmltransient
private executorservice executorservice
@xmlattribute
private boolean parallelprocessing
@xmlattribute
private string strategyref
@xmlattribute
private string executorserviceref
@xmlattribute
private boolean streaming
@xmlattribute
private boolean stoponexception
@xmlattribute
private long timeout
@xmlattribute
private string onprepareref
@xmltransient
private processor onprepare
@xmlattribute
private boolean shareunitofwork
public splitdefinition
public splitdefinition expression expression
super expression
public splitdefinition expressiondefinition expression
super expression
@override
public string tostring
return     getexpression         getoutputs
@override
public string getshortname
return
@override
public string getlabel
return     getexpression
@override
public processor createprocessor routecontext routecontext  throws exception
processor childprocessor   this createchildprocessor routecontext  true
aggregationstrategy   createaggregationstrategy routecontext
if  isparallelprocessing      executorservice    null
string ref   this executorserviceref    null ? this executorserviceref
executorservicemanager manager   routecontext getcamelcontext   getexecutorservicemanager
executorservice   manager newdefaultthreadpool this  ref
long timeout   gettimeout      null ? gettimeout     0
if  timeout > 0     isparallelprocessing
throw new illegalargumentexception
if  onprepareref    null
onprepare   camelcontexthelper mandatorylookup routecontext getcamelcontext    onprepareref  processor class
expression exp   getexpression   createexpression routecontext
splitter answer   new splitter routecontext getcamelcontext    exp  childprocessor  aggregationstrategy
isparallelprocessing    executorservice  isstreaming    isstoponexception
timeout  onprepare  isshareunitofwork
if  isshareunitofwork
// wrap answer in a sub unit of work, since we share the unit of work
return new subunitofworkprocessor answer
return answer
private aggregationstrategy createaggregationstrategy routecontext routecontext
aggregationstrategy strategy   getaggregationstrategy
if  strategy    null    strategyref    null
strategy   camelcontexthelper mandatorylookup routecontext getcamelcontext    strategyref  aggregationstrategy class
return strategy
// fluent api
// -------------------------------------------------------------------------
/**
* set the aggregationstrategy
*
* @return the builder
*/
public splitdefinition aggregationstrategy aggregationstrategy aggregationstrategy
setaggregationstrategy aggregationstrategy
return this
/**
* set the aggregationstrategy
*
* @param aggregationstrategyref a reference to a strategy to lookup
* @return the builder
*/
public splitdefinition aggregationstrategyref string aggregationstrategyref
setstrategyref aggregationstrategyref
return this
/**
* doing the splitting work in parallel
*
* @return the builder
*/
public splitdefinition parallelprocessing
setparallelprocessing true
return this
/**
* enables streaming.
* see {@link org.apache.camel.model.splitdefinition#isstreaming()} for more information
*
* @return the builder
*/
public splitdefinition streaming
setstreaming true
return this
/**
* will now stop further processing if an exception or failure occurred during processing of an
* {@link org.apache.camel.exchange} and the caused exception will be thrown.
* <p/>
* will also stop if processing the exchange failed (has a fault message) or an exception
* was thrown and handled by the error handler (such as using onexception). in all situations
* the splitter will stop further processing. this is the same behavior as in pipeline, which
* is used by the routing engine.
* <p/>
* the default behavior is to <b>not</b> stop but continue processing till the end
*
* @return the builder
*/
public splitdefinition stoponexception
setstoponexception true
return this
public splitdefinition executorservice executorservice executorservice
setexecutorservice executorservice
return this
public splitdefinition executorserviceref string executorserviceref
setexecutorserviceref executorserviceref
return this
/**
* uses the {@link processor} when preparing the {@link org.apache.camel.exchange} to be send.
* this can be used to deep-clone messages that should be send, or any custom logic needed before
* the exchange is send.
*
* @param onprepare the processor
* @return the builder
*/
public splitdefinition onprepare processor onprepare
setonprepare onprepare
return this
/**
* uses the {@link processor} when preparing the {@link org.apache.camel.exchange} to be send.
* this can be used to deep-clone messages that should be send, or any custom logic needed before
* the exchange is send.
*
* @param onprepareref reference to the processor to lookup in the {@link org.apache.camel.spi.registry}
* @return the builder
*/
public splitdefinition onprepareref string onprepareref
setonprepareref onprepareref
return this
/**
* sets a timeout value in millis to use when using parallelprocessing.
*
* @param timeout timeout in millis
* @return the builder
*/
public splitdefinition timeout long timeout
settimeout timeout
return this
/**
* shares the {@link org.apache.camel.spi.unitofwork} with the parent and each of the sub messages.
*
* @return the builder.
* @see org.apache.camel.spi.subunitofwork
*/
public splitdefinition shareunitofwork
setshareunitofwork true
return this
// properties
//-------------------------------------------------------------------------
public aggregationstrategy getaggregationstrategy
return aggregationstrategy
public void setaggregationstrategy aggregationstrategy aggregationstrategy
this aggregationstrategy   aggregationstrategy
public boolean getparallelprocessing
return parallelprocessing
public void setparallelprocessing boolean parallelprocessing
this parallelprocessing   parallelprocessing
public boolean isparallelprocessing
return parallelprocessing    null    parallelprocessing
public boolean getstreaming
return streaming
public void setstreaming boolean streaming
this streaming   streaming
/**
* the splitter should use streaming -- exchanges are being sent as the data for them becomes available.
* this improves throughput and memory usage, but it has a drawback:
* - the sent exchanges will no longer contain the {@link org.apache.camel.exchange#split_size} header property
*
* @return whether or not streaming should be used
*/
public boolean isstreaming
return streaming    null    streaming
public boolean getstoponexception
return stoponexception
public void setstoponexception boolean stoponexception
this stoponexception   stoponexception
public boolean isstoponexception
return stoponexception    null    stoponexception
public executorservice getexecutorservice
return executorservice
public void setexecutorservice executorservice executorservice
this executorservice   executorservice
public string getstrategyref
return strategyref
public void setstrategyref string strategyref
this strategyref   strategyref
public string getexecutorserviceref
return executorserviceref
public void setexecutorserviceref string executorserviceref
this executorserviceref   executorserviceref
public long gettimeout
return timeout
public void settimeout long timeout
this timeout   timeout
public string getonprepareref
return onprepareref
public void setonprepareref string onprepareref
this onprepareref   onprepareref
public processor getonprepare
return onprepare
public void setonprepare processor onprepare
this onprepare   onprepare
public boolean getshareunitofwork
return shareunitofwork
public void setshareunitofwork boolean shareunitofwork
this shareunitofwork   shareunitofwork
public boolean isshareunitofwork
return shareunitofwork    null    shareunitofwork