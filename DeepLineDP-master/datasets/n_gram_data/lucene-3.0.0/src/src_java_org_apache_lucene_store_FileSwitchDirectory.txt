package org apache lucene store
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java io ioexception
import java util set
/**
* expert: a directory instance that switches files between
* two other directory instances.
* <p>files with the specified extensions are placed in the
* primary directory; others are placed in the secondary
* directory.  the provided set must not change once passed
* to this class, and must allow multiple threads to call
* contains at once.</p>
*
* <p><b>note</b>: this api is new and experimental and is
* subject to suddenly change in the next release.
*/
public class fileswitchdirectory extends directory
private final directory secondarydir
private final directory primarydir
private final set<string> primaryextensions
private boolean doclose
public fileswitchdirectory set<string> primaryextensions  directory primarydir  directory secondarydir  boolean doclose
this primaryextensions   primaryextensions
this primarydir   primarydir
this secondarydir   secondarydir
this doclose   doclose
this lockfactory   primarydir getlockfactory
/** return the primary directory */
public directory getprimarydir
return primarydir
/** return the secondary directory */
public directory getsecondarydir
return secondarydir
@override
public void close   throws ioexception
if  doclose
try
secondarydir close
finally
primarydir close
doclose   false
@override
public string listall   throws ioexception
string primaryfiles   primarydir listall
string secondaryfiles   secondarydir listall
string files   new string
system arraycopy primaryfiles  0  files  0  primaryfiles length
system arraycopy secondaryfiles  0  files  primaryfiles length  secondaryfiles length
return files
/** utility method to return a file's extension. */
public static string getextension string name
int i   name lastindexof
if  i     1
return
return name substring i 1  name length
private directory getdirectory string name
string ext   getextension name
if  primaryextensions contains ext
return primarydir
else
return secondarydir
@override
public boolean fileexists string name  throws ioexception
return getdirectory name  fileexists name
@override
public long filemodified string name  throws ioexception
return getdirectory name  filemodified name
@override
public void touchfile string name  throws ioexception
getdirectory name  touchfile name
@override
public void deletefile string name  throws ioexception
getdirectory name  deletefile name
@override
public long filelength string name  throws ioexception
return getdirectory name  filelength name
@override
public indexoutput createoutput string name  throws ioexception
return getdirectory name  createoutput name
@override
public void sync string name  throws ioexception
getdirectory name  sync name
@override
public indexinput openinput string name  throws ioexception
return getdirectory name  openinput name