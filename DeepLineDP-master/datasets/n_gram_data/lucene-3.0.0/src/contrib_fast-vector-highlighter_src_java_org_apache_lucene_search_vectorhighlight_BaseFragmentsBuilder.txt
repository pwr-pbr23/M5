package org apache lucene search vectorhighlight
/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
import java io ioexception
import java util arraylist
import java util list
import org apache lucene document document
import org apache lucene document mapfieldselector
import org apache lucene index indexreader
import org apache lucene search vectorhighlight fieldfraglist weightedfraginfo
import org apache lucene search vectorhighlight fieldfraglist weightedfraginfo subinfo
import org apache lucene search vectorhighlight fieldphraselist weightedphraseinfo toffs
public abstract class basefragmentsbuilder implements fragmentsbuilder
protected string pretags  posttags
public static final string colored_pre_tags
background yellow     background lawngreen     background aquamarine
background magenta     background palegreen     background coral
background wheat     background khaki     background lime
background deepskyblue
public static final string colored_post_tags
protected basefragmentsbuilder
this  new string       new string
protected basefragmentsbuilder  string pretags  string posttags
this pretags   pretags
this posttags   posttags
static object checktagsargument  object tags
if  tags instanceof string   return tags
else if  tags instanceof string   return tags
throw new illegalargumentexception
public abstract list<weightedfraginfo> getweightedfraginfolist  list<weightedfraginfo> src
public string createfragment  indexreader reader  int docid
string fieldname  fieldfraglist fieldfraglist   throws ioexception
string fragments   createfragments  reader  docid  fieldname  fieldfraglist  1
if  fragments    null    fragments length    0   return null
return fragments
public string createfragments  indexreader reader  int docid
string fieldname  fieldfraglist fieldfraglist  int maxnumfragments
throws ioexception
if  maxnumfragments < 0
throw new illegalargumentexception      maxnumfragments
list<weightedfraginfo> fraginfos   getweightedfraginfolist  fieldfraglist fraginfos
list<string> fragments   new arraylist<string>  maxnumfragments
string values   getfieldvalues  reader  docid  fieldname
if  values length    0   return null
stringbuilder buffer   new stringbuilder
int nextvalueindex     0
for  int n   0  n < maxnumfragments    n < fraginfos size    n
weightedfraginfo fraginfo   fraginfos get  n
fragments add  makefragment  buffer  nextvalueindex  values  fraginfo
return fragments toarray  new string
protected string getfieldvalues  indexreader reader  int docid  string fieldname  throws ioexception
document doc   reader document  docid  new mapfieldselector  new string  fieldname
return doc getvalues  fieldname       according to document class javadoc  this never returns null
protected string makefragment  stringbuilder buffer  int index  string values  weightedfraginfo fraginfo
stringbuilder fragment   new stringbuilder
final int s   fraginfo startoffset
string src   getfragmentsource  buffer  index  values  s  fraginfo endoffset
int srcindex   0
for  subinfo subinfo   fraginfo subinfos
for  toffs to   subinfo termsoffsets
fragment append  src substring  srcindex  to startoffset   s     append  getpretag  subinfo seqnum
append  src substring  to startoffset   s  to endoffset   s     append  getposttag  subinfo seqnum
srcindex   to endoffset   s
fragment append  src substring  srcindex
return fragment tostring
protected string getfragmentsource  stringbuilder buffer  int index  string values
int startoffset  int endoffset
while  buffer length   < endoffset    index < values length
if  index > 0    values] length   > 0
buffer append
buffer append  values  ]
int eo   buffer length   < endoffset ? buffer length     endoffset
return buffer substring  startoffset  eo
protected string getpretag  int num
return pretags length > num ? pretags   pretags
protected string getposttag  int num
return posttags length > num ? posttags   posttags