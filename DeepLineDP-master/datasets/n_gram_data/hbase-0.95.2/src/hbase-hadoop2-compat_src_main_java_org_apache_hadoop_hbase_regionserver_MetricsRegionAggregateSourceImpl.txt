/**
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase regionserver
import org apache hadoop hbase metrics basesourceimpl
import org apache hadoop metrics2 metricscollector
import org apache hadoop metrics2 metricsrecordbuilder
import java util treeset
import java util concurrent locks reentrantreadwritelock
public class metricsregionaggregatesourceimpl extends basesourceimpl
implements metricsregionaggregatesource
// lock to guard against concurrent access to regionsources
private final reentrantreadwritelock lock   new reentrantreadwritelock
private final treeset<metricsregionsourceimpl> regionsources
new treeset<metricsregionsourceimpl>
public metricsregionaggregatesourceimpl
this metrics_name  metrics_description  metrics_context  metrics_jmx_context
public metricsregionaggregatesourceimpl string metricsname
string metricsdescription
string metricscontext
string metricsjmxcontext
super metricsname  metricsdescription  metricscontext  metricsjmxcontext
@override
public void register metricsregionsource source
lock writelock   lock
try
regionsources add  metricsregionsourceimpl  source
finally
lock writelock   unlock
@override
public void deregister metricsregionsource source
lock writelock   lock
try
regionsources remove source
finally
lock writelock   unlock
/**
* yes this is a get function that doesn't return anything.  thanks hadoop for breaking all
* expectations of java programmers.  instead of returning anything hadoop metrics expects
* getmetrics to push the metrics into the collector.
*
* @param collector the collector
* @param all       get all the metrics regardless of when they last changed.
*/
@override
public void getmetrics metricscollector collector  boolean all
metricsrecordbuilder mrb   collector addrecord metricsname
setcontext metricscontext
if  regionsources    null
lock readlock   lock
try
for  metricsregionsourceimpl regionmetricsource   regionsources
regionmetricsource snapshot mrb  all
finally
lock readlock   unlock
metricsregistry snapshot mrb  all