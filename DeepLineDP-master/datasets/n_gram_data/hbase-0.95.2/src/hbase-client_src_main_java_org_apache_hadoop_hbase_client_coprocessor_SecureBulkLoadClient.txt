/*
* licensed to the apache software foundation (asf) under one
* or more contributor license agreements.  see the notice file
* distributed with this work for additional information
* regarding copyright ownership.  the asf licenses this file
* to you under the apache license, version 2.0 (the
* "license"); you may not use this file except in compliance
* with the license.  you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache hadoop hbase client coprocessor
import com google protobuf bytestring
import org apache hadoop fs path
import org apache hadoop hbase tablename
import org apache hadoop hbase hconstants
import org apache hadoop hbase client htable
import org apache hadoop hbase ipc blockingrpccallback
import org apache hadoop hbase ipc serverrpccontroller
import org apache hadoop hbase protobuf protobufutil
import org apache hadoop hbase protobuf generated clientprotos
import org apache hadoop hbase protobuf generated securebulkloadprotos
import org apache hadoop hbase security securebulkloadutil
import org apache hadoop hbase util pair
import org apache hadoop security token token
import java io ioexception
import java util arraylist
import java util list
/**
* client proxy for securebulkloadprotocol
* used in conjunction with securebulkloadendpoint
*/
public class securebulkloadclient
private htable table
public securebulkloadclient htable table
this table   table
public string preparebulkload final tablename tablename  throws ioexception
try
return
table coprocessorservice securebulkloadprotos securebulkloadservice class
hconstants empty_start_row
hconstants empty_start_row
new batch call<securebulkloadprotos securebulkloadservice string>
@override
public string call securebulkloadprotos securebulkloadservice instance  throws ioexception
serverrpccontroller controller   new serverrpccontroller
blockingrpccallback<securebulkloadprotos preparebulkloadresponse> rpccallback
new blockingrpccallback<securebulkloadprotos preparebulkloadresponse>
securebulkloadprotos preparebulkloadrequest request
securebulkloadprotos preparebulkloadrequest newbuilder
settablename protobufutil toprototablename tablename   build
instance preparebulkload controller
request
rpccallback
securebulkloadprotos preparebulkloadresponse response   rpccallback get
if  controller failedonexception
throw controller getfailedon
return response getbulktoken
entryset   iterator   next   getvalue
catch  throwable throwable
throw new ioexception throwable
public void cleanupbulkload final string bulktoken  throws ioexception
try
table coprocessorservice securebulkloadprotos securebulkloadservice class
hconstants empty_start_row
hconstants empty_start_row
new batch call<securebulkloadprotos securebulkloadservice  string>
@override
public string call securebulkloadprotos securebulkloadservice instance  throws ioexception
serverrpccontroller controller   new serverrpccontroller
blockingrpccallback<securebulkloadprotos cleanupbulkloadresponse> rpccallback
new blockingrpccallback<securebulkloadprotos cleanupbulkloadresponse>
securebulkloadprotos cleanupbulkloadrequest request
securebulkloadprotos cleanupbulkloadrequest newbuilder
setbulktoken bulktoken  build
instance cleanupbulkload controller
request
rpccallback
if  controller failedonexception
throw controller getfailedon
return null
catch  throwable throwable
throw new ioexception throwable
public boolean bulkloadhfiles final list<pair<byte  string>> familypaths
final token<?> usertoken
final string bulktoken
final byte startrow  throws ioexception
try
return
table coprocessorservice securebulkloadprotos securebulkloadservice class
startrow
startrow
new batch call<securebulkloadprotos securebulkloadservice boolean>
@override
public boolean call securebulkloadprotos securebulkloadservice instance  throws ioexception
securebulkloadprotos delegationtokenproto protodt
securebulkloadprotos delegationtokenproto newbuilder   build
if usertoken    null
protodt
securebulkloadprotos delegationtokenproto newbuilder
setidentifier bytestring copyfrom usertoken getidentifier
setpassword bytestring copyfrom usertoken getpassword
setkind usertoken getkind   tostring
setservice usertoken getservice   tostring    build
list<clientprotos bulkloadhfilerequest familypath> protofamilypaths
new arraylist<clientprotos bulkloadhfilerequest familypath>
for pair<byte  string> el  familypaths
protofamilypaths add clientprotos bulkloadhfilerequest familypath newbuilder
setfamily bytestring copyfrom el getfirst
setpath el getsecond    build
securebulkloadprotos securebulkloadhfilesrequest request
securebulkloadprotos securebulkloadhfilesrequest newbuilder
setfstoken protodt
addallfamilypath protofamilypaths
setbulktoken bulktoken  build
serverrpccontroller controller   new serverrpccontroller
blockingrpccallback<securebulkloadprotos securebulkloadhfilesresponse> rpccallback
new blockingrpccallback<securebulkloadprotos securebulkloadhfilesresponse>
instance securebulkloadhfiles controller
request
rpccallback
securebulkloadprotos securebulkloadhfilesresponse response   rpccallback get
if  controller failedonexception
throw controller getfailedon
return response getloaded
entryset   iterator   next   getvalue
catch  throwable throwable
throw new ioexception throwable
public path getstagingpath string bulktoken  byte family  throws ioexception
return securebulkloadutil getstagingpath table getconfiguration    bulktoken  family