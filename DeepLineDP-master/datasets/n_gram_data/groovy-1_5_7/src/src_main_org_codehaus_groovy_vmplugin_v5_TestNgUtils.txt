/*
* copyright 2003-2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org codehaus groovy vmplugin v5
import groovy lang groovyclassloader
import groovy lang groovyruntimeexception
import org codehaus groovy runtime invokerhelper
import java lang annotation annotation
import java lang reflect method
/**
* java 5 code for working with testng tests.
*
* @author paul king
*
*/
public class testngutils
/**
* utility method to check via reflection if the parsed class appears to be a testng test.
*
* @param scriptclass the class we want to check
* @param loader the groovyclassloader to use to find classes
* @return true if the class appears to be a test
*/
static boolean realistestngtest class scriptclass  groovyclassloader loader
// check if there are appropriate class or method annotations
// that suggest we have a testng test
boolean istest   false
try
try
class testannotationclass   loader loadclass
method methods   scriptclass getmethods
for  int i   0  i < methods length  i
method method   methods
annotation annotation   method getannotation testannotationclass
if  annotation    null
istest   true
break
catch  classnotfoundexception e
// fall through
catch  throwable e
// fall through
return istest ? boolean true   boolean false
/**
* utility method to run a testng test.
*
* @param scriptclass the class we want to run as a test
* @return the result of running the test
*/
static object realruntestngtest class scriptclass
// invoke through reflection to eliminate mandatory testng jar dependency
try
object testng   invokerhelper invokeconstructorof    new object
invokerhelper invokemethod testng     new object scriptclass
object listener   invokerhelper invokeconstructorof    new object
invokerhelper invokemethod testng     new object listener
object result   invokerhelper invokemethod testng     new object
return result
catch  classnotfoundexception e
throw new groovyruntimeexception