/*
* copyright 2003-2008 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package groovy util
import groovy lang delegatingmetaclass
import groovy lang groovysystem
import groovy lang metaclass
import groovy xml qname
import java util arraylist
import java util collection
import java util iterator
import java util list
/**
* a list implementation which is returned by queries on a {@link node}
* which provides some xpath like helper methods for gpath.
*
* @author <a href="mailto:james@coredevelopers.net">james strachan</a>
* @author paul king
*/
public class nodelist extends arraylist
static
// wrap the standard metaclass with the delegate
setmetaclass groovysystem getmetaclassregistry   getmetaclass nodelist class
public nodelist
public nodelist collection collection
super collection
public nodelist int size
super size
private static void setmetaclass final metaclass metaclass
final metaclass newmetaclass   new delegatingmetaclass metaclass
/* (non-javadoc)
* @see groovy.lang.delegatingmetaclass#getattribute(java.lang.object, java.lang.string)
*/
public object getattribute final object object  final string attribute
nodelist nl    nodelist  object
iterator it   nl iterator
list result   new arraylist
while  it hasnext
node node    node  it next
result add node attributes   get attribute
return result
public void setattribute final object object  final string attribute  final object newvalue
nodelist nl    nodelist  object
iterator it   nl iterator
while  it hasnext
node node    node  it next
node attributes   put attribute  newvalue
/* (non-javadoc)
* @see groovy.lang.metaclass#getproperty(java.lang.object, java.lang.string)
*/
public object getproperty object object  string property
if  object instanceof nodelist
nodelist nl    nodelist  object
return nl getat property
return super getproperty object  property
groovysystem getmetaclassregistry   setmetaclass nodelist class  newmetaclass
/**
* provides lookup of elements by non-namespaced name.
*
* @param name the name or shortcut key for nodes of interest
* @return the nodes of interest which match name
*/
public nodelist getat string name
nodelist answer   new nodelist
for  iterator iter   iterator    iter hasnext
object child   iter next
if  child instanceof node
node childnode    node  child
object temp   childnode get name
if  temp instanceof collection
answer addall  collection  temp
else
answer add temp
return answer
/**
* provides lookup of elements by qname.
*
* @param name the name or shortcut key for nodes of interest
* @return the nodes of interest which match name
*/
public nodelist getat qname name
nodelist answer   new nodelist
for  iterator iter   iterator    iter hasnext
object child   iter next
if  child instanceof node
node childnode    node  child
nodelist temp   childnode getat name
answer addall temp
return answer
/**
* returns the text value of all of the elements in the collection.
*
* @return the text value of all the elements in the collection or null
*/
public string text
string previoustext   null
stringbuffer buffer   null
for  iterator iter   this iterator    iter hasnext
object child   iter next
string text   null
if  child instanceof string
text    string  child
else if  child instanceof node
text     node  child  text
if  text    null
if  previoustext    null
previoustext   text
else
if  buffer    null
buffer   new stringbuffer
buffer append previoustext
buffer append text
if  buffer    null
return buffer tostring
if  previoustext    null
return previoustext
return