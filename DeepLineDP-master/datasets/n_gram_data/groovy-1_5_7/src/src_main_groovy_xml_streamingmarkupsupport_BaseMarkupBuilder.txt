/*
* copyright 2003-2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package groovy xml streamingmarkupsupport
import groovy lang closure
import groovy lang groovyinterceptable
import groovy lang groovyobjectsupport
import java util collections
import java util hashmap
import java util map
public class basemarkupbuilder extends builder
public basemarkupbuilder final map namespacemethodmap
super namespacemethodmap
public object bind final closure root
return new document root  this namespacemethodmap
private static class document extends built implements groovyinterceptable
private object out
private final map pendingnamespaces   new hashmap
private final map namespaces   new hashmap
private final map specialproperties   new hashmap
private string prefix
namespaces put                       built in namespace
namespaces put             pseudo namespace for markup keywords
specialproperties put    new outputsink
public object leftshift final object value
return leftshift    value
specialproperties put    new outputsink
public object leftshift final object value
return leftshift    value
specialproperties put    new outputsink
public object leftshift final object value
return leftshift    value
specialproperties put    new outputsink
public object leftshift final object value
return leftshift    value
specialproperties put    new outputsink
public object leftshift final object value
return leftshift    value
private abstract class outputsink extends groovyobjectsupport
private final string name
public outputsink final string name
this name   name
public object invokemethod final string name  final object args
document this prefix   this name
return document this invokemethod name  args
public abstract object leftshift object item
protected object leftshift final string command  final object value
document this getproperty
document this invokemethod command  new object value
return this
public document final closure root  final map namespacemethodmap
super root  namespacemethodmap
/* (non-javadoc)
* @see groovy.lang.groovyobject#invokemethod(java.lang.string, java.lang.object)
*/
public object invokemethod final string name  final object args
final object arguments    object  args
map attrs   collections empty_map
object body   null
//
// sort the parameters out
//
for  int i   0  i    arguments length  i
final object arg   arguments
if  arg instanceof map
attrs    map  arg
else if  arg instanceof closure
final closure c     closure  arg
c setdelegate this
body   c aswritable
else
body   arg
//
// call the closure corresponding to the tag
//
final object uri
if  this pendingnamespaces containskey this prefix
uri   this pendingnamespaces get this prefix
else if  this namespaces containskey this prefix
uri   this namespaces get this prefix
else
uri
final object info    object  this namespacespecifictags get uri
final map tagmap    map  info
final closure defaulttagclosure    closure  info
final string prefix   this prefix
this prefix
if  tagmap containskey name
return   closure  tagmap get name   call new object this  this pendingnamespaces  this namespaces  this namespacespecifictags  prefix  attrs  body  this out
else
return defaulttagclosure call new object name  this  this pendingnamespaces  this namespaces  this namespacespecifictags  prefix  attrs  body  this out
/* (non-javadoc)
* @see groovy.lang.groovyobject#getproperty(java.lang.string)
*/
public object getproperty final string property
final object special   this specialproperties get property
if  special    null
this prefix   property
return this
else
return special
/* (non-javadoc)
* @see groovy.lang.groovyobject#setproperty(java.lang.string, java.lang.object)
*/
public void setproperty string property  object newvalue
if    equals property
this out   newvalue
this root call this
else
super setproperty property  newvalue