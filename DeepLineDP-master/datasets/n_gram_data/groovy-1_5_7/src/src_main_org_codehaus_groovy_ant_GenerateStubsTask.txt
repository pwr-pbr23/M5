/*
* copyright 2003-2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org codehaus groovy ant
import groovy lang groovyclassloader
import org apache tools ant buildexception
import org apache tools ant directoryscanner
import org codehaus groovy control phases
import org codehaus groovy tools javac javastubcompilationunit
import java io file
/**
* generates java stubs from groovy sources.
*
* @version $id$
* @author <a href="mailto:jason@planet57.com">jason dillon</a>
*/
public class generatestubstask
extends compiletasksupport
protected void compile
groovyclassloader gcl   createclassloader
javastubcompilationunit compilation   new javastubcompilationunit config  gcl  destdir
int count   0
string list   src list
for  int i   0  i < list length  i
file basedir   getproject   resolvefile list
if   basedir exists
throw new buildexception     basedir  getlocation
directoryscanner scanner   getdirectoryscanner basedir
string includes   scanner getincludedfiles
log debug     basedir
for  int j 0  j < includes length  j
log debug      includes
file file   new file basedir  includes
compilation addsourcefile file
// increment the count for each non/java src we found
if   includes endswith
count
if  count > 0
log info     count        count > 1 ?              destdir
// generate the stubs
compilation compile phases conversion
else
log info