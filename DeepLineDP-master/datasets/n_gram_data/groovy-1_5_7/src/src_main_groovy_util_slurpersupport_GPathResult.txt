/*
* copyright 2003-2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package groovy util slurpersupport
import groovy lang buildable
import groovy lang closure
import groovy lang delegatingmetaclass
import groovy lang gstring
import groovy lang groovyobject
import groovy lang groovyobjectsupport
import groovy lang groovyruntimeexception
import groovy lang intrange
import groovy lang metaclass
import groovy lang writable
import java math bigdecimal
import java math biginteger
import java net malformedurlexception
import java net uri
import java net urisyntaxexception
import java net url
import java util arraylist
import java util hashmap
import java util iterator
import java util linkedlist
import java util list
import java util map
import java util stack
import org codehaus groovy runtime defaultgroovymethods
/**
* @author john wilson
*/
public abstract class gpathresult extends groovyobjectsupport implements writable  buildable
protected final gpathresult parent
protected final string name
protected final string namespaceprefix
protected final map namespacemap   new hashmap
protected final map namespacetaghints
/**
* @param parent
* @param name
* @param namespaceprefix
* @param namespacetaghints
*/
public gpathresult final gpathresult parent  final string name  final string namespaceprefix  final map namespacetaghints
if  parent    null
// we are the top of the tree
this parent   this
this namespacemap put            the xml namespace is always defined
else
this parent   parent
this namespacemap putall parent namespacemap
this name   name
this namespaceprefix   namespaceprefix
this namespacetaghints   namespacetaghints
setmetaclass getmetaclass        wrap the standard metaclass with the delegate
/* (non-javadoc)
* @see groovy.lang.groovyobjectsupport#setmetaclass(groovy.lang.metaclass)
*/
public void setmetaclass final metaclass metaclass
final metaclass newmetaclass   new delegatingmetaclass metaclass
/* (non-javadoc)
* @see groovy.lang.delegatingmetaclass#getattribute(java.lang.object, java.lang.string)
*/
public object getattribute final object object  final string attribute
return gpathresult this getproperty     attribute
public void setattribute final object object  final string attribute  final object newvalue
gpathresult this setproperty     attribute  newvalue
super setmetaclass newmetaclass
public object getproperty final string property
if    equals property
return parent
else if    equals property
return children
else if    equals property
return depthfirst
else if  property startswith
if  property indexof        1
final int i   property indexof
return new attributes this      property substring i   1   property substring 1  i   this namespacetaghints
else
return new attributes this  property  this namespacetaghints
else
if  property indexof        1
final int i   property indexof
return new nodechildren this  property substring i   1   property substring 0  i   this namespacetaghints
else
return new nodechildren this  property  this namespacetaghints
public void setproperty final string property  final object newvalue
if  property startswith
if  newvalue instanceof string    newvalue instanceof gstring
final iterator iter   iterator
while  iter hasnext
final nodechild child    nodechild iter next
child attributes   put property substring 1   newvalue
else
final gpathresult result   new nodechildren this  property  this namespacetaghints
if  newvalue instanceof map
final iterator iter     map newvalue  entryset   iterator
while  iter hasnext
final map entry entry    map entry iter next
result setproperty     entry getkey    entry getvalue
else
if  newvalue instanceof closure
result replacenode  closure newvalue
else
result replacebody newvalue
public object leftshift final object newvalue
appendnode newvalue
return this
public object plus final object newvalue
this replacenode new closure this
public void docall object args
final groovyobject delegate    groovyobject getdelegate
delegate getproperty
delegate invokemethod    args
delegate getproperty
delegate invokemethod    new object newvalue
return this
protected abstract void replacenode closure newvalue
protected abstract void replacebody object newvalue
protected abstract void appendnode object newvalue
public string name
return this name
public gpathresult parent
return this parent
public gpathresult children
return new nodechildren this  this namespacetaghints
public string lookupnamespace final string prefix
return  string this namespacetaghints get prefix
public string tostring
return text
public integer tointeger
return defaultgroovymethods tointeger text
public long tolong
return defaultgroovymethods tolong text
public float tofloat
return defaultgroovymethods tofloat text
public double todouble
return defaultgroovymethods todouble text
public bigdecimal tobigdecimal
return defaultgroovymethods tobigdecimal text
public biginteger tobiginteger
return defaultgroovymethods tobiginteger text
public url tourl   throws malformedurlexception
return defaultgroovymethods tourl text
public uri touri   throws urisyntaxexception
return defaultgroovymethods touri text
public boolean toboolean
return defaultgroovymethods toboolean text
public gpathresult declarenamespace final map newnamespacemapping
this namespacemap putall newnamespacemapping
return this
/* (non-javadoc)
* @see java.lang.object#equals(java.lang.object)
*/
public boolean equals object obj
return text   equals obj tostring
public object getat final int index
if  index < 0  throw new arrayindexoutofboundsexception index
final iterator iter   iterator
int count   0
while  iter hasnext
if  count      index
return iter next
else
iter next
return new nochildren this  this name  this namespacetaghints
public object getat final intrange range
final int from   range getfromint
final int to   range gettoint
if  range isreverse
throw new groovyruntimeexception    to       from
else if  from < 0    to < 0
throw new groovyruntimeexception    from       to
else
return new iterator
final iterator iter   iterator
object next
int count   0
public boolean hasnext
if  count <  to
while  iter hasnext
if  count   >  from
this next   iter next
return true
else
iter next
return false
public object next
return next
public void remove
throw new unsupportedoperationexception
public void putat final int index  final object newvalue
final gpathresult result    gpathresult getat index
if  newvalue instanceof closure
result replacenode  closure newvalue
else
result replacebody newvalue
public iterator depthfirst
return new iterator
private final list list   new linkedlist
private final stack stack   new stack
private iterator iter   iterator
private gpathresult next   getnextbydepth
public boolean hasnext
return this next    null
public object next
try
return this next
finally
this next   getnextbydepth
public void remove
throw new unsupportedoperationexception
private gpathresult getnextbydepth
while  this iter hasnext
final gpathresult node    gpathresult  this iter next
this list add node
this stack push this iter
this iter   node children   iterator
if  this list isempty
return null
else
gpathresult result    gpathresult  this list get 0
this list remove 0
this iter    iterator  this stack pop
return result
/**
* an iterator useful for traversing xml documents/fragments in breadth-first order.
*
* @return iterator the iterator of gpathresult objects
*/
public iterator breadthfirst
return new iterator
private final list list   new linkedlist
private iterator iter   iterator
private gpathresult next   getnextbybreadth
public boolean hasnext
return this next    null
public object next
try
return this next
finally
this next   getnextbybreadth
public void remove
throw new unsupportedoperationexception
private gpathresult getnextbybreadth
list children   new arraylist
while  this iter hasnext       children isempty
if  this iter hasnext
final gpathresult node    gpathresult  this iter next
this list add node
this list add this iter
children add node children
else
list nextlevel   new arraylist
for  int i   0  i < children size    i
gpathresult next    gpathresult  children get i
iterator iterator   next iterator
while  iterator hasnext
nextlevel add iterator next
this iter   nextlevel iterator
children   new arraylist
if  this list isempty
return null
else
gpathresult result    gpathresult  this list get 0
this list remove 0
this iter    iterator  this list get 0
this list remove 0
return result
public list list
final iterator iter   nodeiterator
final list result   new linkedlist
while  iter hasnext
result add new nodechild  node  iter next    this parent  this namespaceprefix  this namespacetaghints
return result
public boolean isempty
return size      0
public closure getbody
return new closure this parent   this
public void docall object args
final groovyobject delegate    groovyobject getdelegate
final gpathresult thisobject    gpathresult getthisobject
node node    node thisobject getat 0
list children   node children
for int i 0   i<children size    i
object child   children get i
delegate getproperty
if child instanceof node
delegate invokemethod    new object new nodechild  node child  thisobject   null
else
delegate invokemethod    new object child
public abstract int size
public abstract string text
public abstract gpathresult parents
public abstract iterator childnodes
public abstract iterator iterator
public abstract gpathresult find closure closure
public abstract gpathresult findall closure closure
public abstract iterator nodeiterator