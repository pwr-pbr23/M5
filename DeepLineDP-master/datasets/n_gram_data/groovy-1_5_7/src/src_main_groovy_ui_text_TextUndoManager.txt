/*
* copyright 2003-2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package groovy ui text
import java beans propertychangelistener
import javax swing event swingpropertychangesupport
import javax swing event undoableeditevent
import javax swing undo compoundedit
import javax swing undo undomanager
import javax swing undo undoableedit
/**
* to use this, simply drop this as an undoableeditlistener into your document,
* and then create actions to call undo/redo as needed (checking can undo/redo
* first, of course).
*
* @author evan "hippy" slatis
*/
public class textundomanager extends undomanager
private swingpropertychangesupport propchangesupport
new swingpropertychangesupport this
private structurededit compoundedit   new structurededit
private long firstmodified
private undoableedit modificationmarker   edittobeundone
/**
* creates a new instance of textundomanager.
*/
public textundomanager
public void addpropertychangelistener propertychangelistener pcl
propchangesupport addpropertychangelistener pcl
public void die
boolean undoable   canundo
super die
firepropertychangeevent undomanager undoname  undoable  canundo
public void discardalledits
boolean undoable   canundo
boolean redoable   canredo
boolean changed   haschanged
super discardalledits
modificationmarker   edittobeundone
firepropertychangeevent undomanager undoname  undoable  canundo
firepropertychangeevent undomanager undoname  redoable  canredo
protected void firepropertychangeevent string name
boolean oldvalue
boolean newvalue
propchangesupport firepropertychange name  oldvalue  newvalue
public boolean haschanged
return modificationmarker    edittobeundone
public void redo   throws javax swing undo cannotredoexception
compoundedit end
if  firstmodified    0
firstmodified     structurededit edittoberedone    editedtime
boolean undoable   canundo
boolean changed   haschanged
super redo
firepropertychangeevent undomanager undoname  undoable  canundo
protected void redoto undoableedit edit
compoundedit end
if  firstmodified    0
firstmodified     structurededit edittoberedone    editedtime
boolean undoable   canundo
boolean changed   haschanged
super redoto edit
firepropertychangeevent undomanager undoname  undoable  canundo
public void removepropertychangelistener propertychangelistener pcl
propchangesupport removepropertychangelistener pcl
public void reset
boolean changed   modificationmarker    edittobeundone
if  changed
modificationmarker   edittobeundone
protected void trimedits int from  int to
boolean undoable   canundo
boolean redoable   canredo
boolean changed   haschanged
super trimedits from  to
firepropertychangeevent undomanager undoname  undoable  canundo
firepropertychangeevent undomanager redoname  redoable  canredo
public void undo   throws javax swing undo cannotundoexception
compoundedit end
undoableedit edit   edittobeundone
if    structurededit edittobeundone    editedtime
firstmodified
firstmodified   0
else if  firstmodified    0
firstmodified     structurededit edittobeundone    editedtime
boolean redoable   canredo
boolean changed   haschanged
super undo
firepropertychangeevent undomanager redoname  redoable  canredo
public void undoableedithappened undoableeditevent uee
undoableedit edit   uee getedit
boolean undoable   canundo
long edittime   system currenttimemillis
if  firstmodified    0
edittime   compoundedit editedtime   > 700
compoundedit end
compoundedit   new structurededit
compoundedit addedit edit
firstmodified   firstmodified    0 ?
compoundedit editedtime     firstmodified
if  lastedit      compoundedit
boolean changed   haschanged
addedit compoundedit
firepropertychangeevent undomanager undoname  undoable  canundo
private class structurededit extends compoundedit
private long editedtime
public boolean addedit undoableedit edit
boolean result   super addedit edit
if  result    editedtime    0
editedtime   system currenttimemillis
return result
public boolean canundo
return edits size   > 0
protected long editedtime
return editedtime
public boolean isinprogress
return false