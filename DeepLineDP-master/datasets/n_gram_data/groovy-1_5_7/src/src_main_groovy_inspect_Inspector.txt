/*
* copyright 2003-2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package groovy inspect
import groovy lang groovyobject
import groovy lang metaclass
import groovy lang metamethod
import groovy lang propertyvalue
import org codehaus groovy reflection cachedclass
import org codehaus groovy runtime defaultgroovymethods
import org codehaus groovy runtime invokerhelper
import java io printstream
import java lang reflect constructor
import java lang reflect field
import java lang reflect method
import java lang reflect modifier
import java util
/**
* the inspector provides a unified access to an object's
* information that can be determined by introspection.
*
* @author dierk koenig
*/
public class inspector
protected object objectunderinspection
// indexes to retrieve class property information
public static final int class_package_idx         0
public static final int class_class_idx           1
public static final int class_interface_idx       2
public static final int class_superclass_idx      3
public static final int class_other_idx           4
// indexes to retrieve field and method information
public static final int member_origin_idx   0
public static final int member_modifier_idx   1
public static final int member_declarer_idx   2
public static final int member_type_idx   3
public static final int member_name_idx   4
public static final int member_params_idx   5
public static final int member_value_idx   5
public static final int member_exceptions_idx   6
public static final string not_applicable
public static final string groovy
public static final string java
/**
* @param objectunderinspection must not be null
*/
public inspector object objectunderinspection
if  null    objectunderinspection
throw new illegalargumentexception
this objectunderinspection   objectunderinspection
/**
* get the class properties of the object under inspection.
* @return string array to be indexed by the class_xxx_idx constants
*/
public string getclassprops
string result   new string
package pack   getclassunderinspection   getpackage
result        pack    null  ? not_applicable   pack getname
string modifiers   modifier tostring getclassunderinspection   getmodifiers
result   modifiers      shortname getclassunderinspection
result
class interfaces   getclassunderinspection   getinterfaces
for  int i   0  i < interfaces length  i
result    shortname interfaces
result       shortname getclassunderinspection   getsuperclass
result     getclassunderinspection   isprimitive
getclassunderinspection   isarray
isgroovy
return result
public boolean isgroovy
return groovyobject class isassignablefrom getclassunderinspection
/**
* gets the object being inspected.
*/
public object getobject
return objectunderinspection
/**
* get info about usual java instance and class methods as well as constructors.
* @return  array of stringarrays that can be indexed with the member_xxx_idx constants
*/
public object getmethods
method methods   getclassunderinspection   getmethods
constructor ctors   getclassunderinspection   getconstructors
object result   new object
int resultindex   0
for    resultindex < methods length  resultindex
method method   methods
result   methodinfo method
for  int i   0  i < ctors length  i    resultindex
constructor ctor   ctors
result   methodinfo ctor
return result
/**
* get info about instance and class methods that are dynamically added through groovy.
* @return  array of stringarrays that can be indexed with the member_xxx_idx constants
*/
public object getmetamethods
metaclass metaclass   invokerhelper getmetaclass objectunderinspection
list metamethods   metaclass getmetamethods
object result   new object
int i 0
for  iterator iter   metamethods iterator    iter hasnext    i
metamethod metamethod    metamethod  iter next
result   methodinfo metamethod
return result
/**
* get info about usual java public fields incl. constants.
* @return  array of stringarrays that can be indexed with the member_xxx_idx constants
*/
public object getpublicfields
field fields   getclassunderinspection   getfields
object result   new object
for  int i   0  i < fields length  i
field field   fields
result   fieldinfo field
return result
/**
* get info about properties (java and groovy alike).
* @return  array of stringarrays that can be indexed with the member_xxx_idx constants
*/
public object getpropertyinfo
list props   defaultgroovymethods getmetapropertyvalues objectunderinspection
object result   new object
int i 0
for  iterator iter   props iterator    iter hasnext    i
propertyvalue pv    propertyvalue  iter next
result   fieldinfo pv
return result
protected string fieldinfo field field
string result   new string
result   java
result   modifier tostring field getmodifiers
result   shortname field getdeclaringclass
result   shortname field gettype
result   field getname
try
result   invokerhelper inspect field get objectunderinspection
catch  illegalaccessexception e
result   not_applicable
return withoutnulls result
protected string fieldinfo propertyvalue pv
string result   new string
result   groovy
result
result   not_applicable
result   shortname pv gettype
result   pv getname
try
result   invokerhelper inspect pv getvalue
catch  exception e
result   not_applicable
return withoutnulls result
protected class getclassunderinspection
return objectunderinspection getclass
public static string shortname class clazz
if  null    clazz  return not_applicable
string classname   clazz getname
if  null    clazz getpackage    return classname
string packagename   clazz getpackage   getname
int offset   packagename length
if  offset > 0  offset
classname   classname substring offset
return classname
protected string methodinfo method method
string result   new string
int mod   method getmodifiers
result   java
result   shortname method getdeclaringclass
result   modifier tostring mod
result   method getname
result   shortname method getreturntype
class params   method getparametertypes
stringbuffer sb   new stringbuffer
for  int j   0  j < params length  j
sb append shortname params
if  j <  params length   1   sb append
result   sb tostring
sb setlength 0
class exceptions   method getexceptiontypes
for  int k   0  k < exceptions length  k
sb append shortname exceptions
if  k <  exceptions length   1   sb append
result   sb tostring
return withoutnulls result
protected string methodinfo constructor ctor
string result   new string
int mod   ctor getmodifiers
result   java
result   modifier tostring mod
result   shortname ctor getdeclaringclass
result   shortname ctor getdeclaringclass
result   ctor getname
class params   ctor getparametertypes
stringbuffer sb   new stringbuffer
for  int j   0  j < params length  j
sb append shortname params
if  j <  params length   1   sb append
result   sb tostring
sb setlength 0
class exceptions   ctor getexceptiontypes
for  int k   0  k < exceptions length  k
sb append shortname exceptions
if  k <  exceptions length   1   sb append
result   sb tostring
return withoutnulls result
protected string methodinfo metamethod method
string result   new string
int mod   method getmodifiers
result   groovy
result   modifier tostring mod
result   shortname method getdeclaringclass   gettheclass
result   shortname method getreturntype
result   method getname
cachedclass params   method getparametertypes
stringbuffer sb   new stringbuffer
for  int j   0  j < params length  j
sb append shortname params gettheclass
if  j <  params length   1   sb append
result   sb tostring
result   not_applicable     no exception info for groovy metamethods
return withoutnulls result
protected string withoutnulls string tonormalize
for  int i   0  i < tonormalize length  i
string s   tonormalize
if  null    s  tonormalize   not_applicable
return tonormalize
public static void print object memberinfo
print system out  memberinfo
static void print final printstream out  object memberinfo
for  int i   0  i < memberinfo length  i
string metamethod    string  memberinfo
out print i
for  int j   0  j < metamethod length  j
string s   metamethod
out print s
out println
public static collection sort list memberinfo
collections sort memberinfo  new membercomparator
return memberinfo
public static class membercomparator implements comparator
public int compare object a  object b
string astr    string  a
string bstr    string  b
int result   astr compareto bstr
if  0    result  return result
result   astr compareto bstr
if  0    result  return result
result   astr compareto bstr
if  0    result  return result
result   astr compareto bstr
if  0    result  return result
result   astr compareto bstr
if  0    result  return result
result   astr compareto bstr
return result