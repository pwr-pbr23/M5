/*
* uiresourcemgr.java
*
* copyright 2004, 2007 the original author or authors.
*
* licensed under the apache license, version 2.0 (the "license");
* you may not use this file except in compliance with the license.
* you may obtain a copy of the license at
*
*     http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package groovy ui
import groovy ui text groovyfilter
import groovy ui text structuredsyntaxresources
import groovy ui text texteditor
import groovy ui text textundomanager
import javax swing abstractaction
import javax swing action
import javax swing actionmap
import javax swing inputmap
import javax swing jcomponent
import javax swing jscrollpane
import javax swing keystroke
import javax swing event documentevent
import javax swing event documentlistener
import javax swing text defaultstyleddocument
import java awt datatransfer dataflavor
import java awt datatransfer transferable
import java awt event actionevent
import java awt event inputevent
import java awt event keyevent
import java awt print printerjob
import java beans propertychangeevent
import java beans propertychangelistener
import java io file
/**
* component which provides a styled editor for the console.
*
* @version $id$
* @author hippy
*/
public class consoletexteditor extends jscrollpane
private static final printerjob printer_job   printerjob getprinterjob
private texteditor texteditor   new texteditor true  true  true
private undoaction undoaction   new undoaction
private redoaction redoaction   new redoaction
private printaction printaction   new printaction
private boolean editable   true
private file textfile
private textundomanager undomanager
/**
* creates a new instance of consoletexteditor
*/
public consoletexteditor
texteditor setfont structuredsyntaxresources editor_font
setwheelscrollingenabled true
setviewportview texteditor
texteditor setdragenabled editable
initactions
defaultstyleddocument doc   new defaultstyleddocument
doc setdocumentfilter new groovyfilter doc
texteditor setdocument doc
// create and add the undo/redo manager
this undomanager   new textundomanager
doc addundoableeditlistener undomanager
// add the undo actions
undomanager addpropertychangelistener undoaction
undomanager addpropertychangelistener redoaction
doc adddocumentlistener undoaction
doc adddocumentlistener redoaction
inputmap im   texteditor getinputmap jcomponent when_in_focused_window
keystroke ks   keystroke getkeystroke keyevent vk_z  inputevent ctrl_mask  false
im put ks  structuredsyntaxresources undo
actionmap am   texteditor getactionmap
am put structuredsyntaxresources undo  undoaction
ks   keystroke getkeystroke keyevent vk_y  inputevent ctrl_mask  false
im put ks  structuredsyntaxresources redo
am put structuredsyntaxresources redo  redoaction
ks   keystroke getkeystroke keyevent vk_p  inputevent ctrl_mask  false
im put ks  structuredsyntaxresources print
am put structuredsyntaxresources print  printaction
public boolean clipboardavailable
transferable t   structuredsyntaxresources system_clipboard getcontents this
return t isdataflavorsupported dataflavor stringflavor
public texteditor gettexteditor
return texteditor
protected void initactions
actionmap map   getactionmap
printaction printaction   new printaction
map put structuredsyntaxresources print  printaction
private class printaction extends abstractaction
public printaction
setenabled true
public void actionperformed actionevent ae
printer_job setpageable texteditor
try
if  printer_job printdialog
printer_job print
catch  exception e
e printstacktrace
end consoletexteditor printaction
private class redoaction extends updatecaretlistener implements propertychangelistener
public redoaction
setenabled false
public void actionperformed actionevent ae
undomanager redo
setenabled undomanager canredo
undoaction setenabled undomanager canundo
super actionperformed ae
public void propertychange propertychangeevent pce
setenabled undomanager canredo
end consoletexteditor redoaction
private abstract class updatecaretlistener extends abstractaction implements documentlistener
protected int lastupdate
public void changedupdate documentevent de
public void insertupdate documentevent de
lastupdate   de getoffset     de getlength
public void removeupdate documentevent de
lastupdate   de getoffset
public void actionperformed actionevent ae
texteditor setcaretposition lastupdate
private class undoaction extends updatecaretlistener  implements propertychangelistener
public undoaction
setenabled false
public void actionperformed actionevent ae
undomanager undo
setenabled undomanager canundo
redoaction setenabled undomanager canredo
super actionperformed ae
public void propertychange propertychangeevent pce
setenabled undomanager canundo
public action getundoaction
return undoaction
public action getredoaction
return redoaction
public action getprintaction
return printaction