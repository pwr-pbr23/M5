package org jruby java invokers
import java lang reflect constructor
import org jruby javasupport
import java lang reflect method
import java util arraylist
import java util hashmap
import java util iterator
import java util list
import java util map
import java util concurrent concurrenthashmap
import org jruby ruby
import org jruby rubymodule
import org jruby rubyproc
import org jruby java proxies javaproxy
import org jruby runtime block
import org jruby runtime threadcontext
import org jruby runtime builtin irubyobject
public class constructorinvoker extends rubytojavainvoker
private constructor ctors
public constructorinvoker rubymodule host  list<constructor> methods
super host
this ctors   methods toarray new constructor
if   ruby issecurityrestricted
try
method setaccessible this ctors  true
catch securityexception e
// todo: varargs?
synchronized void createjavacallables ruby runtime
if   initialized       read volatile
if  ctors    null
if  ctors length    1
javacallable   javaconstructor create runtime  ctors
else
map methodsmap   new hashmap
int maxarity   0
for  constructor ctor  ctors
// todo: deal with varargs
int arity   ctor getparametertypes   length
maxarity   math max arity  maxarity
list<javaconstructor> methodsforarity    arraylist<javaconstructor> methodsmap get arity
if  methodsforarity    null
methodsforarity   new arraylist<javaconstructor>
methodsmap put arity methodsforarity
methodsforarity add javaconstructor create runtime ctor
javacallables   new javaconstructor
for  iterator<map entry> iter   methodsmap entryset   iterator    iter hasnext
map entry entry   iter next
list<javaconstructor> ctorsforarity    list<javaconstructor> entry getvalue
javaconstructor methodsarray   ctorsforarity toarray new javaconstructor
javacallables   methodsarray
ctors   null
// initialize cache of parameter types to method
cache   new concurrenthashmap
initialized   true     write volatile
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject args
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
int len   args length
object convertedargs   new object
javaconstructor constructor    javaconstructor findcallable self  name  args  len
for  int i   0  i < len  i
convertedargs   convertarg context  args  constructor  i
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect convertedargs
return self
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
javaconstructor constructor    javaconstructor findcallablearityzero self  name
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect
return self
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject arg0
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
javaconstructor constructor    javaconstructor findcallablearityone self  name  arg0
object carg0   convertarg context  arg0  constructor  0
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0
return self
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject arg0  irubyobject arg1
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
javaconstructor constructor    javaconstructor findcallablearitytwo self  name  arg0  arg1
object carg0   convertarg context  arg0  constructor  0
object carg1   convertarg context  arg1  constructor  1
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0  carg1
return self
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject arg0  irubyobject arg1  irubyobject arg2
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
javaconstructor constructor    javaconstructor findcallablearitythree self  name  arg0  arg1  arg2
object carg0   convertarg context  arg0  constructor  0
object carg1   convertarg context  arg1  constructor  1
object carg2   convertarg context  arg2  constructor  2
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0  carg1  carg2
return self
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject args  block block
if  block isgiven
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
int len   args length
// too much array creation!
object convertedargs   new object
irubyobject intermediate   new irubyobject
system arraycopy args  0  intermediate  0  len
intermediate   rubyproc newproc runtime  block  block type lambda
javaconstructor constructor    javaconstructor findcallable self  name  intermediate  len   1
for  int i   0  i < len   1  i
convertedargs   convertarg context  intermediate  constructor  i
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect convertedargs
return self
else
return call context  self  clazz  name  args
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  block block
if  block isgiven
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
rubyproc proc   rubyproc newproc self getruntime    block  block type lambda
javaconstructor constructor    javaconstructor findcallablearityone self  name  proc
object carg0   convertarg context  proc  constructor  0
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0
return self
else
return call context  self  clazz  name
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject arg0  block block
if  block isgiven
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
rubyproc proc   rubyproc newproc self getruntime    block  block type lambda
javaconstructor constructor    javaconstructor findcallablearitytwo self  name  arg0  proc
object carg0   convertarg context  arg0  constructor  0
object carg1   convertarg context  proc  constructor  1
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0  carg1
return self
else
return call context  self  clazz  name  arg0
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject arg0  irubyobject arg1  block block
if  block isgiven
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
rubyproc proc   rubyproc newproc self getruntime    block  block type lambda
javaconstructor constructor    javaconstructor findcallablearitythree self  name  arg0  arg1  proc
object carg0   convertarg context  arg0  constructor  0
object carg1   convertarg context  arg1  constructor  1
object carg2   convertarg context  proc  constructor  2
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0  carg1  carg2
return self
else
return call context  self  clazz  name  arg0  arg1
@override
public irubyobject call threadcontext context  irubyobject self  rubymodule clazz  string name  irubyobject arg0  irubyobject arg1  irubyobject arg2  block block
if  block isgiven
ruby runtime   context getruntime
createjavacallables runtime
javaproxy proxy   castjavaproxy self
rubyproc proc   rubyproc newproc self getruntime    block  block type lambda
javaconstructor constructor    javaconstructor findcallablearityfour self  name  arg0  arg1  arg2  proc
object carg0   convertarg context  arg0  constructor  0
object carg1   convertarg context  arg1  constructor  1
object carg2   convertarg context  arg2  constructor  2
object carg3   convertarg context  proc  constructor  3
proxy datawrapstruct javaobject wrap runtime  constructor newinstancedirect carg0  carg1  carg2  carg3
return self
else
return call context  self  clazz  name  arg0  arg1  arg2