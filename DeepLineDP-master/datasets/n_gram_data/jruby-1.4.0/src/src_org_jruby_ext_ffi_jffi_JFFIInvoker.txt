package org jruby ext ffi jffi
import com kenai jffi callingconvention
import com kenai jffi function
import org jruby ruby
import org jruby rubyarray
import org jruby rubyclass
import org jruby rubyhash
import org jruby rubymodule
import org jruby anno jrubymethod
import org jruby ext ffi abstractinvoker
import org jruby ext ffi directmemoryio
import org jruby ext ffi pointer
import org jruby ext ffi type
import org jruby internal runtime methods dynamicmethod
import org jruby runtime block
import org jruby runtime objectallocator
import org jruby runtime threadcontext
import org jruby runtime builtin irubyobject
public class jffiinvoker extends org jruby ext ffi abstractinvoker
private final function function
private final type returntype
private final type parametertypes
private final callingconvention convention
private final irubyobject enums
public static rubyclass createinvokerclass ruby runtime  rubymodule module
rubyclass result   module defineclassunder
module fastgetclass
objectallocator not_allocatable_allocator
result defineannotatedmethods abstractinvoker class
result defineannotatedmethods jffiinvoker class
result defineannotatedconstants jffiinvoker class
return result
jffiinvoker ruby runtime  long address  type returntype  type parametertypes
this runtime  runtime fastgetmodule    fastgetclass
new codememoryio runtime  address
returntype  parametertypes     null
jffiinvoker ruby runtime  rubyclass klass  directmemoryio fptr
type returntype  type parametertypes  string convention  irubyobject enums
super runtime  klass  parametertypes length  fptr
final com kenai jffi type jffireturntype   ffiutil getffitype returntype
if  jffireturntype    null
throw runtime newargumenterror     returntype
com kenai jffi type jffiparamtypes   new com kenai jffi type
for  int i   0  i < jffiparamtypes length    i
if   jffiparamtypes   ffiutil getffitype parametertypes      null
throw runtime newargumenterror     parametertypes
function   new function fptr getaddress    jffireturntype  jffiparamtypes
this parametertypes   new type
system arraycopy parametertypes  0  this parametertypes  0  parametertypes length
this returntype   returntype
this convention     equals convention
? callingconvention stdcall   callingconvention default
this enums   enums
// wire up function#call(*args) to use the super-fast native invokers
getsingletonclass   addmethod    createdynamicmethod getsingletonclass
@jrubymethod name          meta   true  required   4
public static irubyobject newinstance threadcontext context  irubyobject recv  irubyobject args
if    args instanceof pointer
throw context getruntime   newtypeerror
args getmetaclass   getname
if    args instanceof rubyarray
throw context getruntime   newtypeerror
args getmetaclass   getname
if    args instanceof type
throw context getruntime   newtypeerror     args
pointer ptr    pointer  args
rubyarray paramtypes    rubyarray  args
type returntype    type  args
// get the convention from the options hash
string convention
irubyobject enums   null
if  args instanceof rubyhash
rubyhash options    rubyhash  args
convention   options fastaref context getruntime   newsymbol     asjavastring
enums   options fastaref context getruntime   newsymbol
if  enums    null     enums isnil        enums instanceof rubyhash
throw context getruntime   newtypeerror
enums getmetaclass   getname
else
convention   args asjavastring
type parametertypes   new type
for  int i   0  i < parametertypes length    i
irubyobject type   paramtypes entry i
if    type instanceof type
throw context getruntime   newargumenterror
parametertypes    type  paramtypes entry i
directmemoryio fptr    directmemoryio  ptr getmemoryio
return new jffiinvoker context getruntime     rubyclass  recv  fptr
type  returntype  parametertypes  convention  enums
@override
public dynamicmethod createdynamicmethod rubymodule module
return  enums    null    enums isnil
? methodfactory createdynamicmethod getruntime    module  function
returntype  parametertypes  convention
defaultmethodfactory getfactory   createmethod module
function  returntype  parametertypes  convention  enums