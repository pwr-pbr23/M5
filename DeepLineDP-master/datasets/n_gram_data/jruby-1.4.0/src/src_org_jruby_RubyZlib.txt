/***** begin license block *****
* version: cpl 1.0/gpl 2.0/lgpl 2.1
*
* the contents of this file are subject to the common public
* license version 1.0 (the "license"); you may not use this file
* except in compliance with the license. you may obtain a copy of
* the license at http://www.eclipse.org/legal/cpl-v10.html
*
* software distributed under the license is distributed on an "as
* is" basis, without warranty of any kind, either express or
* implied. see the license for the specific language governing
* rights and limitations under the license.
*
* copyright (c) 2006 ola bini <ola@ologix.com>
* copyright (c) 2009 aurelian oancea <aurelian@locknet.ro>
* copyright (c) 2009 vladimir sizikov <vsizikov@gmail.com>
*
* alternatively, the contents of this file may be used under the terms of
* either of the gnu general public license version 2 or later (the "gpl"),
* or the gnu lesser general public license version 2.1 or later (the "lgpl"),
* in which case the provisions of the gpl or the lgpl are applicable instead
* of those above. if you wish to allow use of your version of this file only
* under the terms of either the gpl or the lgpl, and not to allow others to
* use your version of this file under the terms of the cpl, indicate your
* decision by deleting the provisions above and replace them with the notice
* and other provisions required by the gpl or the lgpl. if you do not delete
* the provisions above, a recipient may use your version of this file under
* the terms of any one of the cpl, the gpl or the lgpl.
***** end license block *****/
package org jruby
import java io ioexception
import java io inputstream
import java io outputstream
import java io unsupportedencodingexception
import java util arraylist
import java util list
import java util zip crc32
import java util zip dataformatexception
import java util zip deflater
import java util zip deflateroutputstream
import java util zip gzipinputstream
import java util zip inflater
import org joda time datetime
import org jruby anno framefield
import org jruby anno jrubyclass
import org jruby anno jrubymethod
import org jruby anno jrubymodule
import org jruby exceptions raiseexception
import org jruby javasupport util runtimehelpers
import org jruby runtime arity
import org jruby runtime block
import org jruby runtime objectallocator
import org jruby runtime threadcontext
import org jruby runtime visibility
import org jruby runtime builtin irubyobject
import org jruby util adler32ext
import org jruby util bytelist
import org jruby util crc32ext
import org jruby util ioinputstream
import org jruby util iooutputstream
import org jruby util zlibdeflate
@jrubymodule name
public class rubyzlib
private final static int max_wbits   15
/** create the zlib module and add it to the ruby runtime.
*
*/
public static rubymodule createzlibmodule ruby runtime
rubymodule result   runtime definemodule
rubyclass gzfile   result defineclassunder    runtime getobject    rubygzipfile gzipfile_allocator
gzfile defineannotatedmethods rubygzipfile class
rubyclass gzreader   result defineclassunder    gzfile  rubygzipreader gzipreader_allocator
gzreader includemodule runtime getenumerable
gzreader defineannotatedmethods rubygzipreader class
rubyclass standarderror   runtime getstandarderror
rubyclass zliberror   result defineclassunder    standarderror  standarderror getallocator
gzreader defineclassunder    zliberror  zliberror getallocator
rubyclass gzwriter   result defineclassunder    gzfile  rubygzipwriter gzipwriter_allocator
gzwriter defineannotatedmethods rubygzipwriter class
result defineconstant   runtime newstring
result defineconstant   runtime newstring
result defineconstant   runtime newfixnum 0
result defineconstant   runtime newfixnum 1
result defineconstant   runtime newfixnum 2
result defineconstant   runtime newfixnum 8
result defineconstant   runtime newfixnum 9
result defineconstant   runtime newfixnum 3
result defineconstant   runtime newfixnum 255
result defineconstant   runtime newfixnum 11
result defineconstant   runtime newfixnum 8
result defineconstant   runtime newfixnum 4
result defineconstant   runtime newfixnum 2
result defineconstant   runtime newfixnum 13
result defineconstant   runtime newfixnum 7
result defineconstant   runtime newfixnum 6
result defineconstant   runtime newfixnum 1
result defineconstant   runtime newfixnum 12
result defineconstant   runtime newfixnum 11
result defineconstant   runtime newfixnum 5
result defineconstant   runtime newfixnum 0
result defineconstant   runtime newfixnum 9
result defineconstant   runtime newfixnum 10
result defineconstant   runtime newfixnum 0
result defineconstant   runtime newfixnum 1
result defineconstant   runtime newfixnum 2
result defineconstant   runtime newfixnum 0
result defineconstant   runtime newfixnum 2
result defineconstant   runtime newfixnum 3
result defineconstant   runtime newfixnum 4
result defineconstant   runtime newfixnum 0
result defineconstant   runtime newfixnum 1
result defineconstant   runtime newfixnum  1
result defineconstant   runtime newfixnum 9
result defineconstant   runtime newfixnum max_wbits
result defineannotatedmethods rubyzlib class
result defineclassunder   zliberror  zliberror getallocator
result defineclassunder   zliberror  zliberror getallocator
result defineclassunder   zliberror  zliberror getallocator
result defineclassunder   zliberror  zliberror getallocator
result defineclassunder   zliberror  zliberror getallocator
result defineclassunder   zliberror  zliberror getallocator
result defineclassunder   zliberror  zliberror getallocator
rubyclass gzerror   gzfile defineclassunder   zliberror  zliberror getallocator
gzfile defineclassunder   gzerror  gzerror getallocator
gzfile defineclassunder   gzerror  gzerror getallocator
gzfile defineclassunder   gzerror  gzerror getallocator
// zstream actually *isn't* allocatable
rubyclass zstream   result defineclassunder    runtime getobject    objectallocator not_allocatable_allocator
zstream defineannotatedmethods zstream class
zstream undefinemethod
rubyclass infl   result defineclassunder    zstream  inflate inflate_allocator
infl defineannotatedmethods inflate class
rubyclass defl   result defineclassunder    zstream  deflate deflate_allocator
defl defineannotatedmethods deflate class
runtime getkernel   callmethod runtime getcurrentcontext     runtime newstring
return result
@jrubyclass name    parent
public static class error
@jrubyclass name    parent
public static class streamend extends error
@jrubyclass name    parent
public static class streamerror extends error
@jrubyclass name    parent
public static class buferror extends error
@jrubyclass name    parent
public static class needdict extends error
@jrubyclass name    parent
public static class memerror extends error
@jrubyclass name    parent
public static class versionerror extends error
@jrubyclass name    parent
public static class dataerror extends error
@jrubymethod name      module   true  visibility   visibility private
public static irubyobject zlib_version irubyobject recv
rubybasicobject res    rubybasicobject    rubymodule recv  fastgetconstant
// mri behavior, enforced by tests
res taint recv getruntime
return res
@jrubymethod name      optional   2  module   true  visibility   visibility private
public static irubyobject crc32 irubyobject recv  irubyobject args  throws exception
args   arity scanargs recv getruntime   args 0 2
long crc   0
bytelist bytes   null
if   args isnil    bytes   args converttostring   getbytelist
if   args isnil    crc   rubynumeric num2long args
crc32ext ext   new crc32ext  int crc
if  bytes    null
ext update bytes unsafebytes    bytes begin    bytes length
return recv getruntime   newfixnum ext getvalue
@jrubymethod name      optional   2  module   true  visibility   visibility private
public static irubyobject adler32 irubyobject recv  irubyobject args  throws exception
args   arity scanargs recv getruntime   args 0 2
int adler   1
bytelist bytes   null
if   args isnil    bytes   args converttostring   getbytelist
if   args isnil    adler   rubynumeric fix2int args
adler32ext ext   new adler32ext adler
if  bytes    null
ext update bytes unsafebytes    bytes begin    bytes length        it t modify the array
return recv getruntime   newfixnum ext getvalue
private final static long crctab   new long
0l  1996959894l  3993919788l  2567524794l  124634137l  1886057615l  3915621685l  2657392035l  249268274l  2044508324l  3772115230l  2547177864l  162941995l
2125561021l  3887607047l  2428444049l  498536548l  1789927666l  4089016648l  2227061214l  450548861l  1843258603l  4107580753l  2211677639l  325883990l
1684777152l  4251122042l  2321926636l  335633487l  1661365465l  4195302755l  2366115317l  997073096l  1281953886l  3579855332l  2724688242l  1006888145l
1258607687l  3524101629l  2768942443l  901097722l  1119000684l  3686517206l  2898065728l  853044451l  1172266101l  3705015759l  2882616665l  651767980l
1373503546l  3369554304l  3218104598l  565507253l  1454621731l  3485111705l  3099436303l  671266974l  1594198024l  3322730930l  2970347812l  795835527l
1483230225l  3244367275l  3060149565l  1994146192l  31158534l  2563907772l  4023717930l  1907459465l  112637215l  2680153253l  3904427059l  2013776290l
251722036l  2517215374l  3775830040l  2137656763l  141376813l  2439277719l  3865271297l  1802195444l  476864866l  2238001368l  4066508878l  1812370925l
453092731l  2181625025l  4111451223l  1706088902l  314042704l  2344532202l  4240017532l  1658658271l  366619977l  2362670323l  4224994405l  1303535960l
984961486l  2747007092l  3569037538l  1256170817l  1037604311l  2765210733l  3554079995l  1131014506l  879679996l  2909243462l  3663771856l  1141124467l
855842277l  2852801631l  3708648649l  1342533948l  654459306l  3188396048l  3373015174l  1466479909l  544179635l  3110523913l  3462522015l  1591671054l
702138776l  2966460450l  3352799412l  1504918807l  783551873l  3082640443l  3233442989l  3988292384l  2596254646l  62317068l  1957810842l  3939845945l
2647816111l  81470997l  1943803523l  3814918930l  2489596804l  225274430l  2053790376l  3826175755l  2466906013l  167816743l  2097651377l  4027552580l
2265490386l  503444072l  1762050814l  4150417245l  2154129355l  426522225l  1852507879l  4275313526l  2312317920l  282753626l  1742555852l  4189708143l
2394877945l  397917763l  1622183637l  3604390888l  2714866558l  953729732l  1340076626l  3518719985l  2797360999l  1068828381l  1219638859l  3624741850l
2936675148l  906185462l  1090812512l  3747672003l  2825379669l  829329135l  1181335161l  3412177804l  3160834842l  628085408l  1382605366l  3423369109l
3138078467l  570562233l  1426400815l  3317316542l  2998733608l  733239954l  1555261956l  3268935591l  3050360625l  752459403l  1541320221l  2607071920l
3965973030l  1969922972l  40735498l  2617837225l  3943577151l  1913087877l  83908371l  2512341634l  3803740692l  2075208622l  213261112l  2463272603l
3855990285l  2094854071l  198958881l  2262029012l  4057260610l  1759359992l  534414190l  2176718541l  4139329115l  1873836001l  414664567l  2282248934l
4279200368l  1711684554l  285281116l  2405801727l  4167216745l  1634467795l  376229701l  2685067896l  3608007406l  1308918612l  956543938l  2808555105l
3495958263l  1231636301l  1047427035l  2932959818l  3654703836l  1088359270l  936918000l  2847714899l  3736837829l  1202900863l  817233897l  3183342108l
3401237130l  1404277552l  615818150l  3134207493l  3453421203l  1423857449l  601450431l  3009837614l  3294710456l  1567103746l  711928724l  3020668471l
3272380065l  1510334235l  755167117
@jrubymethod name      module   true  visibility   visibility private
public static irubyobject crc_table irubyobject recv
list<irubyobject> ll   new arraylist<irubyobject> crctab length
for int i 0 i<crctab length i
ll add recv getruntime   newfixnum crctab
return recv getruntime   newarray ll
@jrubyclass name
public static abstract class zstream extends rubyobject
protected boolean closed   false
protected abstract int internaltotalin
protected abstract int internaltotalout
protected abstract boolean internalstreamendp
protected abstract void internalreset
protected abstract boolean internalfinished
protected abstract int internaladler
// todo: eliminate?
protected abstract irubyobject internalfinish
protected abstract void internalclose
public zstream ruby runtime  rubyclass type
super runtime  type
@jrubymethod name      frame   true  visibility   visibility private
public irubyobject initialize block unusedblock
return this
@jrubymethod name
public irubyobject flush_next_out threadcontext context
return rubystring newemptystring context getruntime
@jrubymethod name
public irubyobject total_out
return getruntime   newfixnum internaltotalout
@jrubymethod name
public irubyobject stream_end_p
return internalstreamendp   ? getruntime   gettrue     getruntime   getfalse
@jrubymethod name
public irubyobject data_type
return getruntime   fastgetmodule    fastgetconstant
@jrubymethod name
public irubyobject closed_p
return closed ? getruntime   gettrue     getruntime   getfalse
@jrubymethod name
public irubyobject reset
internalreset
return getruntime   getnil
@jrubymethod name
public irubyobject avail_out
return rubyfixnum zero getruntime
@jrubymethod name      required   1
public irubyobject set_avail_out irubyobject p1
return p1
@jrubymethod name
public irubyobject adler
return getruntime   newfixnum internaladler
@jrubymethod name      backtrace   true
public irubyobject finish threadcontext context
if  closed
ruby runtime   context getruntime
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass      true
irubyobject result   internalfinish
return result
@jrubymethod name
public irubyobject avail_in
return rubyfixnum zero getruntime
@jrubymethod name
public irubyobject flush_next_in threadcontext context
return rubystring newemptystring context getruntime
@jrubymethod name
public irubyobject total_in
return getruntime   newfixnum internaltotalin
@jrubymethod name
public irubyobject finished_p threadcontext context
ruby runtime   context getruntime
if  closed
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass      true
return internalfinished   ? runtime gettrue     runtime getfalse
@jrubymethod name
public irubyobject close
if   closed
internalclose
closed   true
return getruntime   getnil
@jrubyclass name    parent
public static class inflate extends zstream
public static final int base_size   100
protected static final objectallocator inflate_allocator   new objectallocator
public irubyobject allocate ruby runtime  rubyclass klass
return new inflate runtime  klass
public inflate ruby runtime  rubyclass type
super runtime  type
@jrubymethod name      required   1  meta   true  backtrace   true
public static irubyobject s_inflate threadcontext context  irubyobject recv  irubyobject string
rubyclass klass    rubyclass  recv
inflate inflate    inflate  klass allocate
inflate init max_wbits
irubyobject result
try
inflate append string converttostring   getbytelist
finally
result   inflate finish context
inflate close
return result
@jrubymethod name      optional   1  visibility   visibility private
public irubyobject _initialize irubyobject args  throws exception
int window_bits   max_wbits
if args length > 0     args isnil
window_bits   rubynumeric fix2int args
init window_bits
return this
private void init int window_bits
flater   new inflater window_bits < 0
collected   new bytelist base_size
input   new bytelist
@override
@jrubymethod name
public irubyobject flush_next_out threadcontext context
return flushoutput context getruntime
private irubyobject flushoutput ruby runtime
if  collected realsize > 0
irubyobject res   rubystring newstring runtime
collected bytes  collected begin  collected realsize
resetbuffer collected
return res
return rubystring newemptystring runtime
@jrubymethod name      required   1
public irubyobject append threadcontext context  irubyobject arg
if  arg isnil
run true
else
append arg converttostring   getbytelist
return this
public void append bytelist obj
if   internalfinished
byte bytes   obj bytes
flater setinput bytes
input   new bytelist bytes  false
run false
else
input append obj
@jrubymethod name
public irubyobject sync_point_p
return sync_point
public irubyobject sync_point
return getruntime   getfalse
@jrubymethod name      required   1  backtrace   true
public irubyobject set_dictionary threadcontext context  irubyobject arg  throws exception
try
return set_dictionary arg
catch  illegalargumentexception iae
ruby runtime   context getruntime
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception runtime  errorclass  iae getmessage     true
public irubyobject set_dictionary irubyobject str  throws unsupportedencodingexception
flater setdictionary str converttostring   getbytes
run false
return str
@jrubymethod name      required   1  backtrace   true
public irubyobject inflate threadcontext context  irubyobject string
bytelist data   null
if   string isnil
data   string converttostring   getbytelist
return inflate context  data
public irubyobject inflate threadcontext context  bytelist str
if  null    str
return internalfinish
else
append str
return flushoutput context getruntime
@jrubymethod name      required   1
public irubyobject sync threadcontext context  irubyobject string
append context  string
return context getruntime   getfalse
private void run boolean finish
byte outp   new byte
int resultlength    1
while   internalfinished      resultlength    0
ruby runtime   getruntime
// mri behavior
if  finish    flater needsinput
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass      true
try
resultlength   flater inflate outp
if  flater needsdictionary
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass
else
if  input realsize > 0
int remaining   flater getremaining
if  remaining > 0
input view input realsize   remaining  remaining
else
resetbuffer input
catch  dataformatexception ex
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass  ex getmessage     true
collected append outp  0  resultlength
if  resultlength    outp length
outp   new byte
// mri behavior: in finished mode, we work as pass-through
if  internalfinished      finish
if  input realsize > 0
collected append input
resetbuffer input
if  finish
flater end
protected int internaltotalout
return flater gettotalout
protected boolean internalstreamendp
return flater finished
protected int internaladler
return flater getadler
protected int internaltotalin
return flater gettotalin
@override
protected boolean internalfinished
return flater finished
@override
protected irubyobject internalfinish
run true
flater end
resetbuffer input
return flushoutput getruntime
protected void internalclose
flater end
protected void internalend
flater end
protected void internalreset
flater reset
private inflater flater
private bytelist collected
private bytelist input
static void checklevel ruby runtime  int level
if   level < 0    level > 9     level    deflater default_compression
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass      true
static void checkstrategy ruby runtime  int strategy
switch  strategy
case deflater default_strategy
case deflater filtered
case deflater huffman_only
break
default
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception
runtime  errorclass      true
@jrubyclass name    parent
public static class deflate extends zstream
protected static final objectallocator deflate_allocator   new objectallocator
public irubyobject allocate ruby runtime  rubyclass klass
return new deflate runtime  klass
@jrubymethod name      required   1  optional   1  meta   true  backtrace   true
public static irubyobject s_deflate irubyobject recv  irubyobject args  throws exception
ruby runtime   recv getruntime
args   arity scanargs runtime args 1 1
int level   deflater default_compression
if  args isnil
level   rubynumeric fix2int args
checklevel runtime  level
return zlibdeflate s_deflate recv args converttostring   getbytelist   level
public deflate ruby runtime  rubyclass type
super runtime  type
private zlibdeflate defl
@jrubymethod name
public irubyobject op_dup
throw getruntime   newnotimplementederror
@jrubymethod name      optional   4  visibility   visibility private  backtrace   true
public irubyobject _initialize irubyobject args  throws exception
args   arity scanargs getruntime   args 0 4
int level    1
int window_bits   max_wbits
int memlevel   8
int strategy   0
if  args isnil
level   rubynumeric fix2int args
checklevel getruntime    level
if  args isnil
window_bits   rubynumeric fix2int args
if  args isnil
memlevel   rubynumeric fix2int args
if  args isnil
strategy   rubynumeric fix2int args
defl   new zlibdeflate this level window_bits memlevel strategy
return this
@jrubymethod name      required   1
public irubyobject append irubyobject arg  throws exception
defl append arg
return this
@jrubymethod name      required   2
public irubyobject params threadcontext context  irubyobject level  irubyobject strategy
ruby runtime   context getruntime
int l   rubynumeric fix2int level
checklevel runtime  l
int s   rubynumeric fix2int strategy
checkstrategy runtime  s
defl params l  s
return getruntime   getnil
@jrubymethod name      required   1  backtrace   true
public irubyobject set_dictionary threadcontext context  irubyobject arg  throws exception
try
return defl set_dictionary arg
catch  illegalargumentexception iae
ruby runtime   context getruntime
rubyclass errorclass   runtime fastgetmodule    fastgetclass
throw new raiseexception rubyexception newexception runtime  errorclass  iae getmessage     true
@jrubymethod name      optional   1
public irubyobject flush irubyobject args  throws exception
int flush   2     sync_flush
if args length    1
if  args isnil
flush   rubynumeric fix2int args
return defl flush flush
@jrubymethod name      required   1  optional   1
public irubyobject deflate irubyobject args  throws exception
args   arity scanargs getruntime   args 1 1
bytelist data   null
if   args isnil
data   args converttostring   getbytelist
int flush   0     by default  no_flush
if  args isnil
flush   rubynumeric fix2int args
return defl deflate data  flush
protected int internaltotalout
return defl getdeflater   gettotalout
protected boolean internalstreamendp
return defl getdeflater   finished
protected void internalreset
defl getdeflater   reset
protected int internaladler
return defl getdeflater   getadler
@override
public boolean internalfinished
return defl getdeflater   finished
protected irubyobject internalfinish
return defl finish
protected int internaltotalin
return defl getdeflater   gettotalin
protected void internalclose
defl close
@jrubyclass name
public static class rubygzipfile extends rubyobject
@jrubyclass name    parent
public static class error
@jrubyclass name    parent
public static class crcerror extends error
@jrubyclass name    parent
public static class nofooter extends error
@jrubyclass name    parent
public static class lengtherror extends error
private static irubyobject wrapblock threadcontext context  rubygzipfile instance
block block  throws ioexception
if  block isgiven
try
return block yield context  instance
finally
if   instance isclosed    instance close
return instance
@jrubymethod name      required   1  frame   true  meta   true
public static irubyobject wrap threadcontext context  irubyobject recv  irubyobject io  block block  throws ioexception
ruby runtime   recv getruntime
rubygzipfile instance
// todo: people extending gzipwriter/reader will break.  find better way here.
if  recv    runtime getmodule    getclass
instance   rubygzipwriter newgzipwriter recv  new irubyobject   io    block
else
instance   rubygzipreader newinstance recv  new irubyobject   io    block
return wrapblock context  instance  block
protected static final objectallocator gzipfile_allocator   new objectallocator
public irubyobject allocate ruby runtime  rubyclass klass
return new rubygzipfile runtime  klass
@jrubymethod name      frame   true  meta   true
public static rubygzipfile newinstance irubyobject recv  block block
rubyclass klass    rubyclass recv
rubygzipfile result    rubygzipfile  klass allocate
result callinit new irubyobject  block
return result
protected boolean closed   false
protected boolean finished   false
private int os_code   255
private int level    1
protected string orig_name
protected string comment
protected irubyobject realio
protected rubytime mtime
public rubygzipfile ruby runtime  rubyclass type
super runtime  type
mtime   rubytime newtime runtime  new datetime
@jrubymethod name
public irubyobject os_code
return getruntime   newfixnum os_code
@jrubymethod name
public irubyobject closed_p
return closed ? getruntime   gettrue     getruntime   getfalse
protected boolean isclosed
return closed
@jrubymethod name
public irubyobject orig_name
if closed
rubyclass errorclass   getruntime   fastgetmodule    fastgetclass    fastgetclass
throw new raiseexception rubyexception newexception getruntime    errorclass
return orig_name    null ? getruntime   getnil     getruntime   newstring orig_name
@jrubymethod name
public irubyobject to_io
return realio
@jrubymethod name
public irubyobject comment
if closed
rubyclass errorclass   getruntime   fastgetmodule    fastgetclass    fastgetclass
throw new raiseexception rubyexception newexception getruntime    errorclass
return comment    null ? getruntime   getnil     rubystring newstring getruntime    comment
@jrubymethod name
public irubyobject crc
return rubyfixnum zero getruntime
@jrubymethod name
public irubyobject mtime
return mtime
@jrubymethod name
public irubyobject sync
return getruntime   getnil
@jrubymethod name
public irubyobject finish   throws ioexception
if   finished
//io.finish();
finished   true
return realio
@jrubymethod name
public irubyobject close   throws ioexception
return null
@jrubymethod name
public irubyobject level
return getruntime   newfixnum level
@jrubymethod name      required   1
public irubyobject set_sync irubyobject ignored
return getruntime   getnil
@jrubyclass name    parent    include
public static class rubygzipreader extends rubygzipfile
@jrubyclass name    parent
public static class error
protected static final objectallocator gzipreader_allocator   new objectallocator
public irubyobject allocate ruby runtime  rubyclass klass
return new rubygzipreader runtime  klass
@jrubymethod name      rest   true  frame   true  meta   true
public static rubygzipreader newinstance irubyobject recv  irubyobject args  block block
rubyclass klass    rubyclass recv
rubygzipreader result    rubygzipreader klass allocate
result callinit args  block
return result
@jrubymethod name      required   1  frame   true  meta   true
public static irubyobject open final threadcontext context  irubyobject recv  irubyobject filename  block block  throws ioexception
ruby runtime   recv getruntime
irubyobject io   runtimehelpers invoke context  runtime getfile       filename  runtime newstring
rubygzipreader gzio   newinstance recv  new irubyobject io   block
return rubygzipfile wrapblock context  gzio  block
public rubygzipreader ruby runtime  rubyclass type
super runtime  type
private int line
private int position
private inputstream io
@jrubymethod name      required   1  frame   true  visibility   visibility private
public irubyobject initialize irubyobject io  block unusedblock
realio   io
try
this io   new gzipinputstream new ioinputstream io
catch  ioexception e
ruby runtime   io getruntime
rubyclass errorclass   runtime fastgetmodule    fastgetclass    fastgetclass
throw new raiseexception rubyexception newexception runtime  errorclass  e getmessage
line   1
position  0
return this
@jrubymethod name
public irubyobject rewind
this position  0
// should invoke seek on realio
realio callmethod getruntime   getcurrentcontext       getruntime   newfixnum 0
return getruntime   getnil
@jrubymethod name
public irubyobject lineno
return getruntime   newfixnum line
@jrubymethod name      writes   framefield lastline
public irubyobject readline threadcontext context  throws ioexception
irubyobject dst   gets context  new irubyobject
if  dst isnil
throw getruntime   neweoferror
return dst
public irubyobject internalgets irubyobject args  throws ioexception
bytelist sep     rubystring getruntime   getglobalvariables   get     getbytelist
if  args length > 0
sep   args converttostring   getbytelist
return internalsepgets sep
private irubyobject internalsepgets bytelist sep  throws ioexception
bytelist result   new bytelist
int ce   io read
while  ce     1    sep indexof ce      1
result append  byte ce
ce   io read
// io.available() only returns 0 after eof is encountered
// so we need to differentiate between the empty string and eof
if  0    result length       1    ce
return getruntime   getnil
line
this position  result length
result append sep
return rubystring newstring getruntime   result
@jrubymethod name      optional   1  writes   framefield lastline
public irubyobject gets threadcontext context  irubyobject args  throws ioexception
irubyobject result   internalgets args
if   result isnil
context getcurrentscope   setlastline result
return result
private final static int buff_size   4096
@jrubymethod name      optional   1
public irubyobject read irubyobject args  throws ioexception
if  args length    0    args isnil
bytelist val   new bytelist 10
byte buffer   new byte
int read   io read buffer
while  read     1
val append buffer 0 read
read   io read buffer
this position    val length
return rubystring newstring getruntime   val
int len   rubynumeric fix2int args
if  len < 0
throw getruntime   newargumenterror     len
else if  len > 0
byte buffer   new byte
int toread   len
int offset   0
int read   0
while  toread > 0
read   io read buffer offset toread
if  read     1
break
toread    read
offset    read
hmm
this position    buffer length
return rubystring newstring getruntime   new bytelist buffer 0 len toread false
return rubystring newemptystring getruntime
@jrubymethod name      required   1
public irubyobject set_lineno irubyobject linearg
line   rubynumeric fix2int linearg
return linearg
@jrubymethod name
public irubyobject pos
return rubyfixnum int2fix getruntime    position
@jrubymethod name
public irubyobject readchar   throws ioexception
int value   io read
if  value     1
throw getruntime   neweoferror
position
return getruntime   newfixnum value
@jrubymethod name
public irubyobject getc   throws ioexception
int value   io read
return value     1 ? getruntime   getnil     getruntime   newfixnum value
private boolean iseof   throws ioexception
return   gzipinputstream io  available      0
@override
@jrubymethod name
public irubyobject close   throws ioexception
if   closed
io close
this closed   true
return getruntime   getnil
@jrubymethod name
public irubyobject eof   throws ioexception
return iseof   ? getruntime   gettrue     getruntime   getfalse
@jrubymethod name
public irubyobject eof_p   throws ioexception
return eof
@jrubymethod name
public irubyobject unused
return getruntime   getnil
@jrubymethod name
public irubyobject tell
return getruntime   getnil
@jrubymethod name      optional   1  frame   true
public irubyobject each threadcontext context  irubyobject args  block block  throws ioexception
bytelist sep     rubystring getruntime   getglobalvariables   get     getbytelist
if  args length > 0     args isnil
sep   args converttostring   getbytelist
for  irubyobject result   internalsepgets sep    result isnil    result   internalsepgets sep
block yield context  result
return getruntime   getnil
@jrubymethod name      optional   1  frame   true
public irubyobject each_line threadcontext context  irubyobject args  block block  throws ioexception
return each context  args  block
@jrubymethod name      required   1
public irubyobject ungetc irubyobject arg
return getruntime   getnil
@jrubymethod name      optional   1
public irubyobject readlines irubyobject args  throws ioexception
list<irubyobject> array   new arraylist<irubyobject>
if  args length    0    args isnil
array add read new irubyobject
else
bytelist sep     rubystring getruntime   getglobalvariables   get     getbytelist
if  args length > 0
sep   args converttostring   getbytelist
for  irubyobject result   internalsepgets sep    result isnil    result   internalsepgets sep
array add result
return getruntime   newarray array
@jrubymethod name      frame   true
public irubyobject each_byte threadcontext context  block block  throws ioexception
int value   io read
while  value     1
block yield context  getruntime   newfixnum value
value   io read
return getruntime   getnil
@jrubyclass name    parent
public static class rubygzipwriter extends rubygzipfile
protected static final objectallocator gzipwriter_allocator   new objectallocator
public irubyobject allocate ruby runtime  rubyclass klass
return new rubygzipwriter runtime  klass
@jrubymethod name      rest   true  frame   true  meta   true
public static rubygzipwriter newgzipwriter irubyobject recv  irubyobject args  block block
rubyclass klass    rubyclass recv
rubygzipwriter result    rubygzipwriter klass allocate
result callinit args  block
return result
@jrubymethod name      required   1  optional   2  frame   true  meta   true
public static irubyobject open final threadcontext context  irubyobject recv  irubyobject args  block block  throws ioexception
ruby runtime   recv getruntime
irubyobject level   runtime getnil
irubyobject strategy   runtime getnil
if  args length > 1
level   args
if  args length > 2  strategy   args
irubyobject io   runtimehelpers invoke context  runtime getfile       args  runtime newstring
rubygzipwriter gzio   newgzipwriter recv  new irubyobject io  level  strategy   block
return rubygzipfile wrapblock context  gzio  block
public rubygzipwriter ruby runtime  rubyclass type
super runtime  type
public class headermodifyablegzipoutputstream extends deflateroutputstream
public headermodifyablegzipoutputstream outputstream outputstream  throws ioexception
super outputstream  new deflater deflater default_compression  true   default_buffer_size
@override
public synchronized void write byte bytes  int offset  int length  throws ioexception
writeheaderifneeded
super write bytes  offset  length
checksum update bytes  offset  length
@override
public void finish   throws ioexception
writeheaderifneeded
super finish
writetrailer
public void setmodifiedtime long newmodifiedtime
if   headeriswritten    modifiedtime   newmodifiedtime
public boolean headeriswritten
return headeriswritten
// called before any write to make sure the
// header is always written before the first bytes
private void writeheaderifneeded   throws ioexception
if  headeriswritten    false
writeheader
headeriswritten   true
private void writeheader   throws ioexception
//  see http://www.gzip.org/zlib/rfc-gzip.html
final byte header     gzip_magic_id_1  gzip_magic_id_2
compression_type_deflated
0     flags
byte   modifiedtime    byte  modifiedtime >> 8      4 bytes of modified time
byte   modifiedtime >> 16   byte  modifiedtime >> 24
0     extras flag
gzip_os_type_unknown
out write header
private void writetrailer   throws ioexception
final int originaldatasize   def gettotalin
final int checksumint    int  checksum getvalue
final byte trailer
byte   checksumint    byte  checksumint >> 8
byte   checksumint >> 16    byte  checksumint >> 24
byte   originaldatasize    byte  originaldatasize >> 8
byte   originaldatasize >> 16    byte  originaldatasize >> 24
out write trailer
private crc32   checksum          new crc32
private boolean headeriswritten   false
private long    modifiedtime      system currenttimemillis
private final static int  default_buffer_size         512
private final static byte compression_type_deflated    byte  8
private final static byte gzip_magic_id_1              byte  0x1f
private final static byte gzip_magic_id_2              byte  0x8b
private final static byte gzip_os_type_unknown         byte  255
private headermodifyablegzipoutputstream io
@jrubymethod name      required   1  rest   true  frame   true  visibility   visibility private
public irubyobject initialize2 irubyobject args  block unusedblock  throws ioexception
realio    rubyobject  args
io   new headermodifyablegzipoutputstream new iooutputstream realio  false  false
return this
@override
@jrubymethod name
public irubyobject close   throws ioexception
if   closed  io close
this closed   true
return getruntime   getnil
@jrubymethod name           required   1
public irubyobject append irubyobject p1  throws ioexception
this write p1
return this
@jrubymethod name      required   1  rest   true
public irubyobject printf threadcontext context  irubyobject args  throws ioexception
write rubykernel sprintf context  this  args
return context getruntime   getnil
@jrubymethod name      rest   true
public irubyobject print irubyobject args  throws ioexception
if  args length    0
for  int i   0  j   args length  i < j  i
write args
irubyobject sep   getruntime   getglobalvariables   get
if   sep isnil
write sep
return getruntime   getnil
@jrubymethod name
public irubyobject pos
return getruntime   getnil
@jrubymethod name      required   1
public irubyobject set_orig_name irubyobject str
this orig_name  str converttostring   tostring
return str
@jrubymethod name      required   1
public irubyobject set_comment irubyobject str
this comment  str converttostring   tostring
return str
@jrubymethod name      required   1
public irubyobject putc irubyobject p1  throws ioexception
io write rubynumeric fix2int p1
return p1
@jrubymethod name      rest   true
public irubyobject puts threadcontext context  irubyobject args  throws ioexception
rubystringio sio    rubystringio getruntime   fastgetclass    newinstance context  new irubyobject  block null_block
sio puts context  args
write sio string
return getruntime   getnil
public irubyobject finish   throws ioexception
if   finished  io finish
finished   true
return realio
@jrubymethod name      optional   1
public irubyobject flush irubyobject args  throws ioexception
if  args length    0    args isnil      rubynumeric fix2int args     0       zlib  no_flush
io flush
return getruntime   getnil
@jrubymethod name      required   1
public irubyobject set_mtime irubyobject arg
if  io headeriswritten
rubyclass errorclass   getruntime   fastgetmodule    fastgetclass    fastgetclass
throw new raiseexception rubyexception newexception getruntime    errorclass
if  arg instanceof rubytime
this mtime     rubytime  arg
else if arg isnil
// ...nothing
else
this mtime setdatetime new datetime  rubynumeric fix2long arg  1000
io setmodifiedtime  this mtime to_i   getlongvalue
return getruntime   getnil
@jrubymethod name
public irubyobject tell
return getruntime   getnil
@jrubymethod name      required   1
public irubyobject write irubyobject p1  throws ioexception
bytelist bytes   p1 asstring   getbytelist
io write bytes unsafebytes    bytes begin    bytes length
return getruntime   newfixnum bytes length
// utility method
static void resetbuffer bytelist l
l begin   0
l realsize   0
l invalidate