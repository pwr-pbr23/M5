package org jruby util
import java lang ref reference
import java lang ref referencequeue
/**
* a general purpose reference tracker & reaper utility class.
*/
public final class referencereaper
private final referencequeue referencequeue   new referencequeue
private final thread reaperthread
private referencereaper
reaperthread   new thread reaper
reaperthread setdaemon true
reaperthread start
private static final class singletonholder
private static final referencereaper instance   new referencereaper
public static final referencereaper getinstance
return singletonholder instance
public static abstract class weak<t> extends java lang ref weakreference<t> implements runnable
public weak t referent
super referent  referencereaper getinstance   referencequeue
public static abstract class soft<t> extends java lang ref softreference<t> implements runnable
public soft t referent
super referent  referencereaper getinstance   referencequeue
public static abstract class phantom<t> extends java lang ref phantomreference<t> implements runnable
public phantom t referent
super referent  referencereaper getinstance   referencequeue
private final runnable reaper   new runnable
public void run
for
try
reference r   referencequeue remove
if  r instanceof runnable
runnable  r  run
catch  interruptedexception ex
break
catch  throwable t
continue