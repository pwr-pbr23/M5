package org jruby ext ffi
import java util map
import java util concurrent concurrenthashmap
import org jruby ruby
import org jruby rubyclass
import org jruby rubymodule
import org jruby anno jrubyclass
import org jruby anno jrubymethod
import org jruby runtime objectallocator
import org jruby runtime threadcontext
import org jruby runtime builtin irubyobject
import org jruby util referencereaper
@jrubyclass name       autopointer autoptr_class_name  parent
public final class autopointer extends pointer
static final string autoptr_class_name
/** keep strong references to the reaper until cleanup */
private static final map<reaper  boolean> referenceset   new concurrenthashmap<reaper  boolean>
private pointer pointer
public static rubyclass createautopointerclass ruby runtime  rubymodule module
rubyclass result   module defineclassunder autoptr_class_name
module getclass
autopointerallocator instance
result defineannotatedmethods autopointer class
result defineannotatedconstants autopointer class
return result
private static final class autopointerallocator implements objectallocator
static final objectallocator instance   new autopointerallocator
public irubyobject allocate ruby runtime  rubyclass klazz
return new autopointer runtime  klazz
private autopointer ruby runtime  rubyclass klazz
super runtime  klazz  new nullmemoryio runtime
private static final void checkpointer ruby runtime  irubyobject ptr
if    ptr instanceof pointer
throw runtime newtypeerror ptr  runtime fastgetmodule    fastgetclass
if  ptr instanceof memorypointer    ptr instanceof autopointer
throw runtime newtypeerror
@override
@jrubymethod name
public final irubyobject initialize threadcontext context  irubyobject pointerarg
ruby runtime   context getruntime
checkpointer runtime  pointerarg
// if no release method is defined, then memory leaks will result.
if   getmetaclass   respondsto
throw runtime newruntimeerror
setmemoryio   pointer  pointerarg  getmemoryio
this pointer    pointer  pointerarg
referenceset put new reaper this  pointer  getmetaclass        boolean true
return this
@override
@jrubymethod name
public final irubyobject initialize threadcontext context  irubyobject pointerarg  irubyobject releaser
checkpointer context getruntime    pointerarg
setmemoryio   pointer  pointerarg  getmemoryio
this pointer    pointer  pointerarg
referenceset put new reaper this  pointer  releaser      boolean true
return this
private static final class reaper extends referencereaper phantom<autopointer> implements runnable
private final pointer pointer
private final irubyobject proc
private final string methodname
private reaper autopointer pointer  pointer ptr  irubyobject proc  string methodname
super pointer
this pointer   ptr
this proc   proc
this methodname   methodname
public void run
referenceset remove this
proc callmethod pointer getruntime   getcurrentcontext    methodname  pointer