/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component smpp
import java nio charset charset
import java util arraylist
import java util date
import java util list
import org apache camel exchange
import org apache camel message
import org jsmpp bean alphabet
import org jsmpp bean esmclass
import org jsmpp bean gsmspecificfeature
import org jsmpp bean generaldatacoding
import org jsmpp bean messageclass
import org jsmpp bean messagemode
import org jsmpp bean messagetype
import org jsmpp bean numberingplanindicator
import org jsmpp bean optionalparameter
import org jsmpp bean registereddelivery
import org jsmpp bean submitsm
import org jsmpp bean typeofnumber
import org jsmpp session smppsession
public class smppsubmitsmcommand extends smppsmcommand
public smppsubmitsmcommand smppsession session  smppconfiguration config
super session  config
@override
public void execute exchange exchange  throws smppexception
submitsm submitsms   createsubmitsm exchange
list<string> messageids   new arraylist<string> submitsms length
for  int i   0  i < submitsms length  i
submitsm submitsm   submitsms
string messageid
log debug    i  exchange getexchangeid
try
messageid   session submitshortmessage
submitsm getservicetype
typeofnumber valueof submitsm getsourceaddrton
numberingplanindicator valueof submitsm getsourceaddrnpi
submitsm getsourceaddr
typeofnumber valueof submitsm getdestaddrton
numberingplanindicator valueof submitsm getdestaddrnpi
submitsm getdestaddress
new esmclass submitsm getesmclass
submitsm getprotocolid
submitsm getpriorityflag
submitsm getscheduledeliverytime
submitsm getvalidityperiod
new registereddelivery submitsm getregistereddelivery
submitsm getreplaceifpresent
new generaldatacoding submitsm getdatacoding
byte  0
submitsm getshortmessage
submitsm getoptionalparametes
catch  exception e
throw new smppexception e
messageids add messageid
log debug
exchange getexchangeid    messageids
message message   getresponsemessage exchange
message setheader smppconstants id  messageids
message setheader smppconstants sent_message_count  messageids size
protected submitsm createsubmitsm exchange exchange
string body   exchange getin   getbody string class
byte providedalphabet   getprovidedalphabet exchange
alphabet determinedalphabet   determinealphabet exchange
charset charset   determinecharset providedalphabet  determinedalphabet value
byte shortmessage   body getbytes charset
submitsm template   createsubmitsmtemplate exchange
smppsplitter splitter   createsplitter exchange
byte segments   splitter split shortmessage
template setdatacoding new generaldatacoding false  true  messageclass class1  determinedalphabet  value
// multipart message
if  segments length > 1
template setesmclass new esmclass messagemode default  messagetype default  gsmspecificfeature udhi  value
submitsm submitsms   new submitsm
for  int i   0  i < segments length  i
submitsm submitsm   smpputils copysubmitsm template
submitsm setshortmessage segments
submitsms   submitsm
return submitsms
protected submitsm createsubmitsmtemplate exchange exchange
message in   exchange getin
submitsm submitsm   new submitsm
if  in getheaders   containskey smppconstants dest_addr
submitsm setdestaddress in getheader smppconstants dest_addr  string class
else
submitsm setdestaddress config getdestaddr
if  in getheaders   containskey smppconstants dest_addr_ton
submitsm setdestaddrton in getheader smppconstants dest_addr_ton  byte class
else
submitsm setdestaddrton config getdestaddrton
if  in getheaders   containskey smppconstants dest_addr_npi
submitsm setdestaddrnpi in getheader smppconstants dest_addr_npi  byte class
else
submitsm setdestaddrnpi config getdestaddrnpi
if  in getheaders   containskey smppconstants source_addr
submitsm setsourceaddr in getheader smppconstants source_addr  string class
else
submitsm setsourceaddr config getsourceaddr
if  in getheaders   containskey smppconstants source_addr_ton
submitsm setsourceaddrton in getheader smppconstants source_addr_ton  byte class
else
submitsm setsourceaddrton config getsourceaddrton
if  in getheaders   containskey smppconstants source_addr_npi
submitsm setsourceaddrnpi in getheader smppconstants source_addr_npi  byte class
else
submitsm setsourceaddrnpi config getsourceaddrnpi
if  in getheaders   containskey smppconstants service_type
submitsm setservicetype in getheader smppconstants service_type  string class
else
submitsm setservicetype config getservicetype
if  in getheaders   containskey smppconstants registered_delivery
submitsm setregistereddelivery in getheader smppconstants registered_delivery  byte class
else
submitsm setregistereddelivery config getregistereddelivery
if  in getheaders   containskey smppconstants protocol_id
submitsm setprotocolid in getheader smppconstants protocol_id  byte class
else
submitsm setprotocolid config getprotocolid
if  in getheaders   containskey smppconstants priority_flag
submitsm setpriorityflag in getheader smppconstants priority_flag  byte class
else
submitsm setpriorityflag config getpriorityflag
if  in getheaders   containskey smppconstants schedule_delivery_time
submitsm setscheduledeliverytime smpputils formattime in getheader smppconstants schedule_delivery_time  date class
if  in getheaders   containskey smppconstants validity_period
object validityperiod   in getheader smppconstants validity_period
if  validityperiod instanceof string
submitsm setvalidityperiod  string  validityperiod
else if  validityperiod instanceof date
submitsm setvalidityperiod smpputils formattime  date  validityperiod
if  in getheaders   containskey smppconstants replace_if_present_flag
submitsm setreplaceifpresent in getheader smppconstants replace_if_present_flag  byte class
else
submitsm setreplaceifpresent config getreplaceifpresentflag
submitsm setesmclass new esmclass   value
submitsm setoptionalparametes new optionalparameter
return submitsm