/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component apns factory
import java io filenotfoundexception
import java io inputstream
import javax net ssl sslcontext
import com notnoop apns apns
import com notnoop apns apnsdelegate
import com notnoop apns apnsservice
import com notnoop apns apnsservicebuilder
import com notnoop apns reconnectpolicy
import org apache camel camelcontext
import org apache camel camelcontextaware
import org apache camel component apns model connectionstrategy
import org apache camel component apns model reconnectionpolicy
import org apache camel component apns util assertutils
import org apache camel component apns util paramutils
import org apache camel component apns util resourceutils
import org apache camel util objecthelper
public class apnsservicefactory implements camelcontextaware
private static final int default_pool_size   10
private static final int min_pool_size   1
private static final int max_pool_size   30
private camelcontext camelcontext
private string certificatepath
private string certificatepassword
private connectionstrategy connectionstrategy
private reconnectionpolicy reconnectionpolicy
private sslcontext sslcontext
private int poolsize   default_pool_size
private string gatewayhost
private int gatewayport
private string feedbackhost
private int feedbackport
private apnsdelegate apnsdelegate
public apnsservicefactory
public apnsservicefactory camelcontext camelcontext
this camelcontext   camelcontext
public camelcontext getcamelcontext
return camelcontext
public void setcamelcontext camelcontext camelcontext
this camelcontext   camelcontext
public string getfeedbackhost
return feedbackhost
public void setfeedbackhost string feedbackhost
this feedbackhost   feedbackhost
public string getgatewayhost
return gatewayhost
public void setgatewayhost string gatewayhost
this gatewayhost   gatewayhost
public int getgatewayport
return gatewayport
public void setgatewayport int gatewayport
this gatewayport   gatewayport
public int getfeedbackport
return feedbackport
public void setfeedbackport int feedbackport
this feedbackport   feedbackport
public int getpoolsize
return poolsize
public void setpoolsize int poolsize
this poolsize   poolsize
public string getcertificatepath
return certificatepath
public void setcertificatepath string certificatepath
this certificatepath   certificatepath
public string getcertificatepassword
return certificatepassword
public void setcertificatepassword string certificatepassword
this certificatepassword   certificatepassword
public reconnectionpolicy getreconnectionpolicy
return reconnectionpolicy
public void setreconnectionpolicy reconnectionpolicy reconnectionpolicy
this reconnectionpolicy   reconnectionpolicy
public connectionstrategy getconnectionstrategy
return connectionstrategy
public void setconnectionstrategy connectionstrategy connectionstrategy
this connectionstrategy   connectionstrategy
public sslcontext getsslcontext
return sslcontext
public void setsslcontext sslcontext sslcontext
this sslcontext   sslcontext
public apnsdelegate getapnsdelegate
return apnsdelegate
public apnsservice getapnsservice
apnsservicebuilder builder   apns newservice
configureconnectionstrategy builder
configurereconnectionpolicy builder
configureapnsdelegate builder
configureapnsdestinations builder
try
configureapnscertificate builder
catch  filenotfoundexception e
throw objecthelper wrapruntimecamelexception e
apnsservice apnsservice   builder build
return apnsservice
private void configureapnscertificate apnsservicebuilder builder  throws filenotfoundexception
if  getsslcontext      null
builder withsslcontext getsslcontext
return
objecthelper notnull getcamelcontext
objecthelper notempty getcertificatepath
objecthelper notempty getcertificatepassword
inputstream certificateinputstream   null
try
certificateinputstream   camelcontext getclassresolver   loadresourceasstream getcertificatepath
if  certificateinputstream    null
throw new filenotfoundexception     getcertificatepath
builder withcert certificateinputstream  getcertificatepassword    withproductiondestination
finally
resourceutils close certificateinputstream
private void configureapnsdestinations apnsservicebuilder builder
paramutils checkdestination getgatewayhost    getgatewayport
paramutils checkdestination getfeedbackhost    getfeedbackport
if  objecthelper isnotempty getgatewayhost
builder withgatewaydestination getgatewayhost    getgatewayport
if  objecthelper isnotempty getfeedbackhost
builder withfeedbackdestination getfeedbackhost    getfeedbackport
private void configureapnsdelegate apnsservicebuilder builder
if  apnsdelegate    null
builder withdelegate apnsdelegate
private void configureconnectionstrategy apnsservicebuilder builder
if  getconnectionstrategy      connectionstrategy pool
assertutils istrue poolsize >  min_pool_size      min_pool_size
assertutils istrue poolsize <  max_pool_size      max_pool_size
if  getconnectionstrategy      null
return
switch  getconnectionstrategy
case non_blocking
builder asnonblocking
break
case queue
builder asqueued
break
case pool
builder aspool getpoolsize
break
default
break
private void configurereconnectionpolicy apnsservicebuilder builder
if  getreconnectionpolicy      null
return
switch  getreconnectionpolicy
case every_half_hour
builder withreconnectpolicy reconnectpolicy provided every_half_hour
break
case every_notification
builder withreconnectpolicy reconnectpolicy provided every_notification
break
default
builder withreconnectpolicy reconnectpolicy provided never
break