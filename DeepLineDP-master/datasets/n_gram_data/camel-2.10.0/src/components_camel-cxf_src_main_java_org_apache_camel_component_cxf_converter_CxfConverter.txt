/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel component cxf converter
import java io bytearrayoutputstream
import java io ioexception
import java io inputstream
import java util collection
import javax ws rs core response
import javax xml namespace qname
import javax xml soap soapexception
import javax xml soap soapmessage
import org apache camel converter
import org apache camel exchange
import org apache camel fallbackconverter
import org apache camel typeconverter
import org apache camel component cxf dataformat
import org apache camel converter stream cachedoutputstream
import org apache camel spi typeconverterregistry
import org apache camel util iohelper
import org apache cxf message messagecontentslist
/**
* the <a href="http://camel.apache.org/type-converter.html">type converters</a>
* for cxf related types' converting .
*
* @version
*/
@converter
public final class cxfconverter
private cxfconverter
// helper class
@converter
public static messagecontentslist tomessagecontentslist final object array
if  array    null
return new messagecontentslist array
else
return new messagecontentslist
@converter
public static qname toqname string qname
return qname valueof qname
@converter
public static object toarray object object
if  object instanceof collection
return   collection<?> object  toarray
else
object answer
if  object    null
answer   new object
else
answer   new object
answer   object
return answer
@converter
public static string soapmessagetostring final soapmessage soapmessage  exchange exchange  throws soapexception  ioexception
bytearrayoutputstream baos   new bytearrayoutputstream
soapmessage writeto baos
return baos tostring iohelper getcharsetname exchange
@converter
public static inputstream soapmessagetoinputstream final soapmessage soapmessage  exchange exchange  throws soapexception  ioexception
cachedoutputstream cos   new cachedoutputstream exchange
soapmessage writeto cos
inputstream in   cos getinputstream
return in
@converter
public static dataformat todataformat final string name
return dataformat valueof name touppercase
@converter
public static inputstream toinputstream response response  exchange exchange
object obj   response getentity
if  obj    null
return null
if  obj instanceof inputstream
// short circuit the lookup
return  inputstream obj
typeconverterregistry registry   exchange getcontext   gettypeconverterregistry
typeconverter tc   registry lookup inputstream class  obj getclass
if  tc    null
return tc convertto inputstream class  exchange  obj
return null
/**
* use a fallback type converter so we can convert the embedded list element
* if the value is messagecontentslist.  the algorithm of this converter
* finds the first non-null list element from the list and applies conversion
* to the list element.
*
* @param type the desired type to be converted to
* @param exchange optional exchange which can be null
* @param value the object to be converted
* @param registry type converter registry
* @return the converted value of the desired type or null if no suitable converter found
*/
@suppresswarnings
@fallbackconverter
public static <t> t convertto class<t> type  exchange exchange  object value
typeconverterregistry registry
// cxf-ws messagecontentslist class
if  messagecontentslist class isassignablefrom value getclass
messagecontentslist list    messagecontentslist value
for  object embedded   list
if  embedded    null
if  type isinstance embedded
return type cast embedded
else
typeconverter tc   registry lookup type  embedded getclass
if  tc    null
return tc convertto type  exchange  embedded
// return void to indicate its not possible to convert at this time
return  t  void type
// cxf-rs response class
if  response class isassignablefrom value getclass
response response    response  value
object entity   response getentity
typeconverter tc   registry lookup type  entity getclass
if  tc    null
return tc convertto type  exchange  entity
// return void to indicate its not possible to convert at this time
return  t  void type
return null