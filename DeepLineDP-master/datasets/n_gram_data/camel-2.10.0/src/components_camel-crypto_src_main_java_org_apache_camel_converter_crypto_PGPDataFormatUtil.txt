/**
* licensed to the apache software foundation (asf) under one or more
* contributor license agreements.  see the notice file distributed with
* this work for additional information regarding copyright ownership.
* the asf licenses this file to you under the apache license, version 2.0
* (the "license"); you may not use this file except in compliance with
* the license.  you may obtain a copy of the license at
*
*      http://www.apache.org/licenses/license-2.0
*
* unless required by applicable law or agreed to in writing, software
* distributed under the license is distributed on an "as is" basis,
* without warranties or conditions of any kind, either express or implied.
* see the license for the specific language governing permissions and
* limitations under the license.
*/
package org apache camel converter crypto
import java io bytearrayoutputstream
import java io ioexception
import java io inputstream
import java io outputstream
import java security nosuchproviderexception
import java util date
import java util iterator
import org apache camel camelcontext
import org apache camel util iohelper
import org apache camel util resourcehelper
import org bouncycastle openpgp pgpcompresseddatagenerator
import org bouncycastle openpgp pgpexception
import org bouncycastle openpgp pgpliteraldata
import org bouncycastle openpgp pgpliteraldatagenerator
import org bouncycastle openpgp pgpprivatekey
import org bouncycastle openpgp pgppublickey
import org bouncycastle openpgp pgppublickeyring
import org bouncycastle openpgp pgppublickeyringcollection
import org bouncycastle openpgp pgpsecretkey
import org bouncycastle openpgp pgpsecretkeyring
import org bouncycastle openpgp pgpsecretkeyringcollection
import org bouncycastle openpgp pgputil
public final class pgpdataformatutil
private pgpdataformatutil
public static pgppublickey findpublickey camelcontext context  string filename  string userid  throws ioexception  pgpexception
nosuchproviderexception
inputstream is   resourcehelper resolvemandatoryresourceasinputstream context getclassresolver    filename
pgppublickey privkey
try
privkey   findpublickey context  is  userid
finally
iohelper close is
return privkey
@suppresswarnings
public static pgppublickey findpublickey camelcontext context  inputstream input  string userid  throws ioexception  pgpexception
nosuchproviderexception
pgppublickeyringcollection pgpsec   new pgppublickeyringcollection pgputil getdecoderstream input
iterator<pgppublickeyring> keyringiter   pgpsec getkeyrings
while  keyringiter hasnext
pgppublickeyring keyring   keyringiter next
iterator<pgppublickey> keyiter   keyring getpublickeys
string keyuserid   null
while  keyiter hasnext
pgppublickey key   keyiter next
for  iterator<string> iterator   key getuserids    iterator hasnext
keyuserid   iterator next
if  key isencryptionkey      keyuserid    null    keyuserid contains userid
return key
return null
public static pgpprivatekey findprivatekey camelcontext context  string filename  string userid  string passphrase  throws ioexception
pgpexception  nosuchproviderexception
inputstream is   resourcehelper resolvemandatoryresourceasinputstream context getclassresolver    filename
pgpprivatekey privkey
try
privkey   findprivatekey context  is  userid  passphrase
finally
iohelper close is
return privkey
@suppresswarnings
public static pgpprivatekey findprivatekey camelcontext context  inputstream input  string userid  string passphrase  throws ioexception
pgpexception  nosuchproviderexception
pgpsecretkeyringcollection pgpsec   new pgpsecretkeyringcollection pgputil getdecoderstream input
iterator<pgpsecretkeyring> keyringiter   pgpsec getkeyrings
while  keyringiter hasnext
pgpsecretkeyring keyring   keyringiter next
iterator<pgpsecretkey> keyiter   keyring getsecretkeys
while  keyiter hasnext
pgpsecretkey key   keyiter next
for  iterator<string> iterator   key getuserids    iterator hasnext
string userid   iterator next
if  key issigningkey      userid contains userid
return key extractprivatekey passphrase tochararray
return null
public static byte compress byte cleardata  string filename  int algorithm  throws ioexception
bytearrayoutputstream bout   new bytearrayoutputstream
pgpcompresseddatagenerator comdata   new pgpcompresseddatagenerator algorithm
outputstream cos   comdata open bout      open it with the final destination
pgpliteraldatagenerator ldata   new pgpliteraldatagenerator
outputstream pout   ldata open cos     the compressed output stream
pgpliteraldata binary  filename       to store
cleardata length     length of clear data
new date      current time
try
pout write cleardata
finally
iohelper close pout
comdata close
return bout tobytearray